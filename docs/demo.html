<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>spek — OpenSpec Viewer Demo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400..800&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div id="root"></div>
    <script>window.__DEMO_DATA__ = {"overview":{"specsCount":28,"changesCount":{"active":1,"archived":33},"taskStats":{"total":369,"completed":368}},"specs":[{"topic":"api-adapter","path":"/home/kewang/git/spek/openspec/specs/api-adapter/spec.md"},{"topic":"change-browsing","path":"/home/kewang/git/spek/openspec/specs/change-browsing/spec.md"},{"topic":"core-module","path":"/home/kewang/git/spek/openspec/specs/core-module/spec.md"},{"topic":"dashboard-view","path":"/home/kewang/git/spek/openspec/specs/dashboard-view/spec.md"},{"topic":"filesystem-api","path":"/home/kewang/git/spek/openspec/specs/filesystem-api/spec.md"},{"topic":"frontend-design-skill","path":"/home/kewang/git/spek/openspec/specs/frontend-design-skill/spec.md"},{"topic":"git-timestamp-cache","path":"/home/kewang/git/spek/openspec/specs/git-timestamp-cache/spec.md"},{"topic":"graph-view","path":"/home/kewang/git/spek/openspec/specs/graph-view/spec.md"},{"topic":"live-reload","path":"/home/kewang/git/spek/openspec/specs/live-reload/spec.md"},{"topic":"markdown-renderer","path":"/home/kewang/git/spek/openspec/specs/markdown-renderer/spec.md"},{"topic":"openspec-api","path":"/home/kewang/git/spek/openspec/specs/openspec-api/spec.md"},{"topic":"openspec-scanner","path":"/home/kewang/git/spek/openspec/specs/openspec-scanner/spec.md"},{"topic":"repo-selection","path":"/home/kewang/git/spek/openspec/specs/repo-selection/spec.md"},{"topic":"responsive-layout","path":"/home/kewang/git/spek/openspec/specs/responsive-layout/spec.md"},{"topic":"search-api","path":"/home/kewang/git/spek/openspec/specs/search-api/spec.md"},{"topic":"search-ui","path":"/home/kewang/git/spek/openspec/specs/search-ui/spec.md"},{"topic":"shared-layout","path":"/home/kewang/git/spek/openspec/specs/shared-layout/spec.md"},{"topic":"sidebar-toggle","path":"/home/kewang/git/spek/openspec/specs/sidebar-toggle/spec.md"},{"topic":"spa-routing","path":"/home/kewang/git/spek/openspec/specs/spa-routing/spec.md"},{"topic":"spec-browsing","path":"/home/kewang/git/spek/openspec/specs/spec-browsing/spec.md"},{"topic":"spec-diff","path":"/home/kewang/git/spek/openspec/specs/spec-diff/spec.md"},{"topic":"spec-history","path":"/home/kewang/git/spek/openspec/specs/spec-history/spec.md"},{"topic":"task-parser","path":"/home/kewang/git/spek/openspec/specs/task-parser/spec.md"},{"topic":"theme-toggle","path":"/home/kewang/git/spek/openspec/specs/theme-toggle/spec.md"},{"topic":"vscode-cicd","path":"/home/kewang/git/spek/openspec/specs/vscode-cicd/spec.md"},{"topic":"vscode-extension-host","path":"/home/kewang/git/spek/openspec/specs/vscode-extension-host/spec.md"},{"topic":"vscode-marketplace-metadata","path":"/home/kewang/git/spek/openspec/specs/vscode-marketplace-metadata/spec.md"},{"topic":"webview-integration","path":"/home/kewang/git/spek/openspec/specs/webview-integration/spec.md"}],"specDetails":{"api-adapter":{"topic":"api-adapter","content":"## ADDED Requirements\r\n\r\n### Requirement: ApiAdapter interface\r\nThe frontend SHALL define an `ApiAdapter` interface that abstracts all API communication, allowing different implementations for web and VS Code environments. The interface SHALL include a `getSpecAtChange(topic: string, slug: string): Promise<{ content: string }>` method for fetching spec content at a specific change version.\r\n\r\n#### Scenario: Adapter interface contract\r\n- **WHEN** a component needs to fetch OpenSpec data\r\n- **THEN** it calls methods on the `ApiAdapter` interface (e.g., `getOverview()`, `getSpecs()`, `getChange(slug)`, `getSpecAtChange(topic, slug)`) which return Promises of typed data\r\n\r\n### Requirement: FetchAdapter for web\r\nThe web version SHALL use a `FetchAdapter` that calls the Express REST API via HTTP fetch.\r\n\r\n#### Scenario: Fetch adapter API call\r\n- **WHEN** `FetchAdapter.getOverview()` is called with repoPath set\r\n- **THEN** it performs `fetch('/api/openspec/overview?dir=...')` and returns the parsed JSON response\r\n\r\n#### Scenario: Fetch adapter error handling\r\n- **WHEN** a fetch request returns a non-OK HTTP status\r\n- **THEN** the adapter throws an error with the HTTP status code\r\n\r\n#### Scenario: Fetch adapter getSpecAtChange\r\n- **WHEN** `FetchAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it performs `fetch('/api/openspec/specs/user-auth/at/2026-01-15-add-oauth?dir=...')` and returns the parsed JSON response\r\n\r\n### Requirement: MessageAdapter for VS Code Webview\r\nThe VS Code version SHALL use a `MessageAdapter` that communicates with the extension host via `postMessage`.\r\n\r\n#### Scenario: Message adapter API call\r\n- **WHEN** `MessageAdapter.getOverview()` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getOverview' }` via `postMessage` and returns a Promise that resolves when the matching response arrives\r\n\r\n#### Scenario: Message adapter timeout\r\n- **WHEN** a message request does not receive a response within 10 seconds\r\n- **THEN** the adapter rejects the Promise with a timeout error\r\n\r\n#### Scenario: Message adapter error response\r\n- **WHEN** the extension host responds with `{ type: 'response', id, error: '...' }`\r\n- **THEN** the adapter rejects the Promise with the error message\r\n\r\n#### Scenario: Message adapter getSpecAtChange\r\n- **WHEN** `MessageAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getSpecAtChange', params: { topic: 'user-auth', slug: '2026-01-15-add-oauth' } }` via `postMessage`\r\n\r\n### Requirement: Adapter injection via React Context\r\nThe adapter SHALL be provided to the React component tree via a Context provider, allowing hooks to use the appropriate adapter without knowing the environment.\r\n\r\n#### Scenario: Web app initialization\r\n- **WHEN** the web app mounts\r\n- **THEN** it wraps the component tree with an `ApiAdapterProvider` using `FetchAdapter`\r\n\r\n#### Scenario: Webview app initialization\r\n- **WHEN** the React app mounts inside a VS Code Webview\r\n- **THEN** it wraps the component tree with an `ApiAdapterProvider` using `MessageAdapter`\r\n\r\n#### Scenario: Hook usage\r\n- **WHEN** a hook like `useOverview()` needs to fetch data\r\n- **THEN** it obtains the adapter from `useApiAdapter()` context and calls `adapter.getOverview()`\r\n\r\n### Requirement: StaticAdapter for demo\r\nThe demo version SHALL use a `StaticAdapter` that reads all data from a pre-embedded JSON object (`window.__DEMO_DATA__`) and implements the `ApiAdapter` interface. The `DemoData` structure SHALL include a `specVersions` field mapping topic to slug to content.\r\n\r\n#### Scenario: Serve pre-embedded data\r\n- **WHEN** any API method is called (getOverview, getSpecs, getSpec, getChanges, getChange)\r\n- **THEN** it returns the corresponding data from the embedded JSON via `Promise.resolve()`\r\n\r\n#### Scenario: Client-side search\r\n- **WHEN** `search(query)` is called\r\n- **THEN** it performs case-insensitive substring matching across all spec topic names, spec content, change slugs, and change proposal/design content, returning matching results with context snippets\r\n\r\n#### Scenario: Search matches spec topic names\r\n- **WHEN** `search(\"dashboard\")` is called and a spec with topic `dashboard-view` exists\r\n- **THEN** the result includes `dashboard-view` as a match\r\n\r\n#### Scenario: No-op for inapplicable methods\r\n- **WHEN** `browse()`, `detect()`, or `resync()` is called\r\n- **THEN** it returns sensible defaults without error (empty browse, `hasOpenSpec: true`, void)\r\n\r\n#### Scenario: StaticAdapter getSpecAtChange\r\n- **WHEN** `StaticAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it reads from `window.__DEMO_DATA__.specVersions[\"user-auth\"][\"2026-01-15-add-oauth\"]` and returns `{ content: \"...\" }`\r\n\r\n#### Scenario: StaticAdapter getSpecAtChange not found\r\n- **WHEN** `StaticAdapter.getSpecAtChange(\"user-auth\", \"nonexistent\")` is called\r\n- **AND** no matching version exists in the embedded data\r\n- **THEN** it rejects with an error\r\n","relatedChanges":["2026-02-13-vscode-extension","2026-02-16-ui-design-polish-p0-p1","2026-02-17-spec-diff-viewer"],"history":[{"slug":"2026-02-17-spec-diff-viewer","date":"2026-02-17","timestamp":"2026-02-17T12:25:28+08:00","description":"spec diff viewer","status":"archived"},{"slug":"2026-02-16-ui-design-polish-p0-p1","date":"2026-02-16","timestamp":"2026-02-16T01:41:38+08:00","description":"ui design polish p0 p1","status":"archived"},{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived"}]},"change-browsing":{"topic":"change-browsing","content":"## ADDED Requirements\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Active changes SHALL be visually distinguished with a left accent color border (4px). Changes SHALL be sorted by git timestamp descending (most recent first), falling back to slug date when timestamp is unavailable. Each change SHALL display a relative time indicator (e.g., \"3 hours ago\", \"2 days ago\") when a git timestamp is available, with the full ISO timestamp shown as a tooltip on hover. When no git timestamp is available, the system SHALL fall back to displaying the slug date in YYYY-MM-DD format.\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with a left accent color border, name, and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by timestamp descending, without accent border\r\n\r\n#### Scenario: Display relative time for changes with timestamp\r\n- **WHEN** a change has a git timestamp\r\n- **THEN** the change displays a relative time (e.g., \"2 days ago\") instead of YYYY-MM-DD\r\n- **AND** hovering shows the full ISO timestamp as a tooltip\r\n\r\n#### Scenario: Display date for changes without timestamp\r\n- **WHEN** a change has no git timestamp\r\n- **THEN** the change displays the slug date in YYYY-MM-DD format\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs in OpenSpec workflow order: Proposal, Design, Specs (delta specs), and Tasks. Tab content SHALL transition with a fade-in animation when switching. The change title (including back navigation link) and tab navigation bar SHALL be sticky-positioned below the main header, remaining visible when the user scrolls through long content.\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed with a fade-in transition\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics, with a fade-in transition\r\n\r\n#### Scenario: Tab order\r\n- **WHEN** the ChangeDetail page is rendered\r\n- **THEN** the tabs are displayed in order: Proposal, Design, Specs, Tasks (matching the OpenSpec workflow sequence)\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n#### Scenario: Sticky header on scroll\r\n- **WHEN** user scrolls down through long change content\r\n- **THEN** the change title (with back link) and tab navigation bar SHALL remain fixed below the main application header\r\n- **AND** the sticky area SHALL have an opaque background that covers scrolling content beneath it\r\n\r\n#### Scenario: Sticky does not overlap main header\r\n- **WHEN** the sticky area is active\r\n- **THEN** it SHALL be positioned directly below the main header (top offset equal to header height) with a z-index lower than the main header and sidebar\r\n\r\n### Requirement: Task progress display in change detail\r\nThe Tasks tab SHALL display a progress bar and statistics (completed/total) derived from the change's task data.\r\n\r\n#### Scenario: Show task progress\r\n- **WHEN** viewing the Tasks tab of a change with tasks\r\n- **THEN** a TaskProgress component shows a visual progress bar with \"X / Y completed\" text\r\n\r\n### Requirement: Capability ID linking in proposal\r\nThe system SHALL render inline code elements in proposal markdown as navigable links when the code text matches an existing spec topic name.\r\n\r\n#### Scenario: Capability ID matches existing spec\r\n- **WHEN** a proposal markdown contains an inline code element (e.g., `` `responsive-layout` ``)\r\n- **AND** a spec with the topic name `responsive-layout` exists\r\n- **THEN** the inline code SHALL be rendered as a clickable link navigating to `/specs/responsive-layout`\r\n\r\n#### Scenario: Inline code does not match any spec\r\n- **WHEN** a proposal markdown contains an inline code element that does not match any existing spec topic\r\n- **THEN** the inline code SHALL be rendered as a normal styled code element without a link\r\n\r\n#### Scenario: MarkdownRenderer receives spec topics list\r\n- **WHEN** MarkdownRenderer is used with a `specTopics` prop containing the list of available spec topic names\r\n- **THEN** inline code matching any topic in the list SHALL be rendered as navigable links\r\n\r\n### Requirement: Custom task checkbox styling\r\nThe system SHALL render task items in the Tasks tab using custom SVG icons instead of text-based `[x]`/`[ ]` markers. Completed tasks SHALL display a filled checkmark icon in green, and incomplete tasks SHALL display an empty circle icon. Completed task text SHALL have reduced opacity (0.6) in addition to the existing strikethrough styling.\r\n\r\n#### Scenario: Incomplete task display\r\n- **WHEN** a task item is not completed\r\n- **THEN** the task displays an empty circle SVG icon followed by the task text at full opacity\r\n\r\n#### Scenario: Completed task display\r\n- **WHEN** a task item is completed\r\n- **THEN** the task displays a green checkmark SVG icon followed by the task text with strikethrough and reduced opacity (0.6)\r\n","relatedChanges":["2026-02-13-fix-task-stats-and-capability-nav","2026-02-13-phase2-core-ui-pages","2026-02-16-ui-design-polish-p2","2026-02-21-add-change-timestamp","2026-02-21-sticky-change-detail-header"],"history":[{"slug":"2026-02-21-add-change-timestamp","date":"2026-02-21","timestamp":"2026-02-21T22:27:55+08:00","description":"add change timestamp","status":"archived"},{"slug":"2026-02-21-sticky-change-detail-header","date":"2026-02-21","timestamp":"2026-02-21T21:45:54+08:00","description":"sticky change detail header","status":"archived"},{"slug":"2026-02-16-ui-design-polish-p2","date":"2026-02-16","timestamp":"2026-02-16T02:14:36+08:00","description":"ui design polish p2","status":"archived"},{"slug":"2026-02-13-fix-task-stats-and-capability-nav","date":"2026-02-13","timestamp":"2026-02-13T18:53:25+08:00","description":"fix task stats and capability nav","status":"archived"},{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived"}]},"core-module":{"topic":"core-module","content":"## ADDED Requirements\r\n\r\n### Requirement: Standalone core package\r\nThe core module SHALL be an independent npm package (`@spek/core`) with no framework dependencies, usable by both the web server and the VS Code extension host.\r\n\r\n#### Scenario: Import from web server\r\n- **WHEN** the Express server imports `@spek/core`\r\n- **THEN** it can call scanner and task parser functions directly without additional adapters\r\n\r\n#### Scenario: Import from extension host\r\n- **WHEN** the VS Code extension host imports `@spek/core`\r\n- **THEN** it can call scanner and task parser functions directly without additional adapters\r\n\r\n### Requirement: Scanner functions\r\nThe core module SHALL export scanner functions that accept a base path and return structured OpenSpec data.\r\n\r\n#### Scenario: Scan overview\r\n- **WHEN** `scanOverview(basePath)` is called with a valid repo path\r\n- **THEN** it returns `{ specsCount, changesCount: { active, archived }, taskStats: { total, completed } }`\r\n\r\n#### Scenario: List specs\r\n- **WHEN** `listSpecs(basePath)` is called\r\n- **THEN** it returns an array of `{ topic, path }` for each spec directory\r\n\r\n#### Scenario: Read single spec\r\n- **WHEN** `readSpec(basePath, topic)` is called with an existing topic\r\n- **THEN** it returns `{ topic, content, relatedChanges, history }`\r\n\r\n#### Scenario: List changes\r\n- **WHEN** `listChanges(basePath)` is called\r\n- **THEN** it returns `{ active: ChangeInfo[], archived: ChangeInfo[] }`\r\n\r\n#### Scenario: Read single change\r\n- **WHEN** `readChange(basePath, slug)` is called with an existing change slug\r\n- **THEN** it returns `{ slug, proposal, design, tasks, specs, metadata }`\r\n\r\n#### Scenario: Search content\r\n- **WHEN** `searchContent(basePath, query)` is called\r\n- **THEN** it returns matching results across specs and changes with context snippets\r\n\r\n### Requirement: Task parser functions\r\nThe core module SHALL export task parsing functions that operate on raw Markdown content strings.\r\n\r\n#### Scenario: Parse tasks from content\r\n- **WHEN** `parseTasks(content)` is called with Markdown containing `- [x]` and `- [ ]` checkboxes\r\n- **THEN** it returns `{ total, completed, sections }` with tasks grouped by `##` headings\r\n\r\n### Requirement: Shared type definitions\r\nThe core module SHALL export all TypeScript type definitions used by both the web app and the extension.\r\n\r\n#### Scenario: Type imports\r\n- **WHEN** the web app or extension imports types from `@spek/core`\r\n- **THEN** types such as `OverviewData`, `SpecInfo`, `SpecDetail`, `ChangeInfo`, `ChangeDetail`, `ParsedTasks`, `SearchResult` are available\r\n","relatedChanges":["2026-02-13-vscode-extension"],"history":[{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived"}]},"dashboard-view":{"topic":"dashboard-view","content":"## ADDED Requirements\r\n\r\n### Requirement: Overview statistics display\r\nThe system SHALL display overview statistics from the overview API: total specs count, active changes count, archived changes count, and task completion rate (percentage). Statistics SHALL be displayed in stat cards with large numbers (text-4xl) and a staggered fade-in-up entry animation on page load.\r\n\r\n#### Scenario: Display statistics\r\n- **WHEN** user navigates to the Dashboard page\r\n- **THEN** system displays specs count, active changes count, archived changes count, and overall task completion percentage in stat cards with large accent-colored numbers\r\n\r\n#### Scenario: Staggered entry animation\r\n- **WHEN** the Dashboard page loads\r\n- **THEN** the four stat cards appear with a fade-in-up animation, each card delayed by an incremental amount (e.g., 0ms, 80ms, 160ms, 240ms) creating a staggered reveal effect\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** user has `prefers-reduced-motion: reduce` enabled\r\n- **THEN** stat cards appear immediately without animation\r\n\r\n### Requirement: Active changes list\r\nThe system SHALL display a list of active changes with their names and task progress indicators.\r\n\r\n#### Scenario: Show active changes with progress\r\n- **WHEN** there are active changes in the repo\r\n- **THEN** each active change is displayed with its name and a TaskProgress bar showing completed/total tasks\r\n\r\n#### Scenario: No active changes\r\n- **WHEN** there are no active changes\r\n- **THEN** system displays an empty state message\r\n\r\n### Requirement: Recent archived changes\r\nThe system SHALL display the most recent 10 archived changes. Each change SHALL display a relative time indicator (e.g., \"3 hours ago\", \"2 days ago\") when a git timestamp is available, with the full ISO timestamp shown as a tooltip on hover. When no git timestamp is available, the system SHALL fall back to displaying the slug date in YYYY-MM-DD format.\r\n\r\n#### Scenario: Show archived changes with timestamp\r\n- **WHEN** user views the Dashboard and archived changes have git timestamps\r\n- **THEN** the most recent 10 archived changes are listed with their names and relative time (e.g., \"3 hours ago\")\r\n- **AND** hovering over the time shows the full ISO timestamp as a tooltip\r\n\r\n#### Scenario: Show archived changes without timestamp\r\n- **WHEN** user views the Dashboard and archived changes have no git timestamp\r\n- **THEN** the changes are listed with their names and slug date in YYYY-MM-DD format\r\n\r\n### Requirement: Navigation cards\r\nThe system SHALL provide navigation cards/links to the Specs list and Changes list pages.\r\n\r\n#### Scenario: Navigate to specs\r\n- **WHEN** user clicks the Specs navigation card\r\n- **THEN** system navigates to `/specs`\r\n\r\n#### Scenario: Navigate to changes\r\n- **WHEN** user clicks the Changes navigation card\r\n- **THEN** system navigates to `/changes`\r\n","relatedChanges":["2026-02-13-phase2-core-ui-pages","2026-02-16-ui-design-polish-p0-p1","2026-02-21-add-change-timestamp"],"history":[{"slug":"2026-02-21-add-change-timestamp","date":"2026-02-21","timestamp":"2026-02-21T22:27:55+08:00","description":"add change timestamp","status":"archived"},{"slug":"2026-02-16-ui-design-polish-p0-p1","date":"2026-02-16","timestamp":"2026-02-16T01:41:38+08:00","description":"ui design polish p0 p1","status":"archived"},{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived"}]},"filesystem-api":{"topic":"filesystem-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Browse directories\r\nThe system SHALL provide an API endpoint `GET /api/fs/browse` that returns directory contents for a given path, allowing users to navigate the filesystem to find repos.\r\n\r\n#### Scenario: Browse valid directory\r\n- **WHEN** client sends `GET /api/fs/browse?path=/home/user/projects`\r\n- **THEN** system returns a JSON array of entries, each with `name`, `type` (\"file\" or \"directory\"), and `path`\r\n- **AND** entries are sorted with directories first, then alphabetically\r\n\r\n#### Scenario: Browse without path parameter\r\n- **WHEN** client sends `GET /api/fs/browse` without a `path` parameter\r\n- **THEN** system returns the contents of the user's home directory\r\n\r\n#### Scenario: Browse non-existent directory\r\n- **WHEN** client sends `GET /api/fs/browse?path=/nonexistent`\r\n- **THEN** system returns HTTP 400 with an error message\r\n\r\n### Requirement: Detect OpenSpec directory\r\nThe system SHALL provide an API endpoint `GET /api/fs/detect` that checks whether a given path contains a valid OpenSpec directory. Detection SHALL first check for `openspec/config.yaml`. If `config.yaml` does not exist, the system SHALL fallback to checking whether `openspec/specs/` or `openspec/changes/` directory exists.\r\n\r\n#### Scenario: Path contains valid OpenSpec directory with config.yaml\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"<schema-value>\" }`\r\n\r\n#### Scenario: Path contains OpenSpec directory without config.yaml\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` does not exist\r\n- **AND** `/home/user/my-repo/openspec/specs/` or `/home/user/my-repo/openspec/changes/` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"unknown\" }`\r\n\r\n#### Scenario: Path does not contain OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/empty-repo`\r\n- **AND** no `openspec/` directory exists at that path, or `openspec/` exists but contains neither `specs/` nor `changes/`\r\n- **THEN** system returns `{ \"hasOpenSpec\": false }`\r\n\r\n### Requirement: Path traversal protection\r\nThe system SHALL reject any path that attempts directory traversal outside the specified root.\r\n\r\n#### Scenario: Path traversal attempt\r\n- **WHEN** client sends `GET /api/fs/browse?path=/home/user/../../../etc`\r\n- **THEN** system resolves the path and returns the directory contents of the resolved absolute path without exposing system files outside normal filesystem permissions\r\n","relatedChanges":["2026-02-13-phase1-skeleton-and-api","2026-02-21-fix-detect-fallback"],"history":[{"slug":"2026-02-21-fix-detect-fallback","date":"2026-02-21","timestamp":"2026-02-21T22:27:55+08:00","description":"fix detect fallback","status":"archived"},{"slug":"2026-02-13-phase1-skeleton-and-api","date":"2026-02-13","timestamp":"2026-02-13T17:37:45+08:00","description":"phase1 skeleton and api","status":"archived"}]},"frontend-design-skill":{"topic":"frontend-design-skill","content":"### Requirement: Skill 目錄結構\r\n\r\nfrontend-design skill SHALL 存放於 `.agents/skills/frontend-design/` 目錄下，包含 `SKILL.md` 和 `LICENSE.txt` 兩個檔案。\r\n\r\n#### Scenario: Skill 檔案存在\r\n\r\n- **WHEN** 檢查 `.agents/skills/frontend-design/` 目錄\r\n- **THEN** 目錄中 SHALL 包含 `SKILL.md` 和 `LICENSE.txt`\r\n\r\n### Requirement: Claude Code Skill 註冊\r\n\r\n`.claude/skills/frontend-design` SHALL 為一個 symlink，指向 `../../.agents/skills/frontend-design`，使 Claude Code 能自動偵測並載入此 skill。\r\n\r\n#### Scenario: Symlink 正確指向\r\n\r\n- **WHEN** Claude Code 掃描 `.claude/skills/` 目錄\r\n- **THEN** `frontend-design` symlink SHALL 解析至 `.agents/skills/frontend-design/`\r\n\r\n### Requirement: SKILL.md 包含設計指引\r\n\r\n`SKILL.md` SHALL 包含 frontmatter（name、description、license）以及設計指引內容，涵蓋 Design Thinking 流程和 Frontend Aesthetics Guidelines。\r\n\r\n#### Scenario: Skill 被觸發時提供指引\r\n\r\n- **WHEN** 使用者要求建立網頁元件、頁面、dashboard 或美化 web UI\r\n- **THEN** Claude Code SHALL 載入 SKILL.md 中的設計指引，引導產出高品質前端介面\r\n","relatedChanges":["2026-02-15-add-frontend-design-skill"],"history":[{"slug":"2026-02-15-add-frontend-design-skill","date":"2026-02-15","timestamp":"2026-02-15T23:40:22+08:00","description":"add frontend design skill","status":"archived"}]},"git-timestamp-cache":{"topic":"git-timestamp-cache","content":"## ADDED Requirements\r\n\r\n### Requirement: Build timestamp cache from git log\r\nThe system SHALL provide a function that executes a single `git log` command scoped to `openspec/changes/` and parses the output to build a Map of change slug to earliest commit timestamp (ISO 8601 format).\r\n\r\n#### Scenario: Build cache for repo with git history\r\n- **WHEN** the cache builder is invoked for a repo directory that is a git repository\r\n- **THEN** the system executes `git log --format=\"COMMIT %aI\" --name-only -- openspec/changes/` in the repo directory\r\n- **AND** parses the output to extract the earliest commit timestamp for each change slug\r\n- **AND** returns a `Map<string, string>` mapping slug to ISO 8601 timestamp\r\n\r\n#### Scenario: Build cache for non-git directory\r\n- **WHEN** the cache builder is invoked for a directory that is not a git repository\r\n- **THEN** the system returns an empty Map without throwing an error\r\n\r\n#### Scenario: Change exists in filesystem but not in git\r\n- **WHEN** a change directory exists but has no git commits (e.g., uncommitted new change)\r\n- **THEN** that change slug is not present in the returned Map\r\n\r\n### Requirement: In-memory cache keyed by repo path\r\nThe system SHALL maintain an in-memory cache (`Map<string, Map<string, string>>`) keyed by absolute repo directory path, storing the timestamp Map for each repo.\r\n\r\n#### Scenario: Cache hit\r\n- **WHEN** a timestamp lookup is requested for a repo that has been previously cached\r\n- **THEN** the system returns the cached Map without executing any git commands\r\n\r\n#### Scenario: Cache miss with lazy build\r\n- **WHEN** a timestamp lookup is requested for a repo that has not been cached\r\n- **THEN** the system automatically builds the cache by executing the git log command\r\n- **AND** stores the result for subsequent lookups\r\n\r\n### Requirement: Resync cache\r\nThe system SHALL provide a resync function that clears the cached timestamps for a given repo and immediately rebuilds the cache from git.\r\n\r\n#### Scenario: Resync after repo changes\r\n- **WHEN** the resync function is invoked for a repo directory\r\n- **THEN** the system clears the existing cache entry for that repo\r\n- **AND** rebuilds the cache by executing the git log command\r\n- **AND** returns the newly built timestamp Map\r\n","relatedChanges":["2026-02-13-spec-history-git-timestamp-cache"],"history":[{"slug":"2026-02-13-spec-history-git-timestamp-cache","date":"2026-02-13","timestamp":"2026-02-13T19:19:25+08:00","description":"spec history git timestamp cache","status":"archived"}]},"graph-view":{"topic":"graph-view","content":"## Requirements\r\n\r\n### Requirement: Graph page route\r\nThe system SHALL provide a `/graph` route that renders the Graph View page within the shared Layout. The page SHALL be accessible from all three modes (Web, VS Code Webview, Demo).\r\n\r\n#### Scenario: Navigate to graph page\r\n- **WHEN** user navigates to `/graph`\r\n- **THEN** the Graph View page is rendered within the Layout with sidebar and header visible\r\n\r\n#### Scenario: Graph page in demo mode\r\n- **WHEN** the demo build is loaded\r\n- **AND** user navigates to `/graph`\r\n- **THEN** the Graph View page renders using static graph data from `window.__DEMO_DATA__`\r\n\r\n### Requirement: Graph data fetching\r\nThe system SHALL fetch graph data (nodes and edges) from the API adapter when the Graph View page loads. While loading, the page SHALL display a loading indicator. If the fetch fails, an error message SHALL be displayed.\r\n\r\n#### Scenario: Successful data load\r\n- **WHEN** the Graph View page mounts\r\n- **THEN** the system calls `getGraphData()` on the API adapter\r\n- **AND** renders the force-directed graph with the returned nodes and edges\r\n\r\n#### Scenario: Loading state\r\n- **WHEN** graph data is being fetched\r\n- **THEN** a loading indicator is displayed in the graph container\r\n\r\n#### Scenario: Error state\r\n- **WHEN** graph data fetch fails\r\n- **THEN** an error message is displayed with the failure reason\r\n\r\n### Requirement: Force-directed graph layout\r\nThe system SHALL render an interactive force-directed graph using D3 force simulation. Spec nodes and change nodes SHALL be positioned by the simulation with forces: center force, link force (connecting edges), many-body repulsion force, and collision force to prevent overlap.\r\n\r\n#### Scenario: Initial layout\r\n- **WHEN** graph data is loaded with specs and changes\r\n- **THEN** a force-directed simulation positions all nodes within the SVG viewport\r\n- **AND** the simulation runs until convergence (alpha < 0.001)\r\n\r\n#### Scenario: Empty graph\r\n- **WHEN** graph data contains no nodes with edges (no changes have specs)\r\n- **THEN** the page displays a message indicating no relationships to visualize\r\n\r\n### Requirement: Node visual encoding\r\nThe system SHALL render spec nodes as circles and change nodes as rounded rectangles. Spec node radius SHALL scale with `historyCount` (minimum 20px, maximum 45px). Change node size SHALL scale with `specCount` (number of specs modified). Spec nodes SHALL use the accent color (amber). Change nodes SHALL use green for active status and blue-gray for archived status.\r\n\r\n#### Scenario: Spec node sizing\r\n- **WHEN** a spec has `historyCount` of 5 (highest in the dataset)\r\n- **THEN** its circle radius is at or near the maximum (45px)\r\n\r\n#### Scenario: Spec node with no history\r\n- **WHEN** a spec has `historyCount` of 0\r\n- **THEN** its circle radius is at the minimum (20px)\r\n\r\n#### Scenario: Change node coloring\r\n- **WHEN** a change has `status: \"active\"`\r\n- **THEN** its rectangle uses a green color scheme\r\n- **WHEN** a change has `status: \"archived\"`\r\n- **THEN** its rectangle uses a blue-gray color scheme\r\n\r\n### Requirement: Node labels\r\nThe system SHALL display text labels next to each node. Spec labels SHALL show the topic name. Change labels SHALL show the description (derived from slug). Labels longer than 25 characters SHALL be truncated with ellipsis.\r\n\r\n#### Scenario: Spec label display\r\n- **WHEN** a spec node with topic \"markdown-renderer\" is rendered\r\n- **THEN** a text label \"markdown-renderer\" is displayed adjacent to the node\r\n\r\n#### Scenario: Long change label truncation\r\n- **WHEN** a change with description \"phase3 markdown and search improvements\" is rendered\r\n- **THEN** the label is truncated to 25 characters with \"...\" appended\r\n\r\n### Requirement: Edge rendering\r\nThe system SHALL render edges as lines connecting change nodes to the spec nodes they modified. Edges SHALL use a muted color by default. When a node is hovered, its connected edges SHALL be highlighted.\r\n\r\n#### Scenario: Edge display\r\n- **WHEN** change \"phase3-markdown-and-search\" modified specs \"markdown-renderer\" and \"search-ui\"\r\n- **THEN** two edges are drawn from the change node to each respective spec node\r\n\r\n### Requirement: Drag interaction\r\nThe system SHALL support dragging nodes to reposition them. During drag, the dragged node's position SHALL be fixed. After releasing, the node SHALL remain at its dragged position until the simulation is restarted.\r\n\r\n#### Scenario: Drag a node\r\n- **WHEN** user clicks and drags a spec node\r\n- **THEN** the node follows the cursor\r\n- **AND** connected edges update in real-time\r\n- **AND** the force simulation reheats to adjust surrounding nodes\r\n\r\n### Requirement: Hover highlight interaction\r\nThe system SHALL highlight a node and its connected neighbors when the user hovers over it. All non-connected nodes and edges SHALL reduce opacity to 0.1. The hovered node, its neighbors, and their connecting edges SHALL remain at full opacity.\r\n\r\n#### Scenario: Hover on spec node\r\n- **WHEN** user hovers over spec node \"markdown-renderer\"\r\n- **THEN** the \"markdown-renderer\" node, all change nodes connected to it, and their edges are highlighted at full opacity\r\n- **AND** all other nodes and edges reduce to 0.1 opacity\r\n\r\n#### Scenario: Hover off\r\n- **WHEN** user moves the cursor away from all nodes\r\n- **THEN** all nodes and edges return to full opacity\r\n\r\n### Requirement: Click navigation\r\nThe system SHALL navigate to the detail page when a node is clicked (without dragging). Clicking a spec node SHALL navigate to `/specs/:topic`. Clicking a change node SHALL navigate to `/changes/:slug`.\r\n\r\n#### Scenario: Click spec node\r\n- **WHEN** user clicks (without dragging) on spec node \"api-adapter\"\r\n- **THEN** the app navigates to `/specs/api-adapter`\r\n\r\n#### Scenario: Click change node\r\n- **WHEN** user clicks (without dragging) on change node \"2026-02-13-initial-implementation\"\r\n- **THEN** the app navigates to `/changes/2026-02-13-initial-implementation`\r\n\r\n### Requirement: Zoom and pan\r\nThe system SHALL support zooming (scroll wheel or pinch) and panning (click-and-drag on empty space) of the graph viewport. Zoom SHALL be constrained between 0.3x and 3x. The graph SHALL initially be centered and scaled to fit all nodes within the viewport.\r\n\r\n#### Scenario: Zoom in\r\n- **WHEN** user scrolls up (or pinch-zooms in) on the graph\r\n- **THEN** the graph zooms in, up to a maximum of 3x\r\n\r\n#### Scenario: Zoom out\r\n- **WHEN** user scrolls down (or pinch-zooms out) on the graph\r\n- **THEN** the graph zooms out, down to a minimum of 0.3x\r\n\r\n#### Scenario: Pan\r\n- **WHEN** user clicks and drags on empty space (not on a node)\r\n- **THEN** the entire graph viewport pans in the drag direction\r\n\r\n#### Scenario: Initial fit\r\n- **WHEN** the graph first renders\r\n- **THEN** the viewport is scaled and centered to show all nodes within the visible area\r\n\r\n### Requirement: Graph legend\r\nThe system SHALL display a legend overlay in a corner of the graph container, showing the meaning of node shapes and colors: amber circle = Spec, green rectangle = Active Change, blue-gray rectangle = Archived Change.\r\n\r\n#### Scenario: Legend display\r\n- **WHEN** the graph is rendered\r\n- **THEN** a legend is visible showing node type indicators with labels\r\n","relatedChanges":["2026-02-17-spec-graph-view"],"history":[{"slug":"2026-02-17-spec-graph-view","date":"2026-02-17","timestamp":"2026-02-17T23:49:54+08:00","description":"spec graph view","status":"archived"}]},"live-reload":{"topic":"live-reload","content":"### Requirement: File change detection for Web version\r\nThe Web server SHALL monitor the `openspec/` directory for file changes using `chokidar` and push notifications to connected clients via Server-Sent Events (SSE).\r\n\r\n#### Scenario: SSE endpoint connection\r\n- **WHEN** a client connects to `GET /api/openspec/watch?dir=<repoPath>`\r\n- **THEN** the server opens an SSE stream and begins monitoring `<repoPath>/openspec/` for `.md` and `.yaml` file changes\r\n\r\n#### Scenario: File change notification\r\n- **WHEN** a `.md` or `.yaml` file inside `openspec/` is created, modified, or deleted\r\n- **THEN** the server sends an SSE event `data: {\"type\":\"changed\"}` to all connected clients for that directory, debounced at 500ms\r\n\r\n#### Scenario: Client disconnect cleanup\r\n- **WHEN** a client disconnects from the SSE endpoint\r\n- **THEN** the server removes the client from the notification list and cleans up the watcher if no other clients are connected for that directory\r\n\r\n#### Scenario: Shared watcher per directory\r\n- **WHEN** multiple clients connect to the same `dir` parameter\r\n- **THEN** the server SHALL reuse the same chokidar watcher instance for that directory\r\n\r\n### Requirement: File change detection for VS Code version\r\nThe VS Code extension SHALL monitor the workspace's `openspec/` directory for file changes and notify the webview.\r\n\r\n#### Scenario: FileSystemWatcher setup\r\n- **WHEN** the spek Webview Panel is created\r\n- **THEN** the extension host creates a `vscode.workspace.createFileSystemWatcher` for `openspec/**` to detect all changes including directory moves\r\n\r\n#### Scenario: File change notification to webview\r\n- **WHEN** a file or directory matching the watcher pattern is created, modified, deleted, or moved\r\n- **THEN** the extension host sends `{ type: \"fileChanged\" }` to the webview via `postMessage`, debounced at 500ms\r\n\r\n#### Scenario: Watcher cleanup\r\n- **WHEN** the spek Webview Panel is disposed\r\n- **THEN** the FileSystemWatcher SHALL be disposed along with other panel resources\r\n\r\n### Requirement: RefreshContext for frontend refresh coordination\r\nThe frontend SHALL provide a `RefreshContext` that coordinates data refresh across all hooks when file changes are detected.\r\n\r\n#### Scenario: RefreshContext provides refreshKey\r\n- **WHEN** a component or hook calls `useRefreshKey()`\r\n- **THEN** it receives the current `refreshKey` number value from the context\r\n\r\n#### Scenario: Refresh triggered by file change\r\n- **WHEN** `refresh()` from `RefreshContext` is called\r\n- **THEN** the `refreshKey` counter increments, causing all `useAsyncData` hooks to re-fetch their data\r\n\r\n### Requirement: useFileWatcher hook\r\nThe frontend SHALL provide a `useFileWatcher` hook that connects to the appropriate file change event source based on the runtime environment.\r\n\r\n#### Scenario: Web environment with SSE\r\n- **WHEN** `useFileWatcher` is active in the Web environment\r\n- **THEN** it opens an `EventSource` connection to `/api/openspec/watch?dir=<repoPath>` and calls `refresh()` on each received event\r\n\r\n#### Scenario: VS Code environment with postMessage\r\n- **WHEN** `useFileWatcher` is active in the VS Code webview environment\r\n- **THEN** it listens for `message` events with `type === \"fileChanged\"` and calls `refresh()` on each received event\r\n\r\n#### Scenario: Demo environment no-op\r\n- **WHEN** `useFileWatcher` is active in the Demo environment\r\n- **THEN** it does nothing (no event source to connect to)\r\n\r\n#### Scenario: Cleanup on unmount\r\n- **WHEN** the component using `useFileWatcher` unmounts\r\n- **THEN** the EventSource connection or message listener SHALL be cleaned up\r\n\r\n### Requirement: Debounced re-fetch in useAsyncData\r\nThe `useAsyncData` hook SHALL support automatic re-fetch triggered by `refreshKey` changes with debounce to avoid excessive requests.\r\n\r\n#### Scenario: Re-fetch on refreshKey change\r\n- **WHEN** `refreshKey` changes in the `RefreshContext`\r\n- **THEN** `useAsyncData` triggers a new fetch after a 300ms debounce delay\r\n\r\n#### Scenario: Debounce coalesces rapid changes\r\n- **WHEN** `refreshKey` changes multiple times within 300ms\r\n- **THEN** only one re-fetch is triggered after the last change\r\n\r\n#### Scenario: Existing data preserved during re-fetch\r\n- **WHEN** a re-fetch is triggered by `refreshKey` change\r\n- **THEN** the existing `data` SHALL remain visible (no loading flash) until the new data arrives\r\n\r\n#### Scenario: Refresh failure with existing data\r\n- **WHEN** a re-fetch triggered by `refreshKey` change fails with an error\r\n- **AND** the hook already has existing data from a previous successful fetch\r\n- **THEN** the existing `data` SHALL be preserved\r\n- **AND** the `error` state SHALL NOT be set (remains null)\r\n\r\n#### Scenario: Refresh failure without existing data\r\n- **WHEN** a re-fetch triggered by `refreshKey` change fails with an error\r\n- **AND** the hook has no existing data (data is null)\r\n- **THEN** the `error` state SHALL be set to the error message\r\n","relatedChanges":["2026-02-18-fix-vscode-live-reload-directory-moves","2026-02-18-live-reload","2026-02-22-fix-change-not-found-on-refresh"],"history":[{"slug":"2026-02-22-fix-change-not-found-on-refresh","date":"2026-02-22","timestamp":"2026-02-22T01:49:43+08:00","description":"fix change not found on refresh","status":"archived"},{"slug":"2026-02-18-fix-vscode-live-reload-directory-moves","date":"2026-02-18","timestamp":"2026-02-18T20:15:33+08:00","description":"fix vscode live reload directory moves","status":"archived"},{"slug":"2026-02-18-live-reload","date":"2026-02-18","timestamp":"2026-02-18T19:51:09+08:00","description":"live reload","status":"archived"}]},"markdown-renderer":{"topic":"markdown-renderer","content":"### Requirement: Markdown content rendering\r\nThe system SHALL render Markdown content using react-markdown with remark-gfm plugin, supporting GFM features including tables, strikethrough, and task lists.\r\n\r\n#### Scenario: Standard Markdown rendering\r\n- **WHEN** MarkdownRenderer receives a string containing standard Markdown (headings, lists, bold, italic, links, code blocks)\r\n- **THEN** the content is rendered as formatted HTML with appropriate styling\r\n\r\n#### Scenario: GFM table rendering\r\n- **WHEN** MarkdownRenderer receives content containing a GFM pipe table\r\n- **THEN** the table is rendered as a styled HTML table with header row and data rows\r\n\r\n#### Scenario: GFM checkbox rendering\r\n- **WHEN** MarkdownRenderer receives content containing `- [x]` or `- [ ]` items\r\n- **THEN** the items are rendered as visual checkboxes (read-only)\r\n\r\n### Requirement: BDD keyword highlighting\r\nThe system SHALL visually highlight BDD keywords in rendered Markdown content to improve readability of spec documents.\r\n\r\n#### Scenario: WHEN/GIVEN keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `WHEN` or `GIVEN` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a blue background label style (blue text on blue-tinted background)\r\n\r\n#### Scenario: THEN keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `THEN` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a green background label style (green text on green-tinted background)\r\n\r\n#### Scenario: AND keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `AND` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a gray background label style (gray text on gray-tinted background)\r\n\r\n#### Scenario: MUST/SHALL keyword highlighting\r\n- **WHEN** rendered Markdown contains `MUST` or `SHALL` as standalone uppercase keywords\r\n- **THEN** the keywords are displayed in red bold text\r\n\r\n#### Scenario: ADDED/MODIFIED badge rendering\r\n- **WHEN** rendered Markdown contains `ADDED` or `MODIFIED` as standalone uppercase keywords\r\n- **THEN** `ADDED` is displayed as an orange badge and `MODIFIED` is displayed as a blue badge\r\n\r\n#### Scenario: Keywords inside code blocks are not highlighted\r\n- **WHEN** BDD keywords appear inside inline code or fenced code blocks\r\n- **THEN** the keywords are NOT highlighted and remain as plain code text\r\n\r\n#### Scenario: Case-sensitive matching\r\n- **WHEN** text contains lowercase or mixed-case variations like \"when\", \"Then\", \"must\"\r\n- **THEN** the keywords are NOT highlighted (only exact uppercase matches trigger highlighting)\r\n\r\n### Requirement: Dark theme styling\r\nThe system SHALL apply dark theme styles consistent with the application's design system (background #0a0c0f series, amber accent, text #e2e8f0).\r\n\r\n#### Scenario: Code block styling\r\n- **WHEN** MarkdownRenderer renders a fenced code block\r\n- **THEN** the code block uses a dark background with monospace font and appropriate padding\r\n\r\n#### Scenario: Link styling\r\n- **WHEN** MarkdownRenderer renders a hyperlink\r\n- **THEN** the link is displayed in accent color (amber) with hover effect\r\n\r\n#### Scenario: Heading styling\r\n- **WHEN** MarkdownRenderer renders headings (h1-h6)\r\n- **THEN** headings use appropriate font sizes and weights consistent with the dark theme\r\n","relatedChanges":["2026-02-13-phase3-markdown-and-search"],"history":[{"slug":"2026-02-13-phase3-markdown-and-search","date":"2026-02-13","timestamp":"2026-02-13T18:16:15+08:00","description":"phase3 markdown and search","status":"archived"}]},"openspec-api":{"topic":"openspec-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Overview endpoint\r\nThe system SHALL provide `GET /api/openspec/overview` that returns aggregate statistics for an OpenSpec repository.\r\n\r\n#### Scenario: Get overview of repo with specs and changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `specsCount`, `changesCount` (with `active` and `archived` breakdown), and `taskStats` (aggregate `total` and `completed` across all changes, including both active and archived)\r\n\r\n#### Scenario: Get overview with only archived changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** there are no active changes but archived changes have tasks\r\n- **THEN** system returns `taskStats` with correct `total` and `completed` counts from archived changes\r\n\r\n#### Scenario: Get overview of repo with no specs\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** the repo has no `openspec/specs/` directory\r\n- **THEN** system returns `specsCount: 0` with changes still counted correctly\r\n\r\n### Requirement: List specs\r\nThe system SHALL provide `GET /api/openspec/specs` that returns all spec topics.\r\n\r\n#### Scenario: List all specs\r\n- **WHEN** client sends `GET /api/openspec/specs?dir=/path/to/repo`\r\n- **THEN** system returns a JSON array of spec topics, each with `topic` name and `path`\r\n- **AND** topics are sorted alphabetically\r\n\r\n#### Scenario: No specs directory\r\n- **WHEN** client sends `GET /api/openspec/specs?dir=/path/to/repo`\r\n- **AND** `openspec/specs/` does not exist\r\n- **THEN** system returns an empty array\r\n\r\n### Requirement: Get single spec\r\nThe system SHALL provide `GET /api/openspec/specs/:topic` that returns the full content of a spec.\r\n\r\n#### Scenario: Get existing spec\r\n- **WHEN** client sends `GET /api/openspec/specs/simulation-engine?dir=/path/to/repo`\r\n- **AND** `openspec/specs/simulation-engine/spec.md` exists\r\n- **THEN** system returns JSON with `topic`, `content` (raw Markdown), and `relatedChanges` (list of changes that have delta specs for this topic)\r\n\r\n#### Scenario: Get non-existent spec\r\n- **WHEN** client sends `GET /api/openspec/specs/nonexistent?dir=/path/to/repo`\r\n- **THEN** system returns HTTP 404\r\n\r\n### Requirement: List changes\r\nThe system SHALL provide `GET /api/openspec/changes` that returns all changes grouped by status.\r\n\r\n#### Scenario: List changes with active and archived\r\n- **WHEN** client sends `GET /api/openspec/changes?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `active` array and `archived` array\r\n- **AND** each change includes `slug`, `date` (parsed from slug prefix), `description` (parsed from slug), `hasProposal`, `hasDesign`, `hasTasks`, `hasSpecs`, and `taskStats`\r\n- **AND** changes are sorted by date descending (newest first)\r\n\r\n### Requirement: Get single change\r\nThe system SHALL provide `GET /api/openspec/changes/:slug` that returns full change content.\r\n\r\n#### Scenario: Get existing change with all artifacts\r\n- **WHEN** client sends `GET /api/openspec/changes/2026-02-10-my-feature?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `slug`, `proposal` (Markdown content or null), `design` (Markdown content or null), `tasks` (parsed task structure or null), `specs` (array of delta spec contents), and `metadata` (from `.openspec.yaml` if present)\r\n\r\n#### Scenario: Get non-existent change\r\n- **WHEN** client sends `GET /api/openspec/changes/nonexistent?dir=/path/to/repo`\r\n- **THEN** system returns HTTP 404\r\n\r\n### Requirement: Missing dir parameter\r\nThe system SHALL require the `dir` query parameter on all openspec endpoints.\r\n\r\n#### Scenario: Request without dir parameter\r\n- **WHEN** client sends any `/api/openspec/*` request without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Resync cache endpoint\r\nThe system SHALL provide `POST /api/openspec/resync` that clears and rebuilds the git timestamp cache for a given repo.\r\n\r\n#### Scenario: Successful resync\r\n- **WHEN** client sends `POST /api/openspec/resync?dir=/path/to/repo`\r\n- **THEN** the system clears the timestamp cache for that repo\r\n- **AND** rebuilds the cache from git history\r\n- **AND** returns HTTP 200 with `{ ok: true }`\r\n\r\n#### Scenario: Resync without dir parameter\r\n- **WHEN** client sends `POST /api/openspec/resync` without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Resync UI control\r\nThe system SHALL display a resync button in the sidebar that triggers a cache rebuild. The button MUST show a loading state while the resync is in progress.\r\n\r\n#### Scenario: User triggers resync\r\n- **WHEN** the user clicks the resync button in the sidebar\r\n- **THEN** the system sends `POST /api/openspec/resync` with the current repo path\r\n- **AND** the button shows a loading/spinning state during the request\r\n- **AND** on success, the current page data is refreshed to reflect updated ordering\r\n\r\n#### Scenario: Resync with no repo selected\r\n- **WHEN** no repo is currently selected\r\n- **THEN** the resync button is not displayed or is disabled\r\n\r\n### Requirement: Graph data endpoint\r\nThe system SHALL provide `GET /api/openspec/graph` that returns the relationship graph between specs and changes. The response SHALL contain `nodes` (array of spec and change nodes) and `edges` (array of change-to-spec connections). Only changes that have at least one delta spec SHALL be included as nodes.\r\n\r\n#### Scenario: Get graph data\r\n- **WHEN** client sends `GET /api/openspec/graph?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `nodes` and `edges` arrays\r\n- **AND** each spec node has `id` (prefixed \"spec:\"), `type: \"spec\"`, `label` (topic name), and `historyCount`\r\n- **AND** each change node has `id` (prefixed \"change:\"), `type: \"change\"`, `label` (description), `date`, `status`, and `specCount`\r\n- **AND** each edge has `source` (change node id) and `target` (spec node id)\r\n\r\n#### Scenario: Graph with no spec-bearing changes\r\n- **WHEN** client sends `GET /api/openspec/graph?dir=/path/to/repo`\r\n- **AND** no changes have a `specs/` directory\r\n- **THEN** system returns `nodes` containing only spec nodes with no edges\r\n\r\n#### Scenario: Graph without dir parameter\r\n- **WHEN** client sends `GET /api/openspec/graph` without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Graph data in ApiAdapter\r\nThe system SHALL extend the `ApiAdapter` interface with a `getGraphData()` method. `FetchAdapter` SHALL call `GET /api/openspec/graph`. `MessageAdapter` SHALL use `postMessage` with type `\"getGraphData\"`. `StaticAdapter` SHALL read from `window.__DEMO_DATA__.graphData`.\r\n\r\n#### Scenario: FetchAdapter graph data\r\n- **WHEN** `FetchAdapter.getGraphData()` is called\r\n- **THEN** it sends `GET /api/openspec/graph?dir=...` and returns the parsed JSON response\r\n\r\n#### Scenario: StaticAdapter graph data\r\n- **WHEN** `StaticAdapter.getGraphData()` is called\r\n- **THEN** it returns `window.__DEMO_DATA__.graphData`\r\n\r\n#### Scenario: MessageAdapter graph data\r\n- **WHEN** `MessageAdapter.getGraphData()` is called\r\n- **THEN** it sends a postMessage with `{ type: \"getGraphData\" }` to the VS Code extension host\r\n- **AND** returns the response data\r\n\r\n### Requirement: Core graph data builder\r\nThe system SHALL provide a `buildGraphData(repoDir)` function in `@spek/core` that scans the openspec directory and returns structured graph data. The function SHALL reuse the existing scan logic to identify which changes contain delta specs for which topics.\r\n\r\n#### Scenario: Build graph data from repo\r\n- **WHEN** `buildGraphData(\"/path/to/repo\")` is called\r\n- **AND** the repo has 3 specs and 2 changes, where change A modifies spec 1 and spec 2, and change B modifies spec 2 and spec 3\r\n- **THEN** the function returns 5 nodes (3 specs + 2 changes) and 4 edges\r\n","relatedChanges":["2026-02-13-fix-task-stats-and-capability-nav","2026-02-13-phase1-skeleton-and-api","2026-02-13-spec-history-git-timestamp-cache","2026-02-17-spec-graph-view"],"history":[{"slug":"2026-02-17-spec-graph-view","date":"2026-02-17","timestamp":"2026-02-17T23:49:54+08:00","description":"spec graph view","status":"archived"},{"slug":"2026-02-13-spec-history-git-timestamp-cache","date":"2026-02-13","timestamp":"2026-02-13T19:19:25+08:00","description":"spec history git timestamp cache","status":"archived"},{"slug":"2026-02-13-fix-task-stats-and-capability-nav","date":"2026-02-13","timestamp":"2026-02-13T18:53:25+08:00","description":"fix task stats and capability nav","status":"archived"},{"slug":"2026-02-13-phase1-skeleton-and-api","date":"2026-02-13","timestamp":"2026-02-13T17:37:45+08:00","description":"phase1 skeleton and api","status":"archived"}]},"openspec-scanner":{"topic":"openspec-scanner","content":"## ADDED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL be an async function in the `@spek/core` package that reads an OpenSpec directory and returns its complete structure including specs, active changes, and archived changes. Each `ChangeInfo` SHALL include a `timestamp` field (ISO 8601 string or null) obtained from the git timestamp cache. Changes SHALL be sorted by timestamp descending (most recent first), falling back to slug date when timestamp is unavailable. It SHALL use Node.js `fs` directly and have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n- **AND** each `ChangeInfo` in `activeChanges` and `archivedChanges` SHALL include a `timestamp` field from the git timestamp cache\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n#### Scenario: Sort changes by timestamp\r\n- **WHEN** multiple changes exist with the same slug date (e.g., `2026-02-17-foo` and `2026-02-17-bar`)\r\n- **THEN** changes SHALL be sorted by git timestamp descending (most recent first)\r\n\r\n#### Scenario: Sort changes without git timestamps\r\n- **WHEN** the repo is not a git repository or changes have no git history\r\n- **THEN** changes SHALL be sorted by slug date descending as fallback\r\n- **AND** all `timestamp` fields SHALL be null\r\n\r\n### Requirement: Parse change artifacts\r\nThe scanner SHALL read individual change directories and extract available artifacts.\r\n\r\n#### Scenario: Change with all artifacts\r\n- **WHEN** scanner reads a change directory containing proposal.md, design.md, tasks.md, and specs/\r\n- **THEN** it returns the raw Markdown content for each artifact and a list of delta spec files\r\n\r\n#### Scenario: Change with partial artifacts\r\n- **WHEN** scanner reads a change directory containing only proposal.md\r\n- **THEN** it returns proposal content and null for missing artifacts\r\n\r\n### Requirement: Read spec content\r\nThe scanner SHALL read spec files and return their Markdown content.\r\n\r\n#### Scenario: Read existing spec\r\n- **WHEN** scanner reads `openspec/specs/{topic}/spec.md`\r\n- **THEN** it returns the raw Markdown content of the spec file\r\n\r\n### Requirement: Detect related changes for a spec\r\nThe scanner SHALL identify which changes contain delta specs for a given spec topic.\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** scanner checks for changes related to spec topic \"simulation-engine\"\r\n- **THEN** it returns all change slugs that have a `specs/simulation-engine/spec.md` delta file\r\n","relatedChanges":["2026-02-13-phase1-skeleton-and-api","2026-02-13-vscode-extension","2026-02-21-add-change-timestamp"],"history":[{"slug":"2026-02-21-add-change-timestamp","date":"2026-02-21","timestamp":"2026-02-21T22:27:55+08:00","description":"add change timestamp","status":"archived"},{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived"},{"slug":"2026-02-13-phase1-skeleton-and-api","date":"2026-02-13","timestamp":"2026-02-13T17:37:45+08:00","description":"phase1 skeleton and api","status":"archived"}]},"repo-selection":{"topic":"repo-selection","content":"## ADDED Requirements\r\n\r\n### Requirement: Path input with auto-detection\r\nThe system SHALL provide a text input for entering a filesystem path. Upon input, the system SHALL call the detect API to check for an `openspec/` directory and display the detection result.\r\n\r\n#### Scenario: Valid path with openspec directory\r\n- **WHEN** user enters a path that contains an `openspec/` directory\r\n- **THEN** system displays a success indicator and a button to open the repo\r\n\r\n#### Scenario: Valid path without openspec directory\r\n- **WHEN** user enters a path that does not contain an `openspec/` directory\r\n- **THEN** system displays a warning message indicating no openspec directory found\r\n\r\n#### Scenario: Invalid path\r\n- **WHEN** user enters a path that does not exist\r\n- **THEN** system displays an error message\r\n\r\n### Requirement: Directory browsing\r\nThe system SHALL provide a directory browser that calls the browse API, allowing users to navigate the filesystem and select a repo path.\r\n\r\n#### Scenario: Browse directories\r\n- **WHEN** user clicks the browse button\r\n- **THEN** system displays a list of directories at the current path\r\n- **AND** user can click a directory to navigate into it\r\n- **AND** user can select the current directory as the repo path\r\n\r\n### Requirement: Recent paths persistence\r\nThe system SHALL persist the most recent 5 repo paths in localStorage. On page load, previously used paths SHALL be displayed for quick selection. Each recent path SHALL be validated asynchronously against the detect API to show its current status (valid, invalid, or checking).\r\n\r\n#### Scenario: Save path on successful detection\r\n- **WHEN** user successfully opens a repo (path with valid openspec/)\r\n- **THEN** the path is saved to localStorage recent paths list (max 5, most recent first)\r\n\r\n#### Scenario: Display recent paths on load\r\n- **WHEN** user visits the SelectRepo page\r\n- **THEN** previously saved paths are displayed as clickable options\r\n\r\n#### Scenario: Validate recent paths asynchronously\r\n- **WHEN** the SelectRepo page loads with saved recent paths\r\n- **THEN** the system calls the detect API for each path in parallel\r\n- **AND** each path displays a status indicator: spinner (checking), green checkmark (valid openspec/ found), or red indicator (path invalid or no openspec/)\r\n\r\n#### Scenario: Remove invalid path\r\n- **WHEN** a recent path is determined to be invalid\r\n- **THEN** a delete button appears next to the path allowing the user to remove it from the list\r\n\r\n### Requirement: Auto-navigate to dashboard\r\nThe system SHALL automatically navigate to the Dashboard page after the user selects a valid repo path.\r\n\r\n#### Scenario: Navigate after selection\r\n- **WHEN** user selects a valid repo path (via input, browse, or recent paths)\r\n- **THEN** system navigates to `/dashboard` with the repo path set in RepoContext\r\n","relatedChanges":["2026-02-13-phase2-core-ui-pages","2026-02-13-phase4-polish-and-enhancement"],"history":[{"slug":"2026-02-13-phase4-polish-and-enhancement","date":"2026-02-13","timestamp":"2026-02-13T18:36:04+08:00","description":"phase4 polish and enhancement","status":"archived"},{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived"}]},"responsive-layout":{"topic":"responsive-layout","content":"## ADDED Requirements\r\n\r\n### Requirement: Mobile breakpoint detection\r\nThe system SHALL detect whether the viewport width is below 768px and adapt the layout accordingly. The detection MUST use `window.matchMedia` and respond to runtime viewport changes (e.g., device rotation).\r\n\r\n#### Scenario: Viewport below 768px\r\n- **WHEN** the viewport width is less than 768px\r\n- **THEN** the sidebar is hidden by default and a hamburger menu button appears in the header\r\n\r\n#### Scenario: Viewport at or above 768px\r\n- **WHEN** the viewport width is 768px or greater\r\n- **THEN** the sidebar is displayed in its fixed position and the hamburger menu button is hidden\r\n\r\n#### Scenario: Viewport resize crossing breakpoint\r\n- **WHEN** the viewport is resized from below 768px to at or above 768px\r\n- **THEN** the sidebar transitions to fixed display and the hamburger menu button is hidden\r\n\r\n### Requirement: Mobile sidebar overlay\r\nThe system SHALL display the sidebar as a full-height overlay with a backdrop when opened on viewports below 768px.\r\n\r\n#### Scenario: Open mobile sidebar\r\n- **WHEN** the user taps the hamburger menu button on a mobile viewport\r\n- **THEN** the sidebar slides in from the left as an overlay with a semi-transparent backdrop behind it\r\n\r\n#### Scenario: Close mobile sidebar via backdrop\r\n- **WHEN** the mobile sidebar overlay is open and the user taps the backdrop area\r\n- **THEN** the sidebar closes and the backdrop disappears\r\n\r\n#### Scenario: Close mobile sidebar via navigation\r\n- **WHEN** the mobile sidebar overlay is open and the user taps a navigation link\r\n- **THEN** the system navigates to the selected route and the sidebar closes automatically\r\n\r\n### Requirement: Responsive content grids\r\nThe system SHALL adapt grid layouts for different viewport sizes. Dashboard stat cards MUST use 2 columns on mobile and 4 columns on desktop. Navigation cards MUST stack vertically on mobile.\r\n\r\n#### Scenario: Dashboard stat cards on mobile\r\n- **WHEN** the Dashboard page is rendered on a viewport below 768px\r\n- **THEN** the stat cards are displayed in a 2-column grid\r\n\r\n#### Scenario: Dashboard stat cards on desktop\r\n- **WHEN** the Dashboard page is rendered on a viewport at or above 768px\r\n- **THEN** the stat cards are displayed in a 4-column grid\r\n\r\n### Requirement: Responsive header\r\nThe system SHALL adapt the header layout for mobile viewports. The repo path display MUST be hidden on mobile to save space. The search button MUST remain accessible.\r\n\r\n#### Scenario: Header on mobile\r\n- **WHEN** the header is rendered on a viewport below 768px\r\n- **THEN** the hamburger button is shown on the left, the search button is centered, and the repo path is hidden\r\n\r\n#### Scenario: Header on desktop\r\n- **WHEN** the header is rendered on a viewport at or above 768px\r\n- **THEN** the layout shows the spek brand on the left, search button centered, and repo path on the right\r\n","relatedChanges":["2026-02-13-phase4-polish-and-enhancement"],"history":[{"slug":"2026-02-13-phase4-polish-and-enhancement","date":"2026-02-13","timestamp":"2026-02-13T18:36:04+08:00","description":"phase4 polish and enhancement","status":"archived"}]},"search-api":{"topic":"search-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Full-text search endpoint\r\nThe system SHALL provide `GET /api/openspec/search` that searches across all specs and changes content.\r\n\r\n#### Scenario: Search with matching results\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo&q=effectiveCurrent`\r\n- **THEN** system returns a JSON array of results, each with `type` (\"spec\" or \"change\"), `name` (topic or slug), `matches` (array of matching text with context), and `score`\r\n- **AND** results are sorted by relevance score (best match first)\r\n\r\n#### Scenario: Search with no results\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo&q=xyznonexistent`\r\n- **THEN** system returns an empty array\r\n\r\n#### Scenario: Search without query parameter\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo` without `q` parameter\r\n- **THEN** system returns HTTP 400 with error message\r\n\r\n### Requirement: Search context preview\r\nEach search result SHALL include surrounding context to help users identify the relevant content.\r\n\r\n#### Scenario: Result includes context\r\n- **WHEN** a search matches text within a Markdown file\r\n- **THEN** the match includes up to 100 characters before and after the matched text as context preview\r\n","relatedChanges":["2026-02-13-phase1-skeleton-and-api"],"history":[{"slug":"2026-02-13-phase1-skeleton-and-api","date":"2026-02-13","timestamp":"2026-02-13T17:37:45+08:00","description":"phase1 skeleton and api","status":"archived"}]},"search-ui":{"topic":"search-ui","content":"### Requirement: Search dialog activation\r\nThe system SHALL provide a search dialog that can be opened via keyboard shortcut or UI interaction.\r\n\r\n#### Scenario: Open search with keyboard shortcut\r\n- **WHEN** user presses `Cmd+K` (macOS) or `Ctrl+K` (other platforms) anywhere in the application\r\n- **THEN** a search dialog modal opens with focus on the search input field\r\n\r\n#### Scenario: Open search via header button\r\n- **WHEN** user clicks the search button in the application header\r\n- **THEN** the search dialog modal opens with focus on the search input field\r\n\r\n#### Scenario: Close search with Escape\r\n- **WHEN** the search dialog is open and user presses `Escape`\r\n- **THEN** the search dialog closes\r\n\r\n#### Scenario: Close search by clicking backdrop\r\n- **WHEN** the search dialog is open and user clicks outside the dialog\r\n- **THEN** the search dialog closes\r\n\r\n### Requirement: Search query execution\r\nThe system SHALL search across all specs and changes content by calling the backend search API with debounced input. Search results SHALL highlight matching text fragments in the title and context preview.\r\n\r\n#### Scenario: Debounced search on input\r\n- **WHEN** user types a query in the search input\r\n- **THEN** the system waits 300ms after the last keystroke before sending the search request\r\n\r\n#### Scenario: Display search results with highlights\r\n- **WHEN** the search API returns results\r\n- **THEN** results are displayed grouped by type (Specs and Changes), with matching query text highlighted using a contrasting background color in both the title and context snippet\r\n\r\n#### Scenario: No results found\r\n- **WHEN** the search API returns an empty array\r\n- **THEN** the dialog displays a \"No results found\" message with a suggestion to try different keywords\r\n\r\n#### Scenario: Empty query\r\n- **WHEN** the search input is empty\r\n- **THEN** no search request is made and the results area shows a prompt to start typing\r\n\r\n### Requirement: Search type filter\r\nThe system SHALL provide a type filter in the search dialog allowing users to narrow results by category: All, Specs only, or Changes only.\r\n\r\n#### Scenario: Filter by type\r\n- **WHEN** user selects \"Specs\" filter while search results are displayed\r\n- **THEN** only spec-type results are shown, change-type results are hidden\r\n\r\n#### Scenario: Default filter\r\n- **WHEN** the search dialog opens\r\n- **THEN** the \"All\" filter is selected by default, showing both spec and change results\r\n\r\n#### Scenario: Filter with no matching results\r\n- **WHEN** user selects a type filter and no results match that type\r\n- **THEN** a \"No results found\" message is displayed for that category\r\n\r\n### Requirement: Search result navigation\r\nThe system SHALL allow users to navigate to search results using keyboard or mouse.\r\n\r\n#### Scenario: Click to navigate\r\n- **WHEN** user clicks on a search result\r\n- **THEN** the application navigates to the corresponding page (`/specs/:topic` for spec results, `/changes/:slug` for change results) and the search dialog closes\r\n\r\n#### Scenario: Keyboard navigation with arrow keys\r\n- **WHEN** user presses the down arrow key in the search dialog\r\n- **THEN** the next result item is highlighted\r\n- **AND** pressing the up arrow key highlights the previous result item\r\n\r\n#### Scenario: Confirm selection with Enter\r\n- **WHEN** user presses Enter with a result item highlighted\r\n- **THEN** the application navigates to that result's page and the search dialog closes\r\n","relatedChanges":["2026-02-13-phase3-markdown-and-search","2026-02-16-ui-design-polish-p2"],"history":[{"slug":"2026-02-16-ui-design-polish-p2","date":"2026-02-16","timestamp":"2026-02-16T02:14:36+08:00","description":"ui design polish p2","status":"archived"},{"slug":"2026-02-13-phase3-markdown-and-search","date":"2026-02-13","timestamp":"2026-02-13T18:16:15+08:00","description":"phase3 markdown and search","status":"archived"}]},"shared-layout":{"topic":"shared-layout","content":"## ADDED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: an inline SVG logomark (S-curve with diamond accents, 24x24) followed by the \"spek\" brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button with `aria-label=\"Open navigation menu\"` and hide the repo path. The header SHALL also include a theme toggle button. The logomark SVG SHALL use `currentColor` to follow the accent color, ensuring theme compatibility.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the SVG logomark alongside \"spek\" brand text, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button with `aria-label=\"Open navigation menu\"`, the SVG logomark alongside \"spek\" brand text, search button, and theme toggle, but hides the repo path\r\n\r\n#### Scenario: Logo theme compatibility\r\n- **WHEN** the user toggles between dark and light theme\r\n- **THEN** the logomark color adjusts automatically via the accent color CSS variable\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, Changes, and Graph. Each link SHALL have an associated icon (LayoutDashboard for Overview, FileText for Specs, GitBranch for Changes, Share2 for Graph). The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL support two states: expanded (240px width, showing icons and labels) and collapsed (56px width, showing icons only). A toggle button at the bottom of the sidebar SHALL switch between states. The main content area left margin SHALL adjust to match the current sidebar width.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, Changes, and Graph with corresponding icons\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Graph page\r\n- **THEN** the \"Graph\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar expanded on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is expanded\r\n- **THEN** the sidebar is displayed at 240px width with icons and text labels, and main content has matching left margin\r\n\r\n#### Scenario: Sidebar collapsed on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is collapsed\r\n- **THEN** the sidebar is displayed at 56px width with icons only, and main content has matching left margin\r\n\r\n### Requirement: TaskProgress component\r\nThe system SHALL provide a reusable TaskProgress component that displays a progress bar with completed/total count. The progress bar color SHALL reflect completion status: amber/accent color when incomplete, green when all tasks are completed (completed equals total).\r\n\r\n#### Scenario: Display progress\r\n- **WHEN** TaskProgress is rendered with `completed=3` and `total=5`\r\n- **THEN** a progress bar at 60% width is shown in amber/accent color with text \"3 / 5\"\r\n\r\n#### Scenario: Display completed progress\r\n- **WHEN** TaskProgress is rendered with `completed=5` and `total=5`\r\n- **THEN** a progress bar at 100% width is shown in green color with text \"5 / 5\"\r\n\r\n#### Scenario: Zero tasks\r\n- **WHEN** TaskProgress is rendered with `total=0`\r\n- **THEN** component displays \"No tasks\" or an empty state\r\n\r\n### Requirement: TabView component\r\nThe system SHALL provide a reusable TabView component that renders tab headers and switches between tab content panels. When switching tabs, the new content panel SHALL fade in with a 150ms CSS animation.\r\n\r\n#### Scenario: Switch tabs\r\n- **WHEN** user clicks a tab header\r\n- **THEN** the corresponding tab content panel is displayed with a fade-in animation (150ms duration) and the previous panel is hidden\r\n\r\n#### Scenario: Default tab\r\n- **WHEN** TabView is first rendered\r\n- **THEN** the first tab is selected by default\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** user has `prefers-reduced-motion: reduce` enabled\r\n- **THEN** tab content switches instantly without fade animation\r\n\r\n### Requirement: Custom typography\r\nThe system SHALL use \"Plus Jakarta Sans\" as the primary font family for all UI text, loaded via Google Fonts CDN. The font stack SHALL include `sans-serif` as fallback for offline environments. Code and monospace text SHALL continue to use \"JetBrains Mono\".\r\n\r\n#### Scenario: Font loading\r\n- **WHEN** the application loads in a browser with internet access\r\n- **THEN** \"Plus Jakarta Sans\" is loaded and applied to all non-code text elements\r\n\r\n#### Scenario: Font fallback\r\n- **WHEN** the application loads without internet access (or Google Fonts is blocked)\r\n- **THEN** the browser falls back to the system default sans-serif font\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** the user has `prefers-reduced-motion: reduce` set in their OS/browser\r\n- **THEN** all CSS entry animations are disabled\r\n\r\n### Requirement: Main content area top spacing\r\nThe system SHALL render the main content area with sufficient top spacing below the fixed header to provide visual breathing room between the navbar and page content. The top padding SHALL be at least 72px (header height 56px + 16px spacing).\r\n\r\n#### Scenario: Page title spacing\r\n- **WHEN** any page is rendered within the Layout\r\n- **THEN** the first content element (typically h1) has at least 16px of visual spacing below the header bar\r\n\r\n### Requirement: Back navigation link styling\r\nThe system SHALL render back navigation links (e.g., \"← Back to Specs\", \"← Back to Changes\") at base font size (16px) with medium font weight for adequate visibility and clickability.\r\n\r\n#### Scenario: Back link display\r\n- **WHEN** user views a detail page (SpecDetail or ChangeDetail)\r\n- **THEN** the back navigation link is displayed at 16px font size with medium weight, muted color, and accent color on hover\r\n","relatedChanges":["2026-02-13-apply-brand-logo","2026-02-13-phase2-core-ui-pages","2026-02-13-phase4-polish-and-enhancement","2026-02-14-add-sidebar-toggle","2026-02-16-ui-design-polish-p0-p1","2026-02-16-ui-design-polish-p2","2026-02-17-spec-graph-view"],"history":[{"slug":"2026-02-17-spec-graph-view","date":"2026-02-17","timestamp":"2026-02-17T23:49:54+08:00","description":"spec graph view","status":"archived"},{"slug":"2026-02-16-ui-design-polish-p2","date":"2026-02-16","timestamp":"2026-02-16T02:14:36+08:00","description":"ui design polish p2","status":"archived"},{"slug":"2026-02-16-ui-design-polish-p0-p1","date":"2026-02-16","timestamp":"2026-02-16T01:41:38+08:00","description":"ui design polish p0 p1","status":"archived"},{"slug":"2026-02-14-add-sidebar-toggle","date":"2026-02-14","timestamp":"2026-02-14T12:25:29+08:00","description":"add sidebar toggle","status":"archived"},{"slug":"2026-02-13-apply-brand-logo","date":"2026-02-13","timestamp":"2026-02-13T22:23:07+08:00","description":"apply brand logo","status":"archived"},{"slug":"2026-02-13-phase4-polish-and-enhancement","date":"2026-02-13","timestamp":"2026-02-13T18:36:04+08:00","description":"phase4 polish and enhancement","status":"archived"},{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived"}]},"sidebar-toggle":{"topic":"sidebar-toggle","content":"## ADDED Requirements\r\n\r\n### Requirement: Sidebar collapse toggle button\r\nThe system SHALL display a toggle button at the bottom of the sidebar (above the Resync button) that collapses or expands the sidebar. The button SHALL display a left-pointing chevron (`«`) when the sidebar is expanded and a right-pointing chevron (`»`) when collapsed.\r\n\r\n#### Scenario: Toggle sidebar from expanded to collapsed\r\n- **WHEN** the sidebar is expanded and the user clicks the toggle button\r\n- **THEN** the sidebar collapses to 56px width showing only navigation icons\r\n\r\n#### Scenario: Toggle sidebar from collapsed to expanded\r\n- **WHEN** the sidebar is collapsed and the user clicks the toggle button\r\n- **THEN** the sidebar expands to the full 240px width showing icons and labels\r\n\r\n### Requirement: Collapsed sidebar icon-only navigation\r\nThe system SHALL display navigation items as icon-only buttons when the sidebar is collapsed. Each navigation link SHALL display a corresponding icon: LayoutDashboard icon for Overview, FileText icon for Specs, and GitBranch icon for Changes. Each icon button SHALL include a `title` attribute showing the full link label.\r\n\r\n#### Scenario: Display collapsed navigation with icons\r\n- **WHEN** the sidebar is in collapsed state\r\n- **THEN** navigation items display as icon-only buttons with tooltips\r\n\r\n#### Scenario: Navigate from collapsed sidebar\r\n- **WHEN** the user clicks a navigation icon in collapsed state\r\n- **THEN** the app navigates to the corresponding route\r\n\r\n#### Scenario: Active route indication in collapsed state\r\n- **WHEN** the user is on the Specs page and sidebar is collapsed\r\n- **THEN** the Specs icon is highlighted with the accent color\r\n\r\n### Requirement: Collapsed sidebar Resync button\r\nThe system SHALL display the Resync button as icon-only in collapsed state, without the text label, and with a `title` attribute for tooltip.\r\n\r\n#### Scenario: Resync button in collapsed state\r\n- **WHEN** the sidebar is collapsed\r\n- **THEN** the Resync button displays only the sync icon with a tooltip\r\n\r\n### Requirement: Sidebar collapse state persistence\r\nThe system SHALL persist the sidebar collapse state to localStorage (key: `spek-sidebar-collapsed`) in the web version. On page load, the sidebar SHALL restore the previously saved state. In VS Code webview, the state SHALL default to expanded and not persist across sessions.\r\n\r\n#### Scenario: Persist collapsed state in web version\r\n- **WHEN** the user collapses the sidebar and refreshes the page\r\n- **THEN** the sidebar remains collapsed after reload\r\n\r\n#### Scenario: Default state in VS Code webview\r\n- **WHEN** the webview is first opened\r\n- **THEN** the sidebar is in expanded state\r\n\r\n### Requirement: Sidebar transition animation\r\nThe system SHALL animate the sidebar width change and main content margin with a smooth CSS transition (200ms duration).\r\n\r\n#### Scenario: Smooth collapse animation\r\n- **WHEN** the user clicks the toggle button\r\n- **THEN** the sidebar width and main content margin animate smoothly over 200ms\r\n\r\n### Requirement: Mobile behavior unchanged\r\nThe sidebar toggle feature SHALL only apply to desktop viewports (768px and above). On mobile viewports, the existing overlay sidebar behavior SHALL remain unchanged.\r\n\r\n#### Scenario: Mobile viewport ignores collapse state\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar uses the existing overlay behavior regardless of collapse state\r\n","relatedChanges":["2026-02-14-add-sidebar-toggle"],"history":[{"slug":"2026-02-14-add-sidebar-toggle","date":"2026-02-14","timestamp":"2026-02-14T12:25:29+08:00","description":"add sidebar toggle","status":"archived"}]},"spa-routing":{"topic":"spa-routing","content":"## ADDED Requirements\r\n\r\n### Requirement: Client-side routing\r\nThe system SHALL use React Router v7 with `createBrowserRouter` to define the following routes:\r\n\r\n| Path | Page | Layout |\r\n|------|------|--------|\r\n| `/` | SelectRepo | None |\r\n| `/dashboard` | Dashboard | Layout |\r\n| `/specs` | SpecList | Layout |\r\n| `/specs/:topic` | SpecDetail | Layout |\r\n| `/changes` | ChangeList | Layout |\r\n| `/changes/:slug` | ChangeDetail | Layout |\r\n\r\n#### Scenario: Route to SelectRepo\r\n- **WHEN** user navigates to `/`\r\n- **THEN** the SelectRepo page is rendered without Layout wrapper\r\n\r\n#### Scenario: Route to Dashboard with Layout\r\n- **WHEN** user navigates to `/dashboard`\r\n- **THEN** the Dashboard page is rendered within the shared Layout (Header + Sidebar + Main)\r\n\r\n### Requirement: RepoContext state management\r\nThe system SHALL provide a React Context (`RepoContext`) that stores the current repo path. All API hooks SHALL read the repo path from this context.\r\n\r\n#### Scenario: Set repo path\r\n- **WHEN** user selects a repo on the SelectRepo page\r\n- **THEN** `RepoContext.repoPath` is updated and available to all child components\r\n\r\n#### Scenario: Redirect when no repo selected\r\n- **WHEN** user navigates to any page other than `/` without a repo path in context\r\n- **THEN** system redirects to `/`\r\n\r\n### Requirement: API hooks\r\nThe system SHALL provide custom React hooks in `useOpenSpec.ts` that encapsulate API calls. Each hook SHALL return `{ data, loading, error }` and automatically include the `dir` query parameter from RepoContext.\r\n\r\n#### Scenario: Hook returns loading state\r\n- **WHEN** an API hook is called and the request is in flight\r\n- **THEN** hook returns `{ data: null, loading: true, error: null }`\r\n\r\n#### Scenario: Hook returns data\r\n- **WHEN** the API request succeeds\r\n- **THEN** hook returns `{ data: <response>, loading: false, error: null }`\r\n\r\n#### Scenario: Hook returns error\r\n- **WHEN** the API request fails\r\n- **THEN** hook returns `{ data: null, loading: false, error: <error message> }`\r\n","relatedChanges":["2026-02-13-phase2-core-ui-pages"],"history":[{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived"}]},"spec-browsing":{"topic":"spec-browsing","content":"## ADDED Requirements\r\n\r\n### Requirement: Spec list with filtering\r\nThe system SHALL display all specs sorted alphabetically with history count metadata. A filter input SHALL allow instant client-side filtering by spec topic name. Each spec item SHALL display the topic name and the number of related changes (history count) as secondary information.\r\n\r\n#### Scenario: Display all specs\r\n- **WHEN** user navigates to the SpecList page\r\n- **THEN** all spec topics are listed alphabetically, each showing the topic name and history change count\r\n\r\n#### Scenario: Filter specs\r\n- **WHEN** user types in the filter input\r\n- **THEN** the list is filtered in real-time to show only specs whose topic name contains the search text (case-insensitive)\r\n\r\n#### Scenario: Spec with no history\r\n- **WHEN** a spec has zero related changes\r\n- **THEN** the history count is not displayed (or shows \"No changes\")\r\n\r\n### Requirement: Spec detail display\r\nThe system SHALL display the full content of a spec when the user navigates to its detail page. The raw markdown content SHALL be shown (react-markdown rendering deferred to Phase 3).\r\n\r\n#### Scenario: View spec content\r\n- **WHEN** user navigates to `/specs/:topic`\r\n- **THEN** system displays the spec topic as title and the full spec.md content\r\n\r\n#### Scenario: Spec not found\r\n- **WHEN** user navigates to a spec topic that does not exist\r\n- **THEN** system displays a \"not found\" message\r\n\r\n### Requirement: Related changes display\r\nThe spec detail page SHALL display a list of changes that affect the spec (from the API's `relatedChanges` field). Each change SHALL be a link to its detail page.\r\n\r\n#### Scenario: Show related changes\r\n- **WHEN** viewing a spec that has related changes\r\n- **THEN** a \"Related Changes\" section lists each change as a clickable link to `/changes/:slug`\r\n\r\n#### Scenario: No related changes\r\n- **WHEN** viewing a spec with no related changes\r\n- **THEN** the \"Related Changes\" section shows an empty state message\r\n","relatedChanges":["2026-02-13-phase2-core-ui-pages","2026-02-16-ui-design-polish-p2"],"history":[{"slug":"2026-02-16-ui-design-polish-p2","date":"2026-02-16","timestamp":"2026-02-16T02:14:36+08:00","description":"ui design polish p2","status":"archived"},{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived"}]},"spec-diff":{"topic":"spec-diff","content":"## ADDED Requirements\r\n\r\n### Requirement: Read spec content at a specific change version\r\nThe system SHALL provide a core function `readSpecAtChange(repoDir, topic, slug)` that reads the spec content from a specific change's delta spec file. It SHALL check both active (`openspec/changes/<slug>/specs/<topic>/spec.md`) and archived (`openspec/changes/archive/<slug>/specs/<topic>/spec.md`) change directories.\r\n\r\n#### Scenario: Read spec from active change\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **AND** `openspec/changes/2026-01-15-add-oauth/specs/user-auth/spec.md` exists\r\n- **THEN** it returns `{ content: \"<file contents>\" }`\r\n\r\n#### Scenario: Read spec from archived change\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"2025-12-01-init\")` is called\r\n- **AND** the change is in the archive directory\r\n- **THEN** it returns `{ content: \"<file contents>\" }` from the archive path\r\n\r\n#### Scenario: Spec version not found\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"nonexistent-slug\")` is called\r\n- **AND** no delta spec file exists for that topic in that change\r\n- **THEN** it returns `null`\r\n\r\n### Requirement: Spec version diff API endpoint\r\nThe system SHALL expose `GET /api/openspec/specs/:topic/at/:slug?dir=...` that returns the spec content at a specific change version. The VS Code extension host SHALL handle a `getSpecAtChange` message with the same semantics.\r\n\r\n#### Scenario: Fetch spec at change version via REST\r\n- **WHEN** client calls `GET /api/openspec/specs/user-auth/at/2026-01-15-add-oauth?dir=/repo`\r\n- **THEN** the server returns `{ \"content\": \"<delta spec content>\" }` with status 200\r\n\r\n#### Scenario: Spec version not found via REST\r\n- **WHEN** client calls `GET /api/openspec/specs/user-auth/at/nonexistent?dir=/repo`\r\n- **THEN** the server returns `{ \"error\": \"Spec version not found\" }` with status 404\r\n\r\n#### Scenario: VS Code extension handles getSpecAtChange\r\n- **WHEN** the webview sends `{ type: \"request\", method: \"getSpecAtChange\", params: { topic, slug } }`\r\n- **THEN** the extension host calls `readSpecAtChange` and returns the result\r\n\r\n### Requirement: Diff viewer UI component\r\nThe system SHALL provide a `SpecDiffViewer` component that renders a unified diff between two spec content strings. Diff computation SHALL be done client-side using the `diff` npm package's `diffLines` function.\r\n\r\n#### Scenario: Display unified diff\r\n- **WHEN** the component receives two content strings (old and new)\r\n- **THEN** it renders a unified diff view with added lines highlighted in green and removed lines highlighted in red\r\n\r\n#### Scenario: Identical content\r\n- **WHEN** both content strings are identical\r\n- **THEN** it displays a message indicating no differences found\r\n\r\n#### Scenario: Empty old content\r\n- **WHEN** the old content is empty (new spec)\r\n- **THEN** all lines in the new content are shown as added\r\n\r\n### Requirement: Version comparison interaction on SpecDetail page\r\nThe system SHALL add a comparison mode to the SpecDetail page. Users can select a history entry to compare against the current spec content, or select two history entries to compare against each other.\r\n\r\n#### Scenario: Compare current vs. history version\r\n- **WHEN** the user clicks a \"Compare\" action on a history timeline entry\r\n- **THEN** the system fetches the spec content at that change version\r\n- **AND** displays a diff view comparing the change version (old) against the current spec content (new)\r\n\r\n#### Scenario: Compare two history versions\r\n- **WHEN** the user selects two history entries for comparison\r\n- **THEN** the system fetches both change versions\r\n- **AND** displays a diff view with the earlier version as old and the later version as new\r\n\r\n#### Scenario: Exit diff mode\r\n- **WHEN** the user is viewing a diff and clicks \"Close\" or \"Back to spec\"\r\n- **THEN** the diff view is dismissed and the original spec content is shown again\r\n\r\n#### Scenario: No history available\r\n- **WHEN** a spec has no history entries\r\n- **THEN** no comparison UI is shown\r\n","relatedChanges":["2026-02-17-spec-diff-viewer"],"history":[{"slug":"2026-02-17-spec-diff-viewer","date":"2026-02-17","timestamp":"2026-02-17T12:25:28+08:00","description":"spec diff viewer","status":"archived"}]},"spec-history":{"topic":"spec-history","content":"## ADDED Requirements\r\n\r\n### Requirement: Spec history data in API response\r\nThe system SHALL include a `history` array in the `GET /api/openspec/specs/:topic` response. Each entry MUST contain the change slug, date (if parseable from slug), timestamp (ISO 8601 from git commit cache, or null if unavailable), description, and status (active or archived).\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** a spec has been affected by one or more changes (i.e., changes that contain a delta spec for this topic)\r\n- **THEN** the API response includes a `history` array with entries sorted by git commit timestamp descending (most recent first)\r\n- **AND** if two entries have the same date, the git commit timestamp determines their order\r\n- **AND** each entry contains `{ slug, date, timestamp, description, status }`\r\n\r\n#### Scenario: Spec with no related changes\r\n- **WHEN** a spec has no related changes\r\n- **THEN** the API response includes an empty `history` array\r\n\r\n#### Scenario: Fallback sorting when git timestamp unavailable\r\n- **WHEN** a history entry has no git commit timestamp (e.g., uncommitted change or non-git repo)\r\n- **THEN** the entry's `timestamp` field is null\r\n- **AND** sorting falls back to the date parsed from the slug\r\n\r\n### Requirement: Spec history timeline UI\r\nThe system SHALL display a visual timeline on the SpecDetail page showing all changes that affected the spec. Each timeline entry MUST display the date, change description, and a link to the change detail page. Each timeline entry SHALL also include a \"Compare\" action that triggers diff comparison against the current spec content.\r\n\r\n#### Scenario: Display history timeline\r\n- **WHEN** the SpecDetail page is rendered for a spec with related changes\r\n- **THEN** a \"History\" section is displayed with a vertical timeline showing each change chronologically\r\n\r\n#### Scenario: Timeline entry links to change\r\n- **WHEN** the user clicks on a timeline entry's title or description\r\n- **THEN** the system navigates to the corresponding change detail page\r\n\r\n#### Scenario: No history\r\n- **WHEN** the SpecDetail page is rendered for a spec with no related changes\r\n- **THEN** the \"History\" section displays a message indicating no changes have affected this spec\r\n\r\n#### Scenario: Timeline entry compare action\r\n- **WHEN** the user clicks the \"Compare\" action on a timeline entry\r\n- **THEN** the system enters diff comparison mode showing the difference between that change version and the current spec content\r\n","relatedChanges":["2026-02-13-phase4-polish-and-enhancement","2026-02-13-spec-history-git-timestamp-cache","2026-02-17-spec-diff-viewer"],"history":[{"slug":"2026-02-17-spec-diff-viewer","date":"2026-02-17","timestamp":"2026-02-17T12:25:28+08:00","description":"spec diff viewer","status":"archived"},{"slug":"2026-02-13-spec-history-git-timestamp-cache","date":"2026-02-13","timestamp":"2026-02-13T19:19:25+08:00","description":"spec history git timestamp cache","status":"archived"},{"slug":"2026-02-13-phase4-polish-and-enhancement","date":"2026-02-13","timestamp":"2026-02-13T18:36:04+08:00","description":"phase4 polish and enhancement","status":"archived"}]},"task-parser":{"topic":"task-parser","content":"## ADDED Requirements\r\n\r\n### Requirement: Parse task checkboxes\r\nThe task parser SHALL be a pure function in the `@spek/core` package that reads a tasks.md content string and extracts checkbox items with their completion status. It SHALL have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Parse file with mixed checkboxes\r\n- **WHEN** parser receives a string containing `- [x] Done task` and `- [ ] Pending task`\r\n- **THEN** it returns each task with `text` and `completed` (boolean) fields\r\n\r\n### Requirement: Group tasks by section\r\nThe task parser SHALL group tasks under their `##` heading sections.\r\n\r\n#### Scenario: Tasks under multiple sections\r\n- **WHEN** parser receives a string with `## Phase 1` followed by tasks and `## Phase 2` followed by tasks\r\n- **THEN** it returns sections array, each with `title` and `tasks` array\r\n\r\n#### Scenario: Tasks without section headings\r\n- **WHEN** parser receives a string where tasks appear before any `##` heading\r\n- **THEN** those tasks are grouped under a default section with empty title\r\n\r\n### Requirement: Calculate task statistics\r\nThe task parser SHALL compute aggregate statistics from parsed tasks.\r\n\r\n#### Scenario: Calculate completion stats\r\n- **WHEN** parser processes a string with 10 total checkboxes where 7 are checked\r\n- **THEN** it returns `{ total: 10, completed: 7 }` along with the sections breakdown\r\n\r\n#### Scenario: Empty tasks file\r\n- **WHEN** parser processes an empty string or one with no checkboxes\r\n- **THEN** it returns `{ total: 0, completed: 0, sections: [] }`\r\n","relatedChanges":["2026-02-13-phase1-skeleton-and-api","2026-02-13-vscode-extension"],"history":[{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived"},{"slug":"2026-02-13-phase1-skeleton-and-api","date":"2026-02-13","timestamp":"2026-02-13T17:37:45+08:00","description":"phase1 skeleton and api","status":"archived"}]},"theme-toggle":{"topic":"theme-toggle","content":"## ADDED Requirements\r\n\r\n### Requirement: Theme state management\r\nThe system SHALL provide a ThemeContext that manages the current theme (\"dark\" or \"light\") and exposes a toggle function. The theme state MUST be persisted in localStorage under the key `spek:theme`.\r\n\r\n#### Scenario: Initialize from localStorage\r\n- **WHEN** the application loads and localStorage contains a saved theme preference\r\n- **THEN** the system applies the saved theme\r\n\r\n#### Scenario: Initialize from system preference\r\n- **WHEN** the application loads and no theme is saved in localStorage\r\n- **AND** the user's system preference is light mode (`prefers-color-scheme: light`)\r\n- **THEN** the system applies the light theme\r\n\r\n#### Scenario: Initialize default\r\n- **WHEN** the application loads and no theme is saved and no system preference is detected\r\n- **THEN** the system applies the dark theme as default\r\n\r\n#### Scenario: Toggle theme\r\n- **WHEN** the user triggers the theme toggle\r\n- **THEN** the current theme switches (dark → light or light → dark)\r\n- **AND** the new preference is saved to localStorage\r\n- **AND** the `data-theme` attribute on `<html>` is updated\r\n\r\n### Requirement: Light theme CSS variables\r\nThe system SHALL define a complete set of light theme CSS variables that override the dark theme defaults when `[data-theme=\"light\"]` is set on the `<html>` element.\r\n\r\n#### Scenario: Light theme applied\r\n- **WHEN** the `<html>` element has `data-theme=\"light\"`\r\n- **THEN** all color CSS variables (`--color-bg-primary`, `--color-bg-secondary`, `--color-bg-tertiary`, `--color-border`, `--color-text-primary`, `--color-text-secondary`, `--color-text-muted`, `--color-accent`, `--color-accent-hover`) are overridden with light-appropriate values\r\n\r\n#### Scenario: Dark theme applied\r\n- **WHEN** the `<html>` element has `data-theme=\"dark\"` or no `data-theme` attribute\r\n- **THEN** the default dark theme CSS variables are used\r\n\r\n### Requirement: Theme toggle button\r\nThe system SHALL display a theme toggle button in the header. The button MUST show a sun icon when in dark mode (indicating \"switch to light\") and a moon icon when in light mode (indicating \"switch to dark\").\r\n\r\n#### Scenario: Display toggle in header\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** a theme toggle button is visible in the header area\r\n\r\n#### Scenario: Icon reflects current theme\r\n- **WHEN** the current theme is dark\r\n- **THEN** the toggle button displays a sun icon\r\n- **WHEN** the current theme is light\r\n- **THEN** the toggle button displays a moon icon\r\n","relatedChanges":["2026-02-13-phase4-polish-and-enhancement"],"history":[{"slug":"2026-02-13-phase4-polish-and-enhancement","date":"2026-02-13","timestamp":"2026-02-13T18:36:04+08:00","description":"phase4 polish and enhancement","status":"archived"}]},"vscode-cicd":{"topic":"vscode-cicd","content":"### Requirement: Tag-triggered publish workflow\r\n系統 SHALL 提供 GitHub Actions workflow，於 push 符合 `v*` pattern 的 tag 時自動觸發 VS Code extension 的 build 與 publish 流程。\r\n\r\n#### Scenario: Push version tag triggers workflow\r\n- **WHEN** 開發者 push 一個 `v0.2.0` 格式的 tag\r\n- **THEN** GitHub Actions workflow 自動觸發並執行完整 build chain\r\n\r\n#### Scenario: Non-matching tag does not trigger\r\n- **WHEN** 開發者 push 一個 `release-0.2.0` 或 `feat/something` 格式的 ref\r\n- **THEN** 此 workflow 不被觸發\r\n\r\n### Requirement: Full build chain execution\r\nWorkflow SHALL 依序執行完整 build chain：install dependencies → build @spek/core → build webview assets → build VS Code extension。\r\n\r\n#### Scenario: Build chain completes successfully\r\n- **WHEN** workflow 被觸發且所有 build 步驟成功\r\n- **THEN** `packages/vscode/dist/extension.js` 和 webview assets 皆存在且為最新\r\n\r\n#### Scenario: Build failure stops pipeline\r\n- **WHEN** 任一 build 步驟失敗\r\n- **THEN** 後續步驟不執行，workflow 標記為失敗\r\n\r\n### Requirement: Marketplace publish\r\nWorkflow SHALL 使用 `VSCE_PAT` secret 透過 `vsce publish` 將 extension 發佈到 VS Code Marketplace。\r\n\r\n#### Scenario: Successful publish\r\n- **WHEN** build chain 完成且 `VSCE_PAT` secret 有效\r\n- **THEN** extension 成功發佈到 VS Code Marketplace\r\n\r\n#### Scenario: Missing PAT secret\r\n- **WHEN** `VSCE_PAT` secret 未設定或已過期\r\n- **THEN** publish 步驟失敗，workflow 標記為失敗\r\n\r\n### Requirement: Manual trigger support\r\nWorkflow SHALL 支援 `workflow_dispatch` 手動觸發，方便除錯和測試。\r\n\r\n#### Scenario: Manual trigger from Actions UI\r\n- **WHEN** 開發者在 GitHub Actions UI 手動觸發此 workflow\r\n- **THEN** workflow 執行完整 build + publish 流程\r\n\r\n### Requirement: Version consistency check\r\nWorkflow SHALL 在 publish 前驗證 tag 版號與 `packages/vscode/package.json` 中的 version 欄位一致。\r\n\r\n#### Scenario: Version matches\r\n- **WHEN** tag `v0.2.0` 且 package.json version 為 `0.2.0`\r\n- **THEN** 繼續執行 publish\r\n\r\n#### Scenario: Version mismatch\r\n- **WHEN** tag `v0.3.0` 但 package.json version 為 `0.2.0`\r\n- **THEN** workflow 失敗並輸出版號不一致的錯誤訊息\r\n","relatedChanges":["2026-02-14-vscode-cicd-publish"],"history":[{"slug":"2026-02-14-vscode-cicd-publish","date":"2026-02-14","timestamp":"2026-02-14T14:50:30+08:00","description":"vscode cicd publish","status":"archived"}]},"vscode-extension-host":{"topic":"vscode-extension-host","content":"## ADDED Requirements\r\n\r\n### Requirement: Extension activation\r\nThe extension SHALL activate when a workspace containing an `openspec/` directory is opened, or when the user explicitly invokes a spek command.\r\n\r\n#### Scenario: Workspace with openspec directory\r\n- **WHEN** VS Code opens a workspace where the first workspace folder contains an `openspec/` directory\r\n- **THEN** the extension activates and displays a spek icon in the status bar\r\n\r\n#### Scenario: Workspace without openspec directory\r\n- **WHEN** VS Code opens a workspace without an `openspec/` directory\r\n- **THEN** the extension remains inactive and no status bar icon is shown\r\n\r\n#### Scenario: Manual activation via command\r\n- **WHEN** the user invokes the `spek.open` command from the command palette\r\n- **THEN** the extension activates and opens the spek Webview Panel\r\n\r\n### Requirement: Webview Panel lifecycle\r\nThe extension SHALL manage a single Webview Panel instance for displaying the spek UI.\r\n\r\n#### Scenario: Open spek panel\r\n- **WHEN** the user invokes `spek.open` and no panel exists\r\n- **THEN** the extension creates a new Webview Panel in the active editor column with the title \"spek\"\r\n\r\n#### Scenario: Focus existing panel\r\n- **WHEN** the user invokes `spek.open` and a panel already exists\r\n- **THEN** the extension reveals (focuses) the existing panel instead of creating a new one\r\n\r\n#### Scenario: Panel disposal\r\n- **WHEN** the user closes the spek Webview Panel\r\n- **THEN** the extension cleans up the panel reference and associated message listeners\r\n\r\n### Requirement: Command registration\r\nThe extension SHALL register commands in the VS Code command palette.\r\n\r\n#### Scenario: Available commands\r\n- **WHEN** the extension is active\r\n- **THEN** the following commands are available: `spek.open` (Open spek) and `spek.search` (Search OpenSpec)\r\n\r\n#### Scenario: Search command\r\n- **WHEN** the user invokes `spek.search`\r\n- **THEN** the extension opens (or focuses) the spek panel and sends a message to trigger the search dialog\r\n\r\n### Requirement: Message handler for API requests\r\nThe extension host SHALL handle message-based API requests from the Webview and return responses using core module functions.\r\n\r\n#### Scenario: Handle API request\r\n- **WHEN** the Webview sends a message `{ type: 'request', id: 'req-1', method: 'getOverview' }`\r\n- **THEN** the extension host calls the corresponding core module function and replies with `{ type: 'response', id: 'req-1', data: <result> }`\r\n\r\n#### Scenario: Handle API error\r\n- **WHEN** the Webview sends a request and the core module function throws an error\r\n- **THEN** the extension host replies with `{ type: 'response', id: 'req-1', error: <error message> }`\r\n","relatedChanges":["add-vscode-sidebar","2026-02-13-vscode-extension"],"history":[{"slug":"add-vscode-sidebar","date":null,"timestamp":"2026-02-23T12:08:54+08:00","description":"add vscode sidebar","status":"active"},{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived"}]},"vscode-marketplace-metadata":{"topic":"vscode-marketplace-metadata","content":"### Requirement: Marketplace-ready package.json\r\nExtension 的 `package.json` SHALL 包含所有 VS Code Marketplace 發佈所需的欄位。\r\n\r\n#### Scenario: Required fields present\r\n- **WHEN** 執行 `vsce package` 打包 extension\r\n- **THEN** package.json 包含以下欄位且無 validation 錯誤：`publisher`、`repository`、`license`、`icon`、`categories`、`keywords`\r\n\r\n#### Scenario: Private flag removed\r\n- **WHEN** package.json 被讀取\r\n- **THEN** `\"private\"` 欄位 SHALL 不存在或為 `false`\r\n\r\n#### Scenario: Icon file exists\r\n- **WHEN** package.json 指定 `\"icon\": \"icon.png\"`\r\n- **THEN** `packages/vscode/icon.png` 檔案存在且為 128x128 以上的 PNG 圖片\r\n\r\n### Requirement: Marketplace README\r\nExtension 目錄下 SHALL 有獨立的 `README.md` 作為 Marketplace 頁面內容。\r\n\r\n#### Scenario: README content\r\n- **WHEN** Marketplace 頁面載入\r\n- **THEN** 顯示 extension 的功能說明、安裝方式與使用說明\r\n\r\n#### Scenario: README exists in extension directory\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `packages/vscode/README.md` 被包含在 `.vsix` 中\r\n\r\n### Requirement: Extension version and changelog\r\nExtension SHALL 維護 CHANGELOG.md 記錄每個版本的功能異動，且 package.json version 欄位 SHALL 與最新 CHANGELOG entry 一致。\r\n\r\n#### Scenario: CHANGELOG content\r\n- **WHEN** 使用者在 Marketplace 或 VS Code 中檢視 extension 的 changelog\r\n- **THEN** 顯示按版本分組的變更記錄\r\n\r\n#### Scenario: Version bump with new feature\r\n- **WHEN** 新功能已實作完成\r\n- **THEN** package.json version 更新且 CHANGELOG.md 包含對應版本區塊描述新功能\r\n\r\n### Requirement: vscodeignore configuration\r\n`.vscodeignore` SHALL 排除不需要包含在 `.vsix` 中的檔案，減少套件大小。\r\n\r\n#### Scenario: Source files excluded\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `src/`、`node_modules/`、`tsconfig.json`、`.gitignore` 不被包含在 `.vsix` 中\r\n\r\n#### Scenario: Required files included\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `dist/`、`webview/`、`icon.png`、`README.md`、`CHANGELOG.md`、`LICENSE` 被包含在 `.vsix` 中\r\n\r\n### Requirement: Publish workflow\r\n使用者 SHALL 能透過 `vsce` CLI 將 extension 發佈到 Marketplace。\r\n\r\n#### Scenario: First-time publish\r\n- **WHEN** 使用者執行 `vsce login <publisher>` 並輸入有效的 PAT\r\n- **AND** 執行 `vsce publish`\r\n- **THEN** extension 成功發佈到 VS Code Marketplace\r\n\r\n#### Scenario: Version update publish\r\n- **WHEN** 使用者更新 package.json 版本號\r\n- **AND** 執行 `vsce publish`\r\n- **THEN** Marketplace 上的 extension 更新到新版本\r\n","relatedChanges":["2026-02-13-vscode-marketplace-publish","2026-02-14-add-changelog-entry"],"history":[{"slug":"2026-02-14-add-changelog-entry","date":"2026-02-14","timestamp":"2026-02-14T12:39:38+08:00","description":"add changelog entry","status":"archived"},{"slug":"2026-02-13-vscode-marketplace-publish","date":"2026-02-13","timestamp":"2026-02-13T22:58:03+08:00","description":"vscode marketplace publish","status":"archived"}]},"webview-integration":{"topic":"webview-integration","content":"## ADDED Requirements\r\n\r\n### Requirement: Load React SPA in Webview\r\nThe Webview SHALL load the spek React application from the extension's bundled assets.\r\n\r\n#### Scenario: Webview HTML generation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** it generates an HTML document that loads the built React bundle with asset paths converted via `webview.asWebviewUri()`\r\n\r\n#### Scenario: Asset path resolution\r\n- **WHEN** the Webview HTML references JS or CSS files\r\n- **THEN** all asset paths SHALL use `webview.asWebviewUri()` to convert local file paths to Webview-safe URIs\r\n\r\n#### Scenario: File change notification forwarding\r\n- **WHEN** a file in the `openspec/` directory changes\r\n- **THEN** the Webview Panel SHALL forward the `{ type: \"fileChanged\" }` message to the React application so it can refresh its data\r\n\r\n### Requirement: Content Security Policy\r\nThe Webview SHALL enforce a Content Security Policy that allows the React application to function while preventing unauthorized content.\r\n\r\n#### Scenario: CSP configuration\r\n- **WHEN** the Webview HTML is generated\r\n- **THEN** it includes a CSP meta tag that allows scripts and styles from the extension's webview URI origin with a unique nonce, and disallows inline scripts without the nonce\r\n\r\n#### Scenario: Tailwind CSS compatibility\r\n- **WHEN** Tailwind CSS styles are loaded in the Webview\r\n- **THEN** all styles SHALL be loaded from external CSS files (not inline style tags) to comply with CSP\r\n\r\n### Requirement: Workspace path injection\r\nThe Webview SHALL receive the workspace path from the extension host so the React app can skip the repo selection page.\r\n\r\n#### Scenario: Initial workspace path\r\n- **WHEN** the Webview is created in a workspace with an `openspec/` directory\r\n- **THEN** the extension host sends a `{ type: 'init', workspacePath: '/path/to/repo' }` message after the Webview is ready\r\n\r\n#### Scenario: Webview ready handshake\r\n- **WHEN** the React app finishes mounting in the Webview\r\n- **THEN** it sends a `{ type: 'ready' }` message to the extension host to signal it can receive the workspace path\r\n\r\n### Requirement: Theme synchronization\r\nThe Webview SHALL respect the VS Code color theme.\r\n\r\n#### Scenario: Dark theme active\r\n- **WHEN** VS Code is using a dark color theme\r\n- **THEN** the Webview renders the spek dark theme\r\n\r\n#### Scenario: Light theme active\r\n- **WHEN** VS Code is using a light color theme\r\n- **THEN** the Webview renders the spek light theme\r\n\r\n#### Scenario: Theme change\r\n- **WHEN** the user changes the VS Code color theme while the Webview is open\r\n- **THEN** the Webview updates its theme to match\r\n\r\n### Requirement: Tab icon display\r\nThe Webview Panel SHALL display the spek logo as the tab icon for visual identification.\r\n\r\n#### Scenario: Tab icon is set on panel creation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** the panel's `iconPath` SHALL be set to the `webview/favicon.svg` file from the extension's bundled assets\r\n\r\n#### Scenario: Icon visibility across themes\r\n- **WHEN** the tab icon is displayed in either light or dark VS Code theme\r\n- **THEN** the icon SHALL be visually distinguishable against the tab bar background\r\n","relatedChanges":["2026-02-13-vscode-extension","2026-02-17-add-vscode-tab-icon","2026-02-18-live-reload"],"history":[{"slug":"2026-02-18-live-reload","date":"2026-02-18","timestamp":"2026-02-18T19:51:09+08:00","description":"live reload","status":"archived"},{"slug":"2026-02-17-add-vscode-tab-icon","date":"2026-02-17","timestamp":"2026-02-17T10:47:36+08:00","description":"add vscode tab icon","status":"archived"},{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived"}]}},"changes":{"active":[{"slug":"add-vscode-sidebar","date":null,"timestamp":"2026-02-23T12:08:54+08:00","description":"add vscode sidebar","status":"active","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":17,"completed":16}}],"archived":[{"slug":"2026-02-22-fix-demo-build-and-release-skill","date":"2026-02-22","timestamp":"2026-02-22T01:59:57+08:00","description":"fix demo build and release skill","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":false,"taskStats":{"total":5,"completed":5}},{"slug":"2026-02-22-fix-change-not-found-on-refresh","date":"2026-02-22","timestamp":"2026-02-22T01:49:43+08:00","description":"fix change not found on refresh","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":4,"completed":4}},{"slug":"2026-02-21-add-change-timestamp","date":"2026-02-21","timestamp":"2026-02-21T22:27:55+08:00","description":"add change timestamp","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":10,"completed":10}},{"slug":"2026-02-21-fix-detect-fallback","date":"2026-02-21","timestamp":"2026-02-21T22:27:55+08:00","description":"fix detect fallback","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":5,"completed":5}},{"slug":"2026-02-21-sticky-change-detail-header","date":"2026-02-21","timestamp":"2026-02-21T21:45:54+08:00","description":"sticky change detail header","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":8,"completed":8}},{"slug":"2026-02-18-fix-vscode-live-reload-directory-moves","date":"2026-02-18","timestamp":"2026-02-18T20:15:33+08:00","description":"fix vscode live reload directory moves","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":2,"completed":2}},{"slug":"2026-02-18-live-reload","date":"2026-02-18","timestamp":"2026-02-18T19:51:09+08:00","description":"live reload","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":15,"completed":15}},{"slug":"2026-02-18-move-release-skill-to-project","date":"2026-02-18","timestamp":"2026-02-18T00:25:08+08:00","description":"move release skill to project","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":6,"completed":6}},{"slug":"2026-02-17-spec-graph-view","date":"2026-02-17","timestamp":"2026-02-17T23:49:54+08:00","description":"spec graph view","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":23,"completed":23}},{"slug":"2026-02-17-spec-diff-viewer","date":"2026-02-17","timestamp":"2026-02-17T12:25:28+08:00","description":"spec diff viewer","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":18,"completed":18}},{"slug":"2026-02-17-add-vscode-tab-icon","date":"2026-02-17","timestamp":"2026-02-17T10:47:36+08:00","description":"add vscode tab icon","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":2,"completed":2}},{"slug":"2026-02-16-ui-design-polish-p2","date":"2026-02-16","timestamp":"2026-02-16T02:14:36+08:00","description":"ui design polish p2","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":16,"completed":16}},{"slug":"2026-02-16-ui-design-polish-p0-p1","date":"2026-02-16","timestamp":"2026-02-16T01:41:38+08:00","description":"ui design polish p0 p1","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":12,"completed":12}},{"slug":"2026-02-15-add-frontend-design-skill","date":"2026-02-15","timestamp":"2026-02-15T23:40:22+08:00","description":"add frontend design skill","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":4,"completed":4}},{"slug":"2026-02-15-add-readme-acknowledgments","date":"2026-02-15","timestamp":"2026-02-15T00:55:14+08:00","description":"add readme acknowledgments","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":2,"completed":2}},{"slug":"2026-02-15-add-demo-link-to-readme","date":"2026-02-15","timestamp":"2026-02-15T00:43:11+08:00","description":"add demo link to readme","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":2,"completed":2}},{"slug":"2026-02-15-add-demo-page","date":"2026-02-15","timestamp":"2026-02-15T00:34:41+08:00","description":"add demo page","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":8,"completed":8}},{"slug":"2026-02-14-vscode-cicd-publish","date":"2026-02-14","timestamp":"2026-02-14T14:50:30+08:00","description":"vscode cicd publish","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":9,"completed":9}},{"slug":"2026-02-14-add-changelog-entry","date":"2026-02-14","timestamp":"2026-02-14T12:39:38+08:00","description":"add changelog entry","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":5,"completed":5}},{"slug":"2026-02-14-add-sidebar-toggle","date":"2026-02-14","timestamp":"2026-02-14T12:25:29+08:00","description":"add sidebar toggle","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":12,"completed":12}},{"slug":"2026-02-14-add-readme-screenshots","date":"2026-02-14","timestamp":"2026-02-14T00:09:09+08:00","description":"add readme screenshots","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":12,"completed":12}},{"slug":"2026-02-13-push-to-github","date":"2026-02-13","timestamp":"2026-02-13T23:41:51+08:00","description":"push to github","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":4,"completed":4}},{"slug":"2026-02-13-vscode-marketplace-publish","date":"2026-02-13","timestamp":"2026-02-13T22:58:03+08:00","description":"vscode marketplace publish","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":14,"completed":14}},{"slug":"2026-02-13-add-readme","date":"2026-02-13","timestamp":"2026-02-13T22:33:52+08:00","description":"add readme","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":6,"completed":6}},{"slug":"2026-02-13-apply-brand-logo","date":"2026-02-13","timestamp":"2026-02-13T22:23:07+08:00","description":"apply brand logo","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":5,"completed":5}},{"slug":"2026-02-13-vscode-extension","date":"2026-02-13","timestamp":"2026-02-13T22:10:22+08:00","description":"vscode extension","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":32,"completed":32}},{"slug":"2026-02-13-spec-history-git-timestamp-cache","date":"2026-02-13","timestamp":"2026-02-13T19:19:25+08:00","description":"spec history git timestamp cache","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":8,"completed":8}},{"slug":"2026-02-13-fix-task-stats-and-capability-nav","date":"2026-02-13","timestamp":"2026-02-13T18:53:25+08:00","description":"fix task stats and capability nav","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":7,"completed":7}},{"slug":"2026-02-13-phase4-polish-and-enhancement","date":"2026-02-13","timestamp":"2026-02-13T18:36:04+08:00","description":"phase4 polish and enhancement","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":21,"completed":21}},{"slug":"2026-02-13-phase3-markdown-and-search","date":"2026-02-13","timestamp":"2026-02-13T18:16:15+08:00","description":"phase3 markdown and search","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":13,"completed":13}},{"slug":"2026-02-13-phase2-core-ui-pages","date":"2026-02-13","timestamp":"2026-02-13T18:00:19+08:00","description":"phase2 core ui pages","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":27,"completed":27}},{"slug":"2026-02-13-phase1-skeleton-and-api","date":"2026-02-13","timestamp":"2026-02-13T17:37:45+08:00","description":"phase1 skeleton and api","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":true,"taskStats":{"total":25,"completed":25}},{"slug":"2026-02-13-initial-implementation","date":"2026-02-13","timestamp":"2026-02-13T12:52:04+08:00","description":"initial implementation","status":"archived","hasProposal":true,"hasDesign":true,"hasTasks":true,"hasSpecs":false,"taskStats":{"total":10,"completed":10}}]},"changeDetails":{"add-vscode-sidebar":{"slug":"add-vscode-sidebar","proposal":"## Why\r\n\r\nVS Code Marketplace 的兩位使用者（5 星評論）都反映希望能從 Activity Bar 直接開啟 spek，目前只能透過 Command Palette 或 status bar item 開啟，不夠直覺。新增 Activity Bar sidebar icon 可以讓 spek 更容易被發現和使用。\r\n\r\n## What Changes\r\n\r\n- 在 VS Code Activity Bar 新增 spek icon（使用 SVG）\r\n- 新增 sidebar ViewContainer + TreeView，顯示 OpenSpec 結構（Specs、Changes）\r\n- 點擊 TreeView item 可直接開啟 spek webview panel 並導航到對應內容\r\n- 保留現有的 Command Palette 和 status bar 進入方式不變\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `vscode-sidebar`: VS Code Activity Bar sidebar，提供 TreeView 瀏覽 OpenSpec 結構（specs 列表、changes 列表），點擊 item 開啟 webview panel 並導航至對應頁面\r\n\r\n### Modified Capabilities\r\n- `vscode-extension-host`: 新增 ViewContainer/TreeView 註冊、TreeDataProvider 實作，activation events 不變\r\n\r\n## Impact\r\n\r\n- `packages/vscode/package.json` — 新增 `viewsContainers`、`views`、`menus` contributes\r\n- `packages/vscode/src/` — 新增 TreeDataProvider 檔案，修改 extension.ts 註冊 TreeView\r\n- `packages/vscode/src/panel.ts` — 新增從 host 端導航 webview 到指定路由的 message\r\n- `@spek/core` — 無需修改，TreeDataProvider 直接呼叫現有 scanner API\r\n- Extension icon — 需要新增 Activity Bar 用的 SVG icon\r\n","design":"## Context\r\n\r\n目前 spek VS Code extension 只提供兩個進入點：Command Palette（`spek.open`、`spek.search`）和 status bar item。使用者必須先知道有這些指令才能使用，可見性低。兩位 Marketplace 評論者（5 星）都建議新增 sidebar icon。\r\n\r\nExtension 現有架構：\r\n- 3 個 source files：`extension.ts`（activation + commands）、`panel.ts`（Webview Panel singleton）、`handler.ts`（API dispatch）\r\n- 所有 UI 邏輯在 React webview 中，host 端僅處理 API 請求和生命週期\r\n- `@spek/core` 提供 `scanOpenSpec()` 可直接取得 specs/changes 列表\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 在 Activity Bar 新增 spek icon，提供 TreeView 瀏覽 OpenSpec 結構\r\n- TreeView 顯示 Specs 和 Changes 兩個分組\r\n- 點擊 TreeView item 開啟 webview panel 並導航到對應頁面\r\n- 偵測到 openspec/ 時自動顯示 sidebar\r\n\r\n**Non-Goals:**\r\n- 不在 TreeView 中顯示 spec 內容預覽（內容仍在 webview 中呈現）\r\n- 不支援從 TreeView 編輯 spec/change\r\n- 不取代現有的 Command Palette 和 status bar 進入點\r\n\r\n## Decisions\r\n\r\n### 1. 使用 VS Code native TreeView（非 Webview sidebar）\r\n\r\n**選擇**：使用 `vscode.TreeDataProvider` 實作原生 TreeView\r\n\r\n**理由**：原生 TreeView 效能好、風格一致、不需額外 CSP 設定。Webview sidebar 更靈活但增加複雜度且違反 VS Code UX 慣例。\r\n\r\n### 2. TreeView 結構：兩個 view（Specs + Changes）\r\n\r\n**選擇**：在同一個 ViewContainer 下註冊兩個 TreeView：`spek.specsView` 和 `spek.changesView`\r\n\r\n**理由**：分開的 view 讓使用者可以獨立收合，且各自有明確的 welcome message。單一 TreeView 用 group node 也可行，但兩個 view 更符合 VS Code 慣例（如 Explorer 有 OUTLINE、TIMELINE）。\r\n\r\n### 3. 導航機制：postMessage navigate command\r\n\r\n**選擇**：點擊 TreeView item 時，先 `createOrShow` webview panel，再 `postMessage({ type: 'navigate', path: '/specs/user-auth' })`\r\n\r\n**理由**：webview 已有 React Router，直接透過 message 觸發 `navigate()` 最簡單。不需修改 MessageAdapter 或新增 API endpoint。\r\n\r\n### 4. Activity Bar icon：自製 SVG\r\n\r\n**選擇**：使用與 status bar 和 webview favicon 一致的 spek icon SVG\r\n\r\n**理由**：品牌一致性。VS Code Activity Bar icon 需要 24x24 單色 SVG，需要從現有 favicon 調整。\r\n\r\n### 5. TreeDataProvider 實作：單一檔案\r\n\r\n**選擇**：新增 `packages/vscode/src/tree-provider.ts`，包含 `SpecsTreeProvider` 和 `ChangesTreeProvider` 兩個 class\r\n\r\n**理由**：兩個 provider 邏輯相似但資料不同，放同一個檔案保持簡潔。都使用 `scanOpenSpec()` 取得資料。\r\n\r\n### 6. 資料更新：利用現有 file watcher\r\n\r\n**選擇**：在 `openspec/**` 檔案變更時（現有 file watcher 已偵測），呼叫 TreeDataProvider 的 `refresh()` 方法\r\n\r\n**理由**：不需新增 watcher，複用現有機制。TreeDataProvider 透過 `onDidChangeTreeData` event 通知 VS Code 重新渲染。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **TreeView 資料量** → `scanOpenSpec()` 是同步掃描，大量 spec 時可能短暫阻塞。Mitigation：extension host 已在使用此函式，目前規模不是問題。\r\n- **Icon 設計** → Activity Bar icon 需要 24x24 單色 SVG，與彩色 favicon 不同。Mitigation：製作專用的單色版本。\r\n- **Navigate message** → webview 需要能接收新的 `navigate` message type。Mitigation：在 React app 入口加一個 message listener 即可，改動很小。\r\n","tasks":{"total":17,"completed":16,"sections":[{"title":"1. Activity Bar Icon & ViewContainer 註冊","tasks":[{"text":"1.1 建立 24x24 單色 SVG icon 給 Activity Bar 使用（`packages/vscode/media/sidebar-icon.svg`）","completed":true},{"text":"1.2 在 `packages/vscode/package.json` 新增 `viewsContainers.activitybar` 註冊 spek ViewContainer","completed":true},{"text":"1.3 在 `packages/vscode/package.json` 新增 `views` 註冊 `spek.specsView` 和 `spek.changesView` 兩個 TreeView","completed":true},{"text":"1.4 設定 `when` clause 讓 sidebar 只在 workspace 有 openspec/ 時顯示","completed":true}]},{"title":"2. TreeDataProvider 實作","tasks":[{"text":"2.1 新增 `packages/vscode/src/tree-provider.ts`，實作 `SpecsTreeProvider` class（implements `TreeDataProvider`）","completed":true},{"text":"2.2 實作 `ChangesTreeProvider` class，支援 active/archived 分組顯示","completed":true},{"text":"2.3 兩個 provider 都使用 `@spek/core` 的 `scanOpenSpec()` 取得資料","completed":true},{"text":"2.4 實作 `refresh()` 方法透過 `onDidChangeTreeData` event 觸發更新","completed":true}]},{"title":"3. Extension 整合","tasks":[{"text":"3.1 修改 `extension.ts`，在 activate 時註冊兩個 TreeDataProvider","completed":true},{"text":"3.2 連接現有 file watcher，在 openspec/ 檔案變更時呼叫 TreeProvider 的 `refresh()`","completed":true},{"text":"3.3 在 `package.json` 新增 `spek.openDashboard` command 並註冊為 SPECS view 的 toolbar action","completed":true}]},{"title":"4. Webview 導航","tasks":[{"text":"4.1 在 `panel.ts` 新增 `navigateTo(path)` 方法，透過 postMessage 發送 `{ type: 'navigate', path }` 給 webview","completed":true},{"text":"4.2 在 React app 入口加入 `navigate` message listener，收到後呼叫 React Router 的 `navigate()`","completed":true},{"text":"4.3 TreeView item 的 command 綁定：點擊 spec item 呼叫 `navigateTo('/specs/<topic>')`，點擊 change item 呼叫 `navigateTo('/changes/<slug>')`","completed":true}]},{"title":"5. 驗證與清理","tasks":[{"text":"5.1 執行 `npm run type-check` 確認無型別錯誤","completed":true},{"text":"5.2 執行 `npm run build:vscode` 確認 extension 可正常 build","completed":true},{"text":"5.3 手動測試：打開含 openspec/ 的 workspace，確認 sidebar icon 出現、TreeView 顯示正確、點擊可導航","completed":false}]}]},"specs":[{"topic":"vscode-extension-host","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Extension activation\r\nThe extension SHALL activate when a workspace containing an `openspec/` directory is opened, or when the user explicitly invokes a spek command. Upon activation, the extension SHALL register TreeView providers for the sidebar and display the Activity Bar icon.\r\n\r\n#### Scenario: Workspace with openspec directory\r\n- **WHEN** VS Code opens a workspace where the first workspace folder contains an `openspec/` directory\r\n- **THEN** the extension activates, displays a spek icon in the status bar, and registers the sidebar TreeView providers\r\n\r\n#### Scenario: Workspace without openspec directory\r\n- **WHEN** VS Code opens a workspace without an `openspec/` directory\r\n- **THEN** the extension remains inactive, no status bar icon is shown, and the sidebar is hidden\r\n\r\n#### Scenario: Manual activation via command\r\n- **WHEN** the user invokes the `spek.open` command from the command palette\r\n- **THEN** the extension activates and opens the spek Webview Panel\r\n\r\n### Requirement: Webview Panel lifecycle\r\nThe extension SHALL manage a single Webview Panel instance for displaying the spek UI. The panel SHALL support navigation commands from the extension host.\r\n\r\n#### Scenario: Open spek panel\r\n- **WHEN** the user invokes `spek.open` and no panel exists\r\n- **THEN** the extension creates a new Webview Panel in the active editor column with the title \"spek\"\r\n\r\n#### Scenario: Focus existing panel\r\n- **WHEN** the user invokes `spek.open` and a panel already exists\r\n- **THEN** the extension reveals (focuses) the existing panel instead of creating a new one\r\n\r\n#### Scenario: Panel disposal\r\n- **WHEN** the user closes the spek Webview Panel\r\n- **THEN** the extension cleans up the panel reference and associated message listeners\r\n\r\n#### Scenario: Navigate panel to route\r\n- **WHEN** the extension host sends a `navigate` message with a route path\r\n- **THEN** the webview navigates to the specified route using React Router\r\n"},{"topic":"vscode-sidebar","content":"## ADDED Requirements\r\n\r\n### Requirement: Activity Bar icon\r\nThe extension SHALL register a ViewContainer in the Activity Bar with a spek-branded SVG icon. The ViewContainer SHALL be visible when the workspace contains an `openspec/` directory.\r\n\r\n#### Scenario: Activity Bar icon visible with openspec workspace\r\n- **WHEN** VS Code opens a workspace containing an `openspec/` directory\r\n- **THEN** the spek icon appears in the Activity Bar\r\n\r\n#### Scenario: Activity Bar icon hidden without openspec workspace\r\n- **WHEN** VS Code opens a workspace without an `openspec/` directory\r\n- **THEN** the spek icon is not displayed in the Activity Bar\r\n\r\n### Requirement: Specs TreeView\r\nThe sidebar SHALL display a TreeView listing all specs from the OpenSpec repository. Each item SHALL display the spec topic name. Items SHALL be sorted alphabetically.\r\n\r\n#### Scenario: Display specs list\r\n- **WHEN** the user opens the spek sidebar\r\n- **THEN** a \"SPECS\" section displays all spec topics sorted alphabetically\r\n\r\n#### Scenario: Empty specs\r\n- **WHEN** the workspace has an openspec directory with no specs\r\n- **THEN** the SPECS section displays a welcome message indicating no specs found\r\n\r\n### Requirement: Changes TreeView\r\nThe sidebar SHALL display a TreeView listing changes from the OpenSpec repository, grouped by status (active and archived). Each item SHALL display the change slug name.\r\n\r\n#### Scenario: Display changes with active and archived groups\r\n- **WHEN** the workspace has both active and archived changes\r\n- **THEN** the CHANGES section displays two groups: \"Active\" and \"Archived\", each containing their respective change items\r\n\r\n#### Scenario: Display changes with only active changes\r\n- **WHEN** the workspace has only active changes\r\n- **THEN** the CHANGES section displays only the \"Active\" group\r\n\r\n#### Scenario: Empty changes\r\n- **WHEN** the workspace has no changes\r\n- **THEN** the CHANGES section displays a welcome message indicating no changes found\r\n\r\n### Requirement: TreeView item navigation\r\nWhen the user clicks a TreeView item, the extension SHALL open the spek Webview Panel and navigate to the corresponding page.\r\n\r\n#### Scenario: Click spec item\r\n- **WHEN** the user clicks a spec item with topic \"user-auth\"\r\n- **THEN** the extension opens the spek webview panel and navigates to `/specs/user-auth`\r\n\r\n#### Scenario: Click change item\r\n- **WHEN** the user clicks a change item with slug \"add-login\"\r\n- **THEN** the extension opens the spek webview panel and navigates to `/changes/add-login`\r\n\r\n#### Scenario: Panel already open\r\n- **WHEN** the webview panel is already open and the user clicks a TreeView item\r\n- **THEN** the panel is revealed and navigated to the corresponding page without creating a new panel\r\n\r\n### Requirement: TreeView refresh on file changes\r\nThe TreeView SHALL automatically refresh when files under the `openspec/` directory are created, modified, or deleted.\r\n\r\n#### Scenario: New spec added\r\n- **WHEN** a new spec file is created under `openspec/specs/`\r\n- **THEN** the Specs TreeView refreshes to include the new spec item\r\n\r\n#### Scenario: Change deleted\r\n- **WHEN** a change directory is deleted under `openspec/changes/`\r\n- **THEN** the Changes TreeView refreshes to remove the deleted change item\r\n\r\n### Requirement: Open spek command from sidebar\r\nThe sidebar SHALL provide a toolbar action button to open the full spek Webview Panel (dashboard view).\r\n\r\n#### Scenario: Click open button in sidebar toolbar\r\n- **WHEN** the user clicks the open button in the SPECS view toolbar\r\n- **THEN** the spek webview panel opens showing the dashboard view\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-23"}},"2026-02-22-fix-demo-build-and-release-skill":{"slug":"2026-02-22-fix-demo-build-and-release-skill","proposal":"## Why\r\n\r\n`build-demo.ts` 在 `scanOpenSpec` 改為 async 後漏加 `await`，導致 demo build 失敗。自 v0.4.0 起 `docs/demo.html` 就沒有更新過。同時 release skill 未包含 demo rebuild 步驟，即使 bug 修復後仍會在每次 release 時遺漏 demo 更新。\r\n\r\n## What Changes\r\n\r\n- 修復 `scripts/build-demo.ts` 中 `scanOpenSpec()` 呼叫缺少 `await` 的 bug\r\n- 在 release skill（`.agents/skills/release/SKILL.md`）中新增 demo rebuild 步驟，確保每次 release 都會更新 `docs/demo.html`\r\n- 重新 build `docs/demo.html` 使其反映最新版本\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無）\r\n\r\n### Modified Capabilities\r\n\r\n（無 — 此修改僅涉及 build script bug fix 和 skill 文件調整，不影響任何 spec-level 行為）\r\n\r\n## Impact\r\n\r\n- `scripts/build-demo.ts` — 加入 `await`\r\n- `.agents/skills/release/SKILL.md` — 新增步驟 5（rebuild demo）、步驟編號順延\r\n- `docs/demo.html` — 重新產生，檔案內容會大幅變動（反映 v0.4.0 ~ v0.6.4 的所有功能）\r\n","design":"## Context\r\n\r\n`scanOpenSpec` 在 v0.5.0 加入 git timestamp cache 時從同步改為 async，但 `scripts/build-demo.ts` 的呼叫端沒有跟著加 `await`，導致拿到 Promise 物件而非 ScanResult。自 v0.4.0 以來 demo build 都會失敗。\r\n\r\nRelease skill（`.agents/skills/release/SKILL.md`）流程中沒有 demo rebuild 步驟，即使 bug 修復後 release 時仍不會自動更新 demo page。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 修復 `build-demo.ts` 使 `npm run build:demo` 正常運作\r\n- 在 release skill 流程中加入 demo rebuild，確保每次 release 都更新 GitHub Pages demo\r\n- 重新產生 `docs/demo.html` 反映當前版本\r\n\r\n**Non-Goals:**\r\n- 不建立 CI/CD workflow 自動部署 demo（透過 release skill 手動觸發即可）\r\n- 不改變 demo build 架構或輸出格式\r\n\r\n## Decisions\r\n\r\n1. **修復方式：加 `await`** — `build-demo.ts` 第 25 行 `scanOpenSpec(ROOT)` 前加 `await`。這是唯一需要的程式碼修改。\r\n\r\n2. **Release skill 步驟位置：changelog commit 之後、npm version 之前** — 在步驟 4（commit changelog）與原步驟 5（npm version）之間插入 demo rebuild。這樣 demo 的 commit 會在 version tag 之前，確保 tag 指向的 commit 包含最新 demo。\r\n\r\n## Risks / Trade-offs\r\n\r\n- demo.html 檔案較大（~1.1 MB），每次 release 都會產生大 diff — 可接受，因為是 build artifact\r\n- Release 時間會略增（demo build 約 3 秒）— 影響極小\r\n","tasks":{"total":5,"completed":5,"sections":[{"title":"1. Fix demo build script","tasks":[{"text":"1.1 在 `scripts/build-demo.ts` 的 `scanOpenSpec(ROOT)` 呼叫前加上 `await`","completed":true}]},{"title":"2. Update release skill","tasks":[{"text":"2.1 在 `.agents/skills/release/SKILL.md` 步驟 4（commit changelog）之後新增步驟 5：rebuild demo（`npm run build:demo` + commit）","completed":true},{"text":"2.2 順延後續步驟編號（原 5→6, 6→7, 7→8）","completed":true}]},{"title":"3. Rebuild demo","tasks":[{"text":"3.1 執行 `npm run build:demo` 確認成功","completed":true},{"text":"3.2 確認 `docs/demo.html` 已更新","completed":true}]}]},"specs":[],"metadata":{"schema":"spec-driven","created":"2026-02-21"}},"2026-02-22-fix-change-not-found-on-refresh":{"slug":"2026-02-22-fix-change-not-found-on-refresh","proposal":"## Why\r\n\r\n使用者在 spek 中開啟一個 active change 頁面後，當該 change 被 archive（檔案從 `openspec/changes/<slug>/` 搬移到 `openspec/changes/archive/<slug>/`），file watcher 觸發 refresh re-fetch。若在搬移過程中發生短暫的競態條件導致 re-fetch 失敗，`useAsyncData` 保留了舊 data 但同時也設了 error，而頁面元件的 `if (error)` 檢查在 `if (!data)` 之前，導致即使有有效資料仍顯示 \"Change not found\" 錯誤。此外，Web 版的 `FetchAdapter` 丟出的錯誤訊息只有 \"HTTP 404\"，未解析 server 回應的描述性錯誤訊息。\r\n\r\n## What Changes\r\n\r\n- 修正 `useAsyncData` hook：當 refresh 觸發的 re-fetch 失敗且有既存 data 時，不設定 error（靜默保留舊資料）\r\n- 改善 `FetchAdapter` 的 `fetchJson`：解析 server 回應的 error body，顯示更具描述性的錯誤訊息\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增）\r\n\r\n### Modified Capabilities\r\n\r\n- `live-reload`：新增 refresh re-fetch 失敗時的行為規範 — 若有既存資料應靜默保留，不顯示錯誤\r\n\r\n## Impact\r\n\r\n- `packages/web/src/hooks/useOpenSpec.ts` — `useAsyncData` catch handler\r\n- `packages/web/src/api/FetchAdapter.ts` — `fetchJson` 錯誤處理\r\n","design":"## Context\r\n\r\n`useAsyncData` hook 負責所有 API 資料的 fetch 與 refresh。當 file watcher 觸發 `refreshKey` 變更時，hook 會重新 fetch 資料。目前的 catch handler 在 refresh 失敗時保留舊 data 但同時設定 error，而所有頁面元件都先檢查 `error` 再檢查 `data`，導致即使有有效資料仍顯示錯誤。\r\n\r\n此外，`FetchAdapter.fetchJson` 在 HTTP 錯誤時只丟出 `HTTP <status>`，未解析 server 回傳的錯誤訊息。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- Refresh re-fetch 失敗時，若有既存 data 則靜默保留，不顯示錯誤\r\n- Web 版的 API 錯誤訊息應包含 server 回傳的描述性訊息\r\n\r\n**Non-Goals:**\r\n- 不改動 `readChange()` 核心邏輯（已正確處理 active/archive 雙路徑查找）\r\n- 不改動 file watcher 機制或 debounce 時間\r\n- 不新增 retry 機制\r\n\r\n## Decisions\r\n\r\n### Decision 1: 在 useAsyncData catch handler 中條件性設定 error\r\n\r\n**選擇**：當 `refreshTriggered && prev.data` 為 true 時，將 error 設為 null\r\n\r\n**替代方案**：在每個頁面元件中改為 `if (error && !data)` — 需修改多個檔案，且容易遺漏\r\n\r\n**理由**：源頭修正，一處改動解決所有頁面的問題。當 refresh 失敗但有既存資料時，使用者看到稍微過時的資料遠比看到錯誤訊息好。若資料真的被刪除，使用者重新導航（非 refresh 觸發）時會正確顯示錯誤。\r\n\r\n### Decision 2: FetchAdapter 解析 error response body\r\n\r\n**選擇**：在 `fetchJson` 中，HTTP 錯誤時嘗試解析 JSON body 的 `error` 欄位\r\n\r\n**理由**：Server 回傳的錯誤如 `{ error: \"Change not found\" }` 比 `HTTP 404` 更具可讀性，與 VS Code MessageAdapter 的行為一致。\r\n\r\n## Risks / Trade-offs\r\n\r\n- [refresh 失敗被靜默] → 使用者可能短暫看到過時資料，但下次成功 refresh 或重新導航會更新。可接受的 trade-off，因為 refresh 是自動觸發而非使用者主動請求。\r\n- [error body 解析失敗] → fallback 到原本的 `HTTP <status>` 訊息，無功能損失。\r\n","tasks":{"total":4,"completed":4,"sections":[{"title":"1. Fix useAsyncData refresh error handling","tasks":[{"text":"1.1 修改 `packages/web/src/hooks/useOpenSpec.ts` 的 `useAsyncData` catch handler：當 `refreshTriggered && prev.data` 為 true 時，設 error 為 null","completed":true}]},{"title":"2. Improve FetchAdapter error messages","tasks":[{"text":"2.1 修改 `packages/web/src/api/FetchAdapter.ts` 的 `fetchJson`：HTTP 錯誤時解析 response body 的 `error` 欄位，fallback 到 `HTTP <status>`","completed":true}]},{"title":"3. Verification","tasks":[{"text":"3.1 執行 `npm run type-check` 確認無 TypeScript 錯誤","completed":true},{"text":"3.2 執行 `npm run build` 確認建置成功","completed":true}]}]},"specs":[{"topic":"live-reload","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Debounced re-fetch in useAsyncData\r\nThe `useAsyncData` hook SHALL support automatic re-fetch triggered by `refreshKey` changes with debounce to avoid excessive requests.\r\n\r\n#### Scenario: Re-fetch on refreshKey change\r\n- **WHEN** `refreshKey` changes in the `RefreshContext`\r\n- **THEN** `useAsyncData` triggers a new fetch after a 300ms debounce delay\r\n\r\n#### Scenario: Debounce coalesces rapid changes\r\n- **WHEN** `refreshKey` changes multiple times within 300ms\r\n- **THEN** only one re-fetch is triggered after the last change\r\n\r\n#### Scenario: Existing data preserved during re-fetch\r\n- **WHEN** a re-fetch is triggered by `refreshKey` change\r\n- **THEN** the existing `data` SHALL remain visible (no loading flash) until the new data arrives\r\n\r\n#### Scenario: Refresh failure with existing data\r\n- **WHEN** a re-fetch triggered by `refreshKey` change fails with an error\r\n- **AND** the hook already has existing data from a previous successful fetch\r\n- **THEN** the existing `data` SHALL be preserved\r\n- **AND** the `error` state SHALL NOT be set (remains null)\r\n\r\n#### Scenario: Refresh failure without existing data\r\n- **WHEN** a re-fetch triggered by `refreshKey` change fails with an error\r\n- **AND** the hook has no existing data (data is null)\r\n- **THEN** the `error` state SHALL be set to the error message\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-21"}},"2026-02-21-add-change-timestamp":{"slug":"2026-02-21-add-change-timestamp","proposal":"## Why\r\n\r\n`ChangeInfo` 目前的 `date` 欄位只有從 slug 解析的 `YYYY-MM-DD`，沒有時間資訊。同一天建立的多個 changes 排序不精確，Dashboard 的「Recently Archived」和 Changes 列表只顯示日期，無法區分先後。`git-timestamp-cache` 已經能取得精確的 git commit timestamp，但目前只用在 spec history，沒有用在 changes 列表。\r\n\r\n## What Changes\r\n\r\n- `ChangeInfo` type 新增 `timestamp: string | null` 欄位\r\n- `scanOpenSpec()` 改為 async，掃描時透過 `getTimestamps()` 填入每個 change 的 git timestamp\r\n- Changes 排序邏輯改為優先用 timestamp，fallback 回 slug date\r\n- Dashboard「Recently Archived」和 ChangeList 顯示格式化的日期時間（而非只有 YYYY-MM-DD）\r\n- Web server routes 和 VS Code handler 配合 async 調整\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增）\r\n\r\n### Modified Capabilities\r\n\r\n- `openspec-scanner`: `scanOpenSpec` 改為 async，`ChangeInfo` 增加 `timestamp` 欄位，排序使用 timestamp\r\n- `dashboard-view`: Recently Archived 區塊顯示精確的日期時間\r\n- `change-browsing`: Change 列表顯示精確的日期時間\r\n\r\n## Impact\r\n\r\n- `@spek/core`: `types.ts`（ChangeInfo 加欄位）、`scanner.ts`（async + timestamp enrichment）\r\n- `@spek/web`: `server/routes/openspec.ts`（routes 改 async）、`Dashboard.tsx`、`ChangeList.tsx`（日期顯示）\r\n- `spek-vscode`: `handler.ts`（getChanges/getOverview 配合 async）\r\n- Demo: `StaticAdapter` 不受影響（靜態資料無 git）\r\n","design":"## Context\r\n\r\n`ChangeInfo` 的 `date` 欄位來自 slug 解析（`YYYY-MM-DD`），只有日期沒有時間。`git-timestamp-cache` 模組已能取得每個 change 的 git commit timestamp（ISO 8601），但只用在 `readSpec()` 的 history timeline，未用在 `scanOpenSpec()` 回傳的 changes 列表。\r\n\r\n目前 `scanOpenSpec()` 是同步函式，而 `getTimestamps()` 是 async（需要執行 git 指令）。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- `ChangeInfo` 包含精確的 git timestamp\r\n- Changes 排序用 timestamp 取代純日期\r\n- Dashboard 和 ChangeList UI 顯示含時間的日期\r\n\r\n**Non-Goals:**\r\n- 不改變 `buildChangeTimestamps` 的行為（仍取最早 commit）\r\n- 不改變 SpecDetail history 的現有邏輯\r\n- 不改變 slug 命名規則\r\n\r\n## Decisions\r\n\r\n### 1. `scanOpenSpec` 改為 async\r\n\r\n**決定**：將 `scanOpenSpec()` 改為 `async function`，內部呼叫 `getTimestamps()` 後將 timestamp 填入每個 `ChangeInfo`。\r\n\r\n**替代方案**：在 API 層做 enrichment（scan 後再另外呼叫 getTimestamps 補資料）。但這樣每個 caller（web routes、VS Code handler）都要重複同樣的 enrichment 邏輯，不如直接在 scanner 層處理。\r\n\r\n**影響**：所有呼叫 `scanOpenSpec` 的地方需要加 `await`，包括 web server routes 和 VS Code handler。\r\n\r\n### 2. 排序邏輯\r\n\r\n**決定**：排序優先用 `timestamp`，無 timestamp 時 fallback 回 `date`，與 `readSpec()` 中 history 的排序邏輯一致。\r\n\r\n### 3. UI 日期格式\r\n\r\n**決定**：使用 relative time 格式（如「3 hours ago」「2 days ago」），hover 時 title 顯示完整 ISO timestamp。無 timestamp 時 fallback 顯示原始 `YYYY-MM-DD`。\r\n\r\n**理由**：relative time 在「Recently Archived」語境下比絕對時間更直覺。格式化邏輯寫成共用的 `formatRelativeTime()` utility。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **效能**：`getTimestamps()` 有 in-memory cache，首次呼叫需要執行 git log，後續直接從 cache 取。對大型 repo 首次載入可能多幾百 ms，但 cache 機制已足夠。→ 可接受\r\n- **非 git 環境**：非 git repo 時 `getTimestamps()` 回傳空 Map，所有 timestamp 為 null，fallback 回原本的 date 顯示。→ 無退化\r\n","tasks":{"total":10,"completed":10,"sections":[{"title":"1. Core Type & Scanner","tasks":[{"text":"1.1 在 `types.ts` 的 `ChangeInfo` 加入 `timestamp: string | null` 欄位","completed":true},{"text":"1.2 將 `scanner.ts` 的 `scanOpenSpec()` 改為 async，內部呼叫 `getTimestamps()` 填入每個 ChangeInfo 的 timestamp","completed":true},{"text":"1.3 更新排序邏輯：優先用 timestamp 降序排列，fallback 回 slug date","completed":true}]},{"title":"2. API Layer","tasks":[{"text":"2.1 更新 `packages/web/server/routes/openspec.ts` 的 `/overview` 和 `/changes` routes 為 async，配合 `await scanOpenSpec()`","completed":true},{"text":"2.2 更新 `packages/vscode/src/handler.ts` 的 `getOverview()`、`getSpecs()`、`getChanges()` 為 async，配合 `await scanOpenSpec()`","completed":true}]},{"title":"3. Frontend UI","tasks":[{"text":"3.1 建立 `formatRelativeTime(isoString)` utility 函式（回傳如 \"3 hours ago\"、\"2 days ago\"）","completed":true},{"text":"3.2 更新 `Dashboard.tsx` 的 Recently Archived 區塊：有 timestamp 時顯示 relative time（title 顯示完整時間），無 timestamp 時 fallback 顯示 date","completed":true},{"text":"3.3 更新 `ChangeList.tsx` 的 active 和 archived 區塊：同上格式","completed":true}]},{"title":"4. Build & Verify","tasks":[{"text":"4.1 執行 `npm run type-check` 確認無型別錯誤","completed":true},{"text":"4.2 執行 `npm run build` 確認 build 成功","completed":true}]}]},"specs":[{"topic":"change-browsing","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Active changes SHALL be visually distinguished with a left accent color border (4px). Changes SHALL be sorted by git timestamp descending (most recent first), falling back to slug date when timestamp is unavailable. Each change SHALL display a relative time indicator (e.g., \"3 hours ago\", \"2 days ago\") when a git timestamp is available, with the full ISO timestamp shown as a tooltip on hover. When no git timestamp is available, the system SHALL fall back to displaying the slug date in YYYY-MM-DD format.\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with a left accent color border, name, and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by timestamp descending, without accent border\r\n\r\n#### Scenario: Display relative time for changes with timestamp\r\n- **WHEN** a change has a git timestamp\r\n- **THEN** the change displays a relative time (e.g., \"2 days ago\") instead of YYYY-MM-DD\r\n- **AND** hovering shows the full ISO timestamp as a tooltip\r\n\r\n#### Scenario: Display date for changes without timestamp\r\n- **WHEN** a change has no git timestamp\r\n- **THEN** the change displays the slug date in YYYY-MM-DD format\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n"},{"topic":"dashboard-view","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Recent archived changes\r\nThe system SHALL display the most recent 10 archived changes. Each change SHALL display a relative time indicator (e.g., \"3 hours ago\", \"2 days ago\") when a git timestamp is available, with the full ISO timestamp shown as a tooltip on hover. When no git timestamp is available, the system SHALL fall back to displaying the slug date in YYYY-MM-DD format.\r\n\r\n#### Scenario: Show archived changes with timestamp\r\n- **WHEN** user views the Dashboard and archived changes have git timestamps\r\n- **THEN** the most recent 10 archived changes are listed with their names and relative time (e.g., \"3 hours ago\")\r\n- **AND** hovering over the time shows the full ISO timestamp as a tooltip\r\n\r\n#### Scenario: Show archived changes without timestamp\r\n- **WHEN** user views the Dashboard and archived changes have no git timestamp\r\n- **THEN** the changes are listed with their names and slug date in YYYY-MM-DD format\r\n"},{"topic":"openspec-scanner","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL be an async function in the `@spek/core` package that reads an OpenSpec directory and returns its complete structure including specs, active changes, and archived changes. Each `ChangeInfo` SHALL include a `timestamp` field (ISO 8601 string or null) obtained from the git timestamp cache. Changes SHALL be sorted by timestamp descending (most recent first), falling back to slug date when timestamp is unavailable. It SHALL use Node.js `fs` directly and have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n- **AND** each `ChangeInfo` in `activeChanges` and `archivedChanges` SHALL include a `timestamp` field from the git timestamp cache\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n#### Scenario: Sort changes by timestamp\r\n- **WHEN** multiple changes exist with the same slug date (e.g., `2026-02-17-foo` and `2026-02-17-bar`)\r\n- **THEN** changes SHALL be sorted by git timestamp descending (most recent first)\r\n\r\n#### Scenario: Sort changes without git timestamps\r\n- **WHEN** the repo is not a git repository or changes have no git history\r\n- **THEN** changes SHALL be sorted by slug date descending as fallback\r\n- **AND** all `timestamp` fields SHALL be null\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-21"}},"2026-02-21-fix-detect-fallback":{"slug":"2026-02-21-fix-detect-fallback","proposal":"## Why\r\n\r\nOpenSpec CLI 不強制要求 `config.yaml` 存在，只要有 `openspec/` 目錄就能正常運作。但 spek 的 detect API 和 VS Code activation 都只檢查 `openspec/config.yaml` 是否存在，導致缺少 `config.yaml` 的有效 OpenSpec repo 無法被偵測到。\r\n\r\n## What Changes\r\n\r\n- 修正 detect 邏輯：先檢查 `config.yaml`，若不存在則 fallback 檢查 `openspec/specs/` 或 `openspec/changes/` 目錄是否存在\r\n- 有 `config.yaml` 時回傳 schema；fallback 偵測到時 schema 為 `\"unknown\"`\r\n- Web server 和 VS Code handler 兩邊都要修\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增）\r\n\r\n### Modified Capabilities\r\n\r\n- `filesystem-api`: detect endpoint 增加 fallback 偵測邏輯\r\n\r\n## Impact\r\n\r\n- `packages/web/server/routes/filesystem.ts`：detect route\r\n- `packages/vscode/src/handler.ts`：detect method\r\n","design":"## Context\r\n\r\n目前 detect 邏輯只檢查 `openspec/config.yaml` 是否存在。OpenSpec CLI 不強制要求此檔案，許多 repo 只有 `openspec/specs/` 和 `openspec/changes/` 而無 `config.yaml`。\r\n\r\nWeb server (`filesystem.ts`) 和 VS Code handler (`handler.ts`) 各有一份 detect 實作，邏輯相同。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 有 `config.yaml` 時行為不變（回傳 schema）\r\n- 無 `config.yaml` 但有 `openspec/specs/` 或 `openspec/changes/` 時，回傳 `hasOpenSpec: true, schema: \"unknown\"`\r\n- Web 和 VS Code 兩邊同步修正\r\n\r\n**Non-Goals:**\r\n- 不修改 VS Code `activationEvents`（`workspaceContains:openspec/config.yaml`），那是 VS Code 的限制，不影響功能\r\n- 不將 detect 邏輯抽到 `@spek/core`（scope 太小，兩邊各幾行即可）\r\n\r\n## Decisions\r\n\r\n### Fallback 偵測策略\r\n\r\n**決定**：檢查 `openspec/specs/` 或 `openspec/changes/` 目錄是否存在，任一存在即視為有效。\r\n\r\n**理由**：這兩個目錄是 OpenSpec 的核心結構。只有空的 `openspec/` 目錄（無 specs/ 也無 changes/）不視為有效。\r\n\r\n## Risks / Trade-offs\r\n\r\n- 誤判風險極低：一般專案不會恰好有 `openspec/specs/` 或 `openspec/changes/` 目錄\r\n- fallback 偵測到的 repo schema 為 `\"unknown\"`，不影響瀏覽功能（scanner 不依賴 schema）\r\n","tasks":{"total":5,"completed":5,"sections":[{"title":"1. Web Server","tasks":[{"text":"1.1 修正 `packages/web/server/routes/filesystem.ts` 的 detect route：先檢查 config.yaml，不存在時 fallback 檢查 specs/ 或 changes/ 目錄","completed":true}]},{"title":"2. VS Code Handler","tasks":[{"text":"2.1 修正 `packages/vscode/src/handler.ts` 的 detect method：同上 fallback 邏輯","completed":true}]},{"title":"3. Verify","tasks":[{"text":"3.1 執行 `npm run type-check` 確認無型別錯誤","completed":true},{"text":"3.2 執行 `npm run build` 確認 build 成功","completed":true},{"text":"3.3 用瀏覽器測試：輸入缺少 config.yaml 的 repo 路徑（/home/kewang/git/ha-claude-assistant），確認能偵測到並進入 dashboard","completed":true}]}]},"specs":[{"topic":"filesystem-api","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Detect OpenSpec directory\r\nThe system SHALL provide an API endpoint `GET /api/fs/detect` that checks whether a given path contains a valid OpenSpec directory. Detection SHALL first check for `openspec/config.yaml`. If `config.yaml` does not exist, the system SHALL fallback to checking whether `openspec/specs/` or `openspec/changes/` directory exists.\r\n\r\n#### Scenario: Path contains valid OpenSpec directory with config.yaml\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"<schema-value>\" }`\r\n\r\n#### Scenario: Path contains OpenSpec directory without config.yaml\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` does not exist\r\n- **AND** `/home/user/my-repo/openspec/specs/` or `/home/user/my-repo/openspec/changes/` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"unknown\" }`\r\n\r\n#### Scenario: Path does not contain OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/empty-repo`\r\n- **AND** no `openspec/` directory exists at that path, or `openspec/` exists but contains neither `specs/` nor `changes/`\r\n- **THEN** system returns `{ \"hasOpenSpec\": false }`\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-21"}},"2026-02-21-sticky-change-detail-header":{"slug":"2026-02-21-sticky-change-detail-header","proposal":"## Why\r\n\r\nChangeDetail 頁面的 tab 導航（Proposal / Design / Specs / Tasks）和 change 標題在內容較長時會隨頁面捲動消失，使用者必須捲回頂部才能切換 tab，影響瀏覽體驗。\r\n\r\n## What Changes\r\n\r\n- 將 ChangeDetail 頁面的 change 標題（含返回連結）和 tab 導航列固定在頂部（sticky），捲動時不會消失\r\n- TabView 元件新增 sticky 定位支援，讓 tab bar 區塊可黏在頁面頂部\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增 capability）\r\n\r\n### Modified Capabilities\r\n\r\n- `change-browsing`: Change detail 的 tab 導航列和標題在捲動時固定於頂部\r\n\r\n## Impact\r\n\r\n- `packages/web/src/components/TabView.tsx` — 新增 sticky 定位支援\r\n- `packages/web/src/pages/ChangeDetail.tsx` — 調整結構讓標題和 tab 一起 sticky\r\n- 不影響 API、後端或其他頁面\r\n","design":"## Context\r\n\r\nChangeDetail 頁面使用 `TabView` 元件呈現 Proposal / Design / Specs / Tasks 四個 tab。目前頁面滾動由 window 層級處理（Layout 的 `<main>` 沒有獨立 scroll container），header 是 `fixed top-0 h-14`，main content 以 `pt-18 p-6` 偏移。\r\n\r\n當 change 內容較長時，使用者需捲回頂部才能看到 tab 導航列和 change 標題。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 讓 change 標題（含返回連結）和 tab 導航列在捲動時 sticky 固定於 header 下方\r\n- 對現有 TabView 做最小幅度修改，保持元件通用性\r\n\r\n**Non-Goals:**\r\n- 不改其他頁面的捲動行為\r\n- 不改 Layout header 或 Sidebar 結構\r\n\r\n## Decisions\r\n\r\n### 1. 在 TabView 加入 `header` 和 `sticky` props\r\n\r\n**選擇**：擴充 TabView 接受可選的 `header` ReactNode 和 `sticky` boolean prop。sticky 為 true 時，header + tab bar 一起包在 `sticky top-14` 容器中。\r\n\r\n**理由**：TabView 目前只被 ChangeDetail 使用，但保持 props 可選讓元件仍可在無 sticky 的情境通用。比起在 ChangeDetail 中手動管理 tab state，此方式不重複邏輯。\r\n\r\n**替代方案**：在 ChangeDetail 中自行管理 activeTab state 並手動 render tab buttons + content — 但會重複 TabView 已有的邏輯。\r\n\r\n### 2. 使用 CSS `sticky` 而非 `fixed`\r\n\r\n**選擇**：使用 `position: sticky; top: 3.5rem`（`top-14`，緊貼 Layout header 下方）。\r\n\r\n**理由**：sticky 自然跟隨文件流，不需手動計算寬度或 offset，也不影響 content 排版。因為頁面用 window scroll 而非 overflow container，sticky 在 `<main>` 內可正確運作。\r\n\r\n### 3. Sticky 容器負 margin + padding 拉寬至 main 邊界\r\n\r\n**選擇**：sticky 容器用 `-mx-6 px-6` 讓背景色延伸至 main 的 padding 邊界，避免左右露出底部內容。\r\n\r\n**理由**：main 有 `p-6`，若 sticky 容器不補齊，捲動時兩側會透出下方內容，視覺不佳。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **z-index 衝突**：sticky 容器需要 z-index 高於 content 但低於 header（z-10）和 sidebar（z-30）。使用 `z-[5]` 可滿足此需求。\r\n- **背景色遮蓋**：sticky 容器必須有 `bg-bg-primary` 背景才能遮住下方捲動的內容。\r\n","tasks":{"total":8,"completed":8,"sections":[{"title":"1. TabView 元件擴充","tasks":[{"text":"1.1 在 TabView 新增可選 `header` (ReactNode) 和 `sticky` (boolean) props","completed":true},{"text":"1.2 當 `sticky` 為 true 時，將 header + tab bar 包在 `sticky top-14 z-[5] bg-bg-primary -mx-6 px-6` 容器中","completed":true},{"text":"1.3 非 sticky 模式維持原有行為不變","completed":true}]},{"title":"2. ChangeDetail 頁面調整","tasks":[{"text":"2.1 將 change 標題（返回連結 + slug 標題）移至 TabView 的 `header` prop","completed":true},{"text":"2.2 為 TabView 加上 `sticky` prop","completed":true}]},{"title":"3. 驗證","tasks":[{"text":"3.1 確認 type-check 通過","completed":true},{"text":"3.2 手動驗證：長內容捲動時標題和 tab bar 固定在 header 下方","completed":true},{"text":"3.3 手動驗證：sticky 背景色正確遮住捲動內容，z-index 不與 header/sidebar 衝突","completed":true}]}]},"specs":[{"topic":"change-browsing","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs in OpenSpec workflow order: Proposal, Design, Specs (delta specs), and Tasks. Tab content SHALL transition with a fade-in animation when switching. The change title (including back navigation link) and tab navigation bar SHALL be sticky-positioned below the main header, remaining visible when the user scrolls through long content.\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed with a fade-in transition\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics, with a fade-in transition\r\n\r\n#### Scenario: Tab order\r\n- **WHEN** the ChangeDetail page is rendered\r\n- **THEN** the tabs are displayed in order: Proposal, Design, Specs, Tasks (matching the OpenSpec workflow sequence)\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n#### Scenario: Sticky header on scroll\r\n- **WHEN** user scrolls down through long change content\r\n- **THEN** the change title (with back link) and tab navigation bar SHALL remain fixed below the main application header\r\n- **AND** the sticky area SHALL have an opaque background that covers scrolling content beneath it\r\n\r\n#### Scenario: Sticky does not overlap main header\r\n- **WHEN** the sticky area is active\r\n- **THEN** it SHALL be positioned directly below the main header (top offset equal to header height) with a z-index lower than the main header and sidebar\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-21"}},"2026-02-18-fix-vscode-live-reload-directory-moves":{"slug":"2026-02-18-fix-vscode-live-reload-directory-moves","proposal":"## Why\r\n\r\nVS Code 版的 live-reload 在目錄搬移（如 `mv` archive）時不會觸發更新。原因是 `FileSystemWatcher` 的 glob `openspec/**/*.{md,yaml}` 只匹配檔案，但 `mv` 整個目錄時 OS 層級是目錄 rename，不會對個別檔案觸發 create/delete 事件。Web 版的 chokidar 則能正確偵測。\r\n\r\n## What Changes\r\n\r\n- 將 VS Code `FileSystemWatcher` 的 glob 從 `openspec/**/*.{md,yaml}` 改為 `openspec/**`，捕捉所有變更包含目錄操作\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無）\r\n\r\n### Modified Capabilities\r\n- `live-reload`: FileSystemWatcher glob 放寬為 `openspec/**` 以涵蓋目錄層級的變更事件\r\n\r\n## Impact\r\n\r\n- **VS Code Extension** (`packages/vscode/src/panel.ts`): 修改一行 glob pattern\r\n- 不影響 Web 版和 Demo 版\r\n","design":"## Overview\r\n\r\n單行修正：將 `SpekPanel` 的 `FileSystemWatcher` glob 從 `openspec/**/*.{md,yaml}` 改為 `openspec/**`。\r\n\r\n## Key Decisions\r\n\r\n### 為何用 `openspec/**` 而非更精確的 pattern？\r\n\r\n`vscode.workspace.createFileSystemWatcher` 底層使用 OS 的 inotify (Linux) / FSEvents (macOS)。目錄 rename（`mv`）只在父目錄層觸發事件，不會為子目錄內的個別檔案觸發 create/delete。使用 `openspec/**` 可以捕捉到目錄層級的變更。\r\n\r\n搭配既有的 500ms debounce，即使收到較多事件也不會造成效能問題。\r\n\r\n## File Changes\r\n\r\n| 檔案 | 變更 |\r\n|------|------|\r\n| `packages/vscode/src/panel.ts` | glob pattern 從 `openspec/**/*.{md,yaml}` 改為 `openspec/**` |\r\n","tasks":{"total":2,"completed":2,"sections":[{"title":"1. 修正","tasks":[{"text":"1.1 將 `SpekPanel` 的 FileSystemWatcher glob 從 `openspec/**/*.{md,yaml}` 改為 `openspec/**`","completed":true},{"text":"1.2 Build 通過（`npm run build`）","completed":true}]}]},"specs":[{"topic":"live-reload","content":"## MODIFIED Requirements\r\n\r\n### Requirement: File change detection for VS Code version\r\nThe VS Code extension SHALL monitor the workspace's `openspec/` directory for file changes and notify the webview.\r\n\r\n#### Scenario: FileSystemWatcher setup\r\n- **WHEN** the spek Webview Panel is created\r\n- **THEN** the extension host creates a `vscode.workspace.createFileSystemWatcher` for `openspec/**` to detect all changes including directory moves\r\n\r\n#### Scenario: File change notification to webview\r\n- **WHEN** a file or directory matching the watcher pattern is created, modified, deleted, or moved\r\n- **THEN** the extension host sends `{ type: \"fileChanged\" }` to the webview via `postMessage`, debounced at 500ms\r\n\r\n#### Scenario: Watcher cleanup\r\n- **WHEN** the spek Webview Panel is disposed\r\n- **THEN** the FileSystemWatcher SHALL be disposed along with other panel resources\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-18"}},"2026-02-18-live-reload":{"slug":"2026-02-18-live-reload","proposal":"## Why\r\n\r\n在使用 OpenSpec 工作流時（如執行 `/openspec-new-change`、`/opsx:apply` 等），spek 的畫面不會自動反映磁碟上的檔案變更。使用者必須切到其他頁面再切回來才能看到最新內容，這打斷了工作流程。需要讓 spek 在檔案變更時自動更新畫面。\r\n\r\n## What Changes\r\n\r\n- 新增檔案監聽機制：Web 版使用 `chokidar` 監聽 `openspec/` 目錄變更，透過 SSE (Server-Sent Events) 推送通知給前端\r\n- VS Code 版使用 `vscode.workspace.createFileSystemWatcher` 監聽檔案變更，透過 `postMessage` 通知 webview\r\n- 前端新增 `useFileWatcher` hook，接收檔案變更事件並自動觸發當前頁面資料重新載入\r\n- `useAsyncData` 新增 `refreshKey` 依賴機制，外部可觸發 re-fetch\r\n- Demo 版（StaticAdapter）不受影響，資料為靜態內嵌\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `live-reload`: 檔案變更時自動重新載入頁面資料的機制，涵蓋 Web SSE 通道、VS Code FileSystemWatcher 通道、以及前端 refresh 觸發邏輯\r\n\r\n### Modified Capabilities\r\n- `api-adapter`: ApiAdapter 介面新增 `onFileChange` 訂閱方法，讓前端可監聽檔案變更事件\r\n- `webview-integration`: Webview 新增接收 `fileChanged` 訊息類型的能力\r\n\r\n## Impact\r\n\r\n- **後端** (`packages/web/server/`): 新增 SSE endpoint 和 chokidar 檔案監聽\r\n- **前端** (`packages/web/src/`): 新增 `useFileWatcher` hook，修改 `useAsyncData` 支援外部 refresh 觸發\r\n- **VS Code Extension** (`packages/vscode/src/`): `SpekPanel` 新增 FileSystemWatcher\r\n- **ApiAdapter 介面**: 新增 `onFileChange` 方法，FetchAdapter / MessageAdapter / StaticAdapter 各自實作\r\n- **新增依賴**: `chokidar`（Web server file watching）\r\n- **不影響**: Demo 版、核心模組 (`@spek/core`)\r\n","design":"## Overview\r\n\r\n透過檔案監聽 + 事件推送實現即時更新。整體架構分三層：\r\n\r\n1. **檔案監聽層**：偵測 `openspec/` 目錄下的檔案變更\r\n2. **事件傳輸層**：將變更事件推送給前端（SSE / postMessage）\r\n3. **前端觸發層**：接收事件後自動 re-fetch 當前頁面資料\r\n\r\n## Architecture\r\n\r\n### 前端：RefreshContext + useAsyncData 改造\r\n\r\n不修改 `ApiAdapter` 介面。改用獨立的 `RefreshContext` 管理 refresh 狀態：\r\n\r\n```\r\nRefreshProvider (維護 refreshKey counter)\r\n  └─ useAsyncData 接受 refreshKey 作為依賴\r\n  └─ useFileWatcher 監聯事件源，bump refreshKey\r\n```\r\n\r\n**RefreshContext**：\r\n- 提供 `refreshKey: number` 和 `refresh(): void`\r\n- `useFileWatcher` hook 內部訂閱事件源，收到事件時呼叫 `refresh()`\r\n- 所有 `useAsyncData` 呼叫自動包含 `refreshKey` 作為 deps 的一部分\r\n\r\n**useAsyncData 改造**：\r\n- 從 context 取得 `refreshKey`，加入 deps 陣列\r\n- 當 `refreshKey` 變化時觸發 re-fetch\r\n- 加入 debounce（300ms）：檔案變更常連續觸發（例如寫多個檔案），debounce 避免短時間內大量 re-fetch\r\n\r\n### Web 版：SSE + chokidar\r\n\r\n**Server 端**：\r\n- 新增 `GET /api/openspec/watch?dir=...` SSE endpoint\r\n- 用 `chokidar` 監聽 `{dir}/openspec/` 目錄（recursive）\r\n- 檔案類型過濾：只監聽 `.md` 和 `.yaml` 檔案\r\n- 變更事件 debounce（500ms）後發送 SSE event：`data: { \"type\": \"changed\" }`\r\n- client 斷線時自動清理 watcher\r\n- 用 Map 管理 watcher instances，相同 dir 共用同一個 watcher\r\n\r\n**Client 端**（`useFileWatcher` in FetchAdapter 環境）：\r\n- 用 `EventSource` 連接 SSE endpoint\r\n- 收到事件時呼叫 `RefreshContext.refresh()`\r\n- 元件 unmount 時關閉 EventSource\r\n- EventSource 自帶斷線重連機制\r\n\r\n### VS Code 版：FileSystemWatcher + postMessage\r\n\r\n**Extension host**（`SpekPanel`）：\r\n- 用 `vscode.workspace.createFileSystemWatcher` 監聽 `**/openspec/**/*.{md,yaml}`\r\n- 檔案變更事件 debounce（500ms）後發送 `{ type: \"fileChanged\" }` 到 webview\r\n- watcher 加入 `disposables` 陣列，panel 關閉時自動清理\r\n\r\n**Webview 端**（`useFileWatcher` in MessageAdapter 環境）：\r\n- 監聽 `message` 事件，過濾 `type === \"fileChanged\"`\r\n- 收到時呼叫 `RefreshContext.refresh()`\r\n\r\n### Demo 版\r\n\r\n不需要 file watching。`useFileWatcher` 在 StaticAdapter 環境下為 no-op。\r\n\r\n## Data Flow\r\n\r\n```\r\n檔案變更\r\n  │\r\n  ├─ Web: chokidar → SSE endpoint → EventSource → useFileWatcher\r\n  └─ VSCode: FileSystemWatcher → postMessage → useFileWatcher\r\n                                                      │\r\n                                                      ▼\r\n                                            RefreshContext.refresh()\r\n                                                      │\r\n                                                      ▼\r\n                                              refreshKey++\r\n                                                      │\r\n                                                      ▼\r\n                                          useAsyncData re-fetch (debounced)\r\n```\r\n\r\n## Key Decisions\r\n\r\n### 為何用 RefreshContext 而非修改 ApiAdapter？\r\n\r\nApiAdapter 是純資料抓取介面。檔案監聽是環境層級的 concern，不應耦合到每個 adapter method。用獨立 context 可以：\r\n- 不更動 ApiAdapter 介面，避免 breaking change\r\n- 所有 hooks 自動受益，不需逐一修改\r\n- 容易控制 debounce、pause/resume 等行為\r\n\r\n### 為何用 SSE 而非 WebSocket？\r\n\r\n- SSE 是單向推送，正好符合 server→client 的需求\r\n- 瀏覽器原生支援 `EventSource`，自帶斷線重連\r\n- 不需額外依賴（ws library），Express 原生支援\r\n\r\n### Debounce 策略\r\n\r\n兩階段 debounce：\r\n1. **Server 端 500ms**：chokidar 檔案事件 debounce，減少 SSE 發送頻率\r\n2. **Client 端 300ms**：`useAsyncData` re-fetch debounce，避免同時多個 hook 重複請求\r\n\r\n## File Changes\r\n\r\n| 檔案 | 變更 |\r\n|------|------|\r\n| `packages/web/server/index.ts` | 新增 SSE watch endpoint |\r\n| `packages/web/src/contexts/RefreshContext.tsx` | 新增 RefreshContext + RefreshProvider |\r\n| `packages/web/src/hooks/useFileWatcher.ts` | 新增 useFileWatcher hook（SSE / postMessage / no-op） |\r\n| `packages/web/src/hooks/useOpenSpec.ts` | useAsyncData 加入 refreshKey + debounce |\r\n| `packages/web/src/App.tsx` | 包裹 RefreshProvider |\r\n| `packages/web/src/WebviewApp.tsx` | 包裹 RefreshProvider |\r\n| `packages/web/src/main.demo.tsx` | 包裹 RefreshProvider（如有需要） |\r\n| `packages/vscode/src/panel.ts` | 新增 FileSystemWatcher + postMessage |\r\n| `packages/web/package.json` | 新增 chokidar 依賴 |\r\n","tasks":{"total":15,"completed":15,"sections":[{"title":"1. 前端 Refresh 基礎建設","tasks":[{"text":"1.1 建立 `RefreshContext`（`packages/web/src/contexts/RefreshContext.tsx`）：提供 `refreshKey` 和 `refresh()` 方法","completed":true},{"text":"1.2 修改 `useAsyncData` hook：從 RefreshContext 取得 `refreshKey` 加入 deps，加入 debounce（300ms），re-fetch 時保留既有 data 不顯示 loading flash","completed":true},{"text":"1.3 在 `App.tsx`、`WebviewApp.tsx` 包裹 `RefreshProvider`","completed":true}]},{"title":"2. Web 版 SSE File Watching","tasks":[{"text":"2.1 安裝 `chokidar` 依賴","completed":true},{"text":"2.2 新增 SSE endpoint `GET /api/openspec/watch?dir=...`：用 chokidar 監聯 `openspec/` 目錄下 `.md`/`.yaml` 檔案，debounce 500ms 後發送 SSE event","completed":true},{"text":"2.3 實作 watcher 共享邏輯：相同 dir 共用 watcher，client 斷線時清理","completed":true},{"text":"2.4 建立 `useFileWatcher` hook（Web 版）：用 `EventSource` 連接 SSE endpoint，收到事件時呼叫 `refresh()`","completed":true}]},{"title":"3. VS Code 版 FileSystemWatcher","tasks":[{"text":"3.1 在 `SpekPanel` 建立 `vscode.workspace.createFileSystemWatcher('**/openspec/**/*.{md,yaml}')`","completed":true},{"text":"3.2 監聽 create/change/delete 事件，debounce 500ms 後發送 `{ type: \"fileChanged\" }` 到 webview","completed":true},{"text":"3.3 將 watcher 加入 `disposables` 確保 panel 關閉時清理","completed":true},{"text":"3.4 建立 `useFileWatcher` hook（VS Code 版）：監聽 `fileChanged` message，呼叫 `refresh()`","completed":true}]},{"title":"4. 環境整合與測試","tasks":[{"text":"4.1 `useFileWatcher` 依據環境自動選擇實作（SSE / postMessage / no-op）","completed":true},{"text":"4.2 手動測試 Web 版：啟動 dev server，修改 openspec 檔案確認畫面自動更新","completed":true},{"text":"4.3 Type check 通過（`npm run type-check`）","completed":true},{"text":"4.4 Build 通過（`npm run build`）","completed":true}]}]},"specs":[{"topic":"live-reload","content":"## ADDED Requirements\r\n\r\n### Requirement: File change detection for Web version\r\nThe Web server SHALL monitor the `openspec/` directory for file changes using `chokidar` and push notifications to connected clients via Server-Sent Events (SSE).\r\n\r\n#### Scenario: SSE endpoint connection\r\n- **WHEN** a client connects to `GET /api/openspec/watch?dir=<repoPath>`\r\n- **THEN** the server opens an SSE stream and begins monitoring `<repoPath>/openspec/` for `.md` and `.yaml` file changes\r\n\r\n#### Scenario: File change notification\r\n- **WHEN** a `.md` or `.yaml` file inside `openspec/` is created, modified, or deleted\r\n- **THEN** the server sends an SSE event `data: {\"type\":\"changed\"}` to all connected clients for that directory, debounced at 500ms\r\n\r\n#### Scenario: Client disconnect cleanup\r\n- **WHEN** a client disconnects from the SSE endpoint\r\n- **THEN** the server removes the client from the notification list and cleans up the watcher if no other clients are connected for that directory\r\n\r\n#### Scenario: Shared watcher per directory\r\n- **WHEN** multiple clients connect to the same `dir` parameter\r\n- **THEN** the server SHALL reuse the same chokidar watcher instance for that directory\r\n\r\n### Requirement: File change detection for VS Code version\r\nThe VS Code extension SHALL monitor the workspace's `openspec/` directory for file changes and notify the webview.\r\n\r\n#### Scenario: FileSystemWatcher setup\r\n- **WHEN** the spek Webview Panel is created\r\n- **THEN** the extension host creates a `vscode.workspace.createFileSystemWatcher` for `**/openspec/**/*.{md,yaml}`\r\n\r\n#### Scenario: File change notification to webview\r\n- **WHEN** a file matching the watcher pattern is created, modified, or deleted\r\n- **THEN** the extension host sends `{ type: \"fileChanged\" }` to the webview via `postMessage`, debounced at 500ms\r\n\r\n#### Scenario: Watcher cleanup\r\n- **WHEN** the spek Webview Panel is disposed\r\n- **THEN** the FileSystemWatcher SHALL be disposed along with other panel resources\r\n\r\n### Requirement: RefreshContext for frontend refresh coordination\r\nThe frontend SHALL provide a `RefreshContext` that coordinates data refresh across all hooks when file changes are detected.\r\n\r\n#### Scenario: RefreshContext provides refreshKey\r\n- **WHEN** a component or hook calls `useRefreshKey()`\r\n- **THEN** it receives the current `refreshKey` number value from the context\r\n\r\n#### Scenario: Refresh triggered by file change\r\n- **WHEN** `refresh()` from `RefreshContext` is called\r\n- **THEN** the `refreshKey` counter increments, causing all `useAsyncData` hooks to re-fetch their data\r\n\r\n### Requirement: useFileWatcher hook\r\nThe frontend SHALL provide a `useFileWatcher` hook that connects to the appropriate file change event source based on the runtime environment.\r\n\r\n#### Scenario: Web environment with SSE\r\n- **WHEN** `useFileWatcher` is active in the Web environment\r\n- **THEN** it opens an `EventSource` connection to `/api/openspec/watch?dir=<repoPath>` and calls `refresh()` on each received event\r\n\r\n#### Scenario: VS Code environment with postMessage\r\n- **WHEN** `useFileWatcher` is active in the VS Code webview environment\r\n- **THEN** it listens for `message` events with `type === \"fileChanged\"` and calls `refresh()` on each received event\r\n\r\n#### Scenario: Demo environment no-op\r\n- **WHEN** `useFileWatcher` is active in the Demo environment\r\n- **THEN** it does nothing (no event source to connect to)\r\n\r\n#### Scenario: Cleanup on unmount\r\n- **WHEN** the component using `useFileWatcher` unmounts\r\n- **THEN** the EventSource connection or message listener SHALL be cleaned up\r\n\r\n### Requirement: Debounced re-fetch in useAsyncData\r\nThe `useAsyncData` hook SHALL support automatic re-fetch triggered by `refreshKey` changes with debounce to avoid excessive requests.\r\n\r\n#### Scenario: Re-fetch on refreshKey change\r\n- **WHEN** `refreshKey` changes in the `RefreshContext`\r\n- **THEN** `useAsyncData` triggers a new fetch after a 300ms debounce delay\r\n\r\n#### Scenario: Debounce coalesces rapid changes\r\n- **WHEN** `refreshKey` changes multiple times within 300ms\r\n- **THEN** only one re-fetch is triggered after the last change\r\n\r\n#### Scenario: Existing data preserved during re-fetch\r\n- **WHEN** a re-fetch is triggered by `refreshKey` change\r\n- **THEN** the existing `data` SHALL remain visible (no loading flash) until the new data arrives\r\n"},{"topic":"webview-integration","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Load React SPA in Webview\r\nThe Webview SHALL load the spek React application from the extension's bundled assets.\r\n\r\n#### Scenario: Webview HTML generation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** it generates an HTML document that loads the built React bundle with asset paths converted via `webview.asWebviewUri()`\r\n\r\n#### Scenario: Asset path resolution\r\n- **WHEN** the Webview HTML references JS or CSS files\r\n- **THEN** all asset paths SHALL use `webview.asWebviewUri()` to convert local file paths to Webview-safe URIs\r\n\r\n#### Scenario: File change notification forwarding\r\n- **WHEN** a file in the `openspec/` directory changes\r\n- **THEN** the Webview Panel SHALL forward the `{ type: \"fileChanged\" }` message to the React application so it can refresh its data\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-18"}},"2026-02-18-move-release-skill-to-project":{"slug":"2026-02-18-move-release-skill-to-project","proposal":"## Why\r\n\r\n`/release` skill 目前定義在使用者全域目錄 `~/.claude/skills/release/`，但它是 spek 專案專屬的 skill（內容包含 spek 的 CHANGELOG 路徑、npm version 流程等）。應該放在專案層級，與 `frontend-design` skill 保持一致的管理方式，並納入版本控制。\r\n\r\n## What Changes\r\n\r\n- 將 `/release` skill 從 `~/.claude/skills/release/` 搬移至專案目錄 `.agents/skills/release/`\r\n- 在 `.claude/skills/release` 建立指向 `../../.agents/skills/release` 的 symlink\r\n- 刪除使用者全域目錄中的原始檔案\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增能力）\r\n\r\n### Modified Capabilities\r\n\r\n（無既有 spec 需要修改，此變更僅涉及檔案位置調整，不影響任何功能行為）\r\n\r\n## Impact\r\n\r\n- `.agents/skills/release/SKILL.md` — 新增檔案（從使用者全域搬入）\r\n- `.claude/skills/release` — 新增 symlink\r\n- `~/.claude/skills/release/` — 刪除\r\n- 不影響任何程式碼、API 或依賴\r\n","design":"## Context\r\n\r\nspek 專案的 Claude Code skills 遵循統一的管理慣例：原始檔放在 `.agents/skills/<name>/`，再從 `.claude/skills/<name>` 建立 symlink。目前 `frontend-design` 已採用此模式，但 `release` skill 遺留在使用者全域 `~/.claude/skills/release/`，未納入版本控制。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 將 `release` skill 納入專案版本控制\r\n- 與 `frontend-design` skill 保持一致的目錄結構\r\n\r\n**Non-Goals:**\r\n- 不修改 `release` skill 的內容\r\n- 不變更 skill 的功能行為\r\n\r\n## Decisions\r\n\r\n1. **沿用既有的 symlink 模式**：原始檔放 `.agents/skills/release/SKILL.md`，`.claude/skills/release` 為 symlink。與 `frontend-design` 一致，無需引入新模式。\r\n\r\n## Risks / Trade-offs\r\n\r\n- [風險] 刪除使用者全域的 `~/.claude/skills/release/` 後，在其他專案中無法使用 `/release` → 此 skill 本就是 spek 專屬，不影響其他專案。\r\n","tasks":{"total":6,"completed":6,"sections":[{"title":"1. 搬移 Skill 檔案","tasks":[{"text":"1.1 建立 `.agents/skills/release/` 目錄","completed":true},{"text":"1.2 將 `~/.claude/skills/release/SKILL.md` 複製至 `.agents/skills/release/SKILL.md`","completed":true},{"text":"1.3 在 `.claude/skills/` 建立 `release` symlink 指向 `../../.agents/skills/release`","completed":true},{"text":"1.4 刪除使用者全域目錄 `~/.claude/skills/release/`","completed":true}]},{"title":"2. 驗證","tasks":[{"text":"2.1 確認 `.claude/skills/release` symlink 正確指向 `.agents/skills/release`","completed":true},{"text":"2.2 確認 `/release` skill 可正常載入（顯示在可用 skills 列表中）","completed":true}]}]},"specs":[],"metadata":{"schema":"spec-driven","created":"2026-02-17"}},"2026-02-17-spec-graph-view":{"slug":"2026-02-17-spec-graph-view","proposal":"## Why\r\n\r\n目前 spek 以列表方式呈現 Specs 和 Changes，使用者需要逐一點進去才能了解它們之間的關聯。當專案規模變大，很難直覺看出「哪些 changes 影響了哪些 specs」、「哪些 specs 經常一起被修改」。需要一個互動式圖表視圖，讓使用者一眼掌握 spec 與 change 的關聯全貌。\r\n\r\n## What Changes\r\n\r\n- 新增 Graph View 頁面（`/graph` 路由），以 force-directed 圖表呈現 Specs 與 Changes 的關聯\r\n- Spec 節點（圓形）與 Change 節點（方形）透過邊連接，表示「該 change 修改了該 spec」\r\n- 支援互動操作：拖曳節點、hover 高亮相連節點與邊、點擊導航至詳情頁、縮放平移\r\n- 節點大小反映重要性（spec 的 historyCount、change 的 spec 數量）\r\n- Sidebar 新增 Graph 導覽項目\r\n- 新增 API endpoint 提供圖表所需的關聯資料\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `graph-view`: 互動式 force-directed 圖表頁面，視覺化 specs 與 changes 之間的修改關聯\r\n\r\n### Modified Capabilities\r\n- `shared-layout`: Sidebar 新增 Graph 導覽連結\r\n- `openspec-api`: 新增 graph data endpoint 回傳節點與邊資料\r\n\r\n## Impact\r\n\r\n- 前端：新增頁面元件、D3.js 依賴、路由設定\r\n- 後端：新增 `/api/openspec/graph` endpoint\r\n- Core：可能需要新增 graph data 建構函式\r\n- 所有三個 adapter（FetchAdapter、MessageAdapter、StaticAdapter）需支援新 API\r\n- Demo build 需包含 graph 資料\r\n","design":"## Context\r\n\r\nspek 目前以列表方式呈現 Specs 和 Changes，使用者需要進入個別頁面才能看到它們的關聯。`scanOpenSpec` 已經在掃描時遍歷所有 change 目錄來計算 `historyCount`，代表關聯資料已隱含在掃描過程中，只是沒有結構化暴露出來。\r\n\r\n前端使用 React 19 + Tailwind + React Router v7，透過 `ApiAdapter` 介面抽象通訊層（Fetch / Message / Static 三種實作）。新功能需要遵循這個模式。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 新增 `/graph` 頁面，以 force-directed 圖表呈現 specs 與 changes 的關聯\r\n- 圖表支援拖曳、hover 高亮、點擊導航、縮放平移\r\n- 在 Web、VS Code Webview、Demo 三種模式下都能運作\r\n- 節點大小反映重要性（spec 的 historyCount、change 關聯的 spec 數量）\r\n\r\n**Non-Goals:**\r\n- Spec → Spec 的交叉引用（未來 wiki-link 語法的範疇）\r\n- 時間軸佈局或雙欄佈局（先做 force-directed，其他佈局未來擴展）\r\n- 圖表匯出（截圖、SVG 下載等）\r\n- 圖表內的篩選或搜尋功能\r\n\r\n## Decisions\r\n\r\n### 1. 圖表資料來源：新增 `buildGraphData` core 函式 + API endpoint\r\n\r\n**選擇**：在 `@spek/core` 新增 `buildGraphData(repoDir)` 函式，一次掃描回傳結構化的 nodes + edges。\r\n\r\n**替代方案**：前端從現有 `getSpecs()` + 逐一 `getSpec(topic)` 組合資料。\r\n**拒絕原因**：N+1 查詢，spec 數量多時效能差。\r\n\r\n**資料結構**：\r\n```typescript\r\ninterface GraphData {\r\n  nodes: GraphNode[];\r\n  edges: GraphEdge[];\r\n}\r\ninterface GraphNode {\r\n  id: string;\r\n  type: \"spec\" | \"change\";\r\n  label: string;\r\n  date?: string | null;       // change only\r\n  status?: \"active\" | \"archived\";  // change only\r\n  historyCount?: number;      // spec only\r\n  specCount?: number;         // change only: 關聯幾個 specs\r\n}\r\ninterface GraphEdge {\r\n  source: string;  // change node id（格式 \"change:{slug}\"）\r\n  target: string;  // spec node id（格式 \"spec:{topic}\"）\r\n}\r\n```\r\n\r\n節點 id 用 `\"spec:{topic}\"` / `\"change:{slug}\"` 前綴避免命名衝突。\r\n\r\n### 2. 圖表渲染：D3 force simulation + SVG in React ref\r\n\r\n**選擇**：使用 `d3-force`、`d3-selection`、`d3-zoom`、`d3-drag` 模組，在 React component 中透過 ref 操作 SVG。\r\n\r\n**替代方案 A**：React Flow — 偏向流程圖/節點編輯器，force layout 非原生支援。\r\n**替代方案 B**：純 React re-render 同步 D3 tick — 高頻 tick 觸發 React re-render 效能不佳。\r\n\r\n**拒絕原因**：D3 直接操作 SVG 是 force-directed graph 的標準做法，效能最好、彈性最大。React 只負責容器 mount/unmount 生命週期。\r\n\r\n### 3. 節點視覺設計\r\n\r\n- **Spec 節點**：圓形，琥珀色（accent #f59e0b），半徑依 `historyCount` 縮放（min 20, max 45）\r\n- **Change 節點**：圓角矩形，active 為綠色、archived 為藍灰色，大小依 `specCount` 縮放\r\n- **邊**：淺灰色連線，hover 時高亮為白色\r\n- **文字標籤**：節點旁顯示 topic/description，字型 12px，超長截斷\r\n- 符合現有深色主題（背景 #0a0c0f 系列）\r\n\r\n### 4. 互動行為\r\n\r\n- **拖曳**：D3 drag behavior，拖曳時固定節點位置，放開後可選擇保持或釋放\r\n- **Hover**：高亮該節點 + 所有相連的邊和鄰居節點，其餘降低 opacity\r\n- **點擊**：spec 節點導航至 `/specs/:topic`，change 節點導航至 `/changes/:slug`\r\n- **縮放平移**：D3 zoom behavior，含 zoom extent 限制（0.3x ~ 3x）\r\n\r\n### 5. ApiAdapter 擴展\r\n\r\n在 `ApiAdapter` 介面新增 `getGraphData(): Promise<GraphData>`：\r\n- `FetchAdapter`：呼叫 `GET /api/openspec/graph?dir=...`\r\n- `MessageAdapter`：透過 postMessage `{ type: \"getGraphData\" }`\r\n- `StaticAdapter`：從 `window.__DEMO_DATA__.graphData` 讀取\r\n\r\n### 6. 不含 `hasSpecs` 的 changes 處理\r\n\r\n沒有 `specs/` 目錄的 changes（如純文件 change）不會出現在圖表中，因為它們沒有邊。只顯示有關聯的節點，避免圖表雜訊。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **D3 bundle size**：d3-force + d3-selection + d3-zoom + d3-drag 約增加 ~40KB gzipped。→ 透過只 import 需要的 d3 子模組控制大小。\r\n- **大型 repo 效能**：如果 specs 和 changes 數量極大（數百個節點），force simulation 可能變慢。→ 目前 spek 本身只有 26 specs + 24 changes，短期內不是問題。未來可加 node limit 或 lazy loading。\r\n- **D3 與 React 整合**：D3 直接操作 DOM 繞過 React，可能造成 React 預期外的 DOM 狀態。→ 限制 D3 操作範圍在單一 ref container 內，React 只負責 mount/unmount 該容器。\r\n- **VS Code Webview CSP**：D3 不需要 eval 或 inline script，SVG 操作相容現有 CSP 設定（IIFE + nonce）。→ 低風險。\r\n","tasks":{"total":23,"completed":23,"sections":[{"title":"1. Core: Graph Data Builder","tasks":[{"text":"1.1 Define `GraphData`, `GraphNode`, `GraphEdge` types in `packages/core/src/types.ts`","completed":true},{"text":"1.2 Implement `buildGraphData(repoDir)` function in `packages/core/src/scanner.ts`","completed":true},{"text":"1.3 Export `buildGraphData` and new types from `packages/core/src/index.ts`","completed":true}]},{"title":"2. API: Graph Endpoint and Adapter","tasks":[{"text":"2.1 Add `GET /api/openspec/graph` route in Express server","completed":true},{"text":"2.2 Add `getGraphData()` to `ApiAdapter` interface in `packages/web/src/api/types.ts`","completed":true},{"text":"2.3 Implement `getGraphData()` in `FetchAdapter`","completed":true},{"text":"2.4 Implement `getGraphData()` in `MessageAdapter`","completed":true},{"text":"2.5 Implement `getGraphData()` in `StaticAdapter` (read from `window.__DEMO_DATA__.graphData`)","completed":true}]},{"title":"3. VS Code Extension: Handler","tasks":[{"text":"3.1 Add `getGraphData` message handler in extension host (`handler.ts`)","completed":true}]},{"title":"4. Frontend: Graph View Page","tasks":[{"text":"4.1 Install D3 dependencies (`d3-force`, `d3-selection`, `d3-zoom`, `d3-drag`, `@types/d3-*`)","completed":true},{"text":"4.2 Create `GraphView` page component with data fetching, loading, and error states","completed":true},{"text":"4.3 Implement force-directed simulation (center, link, many-body, collision forces)","completed":true},{"text":"4.4 Render spec nodes (circles, amber, scaled by historyCount) and change nodes (rounded rects, green/blue-gray by status)","completed":true},{"text":"4.5 Render edges (lines connecting change → spec nodes)","completed":true},{"text":"4.6 Render node labels (topic/description, truncated at 25 chars)","completed":true},{"text":"4.7 Implement drag interaction (D3 drag behavior, fix position on drag)","completed":true},{"text":"4.8 Implement hover highlight (connected nodes/edges at full opacity, others at 0.1)","completed":true},{"text":"4.9 Implement click navigation (spec → `/specs/:topic`, change → `/changes/:slug`)","completed":true},{"text":"4.10 Implement zoom and pan (D3 zoom, 0.3x–3x extent, initial fit-to-viewport)","completed":true},{"text":"4.11 Add graph legend overlay (node type indicators)","completed":true}]},{"title":"5. Integration: Routing and Sidebar","tasks":[{"text":"5.1 Add `/graph` route to React Router config in `App.tsx` (and WebviewApp/DemoApp if separate)","completed":true},{"text":"5.2 Add \"Graph\" navigation link with icon to Sidebar component","completed":true}]},{"title":"6. Demo Build","tasks":[{"text":"6.1 Update demo build script (`scripts/build-demo.ts`) to include `graphData` in `__DEMO_DATA__`","completed":true}]}]},"specs":[{"topic":"graph-view","content":"## ADDED Requirements\r\n\r\n### Requirement: Graph page route\r\nThe system SHALL provide a `/graph` route that renders the Graph View page within the shared Layout. The page SHALL be accessible from all three modes (Web, VS Code Webview, Demo).\r\n\r\n#### Scenario: Navigate to graph page\r\n- **WHEN** user navigates to `/graph`\r\n- **THEN** the Graph View page is rendered within the Layout with sidebar and header visible\r\n\r\n#### Scenario: Graph page in demo mode\r\n- **WHEN** the demo build is loaded\r\n- **AND** user navigates to `/graph`\r\n- **THEN** the Graph View page renders using static graph data from `window.__DEMO_DATA__`\r\n\r\n### Requirement: Graph data fetching\r\nThe system SHALL fetch graph data (nodes and edges) from the API adapter when the Graph View page loads. While loading, the page SHALL display a loading indicator. If the fetch fails, an error message SHALL be displayed.\r\n\r\n#### Scenario: Successful data load\r\n- **WHEN** the Graph View page mounts\r\n- **THEN** the system calls `getGraphData()` on the API adapter\r\n- **AND** renders the force-directed graph with the returned nodes and edges\r\n\r\n#### Scenario: Loading state\r\n- **WHEN** graph data is being fetched\r\n- **THEN** a loading indicator is displayed in the graph container\r\n\r\n#### Scenario: Error state\r\n- **WHEN** graph data fetch fails\r\n- **THEN** an error message is displayed with the failure reason\r\n\r\n### Requirement: Force-directed graph layout\r\nThe system SHALL render an interactive force-directed graph using D3 force simulation. Spec nodes and change nodes SHALL be positioned by the simulation with forces: center force, link force (connecting edges), many-body repulsion force, and collision force to prevent overlap.\r\n\r\n#### Scenario: Initial layout\r\n- **WHEN** graph data is loaded with specs and changes\r\n- **THEN** a force-directed simulation positions all nodes within the SVG viewport\r\n- **AND** the simulation runs until convergence (alpha < 0.001)\r\n\r\n#### Scenario: Empty graph\r\n- **WHEN** graph data contains no nodes with edges (no changes have specs)\r\n- **THEN** the page displays a message indicating no relationships to visualize\r\n\r\n### Requirement: Node visual encoding\r\nThe system SHALL render spec nodes as circles and change nodes as rounded rectangles. Spec node radius SHALL scale with `historyCount` (minimum 20px, maximum 45px). Change node size SHALL scale with `specCount` (number of specs modified). Spec nodes SHALL use the accent color (amber). Change nodes SHALL use green for active status and blue-gray for archived status.\r\n\r\n#### Scenario: Spec node sizing\r\n- **WHEN** a spec has `historyCount` of 5 (highest in the dataset)\r\n- **THEN** its circle radius is at or near the maximum (45px)\r\n\r\n#### Scenario: Spec node with no history\r\n- **WHEN** a spec has `historyCount` of 0\r\n- **THEN** its circle radius is at the minimum (20px)\r\n\r\n#### Scenario: Change node coloring\r\n- **WHEN** a change has `status: \"active\"`\r\n- **THEN** its rectangle uses a green color scheme\r\n- **WHEN** a change has `status: \"archived\"`\r\n- **THEN** its rectangle uses a blue-gray color scheme\r\n\r\n### Requirement: Node labels\r\nThe system SHALL display text labels next to each node. Spec labels SHALL show the topic name. Change labels SHALL show the description (derived from slug). Labels longer than 25 characters SHALL be truncated with ellipsis.\r\n\r\n#### Scenario: Spec label display\r\n- **WHEN** a spec node with topic \"markdown-renderer\" is rendered\r\n- **THEN** a text label \"markdown-renderer\" is displayed adjacent to the node\r\n\r\n#### Scenario: Long change label truncation\r\n- **WHEN** a change with description \"phase3 markdown and search improvements\" is rendered\r\n- **THEN** the label is truncated to 25 characters with \"...\" appended\r\n\r\n### Requirement: Edge rendering\r\nThe system SHALL render edges as lines connecting change nodes to the spec nodes they modified. Edges SHALL use a muted color by default. When a node is hovered, its connected edges SHALL be highlighted.\r\n\r\n#### Scenario: Edge display\r\n- **WHEN** change \"phase3-markdown-and-search\" modified specs \"markdown-renderer\" and \"search-ui\"\r\n- **THEN** two edges are drawn from the change node to each respective spec node\r\n\r\n### Requirement: Drag interaction\r\nThe system SHALL support dragging nodes to reposition them. During drag, the dragged node's position SHALL be fixed. After releasing, the node SHALL remain at its dragged position until the simulation is restarted.\r\n\r\n#### Scenario: Drag a node\r\n- **WHEN** user clicks and drags a spec node\r\n- **THEN** the node follows the cursor\r\n- **AND** connected edges update in real-time\r\n- **AND** the force simulation reheats to adjust surrounding nodes\r\n\r\n### Requirement: Hover highlight interaction\r\nThe system SHALL highlight a node and its connected neighbors when the user hovers over it. All non-connected nodes and edges SHALL reduce opacity to 0.1. The hovered node, its neighbors, and their connecting edges SHALL remain at full opacity.\r\n\r\n#### Scenario: Hover on spec node\r\n- **WHEN** user hovers over spec node \"markdown-renderer\"\r\n- **THEN** the \"markdown-renderer\" node, all change nodes connected to it, and their edges are highlighted at full opacity\r\n- **AND** all other nodes and edges reduce to 0.1 opacity\r\n\r\n#### Scenario: Hover off\r\n- **WHEN** user moves the cursor away from all nodes\r\n- **THEN** all nodes and edges return to full opacity\r\n\r\n### Requirement: Click navigation\r\nThe system SHALL navigate to the detail page when a node is clicked (without dragging). Clicking a spec node SHALL navigate to `/specs/:topic`. Clicking a change node SHALL navigate to `/changes/:slug`.\r\n\r\n#### Scenario: Click spec node\r\n- **WHEN** user clicks (without dragging) on spec node \"api-adapter\"\r\n- **THEN** the app navigates to `/specs/api-adapter`\r\n\r\n#### Scenario: Click change node\r\n- **WHEN** user clicks (without dragging) on change node \"2026-02-13-initial-implementation\"\r\n- **THEN** the app navigates to `/changes/2026-02-13-initial-implementation`\r\n\r\n### Requirement: Zoom and pan\r\nThe system SHALL support zooming (scroll wheel or pinch) and panning (click-and-drag on empty space) of the graph viewport. Zoom SHALL be constrained between 0.3x and 3x. The graph SHALL initially be centered and scaled to fit all nodes within the viewport.\r\n\r\n#### Scenario: Zoom in\r\n- **WHEN** user scrolls up (or pinch-zooms in) on the graph\r\n- **THEN** the graph zooms in, up to a maximum of 3x\r\n\r\n#### Scenario: Zoom out\r\n- **WHEN** user scrolls down (or pinch-zooms out) on the graph\r\n- **THEN** the graph zooms out, down to a minimum of 0.3x\r\n\r\n#### Scenario: Pan\r\n- **WHEN** user clicks and drags on empty space (not on a node)\r\n- **THEN** the entire graph viewport pans in the drag direction\r\n\r\n#### Scenario: Initial fit\r\n- **WHEN** the graph first renders\r\n- **THEN** the viewport is scaled and centered to show all nodes within the visible area\r\n\r\n### Requirement: Graph legend\r\nThe system SHALL display a legend overlay in a corner of the graph container, showing the meaning of node shapes and colors: amber circle = Spec, green rectangle = Active Change, blue-gray rectangle = Archived Change.\r\n\r\n#### Scenario: Legend display\r\n- **WHEN** the graph is rendered\r\n- **THEN** a legend is visible showing node type indicators with labels\r\n"},{"topic":"openspec-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Graph data endpoint\r\nThe system SHALL provide `GET /api/openspec/graph` that returns the relationship graph between specs and changes. The response SHALL contain `nodes` (array of spec and change nodes) and `edges` (array of change-to-spec connections). Only changes that have at least one delta spec SHALL be included as nodes.\r\n\r\n#### Scenario: Get graph data\r\n- **WHEN** client sends `GET /api/openspec/graph?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `nodes` and `edges` arrays\r\n- **AND** each spec node has `id` (prefixed \"spec:\"), `type: \"spec\"`, `label` (topic name), and `historyCount`\r\n- **AND** each change node has `id` (prefixed \"change:\"), `type: \"change\"`, `label` (description), `date`, `status`, and `specCount`\r\n- **AND** each edge has `source` (change node id) and `target` (spec node id)\r\n\r\n#### Scenario: Graph with no spec-bearing changes\r\n- **WHEN** client sends `GET /api/openspec/graph?dir=/path/to/repo`\r\n- **AND** no changes have a `specs/` directory\r\n- **THEN** system returns `nodes` containing only spec nodes with no edges\r\n\r\n#### Scenario: Graph without dir parameter\r\n- **WHEN** client sends `GET /api/openspec/graph` without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Graph data in ApiAdapter\r\nThe system SHALL extend the `ApiAdapter` interface with a `getGraphData()` method. `FetchAdapter` SHALL call `GET /api/openspec/graph`. `MessageAdapter` SHALL use `postMessage` with type `\"getGraphData\"`. `StaticAdapter` SHALL read from `window.__DEMO_DATA__.graphData`.\r\n\r\n#### Scenario: FetchAdapter graph data\r\n- **WHEN** `FetchAdapter.getGraphData()` is called\r\n- **THEN** it sends `GET /api/openspec/graph?dir=...` and returns the parsed JSON response\r\n\r\n#### Scenario: StaticAdapter graph data\r\n- **WHEN** `StaticAdapter.getGraphData()` is called\r\n- **THEN** it returns `window.__DEMO_DATA__.graphData`\r\n\r\n#### Scenario: MessageAdapter graph data\r\n- **WHEN** `MessageAdapter.getGraphData()` is called\r\n- **THEN** it sends a postMessage with `{ type: \"getGraphData\" }` to the VS Code extension host\r\n- **AND** returns the response data\r\n\r\n### Requirement: Core graph data builder\r\nThe system SHALL provide a `buildGraphData(repoDir)` function in `@spek/core` that scans the openspec directory and returns structured graph data. The function SHALL reuse the existing scan logic to identify which changes contain delta specs for which topics.\r\n\r\n#### Scenario: Build graph data from repo\r\n- **WHEN** `buildGraphData(\"/path/to/repo\")` is called\r\n- **AND** the repo has 3 specs and 2 changes, where change A modifies spec 1 and spec 2, and change B modifies spec 2 and spec 3\r\n- **THEN** the function returns 5 nodes (3 specs + 2 changes) and 4 edges\r\n"},{"topic":"shared-layout","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, Changes, and Graph. Each link SHALL have an associated icon (LayoutDashboard for Overview, FileText for Specs, GitBranch for Changes, Share2 for Graph). The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL support two states: expanded (240px width, showing icons and labels) and collapsed (56px width, showing icons only). A toggle button at the bottom of the sidebar SHALL switch between states. The main content area left margin SHALL adjust to match the current sidebar width.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, Changes, and Graph with corresponding icons\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Graph page\r\n- **THEN** the \"Graph\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar expanded on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is expanded\r\n- **THEN** the sidebar is displayed at 240px width with icons and text labels, and main content has matching left margin\r\n\r\n#### Scenario: Sidebar collapsed on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is collapsed\r\n- **THEN** the sidebar is displayed at 56px width with icons only, and main content has matching left margin\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-17"}},"2026-02-17-spec-diff-viewer":{"slug":"2026-02-17-spec-diff-viewer","proposal":"## Why\r\n\r\nspek 目前的 spec 頁面透過 history timeline 呈現 spec 的演進記錄，但使用者只能看到「哪些 change 影響了這個 spec」，卻無法比較不同版本之間的具體文字差異。加入 diff 檢視功能，讓使用者可以直觀看到每次變更新增、修改、刪除了哪些需求，將 spek 從「靜態檢視器」升級為「spec 演進追蹤工具」。\r\n\r\n## What Changes\r\n\r\n- 新增 core 函式 `readSpecAtChange`，讀取特定 change 中的 spec 歷史版本內容\r\n- 新增 API endpoint `GET /api/openspec/specs/:topic/at/:slug`，回傳某個 change 對 spec 的 delta 內容\r\n- 擴展 `ApiAdapter` 介面，增加 `getSpecAtChange` 方法（FetchAdapter、MessageAdapter、StaticAdapter 同步實作）\r\n- 在 SpecDetail 頁面新增 diff 檢視 UI，使用者可選取兩個版本進行比較\r\n- 引入前端 diff library，以 side-by-side 或 unified 模式渲染文字差異\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `spec-diff`: Spec 版本差異比較功能——包含 core 層讀取歷史版本、API 層端點、前端 diff 檢視元件\r\n\r\n### Modified Capabilities\r\n- `spec-history`: 在現有 history timeline 上新增「比較」互動，讓使用者可從 timeline 觸發 diff 檢視\r\n- `api-adapter`: 擴展 ApiAdapter 介面，新增 `getSpecAtChange` 方法\r\n\r\n## Impact\r\n\r\n- **Core**: `packages/core/src/scanner.ts` 新增 `readSpecAtChange` 函式，`types.ts` 新增回傳型別\r\n- **Web Server**: `packages/web/server/routes/openspec.ts` 新增 route\r\n- **Frontend**: `packages/web/src/api/` 下所有 adapter 新增方法，`SpecDetail.tsx` 新增 diff UI，新增 `SpecDiffViewer` 元件\r\n- **VS Code Extension**: `packages/vscode/src/handler.ts` 新增 message handler\r\n- **Dependencies**: 新增 diff 計算 library（如 `diff` npm package）\r\n- **Demo**: `StaticAdapter` 與 `build-demo.ts` 需支援歷史版本資料內嵌\r\n","design":"## Context\r\n\r\nspek 的 spec detail 頁面已有 history timeline，顯示哪些 change 影響了該 spec。歷史版本的 spec 內容實際上已存在於 `openspec/changes/<slug>/specs/<topic>/spec.md`（active 或 archive 目錄下），但目前沒有 API 或 UI 來讀取與比較這些歷史內容。\r\n\r\n現有的 `readSpec` 函式回傳當前 spec 內容與 `HistoryEntry[]`，每個 entry 有 slug、date、timestamp、description、status，但不包含歷史版本的實際文字內容。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 讓使用者能在 spec detail 頁面比較任意兩個版本的 spec 差異\r\n- 支援 unified diff 檢視模式\r\n- 在所有三種環境（Web、VS Code Webview、Demo）中可用\r\n- 保持架構一致性——遵循既有的 ApiAdapter pattern\r\n\r\n**Non-Goals:**\r\n- 不做 inline editing（spek 是唯讀檢視器）\r\n- 不做 side-by-side 模式（未來可擴展，目前先做 unified）\r\n- 不做 word-level diff（以行為單位即可）\r\n- 不做跨 spec 的比較\r\n- 不做 git blame 或 git log 直接整合（依賴 OpenSpec 目錄結構而非 git history）\r\n\r\n## Decisions\r\n\r\n### 1. 歷史版本讀取方式：從 change 目錄讀取\r\n\r\n**選擇**：新增 core 函式 `readSpecAtChange(repoDir, topic, slug)` 直接讀取 `openspec/changes/<slug>/specs/<topic>/spec.md` 或 `openspec/changes/archive/<slug>/specs/<topic>/spec.md`。\r\n\r\n**替代方案**：用 `git show <commit>:<path>` 從 git history 讀取。\r\n\r\n**理由**：OpenSpec 的設計已將歷史版本存在 change 目錄結構中，不需要額外依賴 git CLI。這讓非 git repo（或尚未 commit 的 change）也能運作。\r\n\r\n### 2. Diff 計算位置：前端計算\r\n\r\n**選擇**：前端使用 `diff` npm package 計算行級差異。\r\n\r\n**替代方案**：後端計算 diff 回傳結構化 diff 結果。\r\n\r\n**理由**：\r\n- Spec 文件通常不大（數百行以內），前端計算效能不是問題\r\n- 減少 API 複雜度——後端只需提供原始內容\r\n- `diff` 套件體積小（~10KB gzipped），適合前端引入\r\n- 不同環境（Web/Webview/Demo）都能統一處理\r\n\r\n### 3. Diff Library 選擇：`diff` (npm)\r\n\r\n**選擇**：使用 `diff` npm package（https://github.com/kpdecker/jsdiff）\r\n\r\n**理由**：\r\n- 成熟穩定，GitHub 5k+ stars\r\n- 提供 `diffLines` 等 API，回傳結構化 diff result\r\n- 純 JavaScript，無 native dependency\r\n- 體積小，適合 browser 和 webview 環境\r\n\r\n### 4. UI 整合方式：在 SpecDetail 頁面內 inline 顯示\r\n\r\n**選擇**：在 spec detail 頁面的 history timeline 區塊增加版本選取 UI，選取後在頁面內顯示 diff 結果，取代原本的 spec content 區域。\r\n\r\n**替代方案**：用 modal/dialog 顯示 diff，或開新路由頁面。\r\n\r\n**理由**：\r\n- 保持上下文——使用者在看 spec 時可以即時比較\r\n- 不需要額外的路由或 modal 複雜度\r\n- 使用者可以隨時切回原始 content 檢視\r\n\r\n### 5. 版本比較基準：current vs. change version\r\n\r\n**選擇**：預設比較「目前 spec 內容」與「某個 change 版本」。也支援兩個 change 版本之間的比較。\r\n\r\n**理由**：最常見的用例是「這個 change 改了什麼」，比較 current 與 change version 最直覺。\r\n\r\n### 6. API 設計：新增 `getSpecAtChange` 方法\r\n\r\n新增 endpoint `GET /api/openspec/specs/:topic/at/:slug?dir=...`，回傳 `{ content: string }`。\r\n\r\n`ApiAdapter` 介面新增：\r\n```typescript\r\ngetSpecAtChange(topic: string, slug: string): Promise<{ content: string }>\r\n```\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[Risk] Demo 資料膨脹**：StaticAdapter 需要內嵌所有 spec 的歷史版本 → 只嵌入有 delta spec 的版本，資料量可控\r\n- **[Risk] 大量 history entries 時效能**：每次 diff 都需要 API call 取得歷史版本 → spec 文件通常小，可接受。未來如需優化可加 cache\r\n- **[Trade-off] 只做 unified diff**：犧牲 side-by-side 的直覺性 → 減少初版複雜度，unified 在窄螢幕也能用\r\n\r\n## Open Questions\r\n\r\n- 無（初版範圍已明確）\r\n","tasks":{"total":18,"completed":18,"sections":[{"title":"1. Dependencies","tasks":[{"text":"1.1 安裝 `diff` npm package 至 `@spek/web` workspace","completed":true}]},{"title":"2. Core 層","tasks":[{"text":"2.1 在 `packages/core/src/scanner.ts` 新增 `readSpecAtChange(repoDir, topic, slug)` 函式，從 active 或 archive change 目錄讀取 delta spec 內容","completed":true},{"text":"2.2 在 `packages/core/src/types.ts` 新增 `SpecVersionContent` 型別（`{ content: string }`）","completed":true},{"text":"2.3 在 `packages/core/src/index.ts` export 新增的函式與型別","completed":true}]},{"title":"3. API 層（Web Server）","tasks":[{"text":"3.1 在 `packages/web/server/routes/openspec.ts` 新增 `GET /api/openspec/specs/:topic/at/:slug` route","completed":true}]},{"title":"4. API Adapter 層","tasks":[{"text":"4.1 在 `packages/web/src/api/types.ts` 的 `ApiAdapter` 介面新增 `getSpecAtChange(topic: string, slug: string)` 方法","completed":true},{"text":"4.2 在 `FetchAdapter` 實作 `getSpecAtChange`","completed":true},{"text":"4.3 在 `MessageAdapter` 實作 `getSpecAtChange`","completed":true},{"text":"4.4 在 `StaticAdapter` 實作 `getSpecAtChange`，擴展 `DemoData` 型別","completed":true}]},{"title":"5. VS Code Extension","tasks":[{"text":"5.1 在 `packages/vscode/src/handler.ts` 的 `MessageHandler` 新增 `getSpecAtChange` case","completed":true}]},{"title":"6. Frontend 元件","tasks":[{"text":"6.1 建立 `SpecDiffViewer` 元件，使用 `diffLines` 渲染 unified diff","completed":true},{"text":"6.2 在 `useOpenSpec.ts` 新增 `useSpecAtChange(topic, slug)` hook","completed":true},{"text":"6.3 修改 `SpecDetail.tsx`，在 history timeline entry 新增「Compare」按鈕","completed":true},{"text":"6.4 在 `SpecDetail.tsx` 加入 diff 模式狀態管理（選取版本、顯示 diff、退出 diff 模式）","completed":true}]},{"title":"7. Demo 支援","tasks":[{"text":"7.1 修改 `scripts/build-demo.ts`，將 spec 歷史版本內容嵌入 `specVersions` 欄位","completed":true}]},{"title":"8. Build 驗證","tasks":[{"text":"8.1 執行 `npm run build` 確認 core + web build 成功","completed":true},{"text":"8.2 執行 `npm run build:demo` 確認 demo build 成功","completed":true},{"text":"8.3 執行 `npm run type-check` 確認型別檢查通過","completed":true}]}]},"specs":[{"topic":"api-adapter","content":"## MODIFIED Requirements\r\n\r\n### Requirement: ApiAdapter interface\r\nThe frontend SHALL define an `ApiAdapter` interface that abstracts all API communication, allowing different implementations for web and VS Code environments. The interface SHALL include a `getSpecAtChange(topic: string, slug: string): Promise<{ content: string }>` method for fetching spec content at a specific change version.\r\n\r\n#### Scenario: Adapter interface contract\r\n- **WHEN** a component needs to fetch OpenSpec data\r\n- **THEN** it calls methods on the `ApiAdapter` interface (e.g., `getOverview()`, `getSpecs()`, `getChange(slug)`, `getSpecAtChange(topic, slug)`) which return Promises of typed data\r\n\r\n### Requirement: FetchAdapter for web\r\nThe web version SHALL use a `FetchAdapter` that calls the Express REST API via HTTP fetch.\r\n\r\n#### Scenario: Fetch adapter API call\r\n- **WHEN** `FetchAdapter.getOverview()` is called with repoPath set\r\n- **THEN** it performs `fetch('/api/openspec/overview?dir=...')` and returns the parsed JSON response\r\n\r\n#### Scenario: Fetch adapter error handling\r\n- **WHEN** a fetch request returns a non-OK HTTP status\r\n- **THEN** the adapter throws an error with the HTTP status code\r\n\r\n#### Scenario: Fetch adapter getSpecAtChange\r\n- **WHEN** `FetchAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it performs `fetch('/api/openspec/specs/user-auth/at/2026-01-15-add-oauth?dir=...')` and returns the parsed JSON response\r\n\r\n### Requirement: MessageAdapter for VS Code Webview\r\nThe VS Code version SHALL use a `MessageAdapter` that communicates with the extension host via `postMessage`.\r\n\r\n#### Scenario: Message adapter API call\r\n- **WHEN** `MessageAdapter.getOverview()` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getOverview' }` via `postMessage` and returns a Promise that resolves when the matching response arrives\r\n\r\n#### Scenario: Message adapter timeout\r\n- **WHEN** a message request does not receive a response within 10 seconds\r\n- **THEN** the adapter rejects the Promise with a timeout error\r\n\r\n#### Scenario: Message adapter error response\r\n- **WHEN** the extension host responds with `{ type: 'response', id, error: '...' }`\r\n- **THEN** the adapter rejects the Promise with the error message\r\n\r\n#### Scenario: Message adapter getSpecAtChange\r\n- **WHEN** `MessageAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getSpecAtChange', params: { topic: 'user-auth', slug: '2026-01-15-add-oauth' } }` via `postMessage`\r\n\r\n### Requirement: StaticAdapter for demo\r\nThe demo version SHALL use a `StaticAdapter` that reads all data from a pre-embedded JSON object (`window.__DEMO_DATA__`) and implements the `ApiAdapter` interface. The `DemoData` structure SHALL include a `specVersions` field mapping topic to slug to content.\r\n\r\n#### Scenario: Serve pre-embedded data\r\n- **WHEN** any API method is called (getOverview, getSpecs, getSpec, getChanges, getChange)\r\n- **THEN** it returns the corresponding data from the embedded JSON via `Promise.resolve()`\r\n\r\n#### Scenario: Client-side search\r\n- **WHEN** `search(query)` is called\r\n- **THEN** it performs case-insensitive substring matching across all spec topic names, spec content, change slugs, and change proposal/design content, returning matching results with context snippets\r\n\r\n#### Scenario: Search matches spec topic names\r\n- **WHEN** `search(\"dashboard\")` is called and a spec with topic `dashboard-view` exists\r\n- **THEN** the result includes `dashboard-view` as a match\r\n\r\n#### Scenario: No-op for inapplicable methods\r\n- **WHEN** `browse()`, `detect()`, or `resync()` is called\r\n- **THEN** it returns sensible defaults without error (empty browse, `hasOpenSpec: true`, void)\r\n\r\n#### Scenario: StaticAdapter getSpecAtChange\r\n- **WHEN** `StaticAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it reads from `window.__DEMO_DATA__.specVersions[\"user-auth\"][\"2026-01-15-add-oauth\"]` and returns `{ content: \"...\" }`\r\n\r\n#### Scenario: StaticAdapter getSpecAtChange not found\r\n- **WHEN** `StaticAdapter.getSpecAtChange(\"user-auth\", \"nonexistent\")` is called\r\n- **AND** no matching version exists in the embedded data\r\n- **THEN** it rejects with an error\r\n"},{"topic":"spec-diff","content":"## ADDED Requirements\r\n\r\n### Requirement: Read spec content at a specific change version\r\nThe system SHALL provide a core function `readSpecAtChange(repoDir, topic, slug)` that reads the spec content from a specific change's delta spec file. It SHALL check both active (`openspec/changes/<slug>/specs/<topic>/spec.md`) and archived (`openspec/changes/archive/<slug>/specs/<topic>/spec.md`) change directories.\r\n\r\n#### Scenario: Read spec from active change\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **AND** `openspec/changes/2026-01-15-add-oauth/specs/user-auth/spec.md` exists\r\n- **THEN** it returns `{ content: \"<file contents>\" }`\r\n\r\n#### Scenario: Read spec from archived change\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"2025-12-01-init\")` is called\r\n- **AND** the change is in the archive directory\r\n- **THEN** it returns `{ content: \"<file contents>\" }` from the archive path\r\n\r\n#### Scenario: Spec version not found\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"nonexistent-slug\")` is called\r\n- **AND** no delta spec file exists for that topic in that change\r\n- **THEN** it returns `null`\r\n\r\n### Requirement: Spec version diff API endpoint\r\nThe system SHALL expose `GET /api/openspec/specs/:topic/at/:slug?dir=...` that returns the spec content at a specific change version. The VS Code extension host SHALL handle a `getSpecAtChange` message with the same semantics.\r\n\r\n#### Scenario: Fetch spec at change version via REST\r\n- **WHEN** client calls `GET /api/openspec/specs/user-auth/at/2026-01-15-add-oauth?dir=/repo`\r\n- **THEN** the server returns `{ \"content\": \"<delta spec content>\" }` with status 200\r\n\r\n#### Scenario: Spec version not found via REST\r\n- **WHEN** client calls `GET /api/openspec/specs/user-auth/at/nonexistent?dir=/repo`\r\n- **THEN** the server returns `{ \"error\": \"Spec version not found\" }` with status 404\r\n\r\n#### Scenario: VS Code extension handles getSpecAtChange\r\n- **WHEN** the webview sends `{ type: \"request\", method: \"getSpecAtChange\", params: { topic, slug } }`\r\n- **THEN** the extension host calls `readSpecAtChange` and returns the result\r\n\r\n### Requirement: Diff viewer UI component\r\nThe system SHALL provide a `SpecDiffViewer` component that renders a unified diff between two spec content strings. Diff computation SHALL be done client-side using the `diff` npm package's `diffLines` function.\r\n\r\n#### Scenario: Display unified diff\r\n- **WHEN** the component receives two content strings (old and new)\r\n- **THEN** it renders a unified diff view with added lines highlighted in green and removed lines highlighted in red\r\n\r\n#### Scenario: Identical content\r\n- **WHEN** both content strings are identical\r\n- **THEN** it displays a message indicating no differences found\r\n\r\n#### Scenario: Empty old content\r\n- **WHEN** the old content is empty (new spec)\r\n- **THEN** all lines in the new content are shown as added\r\n\r\n### Requirement: Version comparison interaction on SpecDetail page\r\nThe system SHALL add a comparison mode to the SpecDetail page. Users can select a history entry to compare against the current spec content, or select two history entries to compare against each other.\r\n\r\n#### Scenario: Compare current vs. history version\r\n- **WHEN** the user clicks a \"Compare\" action on a history timeline entry\r\n- **THEN** the system fetches the spec content at that change version\r\n- **AND** displays a diff view comparing the change version (old) against the current spec content (new)\r\n\r\n#### Scenario: Compare two history versions\r\n- **WHEN** the user selects two history entries for comparison\r\n- **THEN** the system fetches both change versions\r\n- **AND** displays a diff view with the earlier version as old and the later version as new\r\n\r\n#### Scenario: Exit diff mode\r\n- **WHEN** the user is viewing a diff and clicks \"Close\" or \"Back to spec\"\r\n- **THEN** the diff view is dismissed and the original spec content is shown again\r\n\r\n#### Scenario: No history available\r\n- **WHEN** a spec has no history entries\r\n- **THEN** no comparison UI is shown\r\n"},{"topic":"spec-history","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Spec history timeline UI\r\nThe system SHALL display a visual timeline on the SpecDetail page showing all changes that affected the spec. Each timeline entry MUST display the date, change description, and a link to the change detail page. Each timeline entry SHALL also include a \"Compare\" action that triggers diff comparison against the current spec content.\r\n\r\n#### Scenario: Display history timeline\r\n- **WHEN** the SpecDetail page is rendered for a spec with related changes\r\n- **THEN** a \"History\" section is displayed with a vertical timeline showing each change chronologically\r\n\r\n#### Scenario: Timeline entry links to change\r\n- **WHEN** the user clicks on a timeline entry's title or description\r\n- **THEN** the system navigates to the corresponding change detail page\r\n\r\n#### Scenario: No history\r\n- **WHEN** the SpecDetail page is rendered for a spec with no related changes\r\n- **THEN** the \"History\" section displays a message indicating no changes have affected this spec\r\n\r\n#### Scenario: Timeline entry compare action\r\n- **WHEN** the user clicks the \"Compare\" action on a timeline entry\r\n- **THEN** the system enters diff comparison mode showing the difference between that change version and the current spec content\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-17"}},"2026-02-17-add-vscode-tab-icon":{"slug":"2026-02-17-add-vscode-tab-icon","proposal":"## Why\r\n\r\nVS Code extension 的 webview panel tab 目前只顯示預設圖示，在多個 tab 中缺乏辨識度。既然 extension 已有 `webview/favicon.svg`（琥珀色 S 形 logo），應作為 tab icon 使用，讓使用者快速辨識 spek panel。\r\n\r\n## What Changes\r\n\r\n- 在 `SpekPanel` 建立 webview panel 後設定 `iconPath`，指向已有的 `webview/favicon.svg`\r\n- 不需要新增任何圖片資源，直接複用現有的 favicon\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n_無新增 capability — 此變更為現有 webview-integration 的增強。_\r\n\r\n### Modified Capabilities\r\n\r\n- `webview-integration`: 新增 tab icon 顯示的 requirement\r\n\r\n## Impact\r\n\r\n- 影響檔案：`packages/vscode/src/panel.ts`（加一行 `iconPath` 設定）\r\n- 無 API 變更、無依賴變更、無 breaking change\r\n","design":"## Context\r\n\r\nVS Code 的 `WebviewPanel` 支援 `iconPath` 屬性，可在 tab 上顯示自訂圖示。目前 `SpekPanel` 建立 panel 後未設定此屬性，導致 tab 只顯示預設圖示。\r\n\r\nExtension 已有 `webview/favicon.svg`（32x32，深色背景 + 琥珀色 S 形 logo），適合直接作為 tab icon。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 讓 spek webview panel 在 VS Code tab bar 上顯示專屬 icon\r\n\r\n**Non-Goals:**\r\n- 不區分 light/dark theme 的 icon 版本（現有 SVG 在兩種背景下都可辨識）\r\n- 不新增額外圖片資源\r\n\r\n## Decisions\r\n\r\n### 直接使用現有 favicon.svg\r\n\r\n**選擇**：複用 `webview/favicon.svg` 作為 tab icon\r\n\r\n**替代方案**：\r\n- 新建專用的 tab icon 圖片 — 不必要，現有 SVG 品質已足夠\r\n- 分別提供 light/dark 版本 — 現有 SVG 帶深色背景 `#0a0c0f`，在 light/dark theme 都有足夠對比度\r\n\r\n**理由**：零額外資源，一行程式碼完成。\r\n\r\n### 使用單一 URI 而非 light/dark 物件\r\n\r\n**選擇**：`panel.iconPath = vscode.Uri.joinPath(...)` 傳入單一 URI\r\n\r\n**替代方案**：傳入 `{ light: Uri, dark: Uri }` 物件分別指定\r\n\r\n**理由**：favicon.svg 的深色背景使其在兩種 theme 下都清晰可見，不需分別處理。\r\n\r\n## Risks / Trade-offs\r\n\r\n- [SVG 相容性] VS Code 的 tab icon 支援 SVG 格式 → 無風險，官方文件明確支援\r\n- [icon 尺寸] tab icon 顯示尺寸較小 → favicon.svg 已針對 32x32 小尺寸優化，無問題\r\n","tasks":{"total":2,"completed":2,"sections":[{"title":"1. Implementation","tasks":[{"text":"1.1 在 `packages/vscode/src/panel.ts` 的 `createWebviewPanel` 後加上 `this.panel.iconPath = vscode.Uri.joinPath(context.extensionUri, \"webview\", \"favicon.svg\")`","completed":true}]},{"title":"2. Verification","tasks":[{"text":"2.1 Build extension 並確認 tab icon 正確顯示","completed":true}]}]},"specs":[{"topic":"webview-integration","content":"## ADDED Requirements\r\n\r\n### Requirement: Tab icon display\r\nThe Webview Panel SHALL display the spek logo as the tab icon for visual identification.\r\n\r\n#### Scenario: Tab icon is set on panel creation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** the panel's `iconPath` SHALL be set to the `webview/favicon.svg` file from the extension's bundled assets\r\n\r\n#### Scenario: Icon visibility across themes\r\n- **WHEN** the tab icon is displayed in either light or dark VS Code theme\r\n- **THEN** the icon SHALL be visually distinguishable against the tab bar background\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-17"}},"2026-02-16-ui-design-polish-p2":{"slug":"2026-02-16-ui-design-polish-p2","proposal":"## Why\r\n\r\nP0+P1 設計修正後，仍有多項 P2 級別的 UI/UX 問題影響使用體驗：頁面標題緊貼 navbar 缺乏呼吸空間、Change Detail tab 順序與 OpenSpec 實際工作流程不符、返回導航字體偏小且缺乏層級感、各列表頁信息密度不足、tab 切換缺少過渡動畫等。這些改善將顯著提升瀏覽體驗的流暢度與專業感。\r\n\r\n## What Changes\r\n\r\n- 增加主內容區的頂部間距，讓 h1 不再緊貼 navbar\r\n- 修正 Change Detail tab 排列順序為 Proposal → Design → Specs → Tasks（符合 OpenSpec 工作流程）\r\n- 放大「← Back to Specs/Changes」返回連結字體，增強可點擊性\r\n- Change Detail tab 切換加入 fade 過渡動畫\r\n- Specs/Changes 列表加入內容摘要或副標題，提高信息密度\r\n- 搜尋結果加入匹配文字高亮、分類 filter、空狀態改善\r\n- Active/Archived changes 加入更明顯的視覺區隔\r\n- Tasks checkbox 使用自訂樣式取代原生外觀，已完成項加入淡化效果\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無）\r\n\r\n### Modified Capabilities\r\n\r\n- `shared-layout`: 增加主內容區頂部間距（h1 與 navbar 之間的空間）\r\n- `change-browsing`: 修正 tab 順序、加入 tab 切換動畫、改善返回連結樣式、Active/Archived 視覺區隔、tasks checkbox 自訂樣式\r\n- `spec-browsing`: 改善返回連結樣式、列表加入摘要預覽\r\n- `search-ui`: 搜尋結果匹配高亮、分類 filter、空狀態改善\r\n\r\n## Impact\r\n\r\n- 前端元件：Layout.tsx、ChangeDetail.tsx、SpecDetail.tsx、SpecList.tsx、ChangeList.tsx、TabView.tsx、SearchDialog.tsx\r\n- 無 API 變更、無 breaking changes\r\n- 可能需要新的 CSS 動畫 keyframes\r\n- Demo 頁面會自動受益（共用同一套元件）\r\n","design":"## Context\r\n\r\nP0+P1 修正（commit 91bc191）完成了關鍵 bug 修復與基礎視覺改善。目前殘餘的 P2 問題影響日常瀏覽體驗：h1 緊貼 navbar、tab 順序與工作流程不符、返回連結不夠顯眼、tab 切換生硬、列表信息密度低、搜尋缺乏高亮與 filter、changes 列表視覺單調、tasks checkbox 使用原生樣式。\r\n\r\n現有元件結構：\r\n- `Layout.tsx` — 主內容區 `<main>` 使用 `pt-14 p-6`（pt-14 = 56px 對應 header 高度，p-6 = 24px 全方位 padding）\r\n- `TabView.tsx` — 通用 tab 元件，無動畫\r\n- `ChangeDetail.tsx` — tab 順序為 Proposal → Design → Tasks → Specs；返回連結 `text-sm`\r\n- `SpecDetail.tsx` — 返回連結 `text-sm`\r\n- `SpecList.tsx` / `ChangeList.tsx` — 只顯示名稱，無摘要\r\n- `SearchDialog.tsx` — 無匹配高亮、無分類 filter\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 增加頁面標題與 navbar 之間的視覺間距\r\n- 修正 tab 順序符合 OpenSpec 工作流程（Proposal → Design → Specs → Tasks）\r\n- 放大返回連結字體提升可見性\r\n- Tab 切換加入 fade 過渡動畫\r\n- 列表頁增加信息密度（摘要/統計）\r\n- 搜尋結果高亮匹配文字、加入分類 filter\r\n- Active/Archived changes 視覺區隔更明顯\r\n- Tasks checkbox 自訂樣式\r\n\r\n**Non-Goals:**\r\n- Breadcrumb 導航（會增加複雜度且目前頁面層級只有 2 層，返回連結足夠）\r\n- Grid/list 雙模式切換（P3 再考慮）\r\n- 最近搜尋紀錄（P3）\r\n- Skeleton loading（P3）\r\n\r\n## Decisions\r\n\r\n### 1. H1 頂部間距：在 `<main>` 增加 padding-top\r\n\r\n**方案**：將 `pt-14` 改為 `pt-20`（從 56px → 80px），增加 24px 呼吸空間。\r\n\r\n**理由**：直接在 Layout 層修改最簡單，所有頁面統一受益，不需逐頁調整。相比在每個頁面 h1 加 `mt-*`，這個方案更一致。\r\n\r\n### 2. Tab 順序修正：調整 ChangeDetail tabs 陣列\r\n\r\n**方案**：將 `tabs` 陣列中 `tasks` 和 `specs` 互換位置，變為 Proposal → Design → Specs → Tasks。\r\n\r\n**理由**：符合 OpenSpec 工作流程（先寫 spec 才能產生 tasks）。改動極小，只調換陣列元素順序。\r\n\r\n### 3. 返回連結字體：從 `text-sm` 改為 `text-base`\r\n\r\n**方案**：SpecDetail 和 ChangeDetail 的返回連結從 `text-sm`（14px）改為 `text-base`（16px），並加入 `font-medium`。\r\n\r\n**理由**：`text-base` 提升可讀性但不會過大搶走標題視覺權重。加入 `font-medium` 增加存在感。\r\n\r\n### 4. Tab 切換動畫：CSS transition + key-based re-render\r\n\r\n**方案**：在 TabView 的內容區域加入 CSS `transition` + `opacity` fade 效果。使用 `key={activeId}` 觸發 re-mount 搭配 CSS `@keyframes fadeIn` 動畫。\r\n\r\n**理由**：純 CSS 方案最輕量。不需引入 animation library（如 framer-motion）。fade-in 效果簡潔且不影響效能。\r\n\r\n### 5. 列表摘要：Specs 顯示歷史數、Changes 顯示 proposal 摘要\r\n\r\n**方案**：\r\n- SpecList：在每個 spec 卡片加入歷史 change 數量（需 API 支援，但目前 `SpecInfo` 已有 `historyCount`）\r\n- ChangeList：Active changes 已有 TaskProgress；Archived changes 顯示描述即可（目前已有）\r\n\r\n**理由**：利用現有資料結構，不需新增 API。SpecInfo 中的 `historyCount` 可直接使用。\r\n\r\n### 6. 搜尋高亮：在 ResultItem 中 highlight 匹配片段\r\n\r\n**方案**：建立 `highlightMatch(text, query)` 工具函式，將匹配部分用 `<mark>` 標籤包裹（背景色 accent/20）。同時加入 type filter toggle（All / Specs / Changes）。\r\n\r\n**理由**：純前端實現，不需改 API。`<mark>` 語義正確且容易 style。\r\n\r\n### 7. Changes 視覺區隔：Active 加左側 accent 色條\r\n\r\n**方案**：Active changes 卡片加入左側 4px accent 色條（`border-l-4 border-accent`），Archived 保持現狀。\r\n\r\n**理由**：最小改動達到最大視覺區隔效果。左側色條是常見的狀態標示模式。\r\n\r\n### 8. Tasks checkbox 自訂樣式：CSS 自訂 checkbox 圖示\r\n\r\n**方案**：用 SVG icon 取代文字 `[x]`/`[ ]`，已完成項加入 `opacity-60` 淡化。使用 inline SVG checkmark（✓）和 empty circle。\r\n\r\n**理由**：比原生 checkbox 更一致的外觀。`opacity-60` 搭配既有的 `line-through` 讓已完成項視覺降級更自然。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[風險] `pt-20` 在 mobile 可能過大** → 可使用 responsive class `pt-16 md:pt-20`，但 mobile 的 pt-14 已經包含 header 高度，改為 pt-16 仍會有改善。使用 `pt-18`（72px）作為折衷。\r\n- **[風險] fade 動畫與快速連點 tab 衝突** → 動畫時間設短（150ms），即使快速切換也不會感覺遲鈍。\r\n- **[風險] 搜尋高亮在特殊字元 query 可能出錯** → 對 query 進行 regex escape 處理。\r\n- **[取捨] 不做 breadcrumb** → 目前頁面層級淺（最多 2 層），返回連結字體放大後已足夠。未來若加入更深層級再考慮。\r\n","tasks":{"total":16,"completed":16,"sections":[{"title":"1. Layout and Navigation","tasks":[{"text":"1.1 Increase main content top padding in Layout.tsx (pt-14 → pt-18) for h1 breathing room","completed":true},{"text":"1.2 Change back navigation links from text-sm to text-base font-medium in SpecDetail.tsx and ChangeDetail.tsx","completed":true}]},{"title":"2. Tab Fixes","tasks":[{"text":"2.1 Swap tab order in ChangeDetail.tsx: move Specs before Tasks (Proposal → Design → Specs → Tasks)","completed":true},{"text":"2.2 Add fade-in CSS animation to TabView.tsx content panel with key-based re-render (150ms)","completed":true},{"text":"2.3 Add prefers-reduced-motion media query to disable tab animation","completed":true}]},{"title":"3. List Enhancements","tasks":[{"text":"3.1 Add history count display to SpecList.tsx spec items (use existing historyCount from SpecInfo)","completed":true},{"text":"3.2 Add left accent border (border-l-4 border-accent) to active change cards in ChangeList.tsx","completed":true}]},{"title":"4. Search Improvements","tasks":[{"text":"4.1 Create highlightMatch utility function for marking matched text fragments","completed":true},{"text":"4.2 Apply highlight to search result titles and context in SearchDialog.tsx ResultItem","completed":true},{"text":"4.3 Add type filter toggle (All / Specs / Changes) to SearchDialog.tsx","completed":true},{"text":"4.4 Improve empty state message with search suggestions","completed":true}]},{"title":"5. Task Checkbox Styling","tasks":[{"text":"5.1 Replace text-based [x]/[ ] with custom SVG checkmark/circle icons in ChangeDetail.tsx Tasks tab","completed":true},{"text":"5.2 Add opacity-60 to completed task items","completed":true}]},{"title":"6. Verification","tasks":[{"text":"6.1 Visual test with agent-browser: verify h1 spacing, tab order, back links, animations across pages","completed":true},{"text":"6.2 Run type-check to ensure no TypeScript errors","completed":true},{"text":"6.3 Rebuild demo page and verify changes apply","completed":true}]}]},"specs":[{"topic":"change-browsing","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs in OpenSpec workflow order: Proposal, Design, Specs (delta specs), and Tasks. Tab content SHALL transition with a fade-in animation when switching.\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed with a fade-in transition\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics, with a fade-in transition\r\n\r\n#### Scenario: Tab order\r\n- **WHEN** the ChangeDetail page is rendered\r\n- **THEN** the tabs are displayed in order: Proposal, Design, Specs, Tasks (matching the OpenSpec workflow sequence)\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Active changes SHALL be visually distinguished with a left accent color border (4px). Archived changes SHALL be sorted by date (most recent first).\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with a left accent color border, name, and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by date descending, without accent border\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Custom task checkbox styling\r\nThe system SHALL render task items in the Tasks tab using custom SVG icons instead of text-based `[x]`/`[ ]` markers. Completed tasks SHALL display a filled checkmark icon in green, and incomplete tasks SHALL display an empty circle icon. Completed task text SHALL have reduced opacity (0.6) in addition to the existing strikethrough styling.\r\n\r\n#### Scenario: Incomplete task display\r\n- **WHEN** a task item is not completed\r\n- **THEN** the task displays an empty circle SVG icon followed by the task text at full opacity\r\n\r\n#### Scenario: Completed task display\r\n- **WHEN** a task item is completed\r\n- **THEN** the task displays a green checkmark SVG icon followed by the task text with strikethrough and reduced opacity (0.6)\r\n"},{"topic":"search-ui","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Search query execution\r\nThe system SHALL search across all specs and changes content by calling the backend search API with debounced input. Search results SHALL highlight matching text fragments in the title and context preview.\r\n\r\n#### Scenario: Debounced search on input\r\n- **WHEN** user types a query in the search input\r\n- **THEN** the system waits 300ms after the last keystroke before sending the search request\r\n\r\n#### Scenario: Display search results with highlights\r\n- **WHEN** the search API returns results\r\n- **THEN** results are displayed grouped by type (Specs and Changes), with matching query text highlighted using a contrasting background color in both the title and context snippet\r\n\r\n#### Scenario: No results found\r\n- **WHEN** the search API returns an empty array\r\n- **THEN** the dialog displays a \"No results found\" message with a suggestion to try different keywords\r\n\r\n#### Scenario: Empty query\r\n- **WHEN** the search input is empty\r\n- **THEN** no search request is made and the results area shows a prompt to start typing\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Search type filter\r\nThe system SHALL provide a type filter in the search dialog allowing users to narrow results by category: All, Specs only, or Changes only.\r\n\r\n#### Scenario: Filter by type\r\n- **WHEN** user selects \"Specs\" filter while search results are displayed\r\n- **THEN** only spec-type results are shown, change-type results are hidden\r\n\r\n#### Scenario: Default filter\r\n- **WHEN** the search dialog opens\r\n- **THEN** the \"All\" filter is selected by default, showing both spec and change results\r\n\r\n#### Scenario: Filter with no matching results\r\n- **WHEN** user selects a type filter and no results match that type\r\n- **THEN** a \"No results found\" message is displayed for that category\r\n"},{"topic":"shared-layout","content":"## MODIFIED Requirements\r\n\r\n### Requirement: TabView component\r\nThe system SHALL provide a reusable TabView component that renders tab headers and switches between tab content panels. When switching tabs, the new content panel SHALL fade in with a 150ms CSS animation.\r\n\r\n#### Scenario: Switch tabs\r\n- **WHEN** user clicks a tab header\r\n- **THEN** the corresponding tab content panel is displayed with a fade-in animation (150ms duration) and the previous panel is hidden\r\n\r\n#### Scenario: Default tab\r\n- **WHEN** TabView is first rendered\r\n- **THEN** the first tab is selected by default\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** user has `prefers-reduced-motion: reduce` enabled\r\n- **THEN** tab content switches instantly without fade animation\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Main content area top spacing\r\nThe system SHALL render the main content area with sufficient top spacing below the fixed header to provide visual breathing room between the navbar and page content. The top padding SHALL be at least 72px (header height 56px + 16px spacing).\r\n\r\n#### Scenario: Page title spacing\r\n- **WHEN** any page is rendered within the Layout\r\n- **THEN** the first content element (typically h1) has at least 16px of visual spacing below the header bar\r\n\r\n### Requirement: Back navigation link styling\r\nThe system SHALL render back navigation links (e.g., \"← Back to Specs\", \"← Back to Changes\") at base font size (16px) with medium font weight for adequate visibility and clickability.\r\n\r\n#### Scenario: Back link display\r\n- **WHEN** user views a detail page (SpecDetail or ChangeDetail)\r\n- **THEN** the back navigation link is displayed at 16px font size with medium weight, muted color, and accent color on hover\r\n"},{"topic":"spec-browsing","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Spec list with filtering\r\nThe system SHALL display all specs sorted alphabetically with history count metadata. A filter input SHALL allow instant client-side filtering by spec topic name. Each spec item SHALL display the topic name and the number of related changes (history count) as secondary information.\r\n\r\n#### Scenario: Display all specs\r\n- **WHEN** user navigates to the SpecList page\r\n- **THEN** all spec topics are listed alphabetically, each showing the topic name and history change count\r\n\r\n#### Scenario: Filter specs\r\n- **WHEN** user types in the filter input\r\n- **THEN** the list is filtered in real-time to show only specs whose topic name contains the search text (case-insensitive)\r\n\r\n#### Scenario: Spec with no history\r\n- **WHEN** a spec has zero related changes\r\n- **THEN** the history count is not displayed (or shows \"No changes\")\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-15"}},"2026-02-16-ui-design-polish-p0-p1":{"slug":"2026-02-16-ui-design-polish-p0-p1","proposal":"## Why\r\n\r\n經過前端設計審查，發現 spek 有數項影響功能正確性與使用體驗的問題：Demo 版搜尋功能無法正確搜尋（P0 bug）、行動版漢堡按鈕缺少 accessibility label（P0 a11y）、進度條未反映完成語意（P1）、Dashboard 統計數字視覺權重不足且缺少入場動畫（P1）、以及全站使用系統字體堆疊缺乏品牌識別（P1）。\r\n\r\n## What Changes\r\n\r\n- 修正 StaticAdapter 的 `search()` 實作，使其能正確搜尋 spec/change 的 title 和內容\r\n- 為行動版 hamburger 按鈕加入 `aria-label` 屬性\r\n- TaskProgress 進度條在全部完成時（100%）從琥珀色變為綠色\r\n- Dashboard stat cards 數字放大並加入 staggered fade-in 入場動畫\r\n- 引入特色字體（Google Fonts）取代系統字體堆疊，建立品牌識別\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無）\r\n\r\n### Modified Capabilities\r\n\r\n- `api-adapter`：新增 StaticAdapter 的 search 行為規格（目前 spec 未涵蓋 StaticAdapter）\r\n- `shared-layout`：hamburger 按鈕的 accessibility 需求、全站字體變更\r\n- `dashboard-view`：stat cards 數字樣式放大與入場動畫、進度條完成狀態色彩語意\r\n\r\n## Impact\r\n\r\n- **前端元件**：`StaticAdapter.ts`、`Layout.tsx`（header hamburger）、`Dashboard.tsx`（stat cards）、`TaskProgress.tsx`（進度條）、`global.css`（字體）\r\n- **依賴**：新增 Google Fonts CDN 引用（或 self-hosted）\r\n- **Demo**：修正後需重新 build demo.html\r\n- **VS Code Extension**：webview 字體同步變更，需確認 CSP 允許字體載入\r\n","design":"## Context\r\n\r\nspek 前端經過設計審查後，發現 P0（功能/a11y bug）和 P1（視覺體驗）的改進項目。目前前端使用 React 19 + Tailwind CSS v4 + Vite，所有元件用 Tailwind utility class 做樣式。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 修正 Demo 版 StaticAdapter 搜尋 bug（搜尋 \"dashboard\" 應找到 \"dashboard-view\"）\r\n- 為行動版 hamburger 按鈕加入 aria-label\r\n- TaskProgress 進度條在 100% 完成時顯示綠色\r\n- Dashboard stat cards 數字放大（text-4xl）並加入 staggered fade-in 動畫\r\n- 引入 Google Fonts 特色字體取代系統字體堆疊\r\n\r\n**Non-Goals:**\r\n- 不重新設計整體 layout 或色彩系統\r\n- 不新增 Specs 列表摘要預覽（P2）\r\n- 不做 Tab 切換動畫或 skeleton loading（P2/P3）\r\n- 不處理 VS Code extension 的字體 CSP 問題（另案處理）\r\n\r\n## Decisions\r\n\r\n### 1. StaticAdapter 搜尋修正策略\r\n\r\n**問題**：搜尋 \"dashboard\" 找不到 \"dashboard-view\" spec。原始碼中 `search()` 方法邏輯正確（`topic.toLowerCase().includes(q)` 應該匹配），但 `detail.content` 是 markdown 原始內容。經檢查，問題出在 `specDetails` 的 key 是 topic name（如 `dashboard-view`），`topic.toLowerCase().includes(\"dashboard\")` 理論上為 true。\r\n\r\n需進一步除錯確認是否為 demo build 時 `specDetails` 資料結構問題，或是 `SpecDetail` 的 `content` 欄位為空。\r\n\r\n**決策**：在 search 中加入 spec title（即 topic name）的匹配作為第一優先，同時也搜尋 `specs` 列表（不只 `specDetails`）。改用 Fuse.js 做 fuzzy matching 會過重，改為加強 substring matching 的覆蓋範圍即可。\r\n\r\n### 2. 進度條完成狀態色彩\r\n\r\n**決策**：在 `TaskProgress` 元件中，根據 `completed === total` 條件動態切換進度條顏色 class。\r\n- 未完成：維持 `bg-accent`（琥珀色）\r\n- 已完成：切換為 `bg-green-500`（綠色）\r\n\r\n選擇 Tailwind 內建的 `green-500` 而非自訂色，因為只有這一個語意用途，不需要擴充 theme。\r\n\r\n### 3. Stat Cards 動畫方案\r\n\r\n**決策**：使用純 CSS `@keyframes` + `animation-delay` 做 staggered fade-in，不引入 Motion library。理由：\r\n- 僅 Dashboard 頁面需要，不需要整個動畫框架\r\n- 4 張卡片的 stagger 效果用 CSS 即可實現\r\n- 在 `global.css` 中定義 `@keyframes fadeInUp`，Dashboard 中透過 inline style 設定不同的 `animation-delay`\r\n\r\n數字大小從 `text-2xl` 改為 `text-4xl`，增加視覺衝擊。\r\n\r\n### 4. 字體選擇\r\n\r\n**決策**：選用 **Plus Jakarta Sans** 作為主字體。理由：\r\n- 幾何風格、現代感，適合開發工具\r\n- 有 Variable Font 版本，檔案小效率高\r\n- 支援 400-800 字重，涵蓋 body 和 heading\r\n- 免費開源（OFL），可透過 Google Fonts CDN 載入\r\n\r\n**載入方式**：在 `index.html` 和 demo 的 HTML 中加入 Google Fonts `<link>` tag，再更新 `global.css` 的 `font-family`。不使用 self-hosted 方式以減少 build 複雜度。\r\n\r\n程式碼字體維持 JetBrains Mono 不變。\r\n\r\n### 5. Hamburger aria-label\r\n\r\n**決策**：在 `Layout.tsx` 的行動版 hamburger `<button>` 加入 `aria-label=\"Open navigation menu\"`（英文，因為是 HTML 屬性非使用者可見文字）。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **Google Fonts CDN 依賴**：離線環境（如部分企業內網）可能無法載入字體，需確保 fallback 字體堆疊仍可用 → 加入 `sans-serif` fallback\r\n- **CSS 動畫 prefers-reduced-motion**：部分使用者偏好減少動畫 → 加入 `@media (prefers-reduced-motion: reduce)` 取消動畫\r\n- **VS Code Webview 字體載入**：Webview CSP 預設不允許外部資源 → 此次不處理 VS Code 的字體，維持系統字體 fallback（已列為 Non-Goal）\r\n","tasks":{"total":12,"completed":12,"sections":[{"title":"1. P0: StaticAdapter 搜尋修正","tasks":[{"text":"1.1 除錯 `StaticAdapter.search()` — 確認 demo build 的 `specDetails` 資料結構中 key 與 content 是否正確填充","completed":true},{"text":"1.2 修正 `StaticAdapter.search()` — 確保 spec topic name 的 substring matching 正確運作，同時搜尋 `specs` 列表的 topic name","completed":true},{"text":"1.3 重新 build demo (`npm run build:demo`) 並驗證搜尋 \"dashboard\" 能找到 \"dashboard-view\"","completed":true}]},{"title":"2. P0: Hamburger 按鈕 Accessibility","tasks":[{"text":"2.1 在 `Layout.tsx` 的行動版 hamburger `<button>` 加入 `aria-label=\"Open navigation menu\"`","completed":true}]},{"title":"3. P1: 進度條完成狀態色彩","tasks":[{"text":"3.1 修改 `TaskProgress.tsx` — 根據 `completed === total && total > 0` 條件，將進度條 class 從 `bg-accent` 切換為 `bg-green-500`","completed":true}]},{"title":"4. P1: Stat Cards 視覺強化","tasks":[{"text":"4.1 在 `global.css` 新增 `@keyframes fadeInUp` 動畫定義，以及 `prefers-reduced-motion: reduce` 的取消規則","completed":true},{"text":"4.2 修改 `Dashboard.tsx` — stat card 數字從 `text-2xl` 改為 `text-4xl`，並為每張卡片加入 staggered `animation-delay` 的 fadeInUp 動畫","completed":true}]},{"title":"5. P1: 引入特色字體","tasks":[{"text":"5.1 在 `packages/web/index.html` 加入 Google Fonts `<link>` tag 載入 Plus Jakarta Sans（variable, 400-800）","completed":true},{"text":"5.2 在 `packages/web/src/styles/global.css` 更新 body `font-family` 為 `\"Plus Jakarta Sans\", sans-serif`","completed":true},{"text":"5.3 在 `scripts/build-demo.ts` 確認 demo build 也包含 Google Fonts link，或在 demo HTML template 中加入","completed":true}]},{"title":"6. 驗證","tasks":[{"text":"6.1 執行 `npm run type-check` 確認無型別錯誤","completed":true},{"text":"6.2 重新 build demo (`npm run build:demo`) 並用瀏覽器驗證所有改動","completed":true}]}]},"specs":[{"topic":"api-adapter","content":"## ADDED Requirements\r\n\r\n### Requirement: StaticAdapter for demo\r\nThe demo version SHALL use a `StaticAdapter` that reads all data from a pre-embedded JSON object (`window.__DEMO_DATA__`) and implements the `ApiAdapter` interface.\r\n\r\n#### Scenario: Serve pre-embedded data\r\n- **WHEN** any API method is called (getOverview, getSpecs, getSpec, getChanges, getChange)\r\n- **THEN** it returns the corresponding data from the embedded JSON via `Promise.resolve()`\r\n\r\n#### Scenario: Client-side search\r\n- **WHEN** `search(query)` is called\r\n- **THEN** it performs case-insensitive substring matching across all spec topic names, spec content, change slugs, and change proposal/design content, returning matching results with context snippets\r\n\r\n#### Scenario: Search matches spec topic names\r\n- **WHEN** `search(\"dashboard\")` is called and a spec with topic `dashboard-view` exists\r\n- **THEN** the result includes `dashboard-view` as a match\r\n\r\n#### Scenario: No-op for inapplicable methods\r\n- **WHEN** `browse()`, `detect()`, or `resync()` is called\r\n- **THEN** it returns sensible defaults without error (empty browse, `hasOpenSpec: true`, void)\r\n"},{"topic":"dashboard-view","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Overview statistics display\r\nThe system SHALL display overview statistics from the overview API: total specs count, active changes count, archived changes count, and task completion rate (percentage). Statistics SHALL be displayed in stat cards with large numbers (text-4xl) and a staggered fade-in-up entry animation on page load.\r\n\r\n#### Scenario: Display statistics\r\n- **WHEN** user navigates to the Dashboard page\r\n- **THEN** system displays specs count, active changes count, archived changes count, and overall task completion percentage in stat cards with large accent-colored numbers\r\n\r\n#### Scenario: Staggered entry animation\r\n- **WHEN** the Dashboard page loads\r\n- **THEN** the four stat cards appear with a fade-in-up animation, each card delayed by an incremental amount (e.g., 0ms, 80ms, 160ms, 240ms) creating a staggered reveal effect\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** user has `prefers-reduced-motion: reduce` enabled\r\n- **THEN** stat cards appear immediately without animation\r\n"},{"topic":"shared-layout","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: an inline SVG logomark (S-curve with diamond accents, 24x24) followed by the \"spek\" brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button with `aria-label=\"Open navigation menu\"` and hide the repo path. The header SHALL also include a theme toggle button. The logomark SVG SHALL use `currentColor` to follow the accent color, ensuring theme compatibility.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the SVG logomark alongside \"spek\" brand text, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button with `aria-label=\"Open navigation menu\"`, the SVG logomark alongside \"spek\" brand text, search button, and theme toggle, but hides the repo path\r\n\r\n#### Scenario: Logo theme compatibility\r\n- **WHEN** the user toggles between dark and light theme\r\n- **THEN** the logomark color adjusts automatically via the accent color CSS variable\r\n\r\n### Requirement: TaskProgress component\r\nThe system SHALL provide a reusable TaskProgress component that displays a progress bar with completed/total count. The progress bar color SHALL reflect completion status: amber/accent color when incomplete, green when all tasks are completed (completed equals total).\r\n\r\n#### Scenario: Display progress\r\n- **WHEN** TaskProgress is rendered with `completed=3` and `total=5`\r\n- **THEN** a progress bar at 60% width is shown in amber/accent color with text \"3 / 5\"\r\n\r\n#### Scenario: Display completed progress\r\n- **WHEN** TaskProgress is rendered with `completed=5` and `total=5`\r\n- **THEN** a progress bar at 100% width is shown in green color with text \"5 / 5\"\r\n\r\n#### Scenario: Zero tasks\r\n- **WHEN** TaskProgress is rendered with `total=0`\r\n- **THEN** component displays \"No tasks\" or an empty state\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Custom typography\r\nThe system SHALL use \"Plus Jakarta Sans\" as the primary font family for all UI text, loaded via Google Fonts CDN. The font stack SHALL include `sans-serif` as fallback for offline environments. Code and monospace text SHALL continue to use \"JetBrains Mono\".\r\n\r\n#### Scenario: Font loading\r\n- **WHEN** the application loads in a browser with internet access\r\n- **THEN** \"Plus Jakarta Sans\" is loaded and applied to all non-code text elements\r\n\r\n#### Scenario: Font fallback\r\n- **WHEN** the application loads without internet access (or Google Fonts is blocked)\r\n- **THEN** the browser falls back to the system default sans-serif font\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** the user has `prefers-reduced-motion: reduce` set in their OS/browser\r\n- **THEN** all CSS entry animations are disabled\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-15"}},"2026-02-15-add-frontend-design-skill":{"slug":"2026-02-15-add-frontend-design-skill","proposal":"## Why\r\n\r\nspek 專案需要一個專門的前端設計 skill，讓 Claude Code 在建立網頁元件、頁面或應用程式時，能產出具有高設計品質的前端介面，避免千篇一律的 AI 生成風格。此 skill 已以 `.agents/skills/frontend-design/` 的形式加入專案，需正式納入 OpenSpec 記錄。\r\n\r\n## What Changes\r\n\r\n- 新增 `.agents/skills/frontend-design/` 目錄，包含 `SKILL.md`（skill 定義與設計指引）和 `LICENSE.txt`\r\n- 新增 `.claude/skills/frontend-design` symlink 指向 `.agents/skills/frontend-design`，讓 Claude Code 自動偵測並載入\r\n- Skill 觸發條件：使用者要求建立網頁元件、頁面、landing page、dashboard、React components、HTML/CSS layouts 或美化 web UI 時\r\n- Skill 內容涵蓋設計思維流程、前端美學指引（typography、color、motion、spatial composition、backgrounds）、避免 generic AI 風格的規範\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n- `frontend-design-skill`: Claude Code skill 的結構定義與設計指引，涵蓋 skill 目錄結構、symlink 設定、觸發條件、美學規範\r\n\r\n### Modified Capabilities\r\n\r\n（無）\r\n\r\n## Impact\r\n\r\n- 新增檔案：`.agents/skills/frontend-design/SKILL.md`、`.agents/skills/frontend-design/LICENSE.txt`\r\n- 新增 symlink：`.claude/skills/frontend-design`\r\n- 不影響 spek 核心程式碼、API 或 build 流程\r\n","design":"## Context\r\n\r\nspek 專案新增 frontend-design skill，讓 Claude Code 在處理前端設計相關任務時自動載入設計指引。檔案已放置於 `.agents/skills/frontend-design/`，並透過 `.claude/skills/frontend-design` symlink 讓 Claude Code 偵測。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 將 frontend-design skill 檔案正式納入專案版本控制\r\n- 建立 `.agents/skills/` 作為存放 skill 的標準目錄\r\n- 透過 `.claude/skills/` symlink 機制讓 Claude Code 自動載入\r\n\r\n**Non-Goals:**\r\n- 不修改 spek 的核心程式碼或 UI\r\n- 不建立 skill 的自動化測試或 CI 整合\r\n- 不變更現有 build 流程\r\n\r\n## Decisions\r\n\r\n### 1. Skill 存放於 `.agents/skills/` 而非 `.claude/skills/`\r\n\r\n**選擇**：skill 原始檔放在 `.agents/skills/frontend-design/`，`.claude/skills/frontend-design` 為 symlink。\r\n\r\n**理由**：`.claude/` 是 Claude Code 的設定目錄，放置 symlink 即可。實際 skill 內容存放在 `.agents/` 下，語意更清晰——`.agents/` 存放 agent 相關資源，`.claude/` 只做引用。\r\n\r\n### 2. Skill 內容為純靜態文件\r\n\r\n**選擇**：skill 僅包含 `SKILL.md`（指引）和 `LICENSE.txt`（授權），無程式碼。\r\n\r\n**理由**：frontend-design skill 是 prompt-level 的設計指引，不需要執行任何程式碼，純文件即可。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[Symlink 跨平台]** → Windows 可能需要額外設定才能正確建立 symlink；目前 spek 主要在 Linux/macOS 開發，影響有限\r\n- **[Skill 未自動驗證]** → 沒有機制驗證 SKILL.md 格式是否正確；目前依賴 Claude Code 自身的 skill loading 機制\r\n","tasks":{"total":4,"completed":4,"sections":[{"title":"1. Skill 檔案設置","tasks":[{"text":"1.1 確認 `.agents/skills/frontend-design/SKILL.md` 和 `LICENSE.txt` 已存在且內容正確","completed":true},{"text":"1.2 確認 `.claude/skills/frontend-design` symlink 正確指向 `../../.agents/skills/frontend-design`","completed":true}]},{"title":"2. 文件更新","tasks":[{"text":"2.1 更新 CLAUDE.md — 在 Project Structure 加入 `.agents/` 和 `.claude/skills/` 的說明","completed":true},{"text":"2.2 建立 git commit 記錄此變更","completed":true}]}]},"specs":[{"topic":"frontend-design-skill","content":"## ADDED Requirements\r\n\r\n### Requirement: Skill 目錄結構\r\n\r\nfrontend-design skill SHALL 存放於 `.agents/skills/frontend-design/` 目錄下，包含 `SKILL.md` 和 `LICENSE.txt` 兩個檔案。\r\n\r\n#### Scenario: Skill 檔案存在\r\n\r\n- **WHEN** 檢查 `.agents/skills/frontend-design/` 目錄\r\n- **THEN** 目錄中 SHALL 包含 `SKILL.md` 和 `LICENSE.txt`\r\n\r\n### Requirement: Claude Code Skill 註冊\r\n\r\n`.claude/skills/frontend-design` SHALL 為一個 symlink，指向 `../../.agents/skills/frontend-design`，使 Claude Code 能自動偵測並載入此 skill。\r\n\r\n#### Scenario: Symlink 正確指向\r\n\r\n- **WHEN** Claude Code 掃描 `.claude/skills/` 目錄\r\n- **THEN** `frontend-design` symlink SHALL 解析至 `.agents/skills/frontend-design/`\r\n\r\n### Requirement: SKILL.md 包含設計指引\r\n\r\n`SKILL.md` SHALL 包含 frontmatter（name、description、license）以及設計指引內容，涵蓋 Design Thinking 流程和 Frontend Aesthetics Guidelines。\r\n\r\n#### Scenario: Skill 被觸發時提供指引\r\n\r\n- **WHEN** 使用者要求建立網頁元件、頁面、dashboard 或美化 web UI\r\n- **THEN** Claude Code SHALL 載入 SKILL.md 中的設計指引，引導產出高品質前端介面\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-15"}},"2026-02-15-add-readme-acknowledgments":{"slug":"2026-02-15-add-readme-acknowledgments","proposal":"## Why\r\n\r\nspek 的誕生源自龍哥（高見龍）介紹 SDD（Spec Driven Development）的系列文章，以及 Spectra 目前沒有 Linux 版本的現實需求。應在 README 中記載這段緣由，向啟發者致謝。\r\n\r\n## What Changes\r\n\r\n- 在 README.md 末尾（License 之前）新增 `## Acknowledgments` 段落\r\n- 內容包含：\r\n  - 說明專案靈感來源（龍哥的 SDD 文章）\r\n  - 附上兩篇文章連結\r\n  - 說明因 Spectra 無 Linux 版本而催生本專案\r\n- 同步更新 `README.zh-TW.md`（若存在對應位置）\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新功能）\r\n\r\n### Modified Capabilities\r\n\r\n（無規格變更，僅文件更新）\r\n\r\n## Impact\r\n\r\n- 僅影響 `README.md` 與 `README.zh-TW.md`\r\n- 無程式碼、API 或依賴變更\r\n","design":"## Context\r\n\r\nREADME.md 目前結構為：標題 → What is spek → Features → Screenshots → Quick Start → OpenSpec Directory Structure → Architecture → Development → License。需要在 License 前插入 Acknowledgments 段落。另有 README.zh-TW.md 需同步更新。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 在 README.md 新增 Acknowledgments 段落，致謝龍哥的 SDD 文章\r\n- 同步更新 README.zh-TW.md\r\n\r\n**Non-Goals:**\r\n- 不重構 README 的其他段落\r\n- 不新增其他文件\r\n\r\n## Decisions\r\n\r\n- **段落名稱使用 `Acknowledgments`**：GitHub 社群最廣泛採用的標準名稱\r\n- **放在 License 之前**：符合 GitHub README 慣例順序\r\n- **使用 bullet list + 超連結格式**：簡潔清楚，附上兩篇文章連結\r\n","tasks":{"total":2,"completed":2,"sections":[{"title":"1. README.md","tasks":[{"text":"1.1 在 `## License` 之前新增 `## Acknowledgments` 段落","completed":true}]},{"title":"2. README.zh-TW.md","tasks":[{"text":"2.1 在對應位置新增致謝段落（繁體中文版）","completed":true}]}]},"specs":[{"topic":"readme-acknowledgments","content":"## ADDED Requirements\r\n\r\n### Requirement: README Acknowledgments section\r\n\r\nREADME.md SHALL contain an `## Acknowledgments` section placed immediately before the `## License` section. The section SHALL credit the inspiration sources for the project.\r\n\r\n#### Scenario: Acknowledgments section exists in README.md\r\n- **WHEN** a user reads README.md\r\n- **THEN** an `## Acknowledgments` section appears before `## License`\r\n- **AND** it mentions 龍哥（高見龍）as the inspiration source\r\n- **AND** it links to `https://kaochenlong.com/sdd-spec-driven-development`\r\n- **AND** it links to `https://kaochenlong.com/spectra-with-openspec`\r\n- **AND** it mentions that spek was created because Spectra has no Linux version\r\n\r\n#### Scenario: README.zh-TW.md is in sync\r\n- **WHEN** a user reads README.zh-TW.md\r\n- **THEN** a corresponding acknowledgments section exists with the same content adapted to 繁體中文\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-14"}},"2026-02-15-add-demo-link-to-readme":{"slug":"2026-02-15-add-demo-link-to-readme","proposal":"## Why\r\n\r\n剛完成 demo page 並部署到 GitHub Pages，但 README 沒有提及 demo 連結，潛在使用者無法從 repo 首頁直接找到線上體驗入口。\r\n\r\n## What Changes\r\n\r\n- 在 `README.md` 加上 Live Demo 連結（`https://kewang.github.io/spek/demo.html`）\r\n- 在 `README.zh-TW.md` 加上對應的中文版 Demo 連結\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n（無——僅文件更新）\r\n\r\n### Modified Capabilities\r\n（無）\r\n\r\n## Impact\r\n\r\n- 僅影響 `README.md` 和 `README.zh-TW.md`，不涉及程式碼變更\r\n","design":"## Context\r\n\r\nREADME 是使用者接觸 spek 的第一個入口。demo 連結應放在最顯眼的位置，讓人一眼就能找到。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 在兩份 README 的簡介段落加上 demo 連結\r\n\r\n**Non-Goals:**\r\n- 不修改其他文件內容\r\n\r\n## Decisions\r\n\r\n### 連結位置：放在「提供兩種使用方式」之前\r\n\r\n在 \"What is spek?\" 段落的描述文字後、使用方式列表前插入一行 demo 連結。這是使用者閱讀動線中最早遇到的位置，且不打斷既有段落結構。\r\n","tasks":{"total":2,"completed":2,"sections":[{"title":"1. README Updates","tasks":[{"text":"1.1 在 `README.md` 的 \"Available in two forms\" 之前加上 Live Demo 連結","completed":true},{"text":"1.2 在 `README.zh-TW.md` 的「提供兩種使用方式」之前加上線上 Demo 連結","completed":true}]}]},"specs":[],"metadata":{"schema":"spec-driven","created":"2026-02-14"}},"2026-02-15-add-demo-page":{"slug":"2026-02-15-add-demo-page","proposal":"## Why\r\n\r\nspek 目前缺乏一個可以快速展示產品功能的方式。潛在使用者需要先安裝、設定並啟動服務才能看到效果。一個獨立的靜態 HTML demo 頁面，內嵌 spek 自身的 openspec/ 資料，讓任何人開啟瀏覽器就能直觀體驗 OpenSpec 內容檢視的效果。\r\n\r\n## What Changes\r\n\r\n- 新增一個 build script，將 spek 的 `openspec/` 目錄掃描結果序列化為 JSON，嵌入到一個自包含的靜態 HTML 檔案中\r\n- HTML 使用內嵌 CSS + JS，不依賴外部資源，單檔可直接用瀏覽器開啟\r\n- 展示 spek 的核心瀏覽體驗：specs 列表、spec 內容（含 BDD 語法高亮）、changes 列表、change 詳情（含 tasks 進度）\r\n- 視覺風格沿用 spek 深色主題（#0a0c0f 背景 + 琥珀色 accent）\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `demo-page`: 獨立靜態 HTML demo 頁面，內嵌 openspec 資料，展示 spek 的核心瀏覽功能\r\n\r\n### Modified Capabilities\r\n（無）\r\n\r\n## Impact\r\n\r\n- 新增 build script（`scripts/build-demo.ts` 或類似）用於產生 demo HTML\r\n- 新增 `demo/` 或 `docs/` 目錄存放產出的 HTML\r\n- 新增 npm script（如 `npm run build:demo`）\r\n- 不影響現有 web 版或 VS Code extension 功能\r\n- 可搭配 GitHub Pages 部署\r\n","design":"## Context\r\n\r\nspek 已有 ApiAdapter 抽象層（`FetchAdapter` 給 Web 版、`MessageAdapter` 給 VS Code Webview），以及 IIFE 單檔打包的 Webview 先例。要做 demo 頁面，只需新增第三個 adapter 實作 + 對應的 entry point 和 Vite config，完全複用現有 React 元件。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 產出單一 `docs/demo.html`，可在 GitHub Pages 直接瀏覽\r\n- UI / 功能與現有 Web 版完全一致（Dashboard、Specs、Changes、Search）\r\n- 複用所有現有 React 元件，不重寫\r\n\r\n**Non-Goals:**\r\n- 不需要 Repo 選擇頁（資料已內嵌，固定為 spek 自己的 openspec）\r\n- 不需要 resync / browse / detect 功能（靜態資料）\r\n\r\n## Decisions\r\n\r\n### 1. 新增 `StaticAdapter` 實作 `ApiAdapter`\r\n\r\n複用現有 adapter pattern，新增 `StaticAdapter`，從 build time 注入的全域 `window.__DEMO_DATA__` 讀取預先收集的 JSON 資料。所有方法直接 return Promise.resolve，不發 HTTP 也不 postMessage。search 用簡易字串比對實作。\r\n\r\n### 2. 新增 `DemoApp.tsx` + `main.demo.tsx` entry point\r\n\r\n仿照 `WebviewApp.tsx` 的結構，使用 `HashRouter`（`file://` 相容）+ `StaticAdapter`。路由與 Webview 版相同（跳過 SelectRepo）。\r\n\r\n### 3. 新增 `vite.demo.config.ts` — IIFE 打包\r\n\r\n仿照 `vite.webview.config.ts`，打包成 IIFE 格式，產出到暫存目錄。\r\n\r\n### 4. Build script 組裝最終 HTML\r\n\r\n`scripts/build-demo.ts`：\r\n1. 呼叫 `@spek/core` API 收集所有 openspec 資料\r\n2. 執行 `vite build --config vite.demo.config.ts`\r\n3. 讀取產出的 JS/CSS 檔案，inline 進單一 `docs/demo.html`\r\n\r\n### 5. 搜尋用簡易字串比對\r\n\r\n不引入 Fuse.js。`StaticAdapter.search()` 對所有 spec/change 的 markdown 內容做 case-insensitive includes 比對，回傳匹配段落作為 context。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **檔案大小**：React + 所有元件 + 嵌入資料，IIFE 單檔可能 ~300-500KB → 可接受，gzip 後會小很多\r\n- **資料即時性**：build time 快照 → 每次 release 前重新 `npm run build:demo`\r\n","tasks":{"total":8,"completed":8,"sections":[{"title":"1. StaticAdapter","tasks":[{"text":"1.1 Create `packages/web/src/api/StaticAdapter.ts` — 實作 `ApiAdapter`，從 `window.__DEMO_DATA__` 讀取資料，search 用字串比對","completed":true}]},{"title":"2. Demo Entry Point","tasks":[{"text":"2.1 Create `packages/web/src/DemoApp.tsx` — 仿 WebviewApp，使用 HashRouter + StaticAdapter","completed":true},{"text":"2.2 Create `packages/web/src/main.demo.tsx` — demo 進入點","completed":true},{"text":"2.3 Create `packages/web/index.demo.html` — demo HTML template","completed":true}]},{"title":"3. Vite Config","tasks":[{"text":"3.1 Create `packages/web/vite.demo.config.ts` — IIFE 打包，仿 vite.webview.config.ts","completed":true}]},{"title":"4. Build Script","tasks":[{"text":"4.1 Create `scripts/build-demo.ts` — 用 @spek/core 收集資料，執行 vite build，組裝 inline 單檔 HTML 到 `docs/demo.html`","completed":true},{"text":"4.2 在 root `package.json` 新增 `build:demo` script","completed":true}]},{"title":"5. Verification","tasks":[{"text":"5.1 執行 `npm run build:demo` 驗證產出正常，在瀏覽器開啟 `docs/demo.html` 確認功能完整","completed":true}]}]},"specs":[{"topic":"demo-page","content":"## ADDED Requirements\r\n\r\n### Requirement: StaticAdapter implements ApiAdapter\r\nThe system SHALL provide a `StaticAdapter` class that implements the `ApiAdapter` interface, reading all data from a pre-embedded JSON object (`window.__DEMO_DATA__`).\r\n\r\n#### Scenario: Serve pre-embedded data\r\n- **WHEN** any API method is called (getOverview, getSpecs, getSpec, getChanges, getChange)\r\n- **THEN** it returns the corresponding data from the embedded JSON via `Promise.resolve()`\r\n\r\n#### Scenario: Client-side search\r\n- **WHEN** `search(query)` is called\r\n- **THEN** it performs case-insensitive string matching across all spec and change content, returning matching results with context snippets\r\n\r\n#### Scenario: No-op for inapplicable methods\r\n- **WHEN** `browse()`, `detect()`, or `resync()` is called\r\n- **THEN** it returns sensible defaults without error (empty browse, `hasOpenSpec: true`, void)\r\n\r\n### Requirement: Demo entry point with HashRouter\r\nThe system SHALL provide a `DemoApp.tsx` entry point that uses `HashRouter` and `StaticAdapter`, with the same routes and components as the existing Webview app (Dashboard, Specs, Changes, Search).\r\n\r\n#### Scenario: Render demo app\r\n- **WHEN** user opens `demo.html`\r\n- **THEN** the app renders with Dashboard as the initial view, using all existing React components\r\n\r\n#### Scenario: Hash-based routing\r\n- **WHEN** user navigates between views\r\n- **THEN** the URL hash updates (e.g., `#/specs/api-adapter`) and the app works with `file://` protocol\r\n\r\n### Requirement: Build script generates self-contained demo.html\r\nThe system SHALL provide a build script that collects openspec data using `@spek/core`, runs Vite build, and assembles a single self-contained `docs/demo.html` with all JS, CSS, and data inlined.\r\n\r\n#### Scenario: Build demo\r\n- **WHEN** user runs `npm run build:demo`\r\n- **THEN** system generates `docs/demo.html` containing the complete React app with embedded openspec data\r\n\r\n#### Scenario: Self-contained output\r\n- **WHEN** `docs/demo.html` is generated\r\n- **THEN** the file has no external dependencies and can be opened directly in a browser or served via GitHub Pages\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-14"}},"2026-02-14-vscode-cicd-publish":{"slug":"2026-02-14-vscode-cicd-publish","proposal":"## Why\r\n\r\n目前發佈 VS Code extension 需要多步手動操作（build core → build webview → build extension → cd packages/vscode → vsce publish），無法從 repo root 一行完成，容易遺漏步驟或 build 順序錯誤。設定 CI/CD 讓 push tag 時自動完成整個 build + publish 流程。\r\n\r\n## What Changes\r\n\r\n- 新增 GitHub Actions workflow，於 push `v*` tag 時觸發\r\n- Workflow 自動執行完整 build chain（core → webview → extension）並發佈到 VS Code Marketplace\r\n- 需要在 GitHub repo 設定 `VSCE_PAT` secret（Personal Access Token）\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n- `vscode-cicd`: GitHub Actions workflow 定義，包含 tag 觸發條件、build 步驟、marketplace 發佈\r\n\r\n### Modified Capabilities\r\n\r\n（無既有 spec 需修改）\r\n\r\n## Impact\r\n\r\n- 新增 `.github/workflows/` 目錄及 workflow YAML 檔\r\n- 不影響現有程式碼或 runtime 行為\r\n- 需要 repo maintainer 在 GitHub Settings → Secrets 設定 `VSCE_PAT`\r\n","design":"## Context\r\n\r\n目前 VS Code extension 發佈需要手動在本機執行多步驟：build core → build webview → build extension → cd packages/vscode → vsce publish。這個流程容易遺漏步驟，且無法從 repo root 一行完成。專案目前沒有任何 GitHub Actions workflow。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- Push `v*` tag 時自動觸發 CI/CD pipeline\r\n- 自動完成完整 build chain 並發佈到 VS Code Marketplace\r\n- 支援手動觸發（workflow_dispatch）方便除錯\r\n\r\n**Non-Goals:**\r\n- 不處理 Web 版的 CI/CD（僅限 VS Code extension）\r\n- 不自動建立 GitHub Release\r\n- 不自動 bump version（version 由開發者手動更新 package.json 後 push tag）\r\n\r\n## Decisions\r\n\r\n### 1. Tag 命名採用 `v*` 格式\r\n\r\n**選擇**: 使用 `v*`（例如 `v0.2.0`）\r\n**原因**: 專案功能統一，Web 版與 VS Code extension 共用同一版號，不需要 prefix 區分。\r\n\r\n### 2. 使用 `VSCE_PAT` secret 認證\r\n\r\n**選擇**: Personal Access Token via GitHub Secret\r\n**原因**: 這是 `vsce publish` 的標準認證方式，簡單直接。替代方案如 Azure DevOps service connection 過於複雜。\r\n\r\n### 3. 單一 workflow 檔案，不拆分 build/publish jobs\r\n\r\n**選擇**: 單一 job 完成 build + publish\r\n**原因**: 步驟間有嚴格依賴關係（core → webview → extension → publish），拆分 jobs 需要 artifact 傳遞，增加複雜度但無實質好處。\r\n\r\n### 4. Node.js 版本策略\r\n\r\n**選擇**: 使用 Node.js 20（LTS）\r\n**原因**: 對齊本地開發環境，且 GitHub Actions runner 預裝此版本。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[PAT 過期]** → VSCE_PAT 過期時 publish 會失敗。Mitigation: 使用長效 token 並設 calendar reminder 更新。\r\n- **[Marketplace 發佈失敗]** → 網路問題或 Marketplace 暫時不可用。Mitigation: 可手動重新 trigger workflow。\r\n- **[Version 衝突]** → 忘記更新 version 就 push tag，Marketplace 會拒絕。Mitigation: Workflow 中加入 version check 步驟，從 tag 提取版號與 package.json 比對。\r\n","tasks":{"total":9,"completed":9,"sections":[{"title":"1. Workflow 建立","tasks":[{"text":"1.1 建立 `.github/workflows/vscode-publish.yml` workflow 檔案","completed":true},{"text":"1.2 設定觸發條件：push `v*` tag + workflow_dispatch","completed":true}]},{"title":"2. Build Chain","tasks":[{"text":"2.1 設定 Node.js 20 環境與 npm install","completed":true},{"text":"2.2 加入 build 步驟：build core → build webview → build extension","completed":true}]},{"title":"3. Version Check & Publish","tasks":[{"text":"3.1 加入 version consistency check（從 tag 提取版號與 package.json 比對）","completed":true},{"text":"3.2 加入 vsce publish 步驟，使用 `VSCE_PAT` secret","completed":true}]},{"title":"4. Version 同步","tasks":[{"text":"4.1 Root package.json 版號同步為 `0.2.0`","completed":true},{"text":"4.2 加入 `version` lifecycle script，`npm version` 時自動同步版號到 `packages/vscode/package.json` 並 stage","completed":true},{"text":"4.3 建立 `/release` skill 自動化發佈流程（CHANGELOG 更新 → npm version → push tag）","completed":true}]}]},"specs":[{"topic":"vscode-cicd","content":"## ADDED Requirements\r\n\r\n### Requirement: Tag-triggered publish workflow\r\n系統 SHALL 提供 GitHub Actions workflow，於 push 符合 `v*` pattern 的 tag 時自動觸發 VS Code extension 的 build 與 publish 流程。\r\n\r\n#### Scenario: Push version tag triggers workflow\r\n- **WHEN** 開發者 push 一個 `v0.2.0` 格式的 tag\r\n- **THEN** GitHub Actions workflow 自動觸發並執行完整 build chain\r\n\r\n#### Scenario: Non-matching tag does not trigger\r\n- **WHEN** 開發者 push 一個 `release-0.2.0` 或 `feat/something` 格式的 ref\r\n- **THEN** 此 workflow 不被觸發\r\n\r\n### Requirement: Full build chain execution\r\nWorkflow SHALL 依序執行完整 build chain：install dependencies → build @spek/core → build webview assets → build VS Code extension。\r\n\r\n#### Scenario: Build chain completes successfully\r\n- **WHEN** workflow 被觸發且所有 build 步驟成功\r\n- **THEN** `packages/vscode/dist/extension.js` 和 webview assets 皆存在且為最新\r\n\r\n#### Scenario: Build failure stops pipeline\r\n- **WHEN** 任一 build 步驟失敗\r\n- **THEN** 後續步驟不執行，workflow 標記為失敗\r\n\r\n### Requirement: Marketplace publish\r\nWorkflow SHALL 使用 `VSCE_PAT` secret 透過 `vsce publish` 將 extension 發佈到 VS Code Marketplace。\r\n\r\n#### Scenario: Successful publish\r\n- **WHEN** build chain 完成且 `VSCE_PAT` secret 有效\r\n- **THEN** extension 成功發佈到 VS Code Marketplace\r\n\r\n#### Scenario: Missing PAT secret\r\n- **WHEN** `VSCE_PAT` secret 未設定或已過期\r\n- **THEN** publish 步驟失敗，workflow 標記為失敗\r\n\r\n### Requirement: Manual trigger support\r\nWorkflow SHALL 支援 `workflow_dispatch` 手動觸發，方便除錯和測試。\r\n\r\n#### Scenario: Manual trigger from Actions UI\r\n- **WHEN** 開發者在 GitHub Actions UI 手動觸發此 workflow\r\n- **THEN** workflow 執行完整 build + publish 流程\r\n\r\n### Requirement: Version consistency check\r\nWorkflow SHALL 在 publish 前驗證 tag 版號與 `packages/vscode/package.json` 中的 version 欄位一致。\r\n\r\n#### Scenario: Version matches\r\n- **WHEN** tag `v0.2.0` 且 package.json version 為 `0.2.0`\r\n- **THEN** 繼續執行 publish\r\n\r\n#### Scenario: Version mismatch\r\n- **WHEN** tag `v0.3.0` 但 package.json version 為 `0.2.0`\r\n- **THEN** workflow 失敗並輸出版號不一致的錯誤訊息\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-14"}},"2026-02-14-add-changelog-entry":{"slug":"2026-02-14-add-changelog-entry","proposal":"## Why\r\n\r\nVS Code extension CHANGELOG 停留在 `0.1.0` 初始版本，但之後已新增 sidebar 收合/展開功能（來自使用者回饋）。使用者在 Marketplace 或 VS Code 的 extension 頁面看不到最新功能異動，不知道有新增什麼。需要更新 CHANGELOG 並 bump version 以反映新功能。\r\n\r\n## What Changes\r\n\r\n- 更新 `packages/vscode/CHANGELOG.md`，新增 `0.2.0` 版本紀錄，涵蓋 sidebar toggle 功能\r\n- Bump `packages/vscode/package.json` version 從 `0.1.0` 到 `0.2.0`\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新 capability，僅更新文件與版號）\r\n\r\n### Modified Capabilities\r\n\r\n- `vscode-marketplace-metadata`: 更新 version 欄位與 CHANGELOG 內容\r\n\r\n## Impact\r\n\r\n- `packages/vscode/CHANGELOG.md`：新增版本紀錄\r\n- `packages/vscode/package.json`：version bump\r\n- 不影響任何程式碼邏輯或 runtime 行為\r\n","design":"## Context\r\n\r\nVS Code extension 目前版本為 `0.1.0`，CHANGELOG 只記錄初始發佈。自 0.1.0 之後新增了 sidebar collapse/expand toggle 功能，需要記錄到 CHANGELOG 並 bump 版號。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 新增 `0.2.0` CHANGELOG entry，記錄 sidebar toggle 功能\r\n- Bump package.json version 到 `0.2.0`\r\n\r\n**Non-Goals:**\r\n- 不回溯補齊 0.1.0 以來的所有中間變更（README screenshots 等非功能性變更不需記錄在 extension CHANGELOG）\r\n- 不處理發佈流程（由 `vscode-cicd-publish` change 處理）\r\n\r\n## Decisions\r\n\r\n### 1. 版號策略\r\n\r\n**選擇**: `0.2.0`（minor bump）\r\n**原因**: 新增了使用者可見的功能（sidebar toggle），符合 semver minor 語意。\r\n\r\n### 2. CHANGELOG 格式\r\n\r\n**選擇**: 沿用現有格式（`## version` + bullet list）\r\n**原因**: 保持一致性，簡潔明瞭。\r\n\r\n## Risks / Trade-offs\r\n\r\n- 無顯著風險，純文件變更\r\n","tasks":{"total":5,"completed":5,"sections":[{"title":"1. Version Bump","tasks":[{"text":"1.1 更新 `packages/vscode/package.json` version 從 `0.1.0` 到 `0.2.0`","completed":true}]},{"title":"2. CHANGELOG 更新","tasks":[{"text":"2.1 在 `packages/vscode/CHANGELOG.md` 新增 `0.2.0` 版本區塊，記錄 sidebar collapse toggle 功能","completed":true},{"text":"2.2 建立 root `CHANGELOG.md`，涵蓋專案完整發佈歷程（0.1.0 初始版本 + 0.2.0 sidebar toggle）","completed":true},{"text":"2.3 對齊 `packages/vscode/CHANGELOG.md` 與 root `CHANGELOG.md` 內容一致","completed":true},{"text":"2.4 在 `CLAUDE.md` Conventions 加入 CHANGELOG 同步規範","completed":true}]}]},"specs":[{"topic":"vscode-marketplace-metadata","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Extension version and changelog\r\nExtension SHALL 維護 CHANGELOG.md 記錄每個版本的功能異動，且 package.json version 欄位 SHALL 與最新 CHANGELOG entry 一致。\r\n\r\n#### Scenario: Version bump with new feature\r\n- **WHEN** 新功能（sidebar toggle）已實作完成\r\n- **THEN** package.json version 更新為 `0.2.0`，CHANGELOG.md 包含 `0.2.0` 區塊描述新功能\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-14"}},"2026-02-14-add-sidebar-toggle":{"slug":"2026-02-14-add-sidebar-toggle","proposal":"## Why\r\n\r\n來自 VS Code Marketplace 使用者回饋（Joshua Reed, 5 星）：「This is a very simple but useful extension. It would be even better if a sidebar toggle could be added.」目前 web 版與 VS Code webview 中的 sidebar 導覽列在桌面裝置永遠顯示（240px 寬），無法收合，佔用內容閱讀空間。需要新增 sidebar toggle 功能讓使用者可以折疊 sidebar 以獲得更大的內容區域。\r\n\r\n## What Changes\r\n\r\n- 在 Layout 的 sidebar 區域新增收合/展開 toggle 按鈕\r\n- 收合狀態下 sidebar 縮為窄條（僅顯示導覽 icon），hover 或點擊 icon 可直接導覽\r\n- 展開狀態維持現有完整導覽列\r\n- 主內容區域隨 sidebar 狀態動態調整左邊距\r\n- Web 版將收合狀態記憶到 localStorage，下次開啟時保持上次狀態\r\n- VS Code webview 版同樣支援收合/展開，狀態隨 webview 生命週期\r\n- 共用同一套 Layout 元件邏輯，Web 與 Webview 行為一致\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n- `sidebar-toggle`: Sidebar 收合/展開功能，包含 toggle 按鈕、收合態 icon-only UI、狀態持久化、與主內容區域自適應佈局\r\n\r\n### Modified Capabilities\r\n\r\n- `shared-layout`: Layout 元件需支援 sidebar collapsed/expanded 狀態，調整主內容區域的左邊距與 sidebar 寬度\r\n\r\n## Impact\r\n\r\n- `packages/web/src/components/Layout.tsx`：新增 sidebar toggle 狀態管理與收合態樣式\r\n- `packages/web/src/components/Sidebar.tsx`：支援收合模式（icon-only 顯示）\r\n- 可能新增 sidebar toggle 相關的 icon 或 SVG 元件\r\n- 不影響後端、API、core module 或 VS Code extension host\r\n","design":"## Context\r\n\r\n目前 Layout 元件在桌面模式下固定渲染 240px 寬的 sidebar（`w-60`），主內容區域用 `ml-60` 左移。行動裝置則用 overlay 模式。使用者反饋希望能折疊 sidebar 以獲得更多閱讀空間。\r\n\r\n現有 Sidebar 元件已接受 `open`、`isMobile`、`onClose` props，桌面模式下不使用 `open` 狀態。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 桌面模式下可收合/展開 sidebar\r\n- 收合態顯示 icon-only 窄條，仍可導覽\r\n- 收合狀態持久化（Web 用 localStorage）\r\n- 動畫過渡流暢\r\n- 行動裝置行為不變\r\n\r\n**Non-Goals:**\r\n- 不做拖曳調整 sidebar 寬度\r\n- 不做 hover 自動展開（僅點擊 toggle）\r\n- 不改變行動版 overlay sidebar 行為\r\n\r\n## Decisions\r\n\r\n### 1. 收合態寬度與 icon 設計\r\n\r\n收合態 sidebar 寬度為 56px（`w-14`），僅顯示導覽項目的 icon。每個導覽連結需新增對應 icon：\r\n- Overview → LayoutDashboard icon（田字格）\r\n- Specs → FileText icon（文件）\r\n- Changes → GitBranch icon（分支）\r\n\r\n**理由**：56px 與 header 高度一致，視覺對齊；icon-only 模式保留導覽功能同時大幅節省空間。\r\n\r\n### 2. Toggle 按鈕位置\r\n\r\n在 sidebar 底部、Resync 按鈕上方放置 toggle 按鈕，使用左右箭頭 chevron icon 指示方向（展開時向左 `«`，收合時向右 `»`）。\r\n\r\n**理由**：底部位置不干擾導覽操作，chevron 方向直覺提示操作結果。\r\n\r\n### 3. 狀態管理\r\n\r\n- Layout 元件新增 `collapsed` state\r\n- Web 版透過 localStorage key `spek-sidebar-collapsed` 持久化\r\n- Webview 版不做持久化（隨 webview 生命週期）\r\n- 傳遞 `collapsed` 和 `onToggle` props 給 Sidebar 元件\r\n\r\n**理由**：狀態提升到 Layout 層級讓主內容區域能同步調整邊距。localStorage 與現有 theme 儲存方式一致。\r\n\r\n### 4. CSS 過渡動畫\r\n\r\n使用 `transition-all duration-200` 讓 sidebar 寬度和主內容區域邊距平滑過渡。\r\n\r\n**理由**：200ms 是常見的 UI 過渡時間，不會讓人感覺拖沓。\r\n\r\n## Risks / Trade-offs\r\n\r\n- [收合態 icon 辨識度] → 使用 tooltip（title 屬性）顯示完整名稱\r\n- [Resync 按鈕在收合態] → 收合態只顯示 resync icon，不顯示文字\r\n- [VS Code webview 空間較小] → 收合態在小 viewport 下更有用，不需特殊處理\r\n","tasks":{"total":12,"completed":12,"sections":[{"title":"1. Sidebar 元件改造","tasks":[{"text":"1.1 為 Sidebar 導覽連結新增 icon（Overview: LayoutDashboard, Specs: FileText, Changes: GitBranch），使用 inline SVG","completed":true},{"text":"1.2 新增 `collapsed` 和 `onToggle` props 到 Sidebar 元件","completed":true},{"text":"1.3 實作收合態 UI：56px 寬度、icon-only 導覽、icon-only Resync 按鈕、各項目加 title tooltip","completed":true},{"text":"1.4 實作 toggle 按鈕：位於 sidebar 底部 Resync 上方，展開時顯示 `«`、收合時顯示 `»`","completed":true},{"text":"1.5 加入 sidebar 寬度與內容的 CSS transition 動畫（200ms）","completed":true}]},{"title":"2. Layout 整合","tasks":[{"text":"2.1 在 Layout 元件新增 `collapsed` state，Web 版從 localStorage 讀取初始值","completed":true},{"text":"2.2 傳遞 `collapsed` 和 `onToggle` props 給 Sidebar","completed":true},{"text":"2.3 主內容區域左邊距隨 collapsed 狀態動態切換（`ml-60` ↔ `ml-14`）","completed":true},{"text":"2.4 確認行動裝置行為不受影響（overlay sidebar 維持不變）","completed":true}]},{"title":"3. 驗證與收尾","tasks":[{"text":"3.1 Web 版測試：收合/展開動畫、狀態持久化、頁面重新整理後恢復","completed":true},{"text":"3.2 VS Code webview 測試：收合/展開功能、預設展開狀態","completed":true},{"text":"3.3 確認 type-check 通過","completed":true}]}]},"specs":[{"topic":"shared-layout","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, and Changes. Each link SHALL have an associated icon (LayoutDashboard for Overview, FileText for Specs, GitBranch for Changes). The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL support two states: expanded (240px width, showing icons and labels) and collapsed (56px width, showing icons only). A toggle button at the bottom of the sidebar SHALL switch between states. The main content area left margin SHALL adjust to match the current sidebar width.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, and Changes with corresponding icons\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Dashboard page\r\n- **THEN** the \"Overview\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar expanded on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is expanded\r\n- **THEN** the sidebar is displayed at 240px width with icons and text labels, and main content has matching left margin\r\n\r\n#### Scenario: Sidebar collapsed on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is collapsed\r\n- **THEN** the sidebar is displayed at 56px width with icons only, and main content has matching left margin\r\n"},{"topic":"sidebar-toggle","content":"## ADDED Requirements\r\n\r\n### Requirement: Sidebar collapse toggle button\r\nThe system SHALL display a toggle button at the bottom of the sidebar (above the Resync button) that collapses or expands the sidebar. The button SHALL display a left-pointing chevron (`«`) when the sidebar is expanded and a right-pointing chevron (`»`) when collapsed.\r\n\r\n#### Scenario: Toggle sidebar from expanded to collapsed\r\n- **WHEN** the sidebar is expanded and the user clicks the toggle button\r\n- **THEN** the sidebar collapses to 56px width showing only navigation icons\r\n\r\n#### Scenario: Toggle sidebar from collapsed to expanded\r\n- **WHEN** the sidebar is collapsed and the user clicks the toggle button\r\n- **THEN** the sidebar expands to the full 240px width showing icons and labels\r\n\r\n### Requirement: Collapsed sidebar icon-only navigation\r\nThe system SHALL display navigation items as icon-only buttons when the sidebar is collapsed. Each navigation link SHALL display a corresponding icon: LayoutDashboard icon for Overview, FileText icon for Specs, and GitBranch icon for Changes. Each icon button SHALL include a `title` attribute showing the full link label.\r\n\r\n#### Scenario: Display collapsed navigation with icons\r\n- **WHEN** the sidebar is in collapsed state\r\n- **THEN** navigation items display as icon-only buttons with tooltips\r\n\r\n#### Scenario: Navigate from collapsed sidebar\r\n- **WHEN** the user clicks a navigation icon in collapsed state\r\n- **THEN** the app navigates to the corresponding route\r\n\r\n#### Scenario: Active route indication in collapsed state\r\n- **WHEN** the user is on the Specs page and sidebar is collapsed\r\n- **THEN** the Specs icon is highlighted with the accent color\r\n\r\n### Requirement: Collapsed sidebar Resync button\r\nThe system SHALL display the Resync button as icon-only in collapsed state, without the text label, and with a `title` attribute for tooltip.\r\n\r\n#### Scenario: Resync button in collapsed state\r\n- **WHEN** the sidebar is collapsed\r\n- **THEN** the Resync button displays only the sync icon with a tooltip\r\n\r\n### Requirement: Sidebar collapse state persistence\r\nThe system SHALL persist the sidebar collapse state to localStorage (key: `spek-sidebar-collapsed`) in the web version. On page load, the sidebar SHALL restore the previously saved state. In VS Code webview, the state SHALL default to expanded and not persist across sessions.\r\n\r\n#### Scenario: Persist collapsed state in web version\r\n- **WHEN** the user collapses the sidebar and refreshes the page\r\n- **THEN** the sidebar remains collapsed after reload\r\n\r\n#### Scenario: Default state in VS Code webview\r\n- **WHEN** the webview is first opened\r\n- **THEN** the sidebar is in expanded state\r\n\r\n### Requirement: Sidebar transition animation\r\nThe system SHALL animate the sidebar width change and main content margin with a smooth CSS transition (200ms duration).\r\n\r\n#### Scenario: Smooth collapse animation\r\n- **WHEN** the user clicks the toggle button\r\n- **THEN** the sidebar width and main content margin animate smoothly over 200ms\r\n\r\n### Requirement: Mobile behavior unchanged\r\nThe sidebar toggle feature SHALL only apply to desktop viewports (768px and above). On mobile viewports, the existing overlay sidebar behavior SHALL remain unchanged.\r\n\r\n#### Scenario: Mobile viewport ignores collapse state\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar uses the existing overlay behavior regardless of collapse state\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-14"}},"2026-02-14-add-readme-screenshots":{"slug":"2026-02-14-add-readme-screenshots","proposal":"## Why\r\n\r\nREADME.md 與 README.zh-TW.md 目前只有文字說明，缺乏視覺化的截圖展示。對於初次接觸 spek 的使用者，截圖能快速傳達產品的外觀與功能，大幅提升 README 的可讀性與吸引力。\r\n\r\n## What Changes\r\n\r\n- 新增 `screenshots/` 目錄，存放 6 張深色主題截圖（dashboard、specs-list、spec-detail、changes-list、change-detail、search）\r\n- 在 README.md 的 Features 與 Quick Start 之間新增 \"Screenshots\" 區塊，依序展示各頁面截圖\r\n- 在 README.zh-TW.md 的功能特色與快速開始之間新增「截圖」區塊，內容對應英文版\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增功能性 capability，本次僅為文件內容變更）\r\n\r\n### Modified Capabilities\r\n\r\n（無 spec 層級的行為變更）\r\n\r\n## Impact\r\n\r\n- **文件**：README.md、README.zh-TW.md 新增截圖區塊\r\n- **靜態資源**：新增 `screenshots/` 目錄，包含 6 張 PNG 截圖（總計約 900KB）\r\n- **程式碼**：無影響\r\n","design":"## Context\r\n\r\nREADME.md 與 README.zh-TW.md 目前僅有文字描述，缺乏產品截圖。需要截取應用程式各主要頁面的畫面，並嵌入 README 中，讓使用者在 GitHub 上就能預覽 spek 的介面。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 截取 6 張深色主題截圖，涵蓋所有主要頁面\r\n- 在兩個 README 中新增截圖區塊，位於 Features 與 Quick Start 之間\r\n- 截圖使用合理的 viewport 尺寸（1280x800）\r\n\r\n**Non-Goals:**\r\n- 不截取淺色主題的截圖\r\n- 不建立自動化截圖流程\r\n- 不修改任何程式碼\r\n\r\n## Decisions\r\n\r\n1. **截圖存放位置**：使用 `screenshots/` 目錄於專案根目錄，以相對路徑引用。GitHub README 可直接渲染相對路徑的圖片。\r\n2. **深色主題為主**：spek 預設為深色主題，截圖使用深色主題更能代表產品的視覺風格。\r\n3. **截圖內容**：涵蓋 6 個關鍵頁面 — Dashboard、Specs 列表、Spec 詳細（含 BDD 高亮）、Changes 列表、Change 詳細（含分頁）、搜尋功能。\r\n4. **README 插入位置**：放在 Features 與 Quick Start 之間，讓使用者先了解功能，再看到實際畫面，接著是如何開始使用。\r\n\r\n## Risks / Trade-offs\r\n\r\n- [截圖過時] → 當 UI 有重大變更時需手動重新截圖。目前不建立自動化，因為 UI 變更頻率低。\r\n- [圖片大小] → 6 張 PNG 總計約 900KB，對 git repo 影響可接受。\r\n","tasks":{"total":12,"completed":12,"sections":[{"title":"1. 截圖準備","tasks":[{"text":"1.1 建立 `screenshots/` 目錄於專案根目錄","completed":true},{"text":"1.2 啟動 dev server（`npm run dev`）","completed":true},{"text":"1.3 使用瀏覽器以 1280x800 viewport 開啟 http://localhost:5173","completed":true}]},{"title":"2. 截取頁面截圖（深色主題）","tasks":[{"text":"2.1 截取 Dashboard 總覽頁面 → `screenshots/dashboard.png`","completed":true},{"text":"2.2 截取 Specs 列表頁面 → `screenshots/specs-list.png`","completed":true},{"text":"2.3 截取 Spec 詳細頁面（含 BDD 語法高亮）→ `screenshots/spec-detail.png`","completed":true},{"text":"2.4 截取 Changes 列表頁面 → `screenshots/changes-list.png`","completed":true},{"text":"2.5 截取 Change 詳細頁面（含分頁 tabs）→ `screenshots/change-detail.png`","completed":true},{"text":"2.6 截取搜尋對話框（含搜尋結果）→ `screenshots/search.png`","completed":true}]},{"title":"3. 更新 README","tasks":[{"text":"3.1 在 README.md 的 Features 與 Quick Start 之間新增 \"Screenshots\" 區塊","completed":true},{"text":"3.2 在 README.zh-TW.md 的功能特色與快速開始之間新增「截圖」區塊","completed":true},{"text":"3.3 確認 GitHub 可正確渲染所有截圖的相對路徑","completed":true}]}]},"specs":[],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-push-to-github":{"slug":"2026-02-13-push-to-github","proposal":"## Why\r\n\r\n專案已經開發到可公開的狀態，但 repo 尚未 push 到 GitHub remote。同時 VS Code Extension 已發佈至 Marketplace，但 README 仍顯示手動 build `.vsix` 的安裝方式，需更新為 Marketplace 安裝連結。\r\n\r\n## What Changes\r\n\r\n- 設定 GitHub remote 並將 `master` 分支 push 到 `https://github.com/kewang/spek`\r\n- 更新 `README.md` 的 VS Code Extension 區塊：移除手動 build 指令，改為 Marketplace 安裝連結\r\n- 更新 `README.zh-TW.md` 的 VS Code Extension 區塊：同上\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新增 capability）\r\n\r\n### Modified Capabilities\r\n\r\n（無 spec 層級的需求變更，僅文件與 repo 配置調整）\r\n\r\n## Impact\r\n\r\n- **文件**：`README.md`、`README.zh-TW.md` 的安裝說明更新\r\n- **Git**：新增 remote origin，push `master` 分支\r\n- **程式碼**：無影響\r\n","design":"## Context\r\n\r\n專案目前只有本地 git repo，尚未設定 remote。VS Code Extension 已發佈至 Marketplace，但兩份 README（英文、繁中）的安裝說明仍為手動 build `.vsix` 流程。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 設定 GitHub remote 並 push `master` 分支\r\n- 更新 README.md 和 README.zh-TW.md 的 VS Code Extension 安裝說明為 Marketplace 連結\r\n\r\n**Non-Goals:**\r\n- 不重新命名分支（維持 `master`）\r\n- 不修改程式碼或功能\r\n- 不調整 CI/CD 或 GitHub Actions\r\n\r\n## Decisions\r\n\r\n### 1. 維持 `master` 分支名稱\r\n直接以 `master` push，不改為 `main`。這是使用者的明確要求。\r\n\r\n### 2. README VS Code Extension 區塊改寫方式\r\n- 移除手動 build + `.vsix` 安裝的 code block\r\n- 改為 Marketplace 安裝連結 + 一句說明\r\n- Extension URL: `https://marketplace.visualstudio.com/items?itemName=kewang.spek-vscode`\r\n- 保留 Commands 區塊（`spek: Open spek`、`spek: Search OpenSpec`）不變\r\n\r\n## Risks / Trade-offs\r\n\r\n- [README 手動 build 說明移除] → 開發者如需自行 build extension，可參考 Development 區塊的 build 指令，不另外保留\r\n","tasks":{"total":4,"completed":4,"sections":[{"title":"1. 更新 README","tasks":[{"text":"1.1 更新 README.md 的 VS Code Extension 區塊：移除手動 build 指令，改為 Marketplace 安裝連結","completed":true},{"text":"1.2 更新 README.zh-TW.md 的 VS Code Extension 區塊：同上","completed":true}]},{"title":"2. Push to GitHub","tasks":[{"text":"2.1 設定 GitHub remote origin (`https://github.com/kewang/spek`)","completed":true},{"text":"2.2 Push `master` 分支到 remote","completed":true}]}]},"specs":[],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-vscode-marketplace-publish":{"slug":"2026-02-13-vscode-marketplace-publish","proposal":"## Why\r\n\r\n目前 spek VS Code extension 只能透過手動打包 `.vsix` 安裝，使用門檻高且無法自動更新。發佈到 VS Code Marketplace 讓使用者能直接搜尋安裝，並享有版本更新通知。\r\n\r\n## What Changes\r\n\r\n- 移除 `package.json` 的 `\"private\": true` 限制\r\n- 新增 Marketplace 必要欄位：`repository`、`license`、`icon`、`homepage`、`bugs`\r\n- 建立 extension 專屬 `README.md`（Marketplace 頁面內容）\r\n- 建立 `CHANGELOG.md`\r\n- 產生 128x128 PNG icon（從現有 SVG logomark 轉換）\r\n- 更新 `.vscodeignore` 排除不需要的檔案\r\n- 補充 `categories`、`keywords` 提升 Marketplace 搜尋能見度\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n- `vscode-marketplace-metadata`: 定義 VS Code extension 發佈到 Marketplace 所需的 metadata 配置、檔案結構與發佈流程\r\n\r\n### Modified Capabilities\r\n\r\n（無既有 spec 的需求層級變更，此次僅新增發佈配置）\r\n\r\n## Impact\r\n\r\n- **packages/vscode/package.json**：新增多個 Marketplace 必要欄位\r\n- **packages/vscode/README.md**：新建，作為 Marketplace 頁面內容\r\n- **packages/vscode/CHANGELOG.md**：新建\r\n- **packages/vscode/.vscodeignore**：更新排除規則\r\n- **packages/vscode/icon.png**：新建（從 SVG 轉換）\r\n- **發佈流程**：需要 publisher 帳號與 Azure DevOps PAT\r\n","design":"## Context\r\n\r\nspek VS Code extension 目前以 `\"private\": true` 設定，只能手動打包 `.vsix` 安裝。要發佈到 VS Code Marketplace，需要補齊 metadata、建立 publisher 帳號、並準備 Marketplace 頁面所需的內容檔案（README、icon、CHANGELOG）。\r\n\r\n現有的 extension 打包流程已可運作（esbuild + vsce package），主要缺少的是發佈配置而非功能變更。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 讓 extension 可透過 `vsce publish` 發佈到 VS Code Marketplace\r\n- 提供完整的 Marketplace 頁面（說明、icon、changelog）\r\n- 維持現有打包流程相容\r\n\r\n**Non-Goals:**\r\n- 不建立 CI/CD 自動發佈流程（未來再做）\r\n- 不變更 extension 功能或行為\r\n- 不處理 pre-release / insider channel\r\n\r\n## Decisions\r\n\r\n### 1. Publisher ID 使用 `kewang`\r\n\r\n與 GitHub username 一致，方便辨識。使用者需在 marketplace.visualstudio.com/manage 手動建立此 publisher。\r\n\r\n### 2. Icon 使用 PNG 格式\r\n\r\nMarketplace 要求 128x128 以上的 PNG icon。從現有 `logo/logomark.svg` 轉換為 128x128 PNG，放在 `packages/vscode/icon.png`。\r\n\r\n考慮過的替代方案：直接用 SVG — 但 Marketplace 不支援 SVG icon。\r\n\r\n### 3. Extension README 獨立於 root README\r\n\r\nMarketplace 頁面顯示 extension 目錄下的 README.md，內容應聚焦在 VS Code 使用者的需求（安裝、功能、截圖指引），而非完整的開發文件。\r\n\r\n### 4. categories 與 keywords 選擇\r\n\r\n- categories: `[\"Other\"]` — OpenSpec 是自訂格式，無更精確的分類\r\n- keywords: `[\"openspec\", \"spec\", \"bdd\", \"documentation\", \"viewer\"]` — 最多 5 個，涵蓋搜尋意圖\r\n\r\n### 5. 手動發佈流程\r\n\r\n使用 `vsce login` + `vsce publish` 手動發佈。流程簡單且符合目前需求。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[風險] publisher 名稱被佔用** → 如果 `kewang` 已被佔用，需改用其他 ID 並同步更新 package.json\r\n- **[風險] icon 轉換品質** → SVG 轉 PNG 可能失真，需確認轉換後的效果\r\n- **[取捨] 無 CI/CD 自動發佈** → 每次發佈需手動執行，但避免了 GitHub Actions 設定與 secret 管理的複雜度\r\n","tasks":{"total":14,"completed":14,"sections":[{"title":"1. Icon 準備","tasks":[{"text":"1.1 將 `logo/logomark.svg` 轉換為 128x128 PNG，輸出到 `packages/vscode/icon.png`","completed":true}]},{"title":"2. package.json 更新","tasks":[{"text":"2.1 移除 `\"private\": true`","completed":true},{"text":"2.2 更新 `publisher` 為 `\"kewang\"`","completed":true},{"text":"2.3 新增 `\"repository\"` 欄位（指向 GitHub repo）","completed":true},{"text":"2.4 新增 `\"license\": \"MIT\"`","completed":true},{"text":"2.5 新增 `\"icon\": \"icon.png\"`","completed":true},{"text":"2.6 新增 `\"homepage\"` 與 `\"bugs\"` 欄位","completed":true},{"text":"2.7 更新 `\"categories\"` 為 `[\"Other\"]`","completed":true},{"text":"2.8 新增 `\"keywords\": [\"openspec\", \"spec\", \"bdd\", \"documentation\", \"viewer\"]`","completed":true}]},{"title":"3. Extension README","tasks":[{"text":"3.1 建立 `packages/vscode/README.md`，包含功能說明、安裝方式、使用方法","completed":true}]},{"title":"4. CHANGELOG","tasks":[{"text":"4.1 建立 `packages/vscode/CHANGELOG.md`，包含 v0.1.0 初始版本記錄","completed":true}]},{"title":"5. vscodeignore 更新","tasks":[{"text":"5.1 更新 `packages/vscode/.vscodeignore`，確保排除 src/、node_modules/ 等，保留 dist/、webview/、icon.png、README.md、CHANGELOG.md","completed":true}]},{"title":"6. 驗證打包","tasks":[{"text":"6.1 執行 `vsce package --no-dependencies` 確認打包成功無錯誤","completed":true},{"text":"6.2 檢查 `.vsix` 檔案大小與內容合理","completed":true}]}]},"specs":[{"topic":"vscode-marketplace-metadata","content":"## ADDED Requirements\r\n\r\n### Requirement: Marketplace-ready package.json\r\nExtension 的 `package.json` SHALL 包含所有 VS Code Marketplace 發佈所需的欄位。\r\n\r\n#### Scenario: Required fields present\r\n- **WHEN** 執行 `vsce package` 打包 extension\r\n- **THEN** package.json 包含以下欄位且無 validation 錯誤：`publisher`、`repository`、`license`、`icon`、`categories`、`keywords`\r\n\r\n#### Scenario: Private flag removed\r\n- **WHEN** package.json 被讀取\r\n- **THEN** `\"private\"` 欄位 SHALL 不存在或為 `false`\r\n\r\n#### Scenario: Icon file exists\r\n- **WHEN** package.json 指定 `\"icon\": \"icon.png\"`\r\n- **THEN** `packages/vscode/icon.png` 檔案存在且為 128x128 以上的 PNG 圖片\r\n\r\n### Requirement: Marketplace README\r\nExtension 目錄下 SHALL 有獨立的 `README.md` 作為 Marketplace 頁面內容。\r\n\r\n#### Scenario: README content\r\n- **WHEN** Marketplace 頁面載入\r\n- **THEN** 顯示 extension 的功能說明、安裝方式與使用說明\r\n\r\n#### Scenario: README exists in extension directory\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `packages/vscode/README.md` 被包含在 `.vsix` 中\r\n\r\n### Requirement: CHANGELOG\r\nExtension 目錄下 SHALL 有 `CHANGELOG.md` 記錄版本變更。\r\n\r\n#### Scenario: CHANGELOG content\r\n- **WHEN** 使用者在 Marketplace 或 VS Code 中檢視 extension 的 changelog\r\n- **THEN** 顯示按版本分組的變更記錄\r\n\r\n### Requirement: vscodeignore configuration\r\n`.vscodeignore` SHALL 排除不需要包含在 `.vsix` 中的檔案，減少套件大小。\r\n\r\n#### Scenario: Source files excluded\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `src/`、`node_modules/`、`tsconfig.json`、`.gitignore` 不被包含在 `.vsix` 中\r\n\r\n#### Scenario: Required files included\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `dist/`、`webview/`、`icon.png`、`README.md`、`CHANGELOG.md`、`LICENSE` 被包含在 `.vsix` 中\r\n\r\n### Requirement: Publish workflow\r\n使用者 SHALL 能透過 `vsce` CLI 將 extension 發佈到 Marketplace。\r\n\r\n#### Scenario: First-time publish\r\n- **WHEN** 使用者執行 `vsce login <publisher>` 並輸入有效的 PAT\r\n- **AND** 執行 `vsce publish`\r\n- **THEN** extension 成功發佈到 VS Code Marketplace\r\n\r\n#### Scenario: Version update publish\r\n- **WHEN** 使用者更新 package.json 版本號\r\n- **AND** 執行 `vsce publish`\r\n- **THEN** Marketplace 上的 extension 更新到新版本\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-add-readme":{"slug":"2026-02-13-add-readme","proposal":"## Why\r\n\r\n專案即將發佈到 GitHub，目前缺少 README 文件。沒有 README 的 repo 無法讓訪客快速了解專案用途、安裝方式和技術架構。\r\n\r\n## What Changes\r\n\r\n- 新增 `README.md`（英文版），包含專案介紹、功能特色、快速開始、架構說明、開發指令\r\n- 新增 `README.zh-TW.md`（繁體中文版），內容對應英文版，使用台灣用語\r\n- 兩份 README 互相連結，讀者可切換語言\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無 — 本次變更不涉及任何功能或行為變更，僅新增文件）\r\n\r\n### Modified Capabilities\r\n\r\n（無 — 不影響任何現有 spec）\r\n\r\n## Impact\r\n\r\n- 僅影響 repo 根目錄的文件檔案，不涉及程式碼、API、依賴或系統變更\r\n- GitHub repo 首頁將顯示 README.md 內容\r\n","design":"## Context\r\n\r\n專案即將發佈到 GitHub，需要 README 作為訪客的第一進入點。目前 repo 沒有 README 檔案，只有 `CLAUDE.md`（開發指引）和 `docs/prd.md`（產品需求文件），兩者都不適合作為公開的專案介紹。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 提供英文版 README.md 作為 GitHub 預設顯示\r\n- 提供繁體中文版 README.zh-TW.md 給台灣開發者\r\n- 涵蓋專案介紹、功能特色、快速開始、架構說明、開發指令\r\n\r\n**Non-Goals:**\r\n- 不撰寫 API 文件（已有 CLAUDE.md 涵蓋）\r\n- 不建立 GitHub Pages 或文件網站\r\n- 不新增截圖（可日後補充）\r\n\r\n## Decisions\r\n\r\n1. **雙語 README 以獨立檔案呈現**\r\n   - `README.md`（英文）+ `README.zh-TW.md`（繁中），頂部互相連結\r\n   - 替代方案：單一檔案雙語混排 → 排版混亂、不易維護\r\n   - 替代方案：只寫英文 → 專案以台灣開發者為主要受眾，需要中文版\r\n\r\n2. **引用 `logo/full-logo.svg` 作為頂部 Logo**\r\n   - SVG 格式在 GitHub 上直接渲染，不需額外處理\r\n   - 替代方案：使用 PNG → 需額外轉檔維護\r\n\r\n3. **README 內容結構**\r\n   - 參考 GitHub 上主流開源專案的 README 結構\r\n   - 包含：Logo → 一句話簡介 → 功能列表 → Quick Start → 架構 → 開發指令 → License\r\n\r\n## Risks / Trade-offs\r\n\r\n- SVG Logo 在某些 GitHub 客戶端可能不渲染 → 影響輕微，降級為純文字無礙閱讀\r\n- 中文版需與英文版同步維護 → 內容不多，維護成本低\r\n","tasks":{"total":6,"completed":6,"sections":[{"title":"1. README 英文版","tasks":[{"text":"1.1 建立 `README.md`，包含 Logo、專案簡介、功能特色、Quick Start（Web + VS Code Extension）、OpenSpec 目錄結構說明、架構（Monorepo + API Adapter + Tech Stack）、開發指令、License","completed":true},{"text":"1.2 確認 GitHub repo URL 為 `https://github.com/kewang/spek.git`","completed":true},{"text":"1.3 確認 OpenSpec 連結為 `https://github.com/Fission-AI/OpenSpec`","completed":true}]},{"title":"2. README 繁體中文版","tasks":[{"text":"2.1 建立 `README.zh-TW.md`，內容對應英文版，使用台灣用語","completed":true},{"text":"2.2 兩份 README 頂部互相加上語言切換連結","completed":true}]},{"title":"3. 驗證","tasks":[{"text":"3.1 確認兩份 README 的連結正確、結構完整","completed":true}]}]},"specs":[],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-apply-brand-logo":{"slug":"2026-02-13-apply-brand-logo","proposal":"## Why\r\n\r\nspek 目前僅使用純文字 \"S\" 作為 favicon，缺乏品牌識別度。已設計完成一套完整的 SVG logo 系統（logomark、full logo、favicon），需要套用到專案的 favicon 及 UI header 中，建立統一的品牌視覺。\r\n\r\n## What Changes\r\n\r\n- 替換所有 favicon.svg（web、vscode webview）為新設計的品牌 logo\r\n- 在 Layout header 中加入 SVG logomark，取代純文字 \"spek\"\r\n- 保留 `logo/` 目錄作為品牌素材來源\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無新 capability）\r\n\r\n### Modified Capabilities\r\n\r\n- `shared-layout`: Header component 的 brand 區域從純文字改為 SVG logomark + 文字組合\r\n\r\n## Impact\r\n\r\n- `packages/web/public/favicon.svg` — 替換為新 favicon\r\n- `packages/vscode/webview/favicon.svg` — 同步替換\r\n- `packages/web/src/components/Layout.tsx` — header brand 區域加入 SVG icon\r\n- 無 API 變更、無依賴變更\r\n","design":"## Context\r\n\r\nspek 目前使用純文字 \"S\" 作為 favicon（`<text>` 元素），header 中也僅顯示純文字 \"spek\"。已設計好一套 SVG logo 系統放在 `logo/` 目錄，包含 logomark、full logo、favicon，需要整合到專案中。\r\n\r\n現有 favicon 位置：\r\n- `packages/web/public/favicon.svg`（Web 版）\r\n- `packages/vscode/webview/favicon.svg`（VS Code Webview）\r\n- `public/favicon.svg`、`dist/favicon.svg`（舊檔案，可能未使用）\r\n\r\nHeader brand 區域在 `packages/web/src/components/Layout.tsx` 第 63 行：\r\n```tsx\r\n<span className=\"text-accent font-bold text-lg\">spek</span>\r\n```\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 將新設計的 favicon SVG 替換所有既有 favicon\r\n- 在 header brand 區域加入 inline SVG logomark（S 曲線 + 菱形光點）\r\n- 保持深色/淺色主題相容性\r\n\r\n**Non-Goals:**\r\n- 不修改 SelectRepo 頁面的大標題（那邊維持純文字即可）\r\n- 不新增 PNG/ICO 等其他格式\r\n- 不修改 VS Code extension 的 icon（那是 marketplace 用的，與 webview favicon 不同）\r\n\r\n## Decisions\r\n\r\n### 1. Favicon 直接使用 `logo/favicon.svg` 內容覆蓋\r\n\r\n直接將 `logo/favicon.svg` 的內容複製到各個 `favicon.svg` 位置，而非用 symlink 或 build step 引用。原因：webview 打包時需要實際檔案，symlink 在某些環境不可靠。\r\n\r\n### 2. Header logomark 使用 inline SVG 而非 `<img>`\r\n\r\n在 Layout.tsx 中直接內嵌 SVG 路徑（S 曲線 + 菱形），而非引用外部 SVG 檔案。原因：\r\n- 避免額外 HTTP 請求\r\n- 可直接使用 CSS 變數（`currentColor`）配合主題切換\r\n- Logo 很小（幾行 path），不會膨脹 bundle\r\n\r\n### 3. Header logo 使用 `currentColor` 搭配 accent 色\r\n\r\n不硬編碼 `#f59e0b`，而是使用 Tailwind 的 `text-accent` class 讓 SVG 的 `currentColor` 自動跟隨主題。這樣深色/淺色主題切換時 logo 顏色會自動調整。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[Risk]** Favicon 在某些瀏覽器快取後不更新 → 使用者清除快取即可，非阻塞問題\r\n- **[Trade-off]** Inline SVG vs 外部檔案：稍增 JSX 行數，但省去載入延遲和額外請求\r\n","tasks":{"total":5,"completed":5,"sections":[{"title":"1. Favicon 替換","tasks":[{"text":"1.1 將 `logo/favicon.svg` 內容複製到 `packages/web/public/favicon.svg`","completed":true},{"text":"1.2 將 `logo/favicon.svg` 內容複製到 `packages/vscode/webview/favicon.svg`","completed":true}]},{"title":"2. Header Logomark","tasks":[{"text":"2.1 在 `Layout.tsx` header 的 brand 區域加入 inline SVG logomark（S 曲線 + 菱形光點，使用 `currentColor`），放在 \"spek\" 文字左側","completed":true},{"text":"2.2 確認深色與淺色主題下 logo 顏色正確跟隨 accent 色","completed":true}]},{"title":"3. 清理","tasks":[{"text":"3.1 移除根目錄 `public/favicon.svg` 和 `dist/favicon.svg` 舊檔案（若為過時副本）","completed":true}]}]},"specs":[{"topic":"shared-layout","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: an inline SVG logomark (S-curve with diamond accents, 24x24) followed by the \"spek\" brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button and hide the repo path. The header SHALL also include a theme toggle button. The logomark SVG SHALL use `currentColor` to follow the accent color, ensuring theme compatibility.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the SVG logomark alongside \"spek\" brand text, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button, the SVG logomark alongside \"spek\" brand text, search button, and theme toggle, but hides the repo path\r\n\r\n#### Scenario: Logo theme compatibility\r\n- **WHEN** the user toggles between dark and light theme\r\n- **THEN** the logomark color adjusts automatically via the accent color CSS variable\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-vscode-extension":{"slug":"2026-02-13-vscode-extension","proposal":"## Why\r\n\r\nspek 目前是獨立的 Web 應用，使用者需要在終端執行 `npm run dev` 再開啟瀏覽器。對於日常在 VS Code 中工作的開發者而言，切換到瀏覽器查看 OpenSpec 內容會中斷工作流。將 spek 包裝為 VS Code Extension，讓使用者在編輯器內直接瀏覽 specs 和 changes，是最自然的整合方式。\r\n\r\n## What Changes\r\n\r\n- 新增 VS Code Extension，使用 Webview Panel 嵌入現有 React UI\r\n- 將 `server/lib/` 的核心邏輯（scanner、tasks parser）抽成獨立的 `packages/core/` 共用模組\r\n- 重構為 monorepo 結構（`packages/core`、`packages/web`、`packages/vscode`）\r\n- React 前端新增 API adapter 抽象層，支援 fetch（web）與 postMessage（vscode）兩種通訊模式\r\n- Extension 自動偵測 workspace 中的 `openspec/` 目錄，不需手動選路徑\r\n- 新增 VS Code commands（開啟 spek 面板、搜尋 OpenSpec 內容）\r\n- 現有 Web 版本維持不變，仍可獨立使用\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n- `vscode-extension-host`: Extension 生命週期管理（activate/deactivate）、Webview Panel 建立與通訊、VS Code commands 註冊\r\n- `webview-integration`: React SPA 在 VS Code Webview 中的載入、CSP 設定、資源路徑轉換、message-based API 通訊\r\n- `core-module`: 從 server/lib/ 抽出的共用核心邏輯模組（scanner、tasks parser、型別定義），可被 web server 和 extension host 共用\r\n- `api-adapter`: 前端 API 通訊抽象層，統一 fetch 與 postMessage 兩種模式的介面\r\n\r\n### Modified Capabilities\r\n\r\n- `openspec-scanner`: 核心掃描邏輯需從 Express route 解耦，移至 core module 成為純函式\r\n- `task-parser`: 核心解析邏輯需從 Express route 解耦，移至 core module 成為純函式\r\n\r\n## Impact\r\n\r\n- **專案結構**：從單一 package 重構為 monorepo（packages/core、packages/web、packages/vscode）\r\n- **依賴**：新增 `@types/vscode`、`@vscode/vsce`（打包工具）\r\n- **Build pipeline**：需要新增 extension bundling（esbuild/webpack）、Webview asset build\r\n- **現有 Web 版**：搬到 `packages/web/`，import 路徑從 `server/lib/` 改為 `@spek/core`，功能不變\r\n- **發布**：Web 版照舊 `npm run dev`；Extension 可透過 `vsce package` 打包為 `.vsix`\r\n","design":"## Context\r\n\r\nspek 目前是一個單體 Web 應用（Express + React SPA），使用者需要 `npm run dev` 啟動後在瀏覽器中操作。核心邏輯（OpenSpec 目錄掃描、tasks 解析）與 Express HTTP 層緊耦合在 `server/routes/` 中。\r\n\r\n目標是新增 VS Code Extension 版本，將 React UI 嵌入 Webview Panel，同時保持現有 Web 版本正常運作。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 將 spek 重構為 monorepo，抽出共用核心邏輯\r\n- 建立 VS Code Extension，使用 Webview Panel 呈現 React UI\r\n- Extension 自動偵測 workspace 的 openspec/ 目錄\r\n- 前端透過 API adapter 抽象層支援 fetch 和 postMessage 兩種通訊模式\r\n- 現有 Web 版本功能不變，仍可獨立使用\r\n\r\n**Non-Goals:**\r\n- 不做 VS Code TreeView 原生 sidebar（保持 React UI 一致性）\r\n- 不做 Extension marketplace 發布（先本地 .vsix 安裝）\r\n- 不做 VS Code 原生 Markdown preview 整合\r\n- 不做 multi-root workspace 支援（只取第一個 workspace folder）\r\n\r\n## Decisions\r\n\r\n### D1: Monorepo 結構 — npm workspaces\r\n\r\n使用 npm workspaces 管理三個 package：\r\n\r\n```\r\npackages/\r\n├── core/       # @spek/core — 純邏輯，無框架依賴\r\n├── web/        # @spek/web — 現有 Express + React 應用\r\n└── vscode/     # spek-vscode — VS Code Extension\r\n```\r\n\r\n**Why npm workspaces over turborepo/nx**: 專案規模小，不需要額外的 build orchestration 工具。npm workspaces 原生支援，零配置。\r\n\r\n### D2: Core module 設計 — 純函式 + 型別定義\r\n\r\n從 `server/lib/scanner.ts` 和 `server/lib/tasks.ts` 抽出核心邏輯，成為接受 `basePath: string` 參數的純函式。所有 TypeScript 型別定義也集中在 core。\r\n\r\n```typescript\r\n// packages/core/src/scanner.ts\r\nexport function scanOpenSpec(basePath: string): Promise<OpenSpecStructure>\r\nexport function readSpec(basePath: string, topic: string): Promise<SpecDetail>\r\nexport function readChange(basePath: string, slug: string): Promise<ChangeDetail>\r\nexport function searchContent(basePath: string, query: string): Promise<SearchResult[]>\r\n\r\n// packages/core/src/tasks.ts\r\nexport function parseTasks(content: string): ParsedTasks\r\n```\r\n\r\nCore 直接使用 Node.js `fs/promises`，不依賴 Express 或 VS Code API。Web server 和 Extension host 都直接呼叫這些函式。\r\n\r\n**Why 不用依賴注入 fs**: scanner 和 tasks parser 只需要讀取本地檔案，Node.js fs 在 Express 和 VS Code extension host 中都可用，不需要額外抽象。\r\n\r\n### D3: Webview 通訊 — postMessage + request/response 模式\r\n\r\nExtension host 和 Webview 之間使用 `postMessage` 通訊，模擬 HTTP request/response 模式：\r\n\r\n```typescript\r\n// Webview → Extension Host\r\n{ type: 'request', id: 'req-1', method: 'getOverview' }\r\n\r\n// Extension Host → Webview\r\n{ type: 'response', id: 'req-1', data: { specsCount: 5, ... } }\r\n```\r\n\r\n每個 request 帶唯一 id，response 回傳相同 id，前端用 Promise 包裝等待對應回覆。\r\n\r\n### D4: API Adapter — 策略模式\r\n\r\n前端新增 `ApiAdapter` 介面，hooks 透過 adapter 呼叫 API：\r\n\r\n```typescript\r\ninterface ApiAdapter {\r\n  getOverview(): Promise<OverviewData>;\r\n  getSpecs(): Promise<SpecInfo[]>;\r\n  getSpec(topic: string): Promise<SpecDetail>;\r\n  getChanges(): Promise<ChangesData>;\r\n  getChange(slug: string): Promise<ChangeDetail>;\r\n  search(query: string): Promise<SearchResult[]>;\r\n  browse(path: string): Promise<BrowseData>;\r\n  detect(path: string): Promise<DetectData>;\r\n}\r\n```\r\n\r\n- `FetchAdapter`: 呼叫 `fetch('/api/...')`，用於 Web 版\r\n- `MessageAdapter`: 透過 `postMessage` 傳送請求，用於 Webview 版\r\n\r\nAdapter 透過 React Context 注入，hooks 從 context 取得 adapter 實例。\r\n\r\n**Why 不用 service worker**: postMessage 更直接，service worker 在 Webview 中支援不穩定。\r\n\r\n### D5: Vite build for Webview — 單一 HTML bundle\r\n\r\nWebview 需要載入的 assets 路徑必須透過 `webview.asWebviewUri()` 轉換。Vite build 設定：\r\n\r\n- 產出單一 `index.html` + JS/CSS 各一檔\r\n- Extension 啟動時讀取 build output 的 HTML，替換 asset 路徑為 webview URI\r\n- Tailwind CSS 透過 build 產出，不需 inline style（避免 CSP 問題）\r\n\r\n### D6: Extension 生命週期\r\n\r\n- `activate`: 掃描 workspace folders 尋找 openspec/ 目錄，若找到則在 status bar 顯示 icon\r\n- Command `spek.open`: 建立或聚焦 Webview Panel\r\n- Command `spek.search`: 開啟 Webview 並觸發搜尋對話框\r\n- `deactivate`: 清理 Webview Panel\r\n\r\n### D7: Repo 路徑處理\r\n\r\n- VS Code Extension：自動使用 `vscode.workspace.workspaceFolders[0]`，不需要 SelectRepo 頁面和 filesystem API\r\n- Web 版：維持現有的 SelectRepo 頁面 + filesystem API 行為\r\n- React 端透過 `RepoContext` 初始值區分：Webview 版在 mount 時就注入 workspace path\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[Webview CSP 限制]** → 使用 nonce-based CSP，Vite build 時避免 inline script/style。Tailwind v4 需確認 build output 不含 inline style。\r\n- **[Monorepo 遷移破壞現有功能]** → 分階段進行：先抽 core，確認 web 版正常後再建 extension。\r\n- **[Webview 冷啟動效能]** → React bundle 需要在 Webview 中載入。可考慮 lazy loading 非首頁 route，但初始版本先不優化。\r\n- **[VS Code API 版本相容性]** → 設定 `engines.vscode` 為 `^1.85.0`（2024 年初版本），Webview API 穩定。\r\n- **[npm workspaces 路徑解析]** → 開發時需確認 TypeScript path resolution 和 Vite alias 正確指向 core package。\r\n","tasks":{"total":32,"completed":32,"sections":[{"title":"1. Monorepo 結構建立","tasks":[{"text":"1.1 初始化 npm workspaces：在根目錄 package.json 加入 `workspaces` 設定，建立 `packages/core`、`packages/web`、`packages/vscode` 目錄","completed":true},{"text":"1.2 建立 `packages/core/package.json`（名稱 `@spek/core`），設定 TypeScript 編譯配置","completed":true},{"text":"1.3 搬移現有 `server/` 和 `src/` 到 `packages/web/`，更新 import 路徑和 build 設定","completed":true},{"text":"1.4 驗證 `packages/web` 的 `npm run dev` 仍可正常啟動","completed":true}]},{"title":"2. Core Module 抽取","tasks":[{"text":"2.1 將 `server/lib/scanner.ts` 的核心邏輯搬到 `packages/core/src/scanner.ts`，移除 Express 依賴，改為接受 `basePath` 參數的純函式","completed":true},{"text":"2.2 將 `server/lib/tasks.ts` 搬到 `packages/core/src/tasks.ts`，確保只接受 content string 參數","completed":true},{"text":"2.3 在 `packages/core/src/types.ts` 集中定義所有共用型別（OverviewData、SpecInfo、ChangeInfo 等）","completed":true},{"text":"2.4 建立 `packages/core/src/index.ts` 匯出所有公開 API","completed":true},{"text":"2.5 更新 `packages/web/server/routes/` 改為 import `@spek/core` 的函式","completed":true}]},{"title":"3. API Adapter 抽象層","tasks":[{"text":"3.1 在 `packages/web/src/` 建立 `ApiAdapter` 介面定義（getOverview、getSpecs、getSpec、getChanges、getChange、search、browse、detect）","completed":true},{"text":"3.2 實作 `FetchAdapter`：將現有 `useOpenSpec.ts` 的 fetch 邏輯抽為 adapter 方法","completed":true},{"text":"3.3 實作 `MessageAdapter`：透過 `postMessage` 發送請求，用 Promise + unique id 等待回應","completed":true},{"text":"3.4 建立 `ApiAdapterContext` 和 `ApiAdapterProvider`，透過 React Context 注入 adapter","completed":true},{"text":"3.5 重構 `useOpenSpec.ts` 的 hooks 改為從 context 取得 adapter 呼叫 API","completed":true},{"text":"3.6 在 web 版的 `main.tsx` 用 `FetchAdapter` 包裝 app","completed":true}]},{"title":"4. VS Code Extension 骨架","tasks":[{"text":"4.1 建立 `packages/vscode/package.json`，設定 `engines.vscode`、`activationEvents`、`contributes.commands`","completed":true},{"text":"4.2 設定 extension bundling（esbuild config），產出單一 extension.js","completed":true},{"text":"4.3 實作 `extension.ts`：activate 函式註冊 commands、掃描 workspace 偵測 openspec/、建立 status bar item","completed":true},{"text":"4.4 實作 `deactivate` 函式清理 Webview Panel 和 listeners","completed":true}]},{"title":"5. Webview Panel 整合","tasks":[{"text":"5.1 實作 Webview HTML 產生器：讀取 web build output，替換 asset 路徑為 `webview.asWebviewUri()`，注入 CSP meta tag with nonce","completed":true},{"text":"5.2 設定 Vite build 配置產出適合 Webview 載入的 bundle（固定檔名、相對路徑）","completed":true},{"text":"5.3 實作 message handler：接收 Webview 的 API requests，呼叫 `@spek/core` 函式，回傳 response","completed":true},{"text":"5.4 實作 ready handshake：收到 Webview 的 `ready` 訊息後發送 `init` 訊息含 workspace path","completed":true},{"text":"5.5 實作 theme 同步：監聯 VS Code theme 變更事件，發送 theme 訊息到 Webview","completed":true}]},{"title":"6. Webview 前端適配","tasks":[{"text":"6.1 建立 Webview 專用 entry point，使用 `MessageAdapter` 初始化 app","completed":true},{"text":"6.2 處理 `init` 訊息：收到 workspace path 後自動設定 RepoContext 並跳轉到 Dashboard","completed":true},{"text":"6.3 處理 theme 訊息：根據 VS Code theme 切換 spek 的深色/淺色主題","completed":true},{"text":"6.4 隱藏 web 版專有的 UI 元素（SelectRepo 頁面、repo 路徑輸入框）","completed":true}]},{"title":"7. Build 與打包","tasks":[{"text":"7.1 在根目錄 package.json 新增 scripts：`build:core`、`build:web`、`build:vscode`、`build:all`","completed":true},{"text":"7.2 設定 `packages/vscode` 的 build pipeline：先 build core → build web (webview assets) → bundle extension","completed":true},{"text":"7.3 驗證 `vsce package` 可成功產出 `.vsix` 檔案","completed":true},{"text":"7.4 驗證 `.vsix` 安裝到 VS Code 後可正常使用（開啟 panel、瀏覽 specs/changes、搜尋）","completed":true}]}]},"specs":[{"topic":"api-adapter","content":"## ADDED Requirements\r\n\r\n### Requirement: ApiAdapter interface\r\nThe frontend SHALL define an `ApiAdapter` interface that abstracts all API communication, allowing different implementations for web and VS Code environments.\r\n\r\n#### Scenario: Adapter interface contract\r\n- **WHEN** a component needs to fetch OpenSpec data\r\n- **THEN** it calls methods on the `ApiAdapter` interface (e.g., `getOverview()`, `getSpecs()`, `getChange(slug)`) which return Promises of typed data\r\n\r\n### Requirement: FetchAdapter for web\r\nThe web version SHALL use a `FetchAdapter` that calls the Express REST API via HTTP fetch.\r\n\r\n#### Scenario: Fetch adapter API call\r\n- **WHEN** `FetchAdapter.getOverview()` is called with repoPath set\r\n- **THEN** it performs `fetch('/api/openspec/overview?dir=...')` and returns the parsed JSON response\r\n\r\n#### Scenario: Fetch adapter error handling\r\n- **WHEN** a fetch request returns a non-OK HTTP status\r\n- **THEN** the adapter throws an error with the HTTP status code\r\n\r\n### Requirement: MessageAdapter for VS Code Webview\r\nThe VS Code version SHALL use a `MessageAdapter` that communicates with the extension host via `postMessage`.\r\n\r\n#### Scenario: Message adapter API call\r\n- **WHEN** `MessageAdapter.getOverview()` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getOverview' }` via `postMessage` and returns a Promise that resolves when the matching response arrives\r\n\r\n#### Scenario: Message adapter timeout\r\n- **WHEN** a message request does not receive a response within 10 seconds\r\n- **THEN** the adapter rejects the Promise with a timeout error\r\n\r\n#### Scenario: Message adapter error response\r\n- **WHEN** the extension host responds with `{ type: 'response', id, error: '...' }`\r\n- **THEN** the adapter rejects the Promise with the error message\r\n\r\n### Requirement: Adapter injection via React Context\r\nThe adapter SHALL be provided to the React component tree via a Context provider, allowing hooks to use the appropriate adapter without knowing the environment.\r\n\r\n#### Scenario: Web app initialization\r\n- **WHEN** the web app mounts\r\n- **THEN** it wraps the component tree with an `ApiAdapterProvider` using `FetchAdapter`\r\n\r\n#### Scenario: Webview app initialization\r\n- **WHEN** the React app mounts inside a VS Code Webview\r\n- **THEN** it wraps the component tree with an `ApiAdapterProvider` using `MessageAdapter`\r\n\r\n#### Scenario: Hook usage\r\n- **WHEN** a hook like `useOverview()` needs to fetch data\r\n- **THEN** it obtains the adapter from `useApiAdapter()` context and calls `adapter.getOverview()`\r\n"},{"topic":"core-module","content":"## ADDED Requirements\r\n\r\n### Requirement: Standalone core package\r\nThe core module SHALL be an independent npm package (`@spek/core`) with no framework dependencies, usable by both the web server and the VS Code extension host.\r\n\r\n#### Scenario: Import from web server\r\n- **WHEN** the Express server imports `@spek/core`\r\n- **THEN** it can call scanner and task parser functions directly without additional adapters\r\n\r\n#### Scenario: Import from extension host\r\n- **WHEN** the VS Code extension host imports `@spek/core`\r\n- **THEN** it can call scanner and task parser functions directly without additional adapters\r\n\r\n### Requirement: Scanner functions\r\nThe core module SHALL export scanner functions that accept a base path and return structured OpenSpec data.\r\n\r\n#### Scenario: Scan overview\r\n- **WHEN** `scanOverview(basePath)` is called with a valid repo path\r\n- **THEN** it returns `{ specsCount, changesCount: { active, archived }, taskStats: { total, completed } }`\r\n\r\n#### Scenario: List specs\r\n- **WHEN** `listSpecs(basePath)` is called\r\n- **THEN** it returns an array of `{ topic, path }` for each spec directory\r\n\r\n#### Scenario: Read single spec\r\n- **WHEN** `readSpec(basePath, topic)` is called with an existing topic\r\n- **THEN** it returns `{ topic, content, relatedChanges, history }`\r\n\r\n#### Scenario: List changes\r\n- **WHEN** `listChanges(basePath)` is called\r\n- **THEN** it returns `{ active: ChangeInfo[], archived: ChangeInfo[] }`\r\n\r\n#### Scenario: Read single change\r\n- **WHEN** `readChange(basePath, slug)` is called with an existing change slug\r\n- **THEN** it returns `{ slug, proposal, design, tasks, specs, metadata }`\r\n\r\n#### Scenario: Search content\r\n- **WHEN** `searchContent(basePath, query)` is called\r\n- **THEN** it returns matching results across specs and changes with context snippets\r\n\r\n### Requirement: Task parser functions\r\nThe core module SHALL export task parsing functions that operate on raw Markdown content strings.\r\n\r\n#### Scenario: Parse tasks from content\r\n- **WHEN** `parseTasks(content)` is called with Markdown containing `- [x]` and `- [ ]` checkboxes\r\n- **THEN** it returns `{ total, completed, sections }` with tasks grouped by `##` headings\r\n\r\n### Requirement: Shared type definitions\r\nThe core module SHALL export all TypeScript type definitions used by both the web app and the extension.\r\n\r\n#### Scenario: Type imports\r\n- **WHEN** the web app or extension imports types from `@spek/core`\r\n- **THEN** types such as `OverviewData`, `SpecInfo`, `SpecDetail`, `ChangeInfo`, `ChangeDetail`, `ParsedTasks`, `SearchResult` are available\r\n"},{"topic":"openspec-scanner","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL be a pure function in the `@spek/core` package that reads an OpenSpec directory and returns its complete structure including specs, active changes, and archived changes. It SHALL use Node.js `fs/promises` directly and have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n### Requirement: Parse change artifacts\r\nThe scanner SHALL read individual change directories and extract available artifacts.\r\n\r\n#### Scenario: Change with all artifacts\r\n- **WHEN** scanner reads a change directory containing proposal.md, design.md, tasks.md, and specs/\r\n- **THEN** it returns the raw Markdown content for each artifact and a list of delta spec files\r\n\r\n#### Scenario: Change with partial artifacts\r\n- **WHEN** scanner reads a change directory containing only proposal.md\r\n- **THEN** it returns proposal content and null for missing artifacts\r\n\r\n### Requirement: Read spec content\r\nThe scanner SHALL read spec files and return their Markdown content.\r\n\r\n#### Scenario: Read existing spec\r\n- **WHEN** scanner reads `openspec/specs/{topic}/spec.md`\r\n- **THEN** it returns the raw Markdown content of the spec file\r\n\r\n### Requirement: Detect related changes for a spec\r\nThe scanner SHALL identify which changes contain delta specs for a given spec topic.\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** scanner checks for changes related to spec topic \"simulation-engine\"\r\n- **THEN** it returns all change slugs that have a `specs/simulation-engine/spec.md` delta file\r\n"},{"topic":"task-parser","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Parse task checkboxes\r\nThe task parser SHALL be a pure function in the `@spek/core` package that reads a tasks.md content string and extracts checkbox items with their completion status. It SHALL have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Parse file with mixed checkboxes\r\n- **WHEN** parser receives a string containing `- [x] Done task` and `- [ ] Pending task`\r\n- **THEN** it returns each task with `text` and `completed` (boolean) fields\r\n\r\n### Requirement: Group tasks by section\r\nThe task parser SHALL group tasks under their `##` heading sections.\r\n\r\n#### Scenario: Tasks under multiple sections\r\n- **WHEN** parser receives a string with `## Phase 1` followed by tasks and `## Phase 2` followed by tasks\r\n- **THEN** it returns sections array, each with `title` and `tasks` array\r\n\r\n#### Scenario: Tasks without section headings\r\n- **WHEN** parser receives a string where tasks appear before any `##` heading\r\n- **THEN** those tasks are grouped under a default section with empty title\r\n\r\n### Requirement: Calculate task statistics\r\nThe task parser SHALL compute aggregate statistics from parsed tasks.\r\n\r\n#### Scenario: Calculate completion stats\r\n- **WHEN** parser processes a string with 10 total checkboxes where 7 are checked\r\n- **THEN** it returns `{ total: 10, completed: 7 }` along with the sections breakdown\r\n\r\n#### Scenario: Empty tasks file\r\n- **WHEN** parser processes an empty string or one with no checkboxes\r\n- **THEN** it returns `{ total: 0, completed: 0, sections: [] }`\r\n"},{"topic":"vscode-extension-host","content":"## ADDED Requirements\r\n\r\n### Requirement: Extension activation\r\nThe extension SHALL activate when a workspace containing an `openspec/` directory is opened, or when the user explicitly invokes a spek command.\r\n\r\n#### Scenario: Workspace with openspec directory\r\n- **WHEN** VS Code opens a workspace where the first workspace folder contains an `openspec/` directory\r\n- **THEN** the extension activates and displays a spek icon in the status bar\r\n\r\n#### Scenario: Workspace without openspec directory\r\n- **WHEN** VS Code opens a workspace without an `openspec/` directory\r\n- **THEN** the extension remains inactive and no status bar icon is shown\r\n\r\n#### Scenario: Manual activation via command\r\n- **WHEN** the user invokes the `spek.open` command from the command palette\r\n- **THEN** the extension activates and opens the spek Webview Panel\r\n\r\n### Requirement: Webview Panel lifecycle\r\nThe extension SHALL manage a single Webview Panel instance for displaying the spek UI.\r\n\r\n#### Scenario: Open spek panel\r\n- **WHEN** the user invokes `spek.open` and no panel exists\r\n- **THEN** the extension creates a new Webview Panel in the active editor column with the title \"spek\"\r\n\r\n#### Scenario: Focus existing panel\r\n- **WHEN** the user invokes `spek.open` and a panel already exists\r\n- **THEN** the extension reveals (focuses) the existing panel instead of creating a new one\r\n\r\n#### Scenario: Panel disposal\r\n- **WHEN** the user closes the spek Webview Panel\r\n- **THEN** the extension cleans up the panel reference and associated message listeners\r\n\r\n### Requirement: Command registration\r\nThe extension SHALL register commands in the VS Code command palette.\r\n\r\n#### Scenario: Available commands\r\n- **WHEN** the extension is active\r\n- **THEN** the following commands are available: `spek.open` (Open spek) and `spek.search` (Search OpenSpec)\r\n\r\n#### Scenario: Search command\r\n- **WHEN** the user invokes `spek.search`\r\n- **THEN** the extension opens (or focuses) the spek panel and sends a message to trigger the search dialog\r\n\r\n### Requirement: Message handler for API requests\r\nThe extension host SHALL handle message-based API requests from the Webview and return responses using core module functions.\r\n\r\n#### Scenario: Handle API request\r\n- **WHEN** the Webview sends a message `{ type: 'request', id: 'req-1', method: 'getOverview' }`\r\n- **THEN** the extension host calls the corresponding core module function and replies with `{ type: 'response', id: 'req-1', data: <result> }`\r\n\r\n#### Scenario: Handle API error\r\n- **WHEN** the Webview sends a request and the core module function throws an error\r\n- **THEN** the extension host replies with `{ type: 'response', id: 'req-1', error: <error message> }`\r\n"},{"topic":"webview-integration","content":"## ADDED Requirements\r\n\r\n### Requirement: Load React SPA in Webview\r\nThe Webview SHALL load the spek React application from the extension's bundled assets.\r\n\r\n#### Scenario: Webview HTML generation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** it generates an HTML document that loads the built React bundle with asset paths converted via `webview.asWebviewUri()`\r\n\r\n#### Scenario: Asset path resolution\r\n- **WHEN** the Webview HTML references JS or CSS files\r\n- **THEN** all asset paths SHALL use `webview.asWebviewUri()` to convert local file paths to Webview-safe URIs\r\n\r\n### Requirement: Content Security Policy\r\nThe Webview SHALL enforce a Content Security Policy that allows the React application to function while preventing unauthorized content.\r\n\r\n#### Scenario: CSP configuration\r\n- **WHEN** the Webview HTML is generated\r\n- **THEN** it includes a CSP meta tag that allows scripts and styles from the extension's webview URI origin with a unique nonce, and disallows inline scripts without the nonce\r\n\r\n#### Scenario: Tailwind CSS compatibility\r\n- **WHEN** Tailwind CSS styles are loaded in the Webview\r\n- **THEN** all styles SHALL be loaded from external CSS files (not inline style tags) to comply with CSP\r\n\r\n### Requirement: Workspace path injection\r\nThe Webview SHALL receive the workspace path from the extension host so the React app can skip the repo selection page.\r\n\r\n#### Scenario: Initial workspace path\r\n- **WHEN** the Webview is created in a workspace with an `openspec/` directory\r\n- **THEN** the extension host sends a `{ type: 'init', workspacePath: '/path/to/repo' }` message after the Webview is ready\r\n\r\n#### Scenario: Webview ready handshake\r\n- **WHEN** the React app finishes mounting in the Webview\r\n- **THEN** it sends a `{ type: 'ready' }` message to the extension host to signal it can receive the workspace path\r\n\r\n### Requirement: Theme synchronization\r\nThe Webview SHALL respect the VS Code color theme.\r\n\r\n#### Scenario: Dark theme active\r\n- **WHEN** VS Code is using a dark color theme\r\n- **THEN** the Webview renders the spek dark theme\r\n\r\n#### Scenario: Light theme active\r\n- **WHEN** VS Code is using a light color theme\r\n- **THEN** the Webview renders the spek light theme\r\n\r\n#### Scenario: Theme change\r\n- **WHEN** the user changes the VS Code color theme while the Webview is open\r\n- **THEN** the Webview updates its theme to match\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-spec-history-git-timestamp-cache":{"slug":"2026-02-13-spec-history-git-timestamp-cache","proposal":"## Why\r\n\r\n目前 spec history 的排序只依賴 change slug 中的日期字串（精度到天），同一天內的多個 changes 無法區分先後順序。需要引入 git commit 時間戳作為精確排序依據，並透過 in-memory cache 機制避免每次 API 請求都執行 git 指令。同時，因為 repo 會持續推進，使用者需要手動 resync 的能力來更新快取。\r\n\r\n## What Changes\r\n\r\n- 新增 git timestamp cache 模組：啟動時或首次請求時執行單一 `git log` 指令，解析每個 change 目錄的最早 commit 時間，建立 in-memory Map 快取\r\n- 修改 spec history 排序邏輯：從純日期字串排序改為使用 git commit timestamp 排序，無 timestamp 時 fallback 回 slug 日期\r\n- 新增 resync API endpoint：`POST /api/openspec/resync`，強制重建指定 repo 的 timestamp cache\r\n- 新增 UI resync 按鈕：在畫面上提供手動重新同步的操作，讓使用者在 repo 推進後能更新快取\r\n- 擴充 HistoryEntry 資料結構：新增 `timestamp` 欄位（ISO 8601 格式）\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `git-timestamp-cache`: Git commit 時間戳快取模組，負責解析 git log、建立 in-memory cache、提供 resync 機制\r\n\r\n### Modified Capabilities\r\n- `spec-history`: history 排序改用 git commit timestamp，HistoryEntry 新增 timestamp 欄位\r\n- `openspec-api`: 新增 `POST /api/openspec/resync` endpoint\r\n\r\n## Impact\r\n\r\n- **後端新增檔案**：`server/lib/git-cache.ts`\r\n- **後端修改**：`server/lib/scanner.ts`（readSpec 排序邏輯）、`server/routes/openspec.ts`（新增 resync route）\r\n- **前端修改**：`src/hooks/useOpenSpec.ts`（resync hook）、`src/components/Layout.tsx` 或相關元件（resync 按鈕）、`src/pages/SpecDetail.tsx`（可選：顯示精確時間）\r\n- **新增依賴**：無，使用 Node.js 內建 `child_process` 執行 git\r\n- **效能考量**：git log 只在 cache miss 或手動 resync 時執行一次，日常 API 請求零 git 開銷\r\n","design":"## Context\r\n\r\n目前 spec history 排序僅依賴 change slug 中的日期字串（`YYYY-MM-DD`），同一天有多個 changes 時順序不確定。需要引入 git commit 時間戳作為精確排序來源，同時避免每次 API 請求都執行 git 指令。\r\n\r\n現有流程：`readSpec()` → `findRelatedChanges()` → `parseSlug()` 取日期 → `localeCompare` 排序。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 用 git commit 時間戳精確排序同一天內的 history entries\r\n- 透過 in-memory cache 將 git 操作降為一次性成本\r\n- 提供手動 resync 機制讓使用者在 repo 推進後更新快取\r\n- 無 git 資訊時 graceful fallback 回原有的 slug 日期排序\r\n\r\n**Non-Goals:**\r\n- 不做 file watcher 自動偵測 repo 變更\r\n- 不持久化 cache 到磁碟（server 重啟重建即可）\r\n- 不追蹤 git 以外的時間來源\r\n\r\n## Decisions\r\n\r\n### 1. Git 時間戳取「change 目錄最早 commit 時間」\r\n\r\n取最早 commit 代表 change 的建立時間，符合 history 的時序語意（「這個 change 是什麼時候開始的」）。\r\n\r\n替代方案：取最晚 commit（最後更新時間）— 但這會讓頻繁修改的舊 change 排到前面，不符合時間線直覺。\r\n\r\n### 2. 單一 `git log` 指令批次取得所有 change 時間\r\n\r\n執行一次 `git log --format=\"COMMIT %aI\" --name-only -- openspec/changes/`，解析輸出取得每個 slug 對應的最早 commit 時間。\r\n\r\ngit log 預設最新在前輸出，對同一個 slug 持續覆寫，最後留下的即為最早 commit。\r\n\r\n替代方案：每個 slug 各跑一次 `git log --reverse` — 變更數量多時 N 次 fork 效能差。\r\n\r\n### 3. In-memory Map 快取，以 repo 路徑為 key\r\n\r\n結構：`Map<repoDir, Map<slug, isoTimestamp>>`\r\n\r\nspek 是本地開發工具，記憶體用量極低，無需磁碟持久化。Server 重啟時 cache 清空，下次請求 lazy rebuild。\r\n\r\n### 4. Lazy build + 手動 resync 雙軌機制\r\n\r\n- **Lazy build**：第一次對某 repo 發 API 請求且 cache 不存在時自動建立\r\n- **手動 resync**：`POST /api/openspec/resync?dir=...` 清除該 repo 的 cache 並立即重建\r\n\r\n### 5. Resync 按鈕放在 sidebar 底部\r\n\r\n使用者隨時可觸發，不限特定頁面。按鈕帶 loading 狀態回饋。\r\n\r\n替代方案：放 header — 但 header 空間已用於標題和主題切換，sidebar 底部更適合作為工具類操作。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **非 git repo 的情況** → 若 `git log` 失敗（目錄非 git repo），cache 回傳空 Map，排序 fallback 回 slug 日期。不影響功能。\r\n- **大型 repo git log 較慢** → 限定 `-- openspec/changes/` 路徑過濾，大幅縮小掃描範圍。一般 OpenSpec 的 commit 數量不會太大。\r\n- **Cache 過期使用者不察覺** → 透過 UI resync 按鈕讓使用者主動控制，不做自動失效避免複雜度。\r\n","tasks":{"total":8,"completed":8,"sections":[{"title":"1. Git Timestamp Cache 模組","tasks":[{"text":"1.1 建立 `server/lib/git-cache.ts`，實作 `buildChangeTimestamps(repoDir)` 函式：執行 `git log --format=\"COMMIT %aI\" --name-only -- openspec/changes/` 並解析輸出為 `Map<slug, isoTimestamp>`","completed":true},{"text":"1.2 實作 in-memory cache (`Map<repoDir, Map<slug, timestamp>>`)，含 `getTimestamps(repoDir)` (lazy build) 和 `resyncTimestamps(repoDir)` (清除並重建)","completed":true},{"text":"1.3 處理非 git repo 的 fallback：git 指令失敗時回傳空 Map","completed":true}]},{"title":"2. 後端整合","tasks":[{"text":"2.1 修改 `server/lib/scanner.ts` 的 `readSpec()`：HistoryEntry 新增 `timestamp` 欄位，排序改用 timestamp 降序（無 timestamp 時 fallback 回 date）","completed":true},{"text":"2.2 在 `server/routes/openspec.ts` 新增 `POST /api/openspec/resync` endpoint，呼叫 `resyncTimestamps()`","completed":true}]},{"title":"3. 前端整合","tasks":[{"text":"3.1 修改 `src/hooks/useOpenSpec.ts`：SpecHistoryEntry 新增 `timestamp` 欄位，新增 `useResync()` hook","completed":true},{"text":"3.2 在 sidebar（`src/components/Layout.tsx` 或相關元件）加入 resync 按鈕，含 loading 狀態，未選 repo 時隱藏/disabled","completed":true},{"text":"3.3 修改 `src/pages/SpecDetail.tsx`：history timeline 可顯示精確時間（當 timestamp 存在時）","completed":true}]}]},"specs":[{"topic":"git-timestamp-cache","content":"## ADDED Requirements\r\n\r\n### Requirement: Build timestamp cache from git log\r\nThe system SHALL provide a function that executes a single `git log` command scoped to `openspec/changes/` and parses the output to build a Map of change slug to earliest commit timestamp (ISO 8601 format).\r\n\r\n#### Scenario: Build cache for repo with git history\r\n- **WHEN** the cache builder is invoked for a repo directory that is a git repository\r\n- **THEN** the system executes `git log --format=\"COMMIT %aI\" --name-only -- openspec/changes/` in the repo directory\r\n- **AND** parses the output to extract the earliest commit timestamp for each change slug\r\n- **AND** returns a `Map<string, string>` mapping slug to ISO 8601 timestamp\r\n\r\n#### Scenario: Build cache for non-git directory\r\n- **WHEN** the cache builder is invoked for a directory that is not a git repository\r\n- **THEN** the system returns an empty Map without throwing an error\r\n\r\n#### Scenario: Change exists in filesystem but not in git\r\n- **WHEN** a change directory exists but has no git commits (e.g., uncommitted new change)\r\n- **THEN** that change slug is not present in the returned Map\r\n\r\n### Requirement: In-memory cache keyed by repo path\r\nThe system SHALL maintain an in-memory cache (`Map<string, Map<string, string>>`) keyed by absolute repo directory path, storing the timestamp Map for each repo.\r\n\r\n#### Scenario: Cache hit\r\n- **WHEN** a timestamp lookup is requested for a repo that has been previously cached\r\n- **THEN** the system returns the cached Map without executing any git commands\r\n\r\n#### Scenario: Cache miss with lazy build\r\n- **WHEN** a timestamp lookup is requested for a repo that has not been cached\r\n- **THEN** the system automatically builds the cache by executing the git log command\r\n- **AND** stores the result for subsequent lookups\r\n\r\n### Requirement: Resync cache\r\nThe system SHALL provide a resync function that clears the cached timestamps for a given repo and immediately rebuilds the cache from git.\r\n\r\n#### Scenario: Resync after repo changes\r\n- **WHEN** the resync function is invoked for a repo directory\r\n- **THEN** the system clears the existing cache entry for that repo\r\n- **AND** rebuilds the cache by executing the git log command\r\n- **AND** returns the newly built timestamp Map\r\n"},{"topic":"openspec-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Resync cache endpoint\r\nThe system SHALL provide `POST /api/openspec/resync` that clears and rebuilds the git timestamp cache for a given repo.\r\n\r\n#### Scenario: Successful resync\r\n- **WHEN** client sends `POST /api/openspec/resync?dir=/path/to/repo`\r\n- **THEN** the system clears the timestamp cache for that repo\r\n- **AND** rebuilds the cache from git history\r\n- **AND** returns HTTP 200 with `{ ok: true }`\r\n\r\n#### Scenario: Resync without dir parameter\r\n- **WHEN** client sends `POST /api/openspec/resync` without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Resync UI control\r\nThe system SHALL display a resync button in the sidebar that triggers a cache rebuild. The button MUST show a loading state while the resync is in progress.\r\n\r\n#### Scenario: User triggers resync\r\n- **WHEN** the user clicks the resync button in the sidebar\r\n- **THEN** the system sends `POST /api/openspec/resync` with the current repo path\r\n- **AND** the button shows a loading/spinning state during the request\r\n- **AND** on success, the current page data is refreshed to reflect updated ordering\r\n\r\n#### Scenario: Resync with no repo selected\r\n- **WHEN** no repo is currently selected\r\n- **THEN** the resync button is not displayed or is disabled\r\n"},{"topic":"spec-history","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Spec history data in API response\r\nThe system SHALL include a `history` array in the `GET /api/openspec/specs/:topic` response. Each entry MUST contain the change slug, date (if parseable from slug), timestamp (ISO 8601 from git commit cache, or null if unavailable), description, and status (active or archived).\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** a spec has been affected by one or more changes (i.e., changes that contain a delta spec for this topic)\r\n- **THEN** the API response includes a `history` array with entries sorted by git commit timestamp descending (most recent first)\r\n- **AND** if two entries have the same date, the git commit timestamp determines their order\r\n- **AND** each entry contains `{ slug, date, timestamp, description, status }`\r\n\r\n#### Scenario: Spec with no related changes\r\n- **WHEN** a spec has no related changes\r\n- **THEN** the API response includes an empty `history` array\r\n\r\n#### Scenario: Fallback sorting when git timestamp unavailable\r\n- **WHEN** a history entry has no git commit timestamp (e.g., uncommitted change or non-git repo)\r\n- **THEN** the entry's `timestamp` field is null\r\n- **AND** sorting falls back to the date parsed from the slug\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-fix-task-stats-and-capability-nav":{"slug":"2026-02-13-fix-task-stats-and-capability-nav","proposal":"## Why\r\n\r\nDashboard 的 task completion 永遠顯示 0%，因為 overview API 只統計 active changes 的 task stats，但實際上所有 changes 都已 archived。此外，Change detail 頁面的 Proposal tab 中 Capabilities 區塊列出的 capability ID 應該可以點擊導航到對應的 spec 頁面，目前只是純文字無法互動。\r\n\r\n## What Changes\r\n\r\n- 修正 overview API 的 taskStats 統計邏輯，將 archived changes 的 tasks 納入計算\r\n- 在 Change detail 的 Proposal tab 中，將 capability ID（反引號包裹的 kebab-case 識別碼）渲染為可點擊的連結，導航到對應的 `/specs/:topic` 頁面\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n（無）\r\n\r\n### Modified Capabilities\r\n\r\n- `openspec-api`: overview endpoint 的 taskStats 改為統計所有 changes（含 archived），而非僅 active changes\r\n- `change-browsing`: Proposal tab 中的 capability ID 應渲染為可導航至對應 spec 的連結\r\n\r\n## Impact\r\n\r\n- **後端**: `server/routes/openspec.ts` — overview endpoint 的 taskStats 聚合邏輯\r\n- **前端**: `src/components/MarkdownRenderer.tsx` 或 `src/pages/ChangeDetail.tsx` — capability ID 連結渲染\r\n- **Spec 更新**: `openspec-api` 與 `change-browsing` 的 spec 需更新以反映新行為\r\n","design":"## Context\r\n\r\nDashboard 的 task completion 永遠 0%，根因是 `server/routes/openspec.ts` 第 24 行 overview endpoint 只遍歷 `scan.activeChanges`，但目前所有 changes 皆已 archived。另外，Change detail 的 Proposal tab 中 Capabilities 區塊的 capability ID 以反引號包裹但僅渲染為靜態 `<code>`，無法導航至對應的 spec 頁面。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n\r\n- Overview endpoint 的 taskStats 統計所有 changes（active + archived）的任務完成度\r\n- Proposal markdown 中以反引號包裹的 capability ID（如 `` `responsive-layout` ``）在列表項中渲染為可點擊的連結，導航至 `/specs/:topic`\r\n\r\n**Non-Goals:**\r\n\r\n- 不改變 `/api/openspec/changes` 或 `/api/openspec/changes/:slug` 的回傳格式\r\n- 不新增 capability 專屬的 API endpoint\r\n- 不對所有 inline code 都做連結，僅處理 Capabilities 區塊下的列表項\r\n\r\n## Decisions\r\n\r\n### 1. Overview taskStats 聚合 active + archived\r\n\r\n在 `server/routes/openspec.ts` 的 overview handler 中，將遍歷對象從 `scan.activeChanges` 改為 `[...scan.activeChanges, ...scan.archivedChanges]`。\r\n\r\n**理由**: 最小改動，一行修正，且語義正確——Dashboard 應反映整個 repo 的任務進度。\r\n\r\n### 2. MarkdownRenderer inline code 連結化\r\n\r\n在 `src/components/MarkdownRenderer.tsx` 的 `code` component（inline code 分支）中，檢查 code 內容是否為 kebab-case 格式且對應到已知 spec topic。若符合，渲染為 React Router `<Link>` 導航至 `/specs/:topic`。\r\n\r\n需要的資訊：spec topics 清單。方案是讓 MarkdownRenderer 接受可選的 `specTopics?: string[]` prop，由 ChangeDetail 頁面傳入（從 `/api/openspec/specs` 取得）。\r\n\r\n**理由**:\r\n- 將連結邏輯放在 MarkdownRenderer 而非 ChangeDetail，因為 markdown 內容結構由 renderer 控制\r\n- 使用 prop 傳入 spec topics 而非在 renderer 中呼叫 API，保持元件純粹\r\n- 僅在 specTopics 有傳入且內容匹配時才連結化，避免誤連不存在的 spec\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[風險] inline code 誤判**: 有些 inline code 可能恰好符合 kebab-case 格式但不是 capability ID → 以 specTopics 白名單比對來避免，只有確實存在的 spec 才會連結化\r\n- **[風險] spec 清單多一次 API 呼叫**: ChangeDetail 頁面需額外 fetch spec 清單 → 此呼叫已在 useOpenSpec hook 中存在（`useSpecs`），可直接複用\r\n","tasks":{"total":7,"completed":7,"sections":[{"title":"1. Fix overview taskStats aggregation","tasks":[{"text":"1.1 修改 `server/routes/openspec.ts` overview endpoint，將 taskStats 遍歷對象從 `scan.activeChanges` 改為 `[...scan.activeChanges, ...scan.archivedChanges]`","completed":true},{"text":"1.2 更新 `openspec/specs/openspec-api/spec.md` 的 overview scenario 描述，反映新的聚合邏輯","completed":true}]},{"title":"2. Add capability ID linking in MarkdownRenderer","tasks":[{"text":"2.1 在 `src/components/MarkdownRenderer.tsx` 的 props 新增可選的 `specTopics?: string[]`","completed":true},{"text":"2.2 修改 inline `code` component，當 specTopics 包含該 code 文字時渲染為 React Router `<Link>` 至 `/specs/:topic`","completed":true},{"text":"2.3 在 `src/pages/ChangeDetail.tsx` 中取得 spec topics 清單並傳入 MarkdownRenderer","completed":true}]},{"title":"3. Verification","tasks":[{"text":"3.1 啟動 dev server，確認 Dashboard task completion 顯示正確百分比","completed":true},{"text":"3.2 確認 Change detail Proposal tab 中的 capability ID 可點擊導航至對應 spec 頁面","completed":true}]}]},"specs":[{"topic":"change-browsing","content":"## ADDED Requirements\r\n\r\n### Requirement: Capability ID linking in proposal\r\nThe system SHALL render inline code elements in proposal markdown as navigable links when the code text matches an existing spec topic name.\r\n\r\n#### Scenario: Capability ID matches existing spec\r\n- **WHEN** a proposal markdown contains an inline code element (e.g., `` `responsive-layout` ``)\r\n- **AND** a spec with the topic name `responsive-layout` exists\r\n- **THEN** the inline code SHALL be rendered as a clickable link navigating to `/specs/responsive-layout`\r\n\r\n#### Scenario: Inline code does not match any spec\r\n- **WHEN** a proposal markdown contains an inline code element that does not match any existing spec topic\r\n- **THEN** the inline code SHALL be rendered as a normal styled code element without a link\r\n\r\n#### Scenario: MarkdownRenderer receives spec topics list\r\n- **WHEN** MarkdownRenderer is used with a `specTopics` prop containing the list of available spec topic names\r\n- **THEN** inline code matching any topic in the list SHALL be rendered as navigable links\r\n"},{"topic":"openspec-api","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Overview endpoint\r\nThe system SHALL provide `GET /api/openspec/overview` that returns aggregate statistics for an OpenSpec repository.\r\n\r\n#### Scenario: Get overview of repo with specs and changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `specsCount`, `changesCount` (with `active` and `archived` breakdown), and `taskStats` (aggregate `total` and `completed` across all changes, including both active and archived)\r\n\r\n#### Scenario: Get overview with only archived changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** there are no active changes but archived changes have tasks\r\n- **THEN** system returns `taskStats` with correct `total` and `completed` counts from archived changes\r\n\r\n#### Scenario: Get overview of repo with no specs\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** the repo has no `openspec/specs/` directory\r\n- **THEN** system returns `specsCount: 0` with changes still counted correctly\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-phase4-polish-and-enhancement":{"slug":"2026-02-13-phase4-polish-and-enhancement","proposal":"## Why\r\n\r\nPhase 1~3 完成了核心功能（API、頁面、Markdown 渲染、搜尋），但 UI 仍為桌面限定、僅深色主題、缺少 spec 演進的歷史脈絡。Phase 4 的目標是提升使用體驗——讓應用在各種裝置上可用、提供淺色主題選項、並讓使用者能追蹤 spec 隨時間演進的歷程。\r\n\r\n## What Changes\r\n\r\n- 新增響應式佈局：sidebar 可收合、行動裝置漢堡選單、內容區自適應寬度\r\n- 新增深色/淺色主題切換，支援系統偏好偵測與 localStorage 持久化\r\n- 增強 repo 選擇頁的最近路徑體驗：驗證路徑是否仍有效、顯示路徑狀態\r\n- 新增 spec 演進歷史 API 與 UI：顯示哪些 change 影響了特定 spec，含時間線視圖\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `responsive-layout`: 響應式佈局系統，包含 sidebar 收合、漢堡選單、斷點適配\r\n- `theme-toggle`: 深色/淺色主題切換功能，含系統偏好偵測、localStorage 持久化、CSS 變數雙主題定義\r\n- `spec-history`: Spec 演進歷史追蹤，API 回傳每個 spec 被哪些 change 修改及時間線，UI 以時間線呈現\r\n\r\n### Modified Capabilities\r\n- `shared-layout`: 加入 sidebar 收合能力與響應式斷點適配\r\n- `repo-selection`: 增強最近路徑清單——非同步驗證路徑有效性、顯示狀態指標（有效/無效/檢查中）\r\n\r\n## Impact\r\n\r\n- **前端元件**：Layout、Sidebar 需重構支援收合；新增 ThemeProvider context；SpecDetail 加入歷史時間線區塊\r\n- **CSS**：global.css 需定義淺色主題 CSS 變數，切換以 `data-theme` attribute 或 class 控制\r\n- **API**：新增 `GET /api/openspec/specs/:topic/history` endpoint，回傳 change 影響時間線\r\n- **依賴**：無需新增外部依賴\r\n- **Context**：新增 ThemeContext（或擴充既有 context），管理主題狀態\r\n","design":"## Context\r\n\r\nPhase 1~3 已完成核心功能。目前 UI 為桌面固定 240px sidebar + 固定 header，僅深色主題，spec 詳細頁僅顯示 related changes 的 slug 清單但缺乏時間脈絡。SelectRepo 已有最近路徑清單，但不驗證路徑是否仍存在。\r\n\r\n技術現狀：\r\n- Tailwind CSS v4 + CSS custom properties（`@theme` 區塊定義色彩）\r\n- 固定佈局：header 56px、sidebar 240px、`ml-60 pt-14` 主內容區\r\n- RepoContext 管理 repo 路徑 + localStorage 最近路徑\r\n- `findRelatedChanges()` 已能查找哪些 change 含有特定 spec 的 delta spec\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 讓應用在 768px 以下螢幕可用（sidebar 收合為漢堡選單）\r\n- 提供淺色主題切換，支援 system preference 自動偵測\r\n- 增強最近路徑的可用性（顯示路徑狀態）\r\n- 以時間線呈現 spec 被哪些 change 修改的歷史\r\n\r\n**Non-Goals:**\r\n- 完整的 PWA 或離線支援\r\n- 自訂主題色彩（僅深色/淺色兩套）\r\n- Spec 內容 diff 比對（僅顯示哪些 change 影響了 spec，不比對內容差異）\r\n- 拖放或觸控手勢操作\r\n\r\n## Decisions\r\n\r\n### D1: 響應式斷點策略\r\n\r\n**選擇**：單一斷點 768px，使用 Tailwind `md:` prefix\r\n\r\n- < 768px：sidebar 隱藏，header 顯示漢堡按鈕，點擊彈出 overlay sidebar\r\n- ≥ 768px：sidebar 固定顯示（目前行為），可選收合為 icon-only 模式\r\n\r\n**替代方案**：多斷點（sm/md/lg/xl）→ 過度工程，本應用內容結構單純，一個斷點足夠\r\n\r\n**實作方式**：\r\n- Layout.tsx 加入 `sidebarOpen` state，桌面預設 open，行動版預設 closed\r\n- Sidebar 行動版為 fixed overlay + backdrop，桌面版為 fixed sidebar\r\n- 使用 `window.matchMedia('(min-width: 768px)')` 監聽斷點變化\r\n- Dashboard grid: `grid-cols-2 md:grid-cols-4`\r\n\r\n### D2: 主題切換機制\r\n\r\n**選擇**：`<html data-theme=\"dark|light\">` + CSS custom properties 雙套定義\r\n\r\n- `global.css` 定義兩套 `@theme` 變數（dark 為預設，light 在 `[data-theme=\"light\"]` selector 下覆寫）\r\n- ThemeContext 管理狀態，localStorage key `spek:theme`\r\n- 初始化順序：localStorage → `prefers-color-scheme` → 預設 dark\r\n- Header 右側加入主題切換按鈕（太陽/月亮 icon）\r\n\r\n**替代方案**：\r\n- Tailwind `dark:` class → 需要每個元件都寫兩套 class，改動量大\r\n- CSS-only media query → 無法手動切換\r\n\r\n**注意**：Tailwind CSS v4 的 `@theme` 是全域的，不支援 selector-scoped override。淺色主題需用普通 CSS 變數 override 搭配 `[data-theme=\"light\"]` selector。\r\n\r\n### D3: Spec 歷史 API\r\n\r\n**選擇**：擴充現有 `GET /api/openspec/specs/:topic` 回傳，加入 `history` 欄位\r\n\r\n- `history` 陣列包含每個 related change 的 `{ slug, date, description, status }` 資訊\r\n- 不新增獨立 endpoint，因為 `readSpec()` 已呼叫 `findRelatedChanges()`，只需擴充回傳資料\r\n- 前端 SpecDetail 新增「History」區塊，以時間線呈現\r\n\r\n**替代方案**：新增 `/api/openspec/specs/:topic/history` 獨立 endpoint → 多一次 API call，且資料來源相同，不划算\r\n\r\n### D4: 最近路徑驗證\r\n\r\n**選擇**：SelectRepo 載入時，對每個最近路徑呼叫 detect API 進行非同步驗證\r\n\r\n- 顯示三種狀態：檢查中（spinner）、有效（綠色）、無效（紅色 + 刪除按鈕）\r\n- 驗證在背景進行，不阻擋 UI 互動\r\n- 使用者可刪除無效路徑\r\n\r\n**替代方案**：只在點擊時驗證 → 使用者看到的路徑可能已不存在，體驗不佳\r\n\r\n## Risks / Trade-offs\r\n\r\n- **Tailwind v4 @theme 限制** → CSS custom property override 不在 `@theme` 區塊內，而是用普通 CSS `[data-theme=\"light\"]` selector。需確認所有元件使用 `bg-bg-primary` 等 semantic token 而非直接硬編碼色值。\r\n  - 緩解：全域搜尋硬編碼色值，統一改用 CSS 變數\r\n- **Sidebar overlay 觸控** → 行動版 sidebar overlay 需處理 backdrop 點擊關閉。\r\n  - 緩解：使用 fixed backdrop div + onClick handler\r\n- **路徑驗證延遲** → 多個路徑同時驗證可能造成短暫 loading 狀態。\r\n  - 緩解：並行發送所有 detect 請求，各自獨立更新狀態\r\n","tasks":{"total":21,"completed":21,"sections":[{"title":"1. Theme Toggle","tasks":[{"text":"1.1 Define light theme CSS variables in `global.css` under `[data-theme=\"light\"]` selector","completed":true},{"text":"1.2 Create `ThemeContext` with theme state, toggle function, localStorage persistence (`spek:theme`), and system preference detection","completed":true},{"text":"1.3 Wrap app with `ThemeProvider` in `main.tsx`, set `data-theme` attribute on `<html>`","completed":true},{"text":"1.4 Add theme toggle button (sun/moon icon) to Layout header","completed":true}]},{"title":"2. Responsive Layout","tasks":[{"text":"2.1 Add `sidebarOpen` state and mobile breakpoint detection (`matchMedia 768px`) to Layout","completed":true},{"text":"2.2 Refactor Sidebar to accept `open`/`onClose` props; render as overlay with backdrop on mobile, fixed on desktop","completed":true},{"text":"2.3 Add hamburger menu button to header (visible only on mobile)","completed":true},{"text":"2.4 Update main content area to remove fixed `ml-60` on mobile","completed":true},{"text":"2.5 Update header to hide repo path on mobile","completed":true},{"text":"2.6 Update Dashboard stat cards grid to `grid-cols-2 md:grid-cols-4` and navigation cards to stack on mobile","completed":true}]},{"title":"3. Recent Path Enhancement","tasks":[{"text":"3.1 Add async path validation in SelectRepo — call detect API for each recent path on mount","completed":true},{"text":"3.2 Display status indicators for each recent path: spinner (checking), green checkmark (valid), red indicator (invalid)","completed":true},{"text":"3.3 Add delete button for individual recent paths, update localStorage on removal","completed":true}]},{"title":"4. Spec History","tasks":[{"text":"4.1 Extend `readSpec()` in `scanner.ts` to return `history` array with `{ slug, date, description, status }` for each related change","completed":true},{"text":"4.2 Update `useSpec` hook type to include `history` field","completed":true},{"text":"4.3 Add history timeline UI section to SpecDetail page with date, description, and link to change","completed":true}]},{"title":"5. Verification","tasks":[{"text":"5.1 Verify theme toggle works: dark ↔ light, persists across reload, respects system preference on first visit","completed":true},{"text":"5.2 Verify responsive layout: sidebar collapses on mobile, overlay works, grids adapt","completed":true},{"text":"5.3 Verify recent paths show validation status and allow deletion","completed":true},{"text":"5.4 Verify spec history timeline displays correctly with links to changes","completed":true},{"text":"5.5 Run `npm run type-check` and `npm run build` to confirm no errors","completed":true}]}]},"specs":[{"topic":"repo-selection","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Recent paths persistence\r\nThe system SHALL persist the most recent 5 repo paths in localStorage. On page load, previously used paths SHALL be displayed for quick selection. Each recent path SHALL be validated asynchronously against the detect API to show its current status (valid, invalid, or checking).\r\n\r\n#### Scenario: Save path on successful detection\r\n- **WHEN** user successfully opens a repo (path with valid openspec/)\r\n- **THEN** the path is saved to localStorage recent paths list (max 5, most recent first)\r\n\r\n#### Scenario: Display recent paths on load\r\n- **WHEN** user visits the SelectRepo page\r\n- **THEN** previously saved paths are displayed as clickable options\r\n\r\n#### Scenario: Validate recent paths asynchronously\r\n- **WHEN** the SelectRepo page loads with saved recent paths\r\n- **THEN** the system calls the detect API for each path in parallel\r\n- **AND** each path displays a status indicator: spinner (checking), green checkmark (valid openspec/ found), or red indicator (path invalid or no openspec/)\r\n\r\n#### Scenario: Remove invalid path\r\n- **WHEN** a recent path is determined to be invalid\r\n- **THEN** a delete button appears next to the path allowing the user to remove it from the list\r\n"},{"topic":"responsive-layout","content":"## ADDED Requirements\r\n\r\n### Requirement: Mobile breakpoint detection\r\nThe system SHALL detect whether the viewport width is below 768px and adapt the layout accordingly. The detection MUST use `window.matchMedia` and respond to runtime viewport changes (e.g., device rotation).\r\n\r\n#### Scenario: Viewport below 768px\r\n- **WHEN** the viewport width is less than 768px\r\n- **THEN** the sidebar is hidden by default and a hamburger menu button appears in the header\r\n\r\n#### Scenario: Viewport at or above 768px\r\n- **WHEN** the viewport width is 768px or greater\r\n- **THEN** the sidebar is displayed in its fixed position and the hamburger menu button is hidden\r\n\r\n#### Scenario: Viewport resize crossing breakpoint\r\n- **WHEN** the viewport is resized from below 768px to at or above 768px\r\n- **THEN** the sidebar transitions to fixed display and the hamburger menu button is hidden\r\n\r\n### Requirement: Mobile sidebar overlay\r\nThe system SHALL display the sidebar as a full-height overlay with a backdrop when opened on viewports below 768px.\r\n\r\n#### Scenario: Open mobile sidebar\r\n- **WHEN** the user taps the hamburger menu button on a mobile viewport\r\n- **THEN** the sidebar slides in from the left as an overlay with a semi-transparent backdrop behind it\r\n\r\n#### Scenario: Close mobile sidebar via backdrop\r\n- **WHEN** the mobile sidebar overlay is open and the user taps the backdrop area\r\n- **THEN** the sidebar closes and the backdrop disappears\r\n\r\n#### Scenario: Close mobile sidebar via navigation\r\n- **WHEN** the mobile sidebar overlay is open and the user taps a navigation link\r\n- **THEN** the system navigates to the selected route and the sidebar closes automatically\r\n\r\n### Requirement: Responsive content grids\r\nThe system SHALL adapt grid layouts for different viewport sizes. Dashboard stat cards MUST use 2 columns on mobile and 4 columns on desktop. Navigation cards MUST stack vertically on mobile.\r\n\r\n#### Scenario: Dashboard stat cards on mobile\r\n- **WHEN** the Dashboard page is rendered on a viewport below 768px\r\n- **THEN** the stat cards are displayed in a 2-column grid\r\n\r\n#### Scenario: Dashboard stat cards on desktop\r\n- **WHEN** the Dashboard page is rendered on a viewport at or above 768px\r\n- **THEN** the stat cards are displayed in a 4-column grid\r\n\r\n### Requirement: Responsive header\r\nThe system SHALL adapt the header layout for mobile viewports. The repo path display MUST be hidden on mobile to save space. The search button MUST remain accessible.\r\n\r\n#### Scenario: Header on mobile\r\n- **WHEN** the header is rendered on a viewport below 768px\r\n- **THEN** the hamburger button is shown on the left, the search button is centered, and the repo path is hidden\r\n\r\n#### Scenario: Header on desktop\r\n- **WHEN** the header is rendered on a viewport at or above 768px\r\n- **THEN** the layout shows the spek brand on the left, search button centered, and repo path on the right\r\n"},{"topic":"shared-layout","content":"## MODIFIED Requirements\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, and Changes. The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL be displayed in a fixed position (240px width).\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, and Changes\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Dashboard page\r\n- **THEN** the \"Overview\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar on desktop viewport\r\n- **WHEN** the viewport is at or above 768px\r\n- **THEN** the sidebar is displayed in its fixed position (240px width)\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: the \"spek\" logo/brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button and hide the repo path. The header SHALL also include a theme toggle button.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the spek brand, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button, the spek brand, search button, and theme toggle, but hides the repo path\r\n"},{"topic":"spec-history","content":"## ADDED Requirements\r\n\r\n### Requirement: Spec history data in API response\r\nThe system SHALL include a `history` array in the `GET /api/openspec/specs/:topic` response. Each entry MUST contain the change slug, date (if parseable from slug), description, and status (active or archived).\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** a spec has been affected by one or more changes (i.e., changes that contain a delta spec for this topic)\r\n- **THEN** the API response includes a `history` array with entries sorted by date descending (most recent first)\r\n- **AND** each entry contains `{ slug, date, description, status }`\r\n\r\n#### Scenario: Spec with no related changes\r\n- **WHEN** a spec has no related changes\r\n- **THEN** the API response includes an empty `history` array\r\n\r\n### Requirement: Spec history timeline UI\r\nThe system SHALL display a visual timeline on the SpecDetail page showing all changes that affected the spec. Each timeline entry MUST display the date, change description, and a link to the change detail page.\r\n\r\n#### Scenario: Display history timeline\r\n- **WHEN** the SpecDetail page is rendered for a spec with related changes\r\n- **THEN** a \"History\" section is displayed with a vertical timeline showing each change chronologically\r\n\r\n#### Scenario: Timeline entry links to change\r\n- **WHEN** the user clicks on a timeline entry\r\n- **THEN** the system navigates to the corresponding change detail page\r\n\r\n#### Scenario: No history\r\n- **WHEN** the SpecDetail page is rendered for a spec with no related changes\r\n- **THEN** the \"History\" section displays a message indicating no changes have affected this spec\r\n"},{"topic":"theme-toggle","content":"## ADDED Requirements\r\n\r\n### Requirement: Theme state management\r\nThe system SHALL provide a ThemeContext that manages the current theme (\"dark\" or \"light\") and exposes a toggle function. The theme state MUST be persisted in localStorage under the key `spek:theme`.\r\n\r\n#### Scenario: Initialize from localStorage\r\n- **WHEN** the application loads and localStorage contains a saved theme preference\r\n- **THEN** the system applies the saved theme\r\n\r\n#### Scenario: Initialize from system preference\r\n- **WHEN** the application loads and no theme is saved in localStorage\r\n- **AND** the user's system preference is light mode (`prefers-color-scheme: light`)\r\n- **THEN** the system applies the light theme\r\n\r\n#### Scenario: Initialize default\r\n- **WHEN** the application loads and no theme is saved and no system preference is detected\r\n- **THEN** the system applies the dark theme as default\r\n\r\n#### Scenario: Toggle theme\r\n- **WHEN** the user triggers the theme toggle\r\n- **THEN** the current theme switches (dark → light or light → dark)\r\n- **AND** the new preference is saved to localStorage\r\n- **AND** the `data-theme` attribute on `<html>` is updated\r\n\r\n### Requirement: Light theme CSS variables\r\nThe system SHALL define a complete set of light theme CSS variables that override the dark theme defaults when `[data-theme=\"light\"]` is set on the `<html>` element.\r\n\r\n#### Scenario: Light theme applied\r\n- **WHEN** the `<html>` element has `data-theme=\"light\"`\r\n- **THEN** all color CSS variables (`--color-bg-primary`, `--color-bg-secondary`, `--color-bg-tertiary`, `--color-border`, `--color-text-primary`, `--color-text-secondary`, `--color-text-muted`, `--color-accent`, `--color-accent-hover`) are overridden with light-appropriate values\r\n\r\n#### Scenario: Dark theme applied\r\n- **WHEN** the `<html>` element has `data-theme=\"dark\"` or no `data-theme` attribute\r\n- **THEN** the default dark theme CSS variables are used\r\n\r\n### Requirement: Theme toggle button\r\nThe system SHALL display a theme toggle button in the header. The button MUST show a sun icon when in dark mode (indicating \"switch to light\") and a moon icon when in light mode (indicating \"switch to dark\").\r\n\r\n#### Scenario: Display toggle in header\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** a theme toggle button is visible in the header area\r\n\r\n#### Scenario: Icon reflects current theme\r\n- **WHEN** the current theme is dark\r\n- **THEN** the toggle button displays a sun icon\r\n- **WHEN** the current theme is light\r\n- **THEN** the toggle button displays a moon icon\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-phase3-markdown-and-search":{"slug":"2026-02-13-phase3-markdown-and-search","proposal":"## Why\r\n\r\nPhase 2 完成了核心 UI 頁面，但 Markdown 內容以 `<pre>` 原始文字顯示，缺乏可讀性和 BDD 語法高亮。搜尋按鈕目前為 disabled 狀態，後端搜尋 API 已就緒但前端尚未串接。本階段將補齊 Markdown 渲染和搜尋 UI，使 spek 成為可實際使用的 OpenSpec 檢視器。\r\n\r\n## What Changes\r\n\r\n- 新增 `MarkdownRenderer` 元件，使用 `react-markdown` + `remark-gfm` 渲染 Markdown 內容\r\n- 實作 BDD 語法高亮：WHEN/GIVEN（藍）、THEN（綠）、AND（灰）、MUST/SHALL（紅）、ADDED/MODIFIED（橘/藍 badge）\r\n- 新增 `SearchDialog` 元件，支援 `Cmd+K` / `Ctrl+K` 快捷鍵開啟\r\n- 串接後端 `/api/openspec/search` API，搜尋結果含上下文預覽\r\n- 將 SpecDetail、ChangeDetail 頁面的 `<pre>` 替換為 `MarkdownRenderer`\r\n- 將 Layout header 的 disabled search 按鈕替換為可用的搜尋觸發器\r\n- 新增 `react-markdown` 和 `remark-gfm` npm 依賴\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `markdown-renderer`: Markdown 渲染元件，含 GFM 支援與 BDD 語法高亮\r\n- `search-ui`: 全文搜尋對話框 UI，含鍵盤快捷鍵與結果導覽\r\n\r\n### Modified Capabilities\r\n（無 spec 層級的需求變更，現有 API 行為不變）\r\n\r\n## Impact\r\n\r\n- **前端元件**：新增 `MarkdownRenderer.tsx`、`SearchDialog.tsx`；修改 `SpecDetail.tsx`、`ChangeDetail.tsx`、`Layout.tsx`\r\n- **依賴**：新增 `react-markdown`、`remark-gfm` 套件\r\n- **API**：僅串接現有 search API，無後端變更\r\n- **樣式**：新增 BDD 高亮相關 CSS 規則\r\n","design":"## Context\r\n\r\nPhase 2 完成了核心 UI 頁面，但所有 Markdown 內容以 `<pre>` 顯示原始文字。搜尋按鈕為 disabled placeholder。後端搜尋 API（`/api/openspec/search`，使用 Fuse.js）已在 Phase 1 實作完成。\r\n\r\n目前前端尚未安裝 `react-markdown` 或 `remark-gfm`，需新增這兩個依賴。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 以 react-markdown 渲染所有 Markdown 內容，支援 GFM（表格、checkbox、strikethrough）\r\n- 實作 BDD 語法高亮，讓 WHEN/THEN/MUST 等關鍵字在視覺上突出\r\n- 提供 SearchDialog 搜尋對話框，支援 Cmd+K / Ctrl+K 快捷鍵\r\n- 搜尋結果按類型分組（spec / change），點擊可導覽至對應頁面\r\n\r\n**Non-Goals:**\r\n- 不做 Markdown 編輯功能\r\n- 不修改後端搜尋 API 邏輯\r\n- 不做搜尋結果的 client-side re-ranking（直接使用後端排序）\r\n- 不做搜尋歷史記錄\r\n\r\n## Decisions\r\n\r\n### D1: BDD 高亮實作方式 — react-markdown custom components\r\n\r\n使用 react-markdown 的 `components` prop 自訂渲染。在段落（`p`）和列表項（`li`）元件中，對文字節點進行正規表達式匹配，將 BDD 關鍵字包裹在 `<span>` 中套用對應樣式。\r\n\r\n**替代方案**：remark plugin 做 AST 轉換 — 較複雜且不易維護，BDD 高亮本質是視覺層處理，不需要改動 AST。\r\n\r\n**關鍵字與樣式對應**：\r\n- `WHEN`、`GIVEN` → 藍色背景標籤 (`bg-blue-500/20 text-blue-400`)\r\n- `THEN` → 綠色背景標籤 (`bg-green-500/20 text-green-400`)\r\n- `AND` → 灰色背景標籤 (`bg-gray-500/20 text-gray-400`)\r\n- `MUST`、`SHALL` → 紅色粗體 (`text-red-400 font-bold`)\r\n- `ADDED`、`MODIFIED` → 橘/藍 badge (`bg-orange-500/20` / `bg-blue-500/20`)\r\n\r\n匹配規則：僅在單字邊界（word boundary）匹配，且關鍵字為全大寫時才觸發，避免誤匹配一般英文文字。\r\n\r\n### D2: SearchDialog 設計 — Modal overlay + 即時搜尋\r\n\r\n採用 modal overlay 模式，按 `Cmd+K` / `Ctrl+K` 開啟，按 `Escape` 關閉。輸入文字時 debounce 300ms 後呼叫後端搜尋 API。\r\n\r\n結果按 type 分組顯示（Specs / Changes），每筆結果顯示名稱和上下文預覽片段。點擊結果使用 React Router `navigate()` 跳轉到對應頁面。\r\n\r\n支援鍵盤導覽：上下箭頭選取結果、Enter 確認跳轉。\r\n\r\n### D3: MarkdownRenderer 整合點\r\n\r\nMarkdownRenderer 作為純展示元件，接受 `content: string` prop。在以下位置使用：\r\n- `SpecDetail.tsx` — 替換 `<pre>{data.content}</pre>`\r\n- `ChangeDetail.tsx` — 替換 proposal、design、specs tab 的 `<pre>` 區塊\r\n- Tasks tab 保持現有的結構化顯示（checkbox + progress），不使用 MarkdownRenderer\r\n\r\n## Risks / Trade-offs\r\n\r\n- **[效能] 大型 Markdown 檔案渲染延遲** → react-markdown 已有虛擬化機制，且 OpenSpec 檔案通常不超過數百行，風險低\r\n- **[誤匹配] BDD 關鍵字出現在程式碼區塊中** → 僅在非 code 元素中執行高亮，`code` 和 `pre` 元件不做處理\r\n- **[搜尋延遲] 每次輸入都打 API** → debounce 300ms 減少請求頻率；後端為本地檔案讀取，延遲可忽略\r\n","tasks":{"total":13,"completed":13,"sections":[{"title":"1. Dependencies","tasks":[{"text":"1.1 Install react-markdown and remark-gfm packages","completed":true}]},{"title":"2. MarkdownRenderer Component","tasks":[{"text":"2.1 Create MarkdownRenderer component with react-markdown + remark-gfm rendering","completed":true},{"text":"2.2 Implement BDD keyword highlighting (WHEN/GIVEN, THEN, AND, MUST/SHALL, ADDED/MODIFIED) using custom component overrides","completed":true},{"text":"2.3 Add dark theme styles for rendered Markdown (code blocks, links, headings, tables)","completed":true}]},{"title":"3. Integrate MarkdownRenderer","tasks":[{"text":"3.1 Replace `<pre>` in SpecDetail with MarkdownRenderer","completed":true},{"text":"3.2 Replace `<pre>` in ChangeDetail (proposal, design, specs tabs) with MarkdownRenderer","completed":true}]},{"title":"4. SearchDialog Component","tasks":[{"text":"4.1 Create SearchDialog component with modal overlay, search input, and results display","completed":true},{"text":"4.2 Add useSearch hook to call `/api/openspec/search` with 300ms debounce","completed":true},{"text":"4.3 Implement result grouping by type (Specs / Changes) with context preview","completed":true},{"text":"4.4 Implement keyboard navigation (arrow keys to select, Enter to confirm, Escape to close)","completed":true},{"text":"4.5 Implement click-to-navigate using React Router","completed":true}]},{"title":"5. Integrate SearchDialog","tasks":[{"text":"5.1 Add Cmd+K / Ctrl+K global keyboard shortcut to open SearchDialog","completed":true},{"text":"5.2 Replace disabled search button in Layout header with functional search trigger","completed":true}]}]},"specs":[{"topic":"markdown-renderer","content":"## ADDED Requirements\r\n\r\n### Requirement: Markdown content rendering\r\nThe system SHALL render Markdown content using react-markdown with remark-gfm plugin, supporting GFM features including tables, strikethrough, and task lists.\r\n\r\n#### Scenario: Standard Markdown rendering\r\n- **WHEN** MarkdownRenderer receives a string containing standard Markdown (headings, lists, bold, italic, links, code blocks)\r\n- **THEN** the content is rendered as formatted HTML with appropriate styling\r\n\r\n#### Scenario: GFM table rendering\r\n- **WHEN** MarkdownRenderer receives content containing a GFM pipe table\r\n- **THEN** the table is rendered as a styled HTML table with header row and data rows\r\n\r\n#### Scenario: GFM checkbox rendering\r\n- **WHEN** MarkdownRenderer receives content containing `- [x]` or `- [ ]` items\r\n- **THEN** the items are rendered as visual checkboxes (read-only)\r\n\r\n### Requirement: BDD keyword highlighting\r\nThe system SHALL visually highlight BDD keywords in rendered Markdown content to improve readability of spec documents.\r\n\r\n#### Scenario: WHEN/GIVEN keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `WHEN` or `GIVEN` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a blue background label style (blue text on blue-tinted background)\r\n\r\n#### Scenario: THEN keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `THEN` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a green background label style (green text on green-tinted background)\r\n\r\n#### Scenario: AND keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `AND` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a gray background label style (gray text on gray-tinted background)\r\n\r\n#### Scenario: MUST/SHALL keyword highlighting\r\n- **WHEN** rendered Markdown contains `MUST` or `SHALL` as standalone uppercase keywords\r\n- **THEN** the keywords are displayed in red bold text\r\n\r\n#### Scenario: ADDED/MODIFIED badge rendering\r\n- **WHEN** rendered Markdown contains `ADDED` or `MODIFIED` as standalone uppercase keywords\r\n- **THEN** `ADDED` is displayed as an orange badge and `MODIFIED` is displayed as a blue badge\r\n\r\n#### Scenario: Keywords inside code blocks are not highlighted\r\n- **WHEN** BDD keywords appear inside inline code or fenced code blocks\r\n- **THEN** the keywords are NOT highlighted and remain as plain code text\r\n\r\n#### Scenario: Case-sensitive matching\r\n- **WHEN** text contains lowercase or mixed-case variations like \"when\", \"Then\", \"must\"\r\n- **THEN** the keywords are NOT highlighted (only exact uppercase matches trigger highlighting)\r\n\r\n### Requirement: Dark theme styling\r\nThe system SHALL apply dark theme styles consistent with the application's design system (background #0a0c0f series, amber accent, text #e2e8f0).\r\n\r\n#### Scenario: Code block styling\r\n- **WHEN** MarkdownRenderer renders a fenced code block\r\n- **THEN** the code block uses a dark background with monospace font and appropriate padding\r\n\r\n#### Scenario: Link styling\r\n- **WHEN** MarkdownRenderer renders a hyperlink\r\n- **THEN** the link is displayed in accent color (amber) with hover effect\r\n\r\n#### Scenario: Heading styling\r\n- **WHEN** MarkdownRenderer renders headings (h1-h6)\r\n- **THEN** headings use appropriate font sizes and weights consistent with the dark theme\r\n"},{"topic":"search-ui","content":"## ADDED Requirements\r\n\r\n### Requirement: Search dialog activation\r\nThe system SHALL provide a search dialog that can be opened via keyboard shortcut or UI interaction.\r\n\r\n#### Scenario: Open search with keyboard shortcut\r\n- **WHEN** user presses `Cmd+K` (macOS) or `Ctrl+K` (other platforms) anywhere in the application\r\n- **THEN** a search dialog modal opens with focus on the search input field\r\n\r\n#### Scenario: Open search via header button\r\n- **WHEN** user clicks the search button in the application header\r\n- **THEN** the search dialog modal opens with focus on the search input field\r\n\r\n#### Scenario: Close search with Escape\r\n- **WHEN** the search dialog is open and user presses `Escape`\r\n- **THEN** the search dialog closes\r\n\r\n#### Scenario: Close search by clicking backdrop\r\n- **WHEN** the search dialog is open and user clicks outside the dialog\r\n- **THEN** the search dialog closes\r\n\r\n### Requirement: Search query execution\r\nThe system SHALL search across all specs and changes content by calling the backend search API with debounced input.\r\n\r\n#### Scenario: Debounced search on input\r\n- **WHEN** user types a query in the search input\r\n- **THEN** the system waits 300ms after the last keystroke before sending the search request to `GET /api/openspec/search`\r\n\r\n#### Scenario: Display search results\r\n- **WHEN** the search API returns results\r\n- **THEN** results are displayed grouped by type (Specs and Changes), each showing the name and a context preview snippet\r\n\r\n#### Scenario: No results found\r\n- **WHEN** the search API returns an empty array\r\n- **THEN** the dialog displays a \"No results found\" message\r\n\r\n#### Scenario: Empty query\r\n- **WHEN** the search input is empty\r\n- **THEN** no search request is made and the results area shows a prompt to start typing\r\n\r\n### Requirement: Search result navigation\r\nThe system SHALL allow users to navigate to search results using keyboard or mouse.\r\n\r\n#### Scenario: Click to navigate\r\n- **WHEN** user clicks on a search result\r\n- **THEN** the application navigates to the corresponding page (`/specs/:topic` for spec results, `/changes/:slug` for change results) and the search dialog closes\r\n\r\n#### Scenario: Keyboard navigation with arrow keys\r\n- **WHEN** user presses the down arrow key in the search dialog\r\n- **THEN** the next result item is highlighted\r\n- **AND** pressing the up arrow key highlights the previous result item\r\n\r\n#### Scenario: Confirm selection with Enter\r\n- **WHEN** user presses Enter with a result item highlighted\r\n- **THEN** the application navigates to that result's page and the search dialog closes\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-phase2-core-ui-pages":{"slug":"2026-02-13-phase2-core-ui-pages","proposal":"## Why\r\n\r\nPhase 1 完成了後端 API 和專案骨架，但前端目前只有一個 placeholder 頁面。使用者無法實際瀏覽任何 OpenSpec 內容。Phase 2 需要建立所有核心 UI 頁面，讓 spek 成為一個可操作的唯讀瀏覽器。\r\n\r\n## What Changes\r\n\r\n- 新增 React Router 路由設定，串接所有頁面\r\n- 新增 RepoContext 管理目前選擇的 repo 路徑\r\n- 新增 `useOpenSpec` hooks 封裝所有 API 呼叫\r\n- 新增 SelectRepo 頁面（路徑輸入 + 目錄瀏覽 + 自動偵測 + localStorage 記憶）\r\n- 新增 Layout 共用佈局（Header + Sidebar + 主內容區）\r\n- 新增 Dashboard 總覽頁（統計數據 + active changes + 最近封存）\r\n- 新增 SpecList + SpecDetail 頁面（列表過濾 + 內容顯示 + 關聯 changes）\r\n- 新增 ChangeList + ChangeDetail 頁面（時間線 + Tab 切換 proposal/design/tasks/specs）\r\n- 新增 TaskProgress 進度條元件\r\n- 新增 TabView 頁籤切換元件\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n- `repo-selection`: 選擇 repo 路徑的 UI 流程，包含目錄瀏覽、openspec 偵測、localStorage 持久化\r\n- `spa-routing`: React Router 路由架構與 RepoContext 狀態管理\r\n- `dashboard-view`: 專案總覽 dashboard，顯示統計與 change 進度\r\n- `spec-browsing`: Spec 列表與詳細頁面，含即時過濾與關聯 changes\r\n- `change-browsing`: Change 列表與詳細頁面，含 Tab 切換與任務進度顯示\r\n- `shared-layout`: 共用佈局元件（Header、Sidebar、TaskProgress、TabView）\r\n\r\n### Modified Capabilities\r\n（無既有 spec 需修改，Phase 2 純為前端新增）\r\n\r\n## Impact\r\n\r\n- **新增檔案**：`src/pages/` 6 個頁面、`src/components/` 4+ 個元件、`src/hooks/useOpenSpec.ts`、`src/contexts/RepoContext.tsx`\r\n- **修改檔案**：`src/App.tsx`（加入路由）、`src/main.tsx`（加入 providers）\r\n- **依賴**：使用已安裝的 react-router-dom v7；Markdown 渲染留待 Phase 3\r\n- **後端**：無變更，完全使用 Phase 1 建立的 API\r\n","design":"## Context\r\n\r\nPhase 1 完成了 Express API server 和專案骨架。後端提供完整的 OpenSpec 資料讀取 API，前端目前僅有 placeholder。Phase 2 要建立完整的前端頁面系統，使 spek 成為可操作的瀏覽器。\r\n\r\n現有基礎設施：\r\n- Vite + React 19 + TypeScript + Tailwind CSS v4 已設定完成\r\n- 深色主題色系已定義（`global.css` @theme）\r\n- react-router-dom v7 已安裝但未使用\r\n- API proxy 已設定（`/api` → localhost:3001）\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 建立 6 個核心頁面，串接所有後端 API\r\n- 建立可重用的 Layout、Sidebar、TaskProgress、TabView 元件\r\n- 實作 RepoContext 管理全域 repo 路徑狀態\r\n- 提供流暢的導覽體驗（路由、sidebar、breadcrumb）\r\n\r\n**Non-Goals:**\r\n- Markdown 渲染與 BDD 語法高亮（Phase 3）\r\n- 全文搜尋 UI / SearchDialog（Phase 3）\r\n- 響應式佈局（Phase 4）\r\n- 深色/淺色主題切換（Phase 4）\r\n\r\n## Decisions\r\n\r\n### 1. 路由架構：React Router v7 data router\r\n\r\n使用 `createBrowserRouter` + `RouterProvider`。路由結構：\r\n\r\n```\r\n/                    → SelectRepo（無 Layout）\r\n/dashboard           → Layout > Dashboard\r\n/specs               → Layout > SpecList\r\n/specs/:topic        → Layout > SpecDetail\r\n/changes             → Layout > ChangeList\r\n/changes/:slug       → Layout > ChangeDetail\r\n```\r\n\r\n所有 `/dashboard` 以下路由共用 Layout wrapper，SelectRepo 獨立。`dir` query param 在 RepoContext 中管理，各 hook 自動附加。\r\n\r\n**替代方案**：用 `<BrowserRouter>` + `<Routes>` 聲明式路由 — 但 data router 支援 loader/action，未來擴充性較好。\r\n\r\n### 2. 狀態管理：React Context + URL query param\r\n\r\n- `RepoContext` 提供 `repoPath` 和 `setRepoPath`\r\n- `repoPath` 同步到 URL `?dir=` query param（single source of truth）\r\n- localStorage 記憶最近使用的路徑列表（最多 5 個）\r\n- 未選擇 repo 時，自動導向 `/`\r\n\r\n**替代方案**：Zustand / Redux — 過度工程，Context 足以應付唯讀場景。\r\n\r\n### 3. API hooks：自訂 hooks + fetch\r\n\r\n`src/hooks/useOpenSpec.ts` 提供：\r\n- `useOverview()` → overview 統計\r\n- `useSpecs()` → spec 列表\r\n- `useSpec(topic)` → 單一 spec\r\n- `useChanges()` → change 列表\r\n- `useChange(slug)` → 單一 change\r\n- `useBrowse(path)` → 目錄瀏覽\r\n- `useDetect(path)` → openspec 偵測\r\n\r\n每個 hook 回傳 `{ data, loading, error }`，內部使用 `fetch` + `useEffect`。`dir` 從 RepoContext 取得。\r\n\r\n**替代方案**：TanStack Query — 功能強大但此場景不需要 cache invalidation、mutation 等功能。\r\n\r\n### 4. Markdown 內容顯示：Phase 2 用純文字預覽\r\n\r\nPhase 2 先用 `<pre>` 顯示 raw markdown 內容，Phase 3 再替換為 react-markdown + BDD 高亮。這樣可以先驗證資料流是否正確。\r\n\r\n### 5. Layout 結構\r\n\r\n```\r\n┌─ Header ──────────────────────────────────┐\r\n│  spek logo     [搜尋預留]    repo path     │\r\n├─ Sidebar ─┬─ Main ────────────────────────┤\r\n│ 240px     │  padding 24px                 │\r\n│ fixed     │  max-width 容器               │\r\n│           │                               │\r\n└───────────┴───────────────────────────────┘\r\n```\r\n\r\n- Header 高度 56px，bg-secondary，border-bottom\r\n- Sidebar 寬度 240px，bg-secondary，fixed left\r\n- Main 區域 `ml-60` offset\r\n\r\n### 6. 頁面資料流\r\n\r\n每個頁面在 mount 時透過 hook 取得資料。Loading 狀態顯示 skeleton/spinner，error 狀態顯示錯誤訊息。不做 prefetch。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **無 Markdown 渲染**：Phase 2 顯示原始文字，使用者體驗有限。→ Phase 3 會補上，Phase 2 先確保資料流正確。\r\n- **無搜尋功能**：Header 搜尋按鈕為 placeholder。→ Phase 3 實作 SearchDialog。\r\n- **單一 Context**：如果 repo 路徑頻繁變更可能造成全部重新渲染。→ 實際使用場景中 repo 路徑很少變更，不是問題。\r\n- **無 loading skeleton**：先用簡單 spinner，不做精緻的 skeleton screen。→ 未來可改善但非 Phase 2 優先。\r\n","tasks":{"total":27,"completed":27,"sections":[{"title":"1. 基礎建設：路由與狀態管理","tasks":[{"text":"1.0 建立 `.nvmrc` — 指定 Node 22","completed":true},{"text":"1.1 建立 `src/contexts/RepoContext.tsx` — 提供 repoPath / setRepoPath，從 localStorage 初始化","completed":true},{"text":"1.2 建立 `src/hooks/useOpenSpec.ts` — 封裝所有 API hooks（useOverview, useSpecs, useSpec, useChanges, useChange, useBrowse, useDetect），每個回傳 { data, loading, error }","completed":true},{"text":"1.3 改寫 `src/App.tsx` — 使用 createBrowserRouter 設定路由表，包裹 RepoContext Provider","completed":true},{"text":"1.4 更新 `src/main.tsx` — 渲染 RouterProvider","completed":true}]},{"title":"2. 共用元件","tasks":[{"text":"2.1 建立 `src/components/Layout.tsx` — Header (56px) + Sidebar (240px) + Main 區域，使用 Outlet 渲染子路由","completed":true},{"text":"2.2 建立 `src/components/Sidebar.tsx` — Overview / Specs / Changes 導覽連結，當前路由高亮","completed":true},{"text":"2.3 建立 `src/components/TaskProgress.tsx` — 進度條元件，接收 completed / total props","completed":true},{"text":"2.4 建立 `src/components/TabView.tsx` — 通用 Tab 切換元件，接收 tabs 配置","completed":true}]},{"title":"3. SelectRepo 頁面","tasks":[{"text":"3.1 建立 `src/pages/SelectRepo.tsx` — 路徑輸入框 + 偵測結果顯示 + 開啟按鈕","completed":true},{"text":"3.2 實作目錄瀏覽功能 — 呼叫 browse API 顯示目錄列表，點擊導覽","completed":true},{"text":"3.3 實作最近路徑列表 — 從 localStorage 讀取，點擊快速選擇","completed":true},{"text":"3.4 實作自動導向 — 選擇有效 repo 後設定 RepoContext 並導向 /dashboard","completed":true}]},{"title":"4. Dashboard 頁面","tasks":[{"text":"4.1 建立 `src/pages/Dashboard.tsx` — 呼叫 useOverview 顯示統計卡片（specs 數量、active/archived changes 數量、任務完成率）","completed":true},{"text":"4.2 實作 active changes 列表區塊 — 顯示名稱 + TaskProgress 進度條","completed":true},{"text":"4.3 實作最近封存 changes 區塊 — 最近 10 個 archived changes","completed":true},{"text":"4.4 實作導覽卡片 — 連結到 /specs 和 /changes","completed":true}]},{"title":"5. Spec 頁面","tasks":[{"text":"5.1 建立 `src/pages/SpecList.tsx` — 呼叫 useSpecs 顯示字母排序列表 + 即時過濾輸入","completed":true},{"text":"5.2 建立 `src/pages/SpecDetail.tsx` — 呼叫 useSpec(topic) 顯示標題 + raw markdown 內容 + 關聯 changes 列表","completed":true}]},{"title":"6. Change 頁面","tasks":[{"text":"6.1 建立 `src/pages/ChangeList.tsx` — 呼叫 useChanges 分 Active / Archived 區塊顯示，Archived 按日期排序","completed":true},{"text":"6.2 建立 `src/pages/ChangeDetail.tsx` — 呼叫 useChange(slug)，使用 TabView 切換 Proposal / Design / Tasks / Specs 四個 tab","completed":true},{"text":"6.3 實作 Tasks tab — 顯示 TaskProgress 進度條 + raw tasks 內容","completed":true},{"text":"6.4 實作 Specs tab — 列出 delta specs 並顯示內容","completed":true}]},{"title":"7. 保護性路由與收尾","tasks":[{"text":"7.1 實作未選擇 repo 時重導向 `/` 的邏輯（在 Layout 或路由 loader 中）","completed":true},{"text":"7.2 驗證所有頁面的 loading / error 狀態顯示","completed":true},{"text":"7.3 確認 `npm run type-check` 通過","completed":true},{"text":"7.4 確認 `npm run build` 成功","completed":true}]}]},"specs":[{"topic":"change-browsing","content":"## ADDED Requirements\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Archived changes SHALL be sorted by date (most recent first).\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with name and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by date descending\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs for: Proposal, Design, Tasks, and Specs (delta specs).\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed (raw markdown)\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed (raw markdown)\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n### Requirement: Task progress display in change detail\r\nThe Tasks tab SHALL display a progress bar and statistics (completed/total) derived from the change's task data.\r\n\r\n#### Scenario: Show task progress\r\n- **WHEN** viewing the Tasks tab of a change with tasks\r\n- **THEN** a TaskProgress component shows a visual progress bar with \"X / Y completed\" text\r\n"},{"topic":"dashboard-view","content":"## ADDED Requirements\r\n\r\n### Requirement: Overview statistics display\r\nThe system SHALL display overview statistics from the overview API: total specs count, active changes count, archived changes count, and task completion rate (percentage).\r\n\r\n#### Scenario: Display statistics\r\n- **WHEN** user navigates to the Dashboard page\r\n- **THEN** system displays specs count, active changes count, archived changes count, and overall task completion percentage in stat cards\r\n\r\n### Requirement: Active changes list\r\nThe system SHALL display a list of active changes with their names and task progress indicators.\r\n\r\n#### Scenario: Show active changes with progress\r\n- **WHEN** there are active changes in the repo\r\n- **THEN** each active change is displayed with its name and a TaskProgress bar showing completed/total tasks\r\n\r\n#### Scenario: No active changes\r\n- **WHEN** there are no active changes\r\n- **THEN** system displays an empty state message\r\n\r\n### Requirement: Recent archived changes\r\nThe system SHALL display the most recent 10 archived changes.\r\n\r\n#### Scenario: Show archived changes\r\n- **WHEN** user views the Dashboard\r\n- **THEN** the most recent 10 archived changes are listed with their names and dates\r\n\r\n### Requirement: Navigation cards\r\nThe system SHALL provide navigation cards/links to the Specs list and Changes list pages.\r\n\r\n#### Scenario: Navigate to specs\r\n- **WHEN** user clicks the Specs navigation card\r\n- **THEN** system navigates to `/specs`\r\n\r\n#### Scenario: Navigate to changes\r\n- **WHEN** user clicks the Changes navigation card\r\n- **THEN** system navigates to `/changes`\r\n"},{"topic":"repo-selection","content":"## ADDED Requirements\r\n\r\n### Requirement: Path input with auto-detection\r\nThe system SHALL provide a text input for entering a filesystem path. Upon input, the system SHALL call the detect API to check for an `openspec/` directory and display the detection result.\r\n\r\n#### Scenario: Valid path with openspec directory\r\n- **WHEN** user enters a path that contains an `openspec/` directory\r\n- **THEN** system displays a success indicator and a button to open the repo\r\n\r\n#### Scenario: Valid path without openspec directory\r\n- **WHEN** user enters a path that does not contain an `openspec/` directory\r\n- **THEN** system displays a warning message indicating no openspec directory found\r\n\r\n#### Scenario: Invalid path\r\n- **WHEN** user enters a path that does not exist\r\n- **THEN** system displays an error message\r\n\r\n### Requirement: Directory browsing\r\nThe system SHALL provide a directory browser that calls the browse API, allowing users to navigate the filesystem and select a repo path.\r\n\r\n#### Scenario: Browse directories\r\n- **WHEN** user clicks the browse button\r\n- **THEN** system displays a list of directories at the current path\r\n- **AND** user can click a directory to navigate into it\r\n- **AND** user can select the current directory as the repo path\r\n\r\n### Requirement: Recent paths persistence\r\nThe system SHALL persist the most recent 5 repo paths in localStorage. On page load, previously used paths SHALL be displayed for quick selection.\r\n\r\n#### Scenario: Save path on successful detection\r\n- **WHEN** user successfully opens a repo (path with valid openspec/)\r\n- **THEN** the path is saved to localStorage recent paths list (max 5, most recent first)\r\n\r\n#### Scenario: Display recent paths on load\r\n- **WHEN** user visits the SelectRepo page\r\n- **THEN** previously saved paths are displayed as clickable options\r\n\r\n### Requirement: Auto-navigate to dashboard\r\nThe system SHALL automatically navigate to the Dashboard page after the user selects a valid repo path.\r\n\r\n#### Scenario: Navigate after selection\r\n- **WHEN** user selects a valid repo path (via input, browse, or recent paths)\r\n- **THEN** system navigates to `/dashboard` with the repo path set in RepoContext\r\n"},{"topic":"shared-layout","content":"## ADDED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: the \"spek\" logo/brand text (left), a search button placeholder (center), and the current repo path (right).\r\n\r\n#### Scenario: Display header\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the header displays the spek brand, a disabled search button, and the current repo path from RepoContext\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a fixed sidebar (240px width) with navigation links: Overview (Dashboard), Specs, and Changes. The current route SHALL be visually highlighted.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, and Changes\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Dashboard page\r\n- **THEN** the \"Overview\" link in the sidebar is highlighted with the accent color\r\n\r\n### Requirement: TaskProgress component\r\nThe system SHALL provide a reusable TaskProgress component that displays a progress bar with completed/total count.\r\n\r\n#### Scenario: Display progress\r\n- **WHEN** TaskProgress is rendered with `completed=3` and `total=5`\r\n- **THEN** a progress bar at 60% width is shown with text \"3 / 5\"\r\n\r\n#### Scenario: Zero tasks\r\n- **WHEN** TaskProgress is rendered with `total=0`\r\n- **THEN** component displays \"No tasks\" or an empty state\r\n\r\n### Requirement: TabView component\r\nThe system SHALL provide a reusable TabView component that renders tab headers and switches between tab content panels.\r\n\r\n#### Scenario: Switch tabs\r\n- **WHEN** user clicks a tab header\r\n- **THEN** the corresponding tab content panel is displayed and the previous panel is hidden\r\n\r\n#### Scenario: Default tab\r\n- **WHEN** TabView is first rendered\r\n- **THEN** the first tab is selected by default\r\n"},{"topic":"spa-routing","content":"## ADDED Requirements\r\n\r\n### Requirement: Client-side routing\r\nThe system SHALL use React Router v7 with `createBrowserRouter` to define the following routes:\r\n\r\n| Path | Page | Layout |\r\n|------|------|--------|\r\n| `/` | SelectRepo | None |\r\n| `/dashboard` | Dashboard | Layout |\r\n| `/specs` | SpecList | Layout |\r\n| `/specs/:topic` | SpecDetail | Layout |\r\n| `/changes` | ChangeList | Layout |\r\n| `/changes/:slug` | ChangeDetail | Layout |\r\n\r\n#### Scenario: Route to SelectRepo\r\n- **WHEN** user navigates to `/`\r\n- **THEN** the SelectRepo page is rendered without Layout wrapper\r\n\r\n#### Scenario: Route to Dashboard with Layout\r\n- **WHEN** user navigates to `/dashboard`\r\n- **THEN** the Dashboard page is rendered within the shared Layout (Header + Sidebar + Main)\r\n\r\n### Requirement: RepoContext state management\r\nThe system SHALL provide a React Context (`RepoContext`) that stores the current repo path. All API hooks SHALL read the repo path from this context.\r\n\r\n#### Scenario: Set repo path\r\n- **WHEN** user selects a repo on the SelectRepo page\r\n- **THEN** `RepoContext.repoPath` is updated and available to all child components\r\n\r\n#### Scenario: Redirect when no repo selected\r\n- **WHEN** user navigates to any page other than `/` without a repo path in context\r\n- **THEN** system redirects to `/`\r\n\r\n### Requirement: API hooks\r\nThe system SHALL provide custom React hooks in `useOpenSpec.ts` that encapsulate API calls. Each hook SHALL return `{ data, loading, error }` and automatically include the `dir` query parameter from RepoContext.\r\n\r\n#### Scenario: Hook returns loading state\r\n- **WHEN** an API hook is called and the request is in flight\r\n- **THEN** hook returns `{ data: null, loading: true, error: null }`\r\n\r\n#### Scenario: Hook returns data\r\n- **WHEN** the API request succeeds\r\n- **THEN** hook returns `{ data: <response>, loading: false, error: null }`\r\n\r\n#### Scenario: Hook returns error\r\n- **WHEN** the API request fails\r\n- **THEN** hook returns `{ data: null, loading: false, error: <error message> }`\r\n"},{"topic":"spec-browsing","content":"## ADDED Requirements\r\n\r\n### Requirement: Spec list with filtering\r\nThe system SHALL display all specs sorted alphabetically. A filter input SHALL allow instant client-side filtering by spec topic name.\r\n\r\n#### Scenario: Display all specs\r\n- **WHEN** user navigates to the SpecList page\r\n- **THEN** all spec topics are listed alphabetically\r\n\r\n#### Scenario: Filter specs\r\n- **WHEN** user types in the filter input\r\n- **THEN** the list is filtered in real-time to show only specs whose topic name contains the search text (case-insensitive)\r\n\r\n### Requirement: Spec detail display\r\nThe system SHALL display the full content of a spec when the user navigates to its detail page. The raw markdown content SHALL be shown (react-markdown rendering deferred to Phase 3).\r\n\r\n#### Scenario: View spec content\r\n- **WHEN** user navigates to `/specs/:topic`\r\n- **THEN** system displays the spec topic as title and the full spec.md content\r\n\r\n#### Scenario: Spec not found\r\n- **WHEN** user navigates to a spec topic that does not exist\r\n- **THEN** system displays a \"not found\" message\r\n\r\n### Requirement: Related changes display\r\nThe spec detail page SHALL display a list of changes that affect the spec (from the API's `relatedChanges` field). Each change SHALL be a link to its detail page.\r\n\r\n#### Scenario: Show related changes\r\n- **WHEN** viewing a spec that has related changes\r\n- **THEN** a \"Related Changes\" section lists each change as a clickable link to `/changes/:slug`\r\n\r\n#### Scenario: No related changes\r\n- **WHEN** viewing a spec with no related changes\r\n- **THEN** the \"Related Changes\" section shows an empty state message\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-phase1-skeleton-and-api":{"slug":"2026-02-13-phase1-skeleton-and-api","proposal":"## Why\r\n\r\nspek 目前只有 PRD 和設計文件，尚無任何可執行的程式碼。需要建立專案骨架（Vite + React + Express）與後端 API server，作為所有後續功能的基礎設施。這是第一個實作階段，沒有骨架就無法進行任何 UI 或功能開發。\r\n\r\n## What Changes\r\n\r\n- 初始化 Node.js 專案（package.json、TypeScript 設定、Vite 設定）\r\n- 建立 Express API server，提供本地檔案系統讀取能力\r\n- 實作 OpenSpec 目錄掃描器（scanner），解析 specs、changes 結構\r\n- 實作 tasks.md checkbox 解析器，計算任務完成統計\r\n- 建立所有 REST API endpoints（filesystem 瀏覽、openspec 資料讀取、全文搜尋）\r\n- 設定 Vite dev server proxy，將 `/api/*` 轉發到 Express\r\n- 建立最小化的 React 前端入口，確認前後端串接正常\r\n\r\n## Capabilities\r\n\r\n### New Capabilities\r\n\r\n- `filesystem-api`: 目錄瀏覽與 openspec 目錄偵測 API（`/api/fs/*`）\r\n- `openspec-api`: OpenSpec 資料讀取 API — overview、specs 列表與詳情、changes 列表與詳情（`/api/openspec/*`）\r\n- `search-api`: 跨 specs 與 changes 的全文搜尋 API（`/api/openspec/search`）\r\n- `openspec-scanner`: 目錄掃描與 Markdown/YAML 解析邏輯\r\n- `task-parser`: tasks.md checkbox 解析與統計（section 分組、完成率計算）\r\n\r\n### Modified Capabilities\r\n\r\n（無既有 capabilities）\r\n\r\n## Impact\r\n\r\n- **新增依賴**：express、cors、glob、gray-matter、fuse.js、concurrently、tsx、typescript、@types/*\r\n- **新增目錄**：`server/`（API server）、`src/`（React 前端入口）\r\n- **設定檔**：package.json、tsconfig.json、tsconfig.server.json、vite.config.ts、tailwind 相關設定\r\n- **開發流程**：`npm run dev` 同時啟動 Vite (5173) + Express (3001)\r\n","design":"## Context\r\n\r\nspek 是一個全新專案，目前只有 PRD（`docs/prd.md`）和 OpenSpec 工作流程文件。此 Phase 1 需要從零建立專案骨架，包含前端建置工具、後端 API server、以及核心的 OpenSpec 資料解析邏輯。\r\n\r\nPRD 已定義完整的技術選型與 API 設計，本設計文件聚焦在實作層面的決策。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 建立可運行的 Vite + React + Express 開發環境\r\n- 實作完整的後端 API endpoints，能正確讀取任意 repo 的 OpenSpec 內容\r\n- 前後端能透過 proxy 正常串接\r\n- `npm run dev` 一鍵啟動\r\n\r\n**Non-Goals:**\r\n- UI 頁面的完整實作（Phase 2）\r\n- Markdown 渲染與 BDD 語法高亮（Phase 3）\r\n- 搜尋 UI（Phase 3）；本階段只做搜尋 API\r\n- 響應式佈局、主題切換（Phase 4）\r\n\r\n## Decisions\r\n\r\n### D1: Express 使用 tsx 執行，不預先編譯\r\n\r\n**選擇**：開發時用 `tsx watch server/index.ts` 直接執行 TypeScript\r\n**替代方案**：tsc 編譯後執行 JS、ts-node\r\n**理由**：tsx 基於 esbuild，啟動快、支援 watch mode、不需額外 tsconfig 設定。ts-node 較慢且 ESM 設定複雜。\r\n\r\n### D2: 前後端各自 tsconfig\r\n\r\n**選擇**：`tsconfig.json`（前端，Vite 用）+ `tsconfig.server.json`（後端）\r\n**理由**：前端需要 JSX、DOM types；後端需要 Node types、不同 module 設定。共用 tsconfig 會造成型別衝突。\r\n\r\n### D3: 安全性 — 路徑限制\r\n\r\n**選擇**：所有 openspec routes 限制只讀取 `{dir}/openspec/` 下的 `.md` 和 `.yaml` 檔案，filesystem routes 只回傳目錄列表\r\n**理由**：雖然是本地工具，但仍應避免意外暴露敏感檔案。path traversal 攻擊（`../../etc/passwd`）必須防範。\r\n\r\n### D4: Scanner 使用同步檔案讀取\r\n\r\n**選擇**：scanner 和 tasks parser 使用 `fs.readFileSync` / `fs.readdirSync`\r\n**替代方案**：async fs API\r\n**理由**：OpenSpec 目錄通常很小（數十個檔案），同步讀取程式碼更簡潔。API response 時間不會有感知差異。若未來效能成為問題再改為 async。\r\n\r\n### D5: 搜尋用 server-side 遍歷 + Fuse.js 排序\r\n\r\n**選擇**：搜尋 API 在 server 端讀取所有 `.md` 內容，用 Fuse.js 做模糊匹配與排序\r\n**替代方案**：純 client-side 搜尋（需先載入所有內容）、SQLite FTS\r\n**理由**：Server-side 讀檔避免一次傳輸大量內容到前端。Fuse.js 輕量且支援模糊搜尋，足以應付 OpenSpec 規模的內容量。\r\n\r\n## Risks / Trade-offs\r\n\r\n- **同步 I/O 阻塞**：scanner 使用同步讀取，若 repo 極大（數百個 specs）可能短暫阻塞 → 目前 OpenSpec 規模不大，可接受；未來可改 async\r\n- **無快取機制**：每次 API 呼叫重新讀取檔案系統 → 本地 SSD 讀取延遲極低，Phase 1 不需要快取\r\n- **path traversal 風險**：使用者可傳入惡意路徑 → 所有路徑需經過 `path.resolve` + 檢查是否在允許範圍內\r\n","tasks":{"total":25,"completed":25,"sections":[{"title":"1. 專案初始化","tasks":[{"text":"1.1 建立 package.json（name、scripts、dependencies、devDependencies）","completed":true},{"text":"1.2 建立 tsconfig.json（前端）與 tsconfig.server.json（後端）","completed":true},{"text":"1.3 建立 vite.config.ts（含 proxy 設定將 /api 轉發到 port 3001）","completed":true},{"text":"1.4 設定 Tailwind CSS v4（global.css）","completed":true},{"text":"1.5 建立 React 入口（src/main.tsx、src/App.tsx）— 最小化版本確認前端可運行","completed":true},{"text":"1.6 npm install 驗證所有依賴安裝成功","completed":true}]},{"title":"2. Express API Server 骨架","tasks":[{"text":"2.1 建立 server/index.ts — Express 入口，啟動 port 3001，掛載 routes","completed":true},{"text":"2.2 建立 server/routes/filesystem.ts — `/api/fs/browse` 與 `/api/fs/detect` endpoints","completed":true},{"text":"2.3 建立 server/routes/openspec.ts — 掛載所有 `/api/openspec/*` routes（先回傳空殼）","completed":true}]},{"title":"3. OpenSpec Scanner","tasks":[{"text":"3.1 建立 server/lib/scanner.ts — 掃描 openspec/ 目錄結構（specs、active changes、archived changes）","completed":true},{"text":"3.2 實作 readSpec() — 讀取單一 spec 的 Markdown 內容","completed":true},{"text":"3.3 實作 readChange() — 讀取 change 的所有 artifacts（proposal、design、tasks、delta specs）","completed":true},{"text":"3.4 實作 findRelatedChanges() — 找出與某 spec topic 相關的 changes","completed":true}]},{"title":"4. Task Parser","tasks":[{"text":"4.1 建立 server/lib/tasks.ts — 解析 tasks.md checkbox 語法","completed":true},{"text":"4.2 實作 section 分組邏輯（## heading 分組）","completed":true},{"text":"4.3 實作統計計算（total、completed）","completed":true}]},{"title":"5. OpenSpec API Endpoints","tasks":[{"text":"5.1 實作 GET /api/openspec/overview — 回傳 specsCount、changesCount、taskStats","completed":true},{"text":"5.2 實作 GET /api/openspec/specs — 回傳 spec topics 列表","completed":true},{"text":"5.3 實作 GET /api/openspec/specs/:topic — 回傳單一 spec 內容 + relatedChanges","completed":true},{"text":"5.4 實作 GET /api/openspec/changes — 回傳 active/archived changes 列表","completed":true},{"text":"5.5 實作 GET /api/openspec/changes/:slug — 回傳單一 change 完整內容","completed":true},{"text":"5.6 實作 GET /api/openspec/search — 全文搜尋（Fuse.js）","completed":true}]},{"title":"6. 驗證","tasks":[{"text":"6.1 npm run dev 啟動成功（Vite + Express 同時運行）","completed":true},{"text":"6.2 前端頁面可開啟 http://localhost:5173","completed":true},{"text":"6.3 API endpoints 可透過 curl 或瀏覽器測試回傳正確資料","completed":true}]}]},"specs":[{"topic":"filesystem-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Browse directories\r\nThe system SHALL provide an API endpoint `GET /api/fs/browse` that returns directory contents for a given path, allowing users to navigate the filesystem to find repos.\r\n\r\n#### Scenario: Browse valid directory\r\n- **WHEN** client sends `GET /api/fs/browse?path=/home/user/projects`\r\n- **THEN** system returns a JSON array of entries, each with `name`, `type` (\"file\" or \"directory\"), and `path`\r\n- **AND** entries are sorted with directories first, then alphabetically\r\n\r\n#### Scenario: Browse without path parameter\r\n- **WHEN** client sends `GET /api/fs/browse` without a `path` parameter\r\n- **THEN** system returns the contents of the user's home directory\r\n\r\n#### Scenario: Browse non-existent directory\r\n- **WHEN** client sends `GET /api/fs/browse?path=/nonexistent`\r\n- **THEN** system returns HTTP 400 with an error message\r\n\r\n### Requirement: Detect OpenSpec directory\r\nThe system SHALL provide an API endpoint `GET /api/fs/detect` that checks whether a given path contains an `openspec/` directory with a valid `config.yaml`.\r\n\r\n#### Scenario: Path contains valid OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"<schema-value>\" }`\r\n\r\n#### Scenario: Path does not contain OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/empty-repo`\r\n- **AND** no `openspec/` directory exists at that path\r\n- **THEN** system returns `{ \"hasOpenSpec\": false }`\r\n\r\n### Requirement: Path traversal protection\r\nThe system SHALL reject any path that attempts directory traversal outside the specified root.\r\n\r\n#### Scenario: Path traversal attempt\r\n- **WHEN** client sends `GET /api/fs/browse?path=/home/user/../../../etc`\r\n- **THEN** system resolves the path and returns the directory contents of the resolved absolute path without exposing system files outside normal filesystem permissions\r\n"},{"topic":"openspec-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Overview endpoint\r\nThe system SHALL provide `GET /api/openspec/overview` that returns aggregate statistics for an OpenSpec repository.\r\n\r\n#### Scenario: Get overview of repo with specs and changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `specsCount`, `changesCount` (with `active` and `archived` breakdown), and `taskStats` (aggregate `total` and `completed` across all active changes)\r\n\r\n#### Scenario: Get overview of repo with no specs\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** the repo has no `openspec/specs/` directory\r\n- **THEN** system returns `specsCount: 0` with changes still counted correctly\r\n\r\n### Requirement: List specs\r\nThe system SHALL provide `GET /api/openspec/specs` that returns all spec topics.\r\n\r\n#### Scenario: List all specs\r\n- **WHEN** client sends `GET /api/openspec/specs?dir=/path/to/repo`\r\n- **THEN** system returns a JSON array of spec topics, each with `topic` name and `path`\r\n- **AND** topics are sorted alphabetically\r\n\r\n#### Scenario: No specs directory\r\n- **WHEN** client sends `GET /api/openspec/specs?dir=/path/to/repo`\r\n- **AND** `openspec/specs/` does not exist\r\n- **THEN** system returns an empty array\r\n\r\n### Requirement: Get single spec\r\nThe system SHALL provide `GET /api/openspec/specs/:topic` that returns the full content of a spec.\r\n\r\n#### Scenario: Get existing spec\r\n- **WHEN** client sends `GET /api/openspec/specs/simulation-engine?dir=/path/to/repo`\r\n- **AND** `openspec/specs/simulation-engine/spec.md` exists\r\n- **THEN** system returns JSON with `topic`, `content` (raw Markdown), and `relatedChanges` (list of changes that have delta specs for this topic)\r\n\r\n#### Scenario: Get non-existent spec\r\n- **WHEN** client sends `GET /api/openspec/specs/nonexistent?dir=/path/to/repo`\r\n- **THEN** system returns HTTP 404\r\n\r\n### Requirement: List changes\r\nThe system SHALL provide `GET /api/openspec/changes` that returns all changes grouped by status.\r\n\r\n#### Scenario: List changes with active and archived\r\n- **WHEN** client sends `GET /api/openspec/changes?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `active` array and `archived` array\r\n- **AND** each change includes `slug`, `date` (parsed from slug prefix), `description` (parsed from slug), `hasProposal`, `hasDesign`, `hasTasks`, `hasSpecs`, and `taskStats`\r\n- **AND** changes are sorted by date descending (newest first)\r\n\r\n### Requirement: Get single change\r\nThe system SHALL provide `GET /api/openspec/changes/:slug` that returns full change content.\r\n\r\n#### Scenario: Get existing change with all artifacts\r\n- **WHEN** client sends `GET /api/openspec/changes/2026-02-10-my-feature?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `slug`, `proposal` (Markdown content or null), `design` (Markdown content or null), `tasks` (parsed task structure or null), `specs` (array of delta spec contents), and `metadata` (from `.openspec.yaml` if present)\r\n\r\n#### Scenario: Get non-existent change\r\n- **WHEN** client sends `GET /api/openspec/changes/nonexistent?dir=/path/to/repo`\r\n- **THEN** system returns HTTP 404\r\n\r\n### Requirement: Missing dir parameter\r\nThe system SHALL require the `dir` query parameter on all openspec endpoints.\r\n\r\n#### Scenario: Request without dir parameter\r\n- **WHEN** client sends any `/api/openspec/*` request without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n"},{"topic":"openspec-scanner","content":"## ADDED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL read an OpenSpec directory and return its complete structure including specs, active changes, and archived changes.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n### Requirement: Parse change artifacts\r\nThe scanner SHALL read individual change directories and extract available artifacts.\r\n\r\n#### Scenario: Change with all artifacts\r\n- **WHEN** scanner reads a change directory containing proposal.md, design.md, tasks.md, and specs/\r\n- **THEN** it returns the raw Markdown content for each artifact and a list of delta spec files\r\n\r\n#### Scenario: Change with partial artifacts\r\n- **WHEN** scanner reads a change directory containing only proposal.md\r\n- **THEN** it returns proposal content and null for missing artifacts\r\n\r\n### Requirement: Read spec content\r\nThe scanner SHALL read spec files and return their Markdown content.\r\n\r\n#### Scenario: Read existing spec\r\n- **WHEN** scanner reads `openspec/specs/{topic}/spec.md`\r\n- **THEN** it returns the raw Markdown content of the spec file\r\n\r\n### Requirement: Detect related changes for a spec\r\nThe scanner SHALL identify which changes contain delta specs for a given spec topic.\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** scanner checks for changes related to spec topic \"simulation-engine\"\r\n- **THEN** it returns all change slugs that have a `specs/simulation-engine/spec.md` delta file\r\n"},{"topic":"search-api","content":"## ADDED Requirements\r\n\r\n### Requirement: Full-text search endpoint\r\nThe system SHALL provide `GET /api/openspec/search` that searches across all specs and changes content.\r\n\r\n#### Scenario: Search with matching results\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo&q=effectiveCurrent`\r\n- **THEN** system returns a JSON array of results, each with `type` (\"spec\" or \"change\"), `name` (topic or slug), `matches` (array of matching text with context), and `score`\r\n- **AND** results are sorted by relevance score (best match first)\r\n\r\n#### Scenario: Search with no results\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo&q=xyznonexistent`\r\n- **THEN** system returns an empty array\r\n\r\n#### Scenario: Search without query parameter\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo` without `q` parameter\r\n- **THEN** system returns HTTP 400 with error message\r\n\r\n### Requirement: Search context preview\r\nEach search result SHALL include surrounding context to help users identify the relevant content.\r\n\r\n#### Scenario: Result includes context\r\n- **WHEN** a search matches text within a Markdown file\r\n- **THEN** the match includes up to 100 characters before and after the matched text as context preview\r\n"},{"topic":"task-parser","content":"## ADDED Requirements\r\n\r\n### Requirement: Parse task checkboxes\r\nThe task parser SHALL read a tasks.md file and extract checkbox items with their completion status.\r\n\r\n#### Scenario: Parse file with mixed checkboxes\r\n- **WHEN** parser reads a tasks.md containing `- [x] Done task` and `- [ ] Pending task`\r\n- **THEN** it returns each task with `text` and `completed` (boolean) fields\r\n\r\n### Requirement: Group tasks by section\r\nThe task parser SHALL group tasks under their `##` heading sections.\r\n\r\n#### Scenario: Tasks under multiple sections\r\n- **WHEN** parser reads a tasks.md with `## Phase 1` followed by tasks and `## Phase 2` followed by tasks\r\n- **THEN** it returns sections array, each with `title` and `tasks` array\r\n\r\n#### Scenario: Tasks without section headings\r\n- **WHEN** parser reads a tasks.md where tasks appear before any `##` heading\r\n- **THEN** those tasks are grouped under a default section with empty title\r\n\r\n### Requirement: Calculate task statistics\r\nThe task parser SHALL compute aggregate statistics from parsed tasks.\r\n\r\n#### Scenario: Calculate completion stats\r\n- **WHEN** parser processes a tasks.md with 10 total checkboxes where 7 are checked\r\n- **THEN** it returns `{ total: 10, completed: 7 }` along with the sections breakdown\r\n\r\n#### Scenario: Empty tasks file\r\n- **WHEN** parser processes an empty tasks.md or one with no checkboxes\r\n- **THEN** it returns `{ total: 0, completed: 0, sections: [] }`\r\n"}],"metadata":{"schema":"spec-driven","created":"2026-02-13"}},"2026-02-13-initial-implementation":{"slug":"2026-02-13-initial-implementation","proposal":"# spek — OpenSpec Viewer PRD\r\n\r\n## Context\r\n\r\nOpenSpec 是一個 spec-driven 的工作流程管理結構，在實際專案中會累積大量的 specs、changes（含 proposal/design/tasks）。目前這些內容只能透過檔案系統或文字編輯器閱讀，缺乏結構化瀏覽、搜尋、狀態總覽能力。\r\n\r\n**目標**：建立一個輕量級的本地 Web 應用程式 `spek`，使用者 clone 後啟動，選擇包含 `openspec/` 的 repo 路徑即可瀏覽內容。\r\n\r\n---\r\n\r\n## 1. 產品定位\r\n\r\n- **專案名稱**：`spek`\r\n- **定位**：OpenSpec 內容的本地唯讀檢視器\r\n- **使用流程**：`git clone` → `npm install` → `npm run dev` → 瀏覽器開啟 → 選擇 repo 路徑 → 瀏覽內容\r\n\r\n## 2. 非目標\r\n\r\n- 不做內容編輯功能（唯讀）\r\n- 不做使用者認證或權限管理\r\n- 不做 OpenSpec 工作流程管理（建立/封存 change 等操作）\r\n- 不做雲端部署版本（純本地工具）\r\n\r\n---\r\n\r\n## 3. OpenSpec 資料結構\r\n\r\n```\r\n{repo}/openspec/\r\n├── config.yaml                    # schema: spec-driven\r\n├── specs/                         # Spec 主題目錄\r\n│   └── {topic}/spec.md           # BDD 格式規格 (WHEN/THEN/AND)\r\n└── changes/\r\n    ├── archive/                   # 已封存變更\r\n    │   └── {YYYY-MM-DD-desc}/\r\n    │       ├── .openspec.yaml    # schema + created date\r\n    │       ├── proposal.md       # Why / What Changes / Capabilities / Impact\r\n    │       ├── design.md         # Context / Goals / Decisions / Risks\r\n    │       ├── tasks.md          # Checkbox 任務清單\r\n    │       └── specs/            # 該 change 的 delta specs\r\n    └── {active-change}/          # 進行中變更（同結構）\r\n```\r\n\r\n**內容特徵**：\r\n- 繁中+英文混排\r\n- BDD 語法：WHEN/THEN/AND/MUST\r\n- 任務用 `- [x]` / `- [ ]` checkbox\r\n- Change 命名：`YYYY-MM-DD-description`\r\n\r\n---\r\n\r\n## 4. 技術架構\r\n\r\n### 4.1 技術選型\r\n\r\n| 層面 | 選擇 | 理由 |\r\n|------|------|------|\r\n| **Backend** | Node.js + Express | 讀取本地檔案系統，提供 REST API |\r\n| **Frontend** | React + Vite | 使用者的 Rewire 專案同技術棧，熟悉且輕量 |\r\n| **Markdown 渲染** | react-markdown + remark-gfm | 支援 GFM checkbox、表格等 |\r\n| **搜尋** | Fuse.js (client-side) | 輕量模糊搜尋，無需額外服務 |\r\n| **樣式** | Tailwind CSS v4 | 快速開發，深色主題支援 |\r\n| **語言** | TypeScript | 前後端一致的型別安全 |\r\n\r\n### 4.2 專案結構\r\n\r\n```\r\nspek/\r\n├── package.json\r\n├── tsconfig.json\r\n├── vite.config.ts\r\n├── server/\r\n│   ├── index.ts               # Express 入口，啟動 API server\r\n│   ├── routes/\r\n│   │   ├── openspec.ts        # /api/openspec/* — 讀取 OpenSpec 資料\r\n│   │   └── filesystem.ts      # /api/fs/* — 目錄瀏覽（選擇 repo 用）\r\n│   └── lib/\r\n│       ├── scanner.ts         # OpenSpec 目錄掃描 + 解析\r\n│       └── tasks.ts           # tasks.md checkbox 解析 + 統計\r\n├── src/\r\n│   ├── main.tsx               # React 入口\r\n│   ├── App.tsx                # 路由設定\r\n│   ├── pages/\r\n│   │   ├── SelectRepo.tsx     # 首頁：選擇/輸入 repo 路徑\r\n│   │   ├── Dashboard.tsx      # 專案總覽 dashboard\r\n│   │   ├── SpecList.tsx       # Specs 列表\r\n│   │   ├── SpecDetail.tsx     # Spec 詳細頁面\r\n│   │   ├── ChangeList.tsx     # Changes 時間線\r\n│   │   └── ChangeDetail.tsx   # Change 詳細（tab: proposal/design/tasks/specs）\r\n│   ├── components/\r\n│   │   ├── Layout.tsx         # 共用佈局（sidebar + header）\r\n│   │   ├── Sidebar.tsx        # 側邊導覽\r\n│   │   ├── MarkdownRenderer.tsx  # Markdown 渲染 + BDD 高亮\r\n│   │   ├── TaskProgress.tsx   # 任務進度條\r\n│   │   ├── SearchDialog.tsx   # 搜尋對話框 (Cmd+K)\r\n│   │   └── TabView.tsx        # Tab 切換元件\r\n│   ├── hooks/\r\n│   │   └── useOpenSpec.ts     # API 呼叫 hooks\r\n│   └── styles/\r\n│       └── global.css         # Tailwind + 自訂樣式\r\n└── public/\r\n    └── favicon.svg\r\n```\r\n\r\n### 4.3 API 設計\r\n\r\n```\r\nGET  /api/fs/browse?path=...        # 瀏覽目錄（選擇 repo 用）\r\nGET  /api/fs/detect?path=...        # 偵測指定路徑是否有 openspec/\r\n\r\nGET  /api/openspec/overview?dir=... # 總覽（specs數量、changes數量、任務統計）\r\nGET  /api/openspec/specs?dir=...    # Spec 主題列表\r\nGET  /api/openspec/specs/:topic?dir=...  # 單一 spec 內容 + 關聯 changes\r\nGET  /api/openspec/changes?dir=...  # Changes 列表（含任務統計）\r\nGET  /api/openspec/changes/:slug?dir=... # 單一 change 完整內容\r\nGET  /api/openspec/search?dir=...&q=...  # 全文搜尋\r\n```\r\n\r\n### 4.4 啟動方式\r\n\r\n```bash\r\n# Clone 後啟動\r\ngit clone <spek-repo>\r\ncd spek\r\nnpm install\r\nnpm run dev        # 啟動 Vite dev server + Express API server (concurrently)\r\n\r\n# 瀏覽器開啟 http://localhost:5173\r\n# 在 UI 中輸入或瀏覽選擇 repo 路徑\r\n```\r\n\r\n---\r\n\r\n## 5. 功能需求\r\n\r\n### FR-1：選擇 Repo\r\n\r\n- 首頁顯示路徑輸入框\r\n- 輸入路徑後自動偵測是否有 `openspec/` 目錄\r\n- 記住最近使用的路徑（localStorage）\r\n- 偵測成功後自動跳轉到 Dashboard\r\n\r\n### FR-2：Dashboard 總覽\r\n\r\n- Specs 數量、Changes 數量（active/archived）、任務完成率\r\n- Active changes 列表（含進度條）\r\n- 最近封存的 changes（最近 10 個）\r\n\r\n### FR-3：Specs 瀏覽\r\n\r\n- Spec 主題列表（字母排序 + 即時過濾）\r\n- Spec 詳細頁：Markdown 渲染 + BDD 關鍵字高亮\r\n- 關聯 changes 列表（哪些 changes 影響了此 spec）\r\n\r\n### FR-4：Changes 瀏覽\r\n\r\n- 按日期分組的時間線列表\r\n- 區分 active / archived\r\n- Change 詳細頁：Tab 切換（Proposal / Design / Tasks / Specs）\r\n- Tasks tab 顯示 checkbox 狀態 + 進度統計\r\n\r\n### FR-5：全文搜尋\r\n\r\n- `Cmd+K` 快捷鍵開啟搜尋對話框\r\n- 跨 specs + changes 搜尋\r\n- 結果分類顯示，附上下文預覽\r\n- 點擊跳轉到對應頁面\r\n\r\n### FR-6：BDD 語法高亮\r\n\r\n- `WHEN`/`GIVEN`：藍色標籤\r\n- `THEN`：綠色標籤\r\n- `AND`：灰色標籤\r\n- `MUST`/`SHALL`：紅色粗體\r\n- `ADDED`/`MODIFIED`：橘/藍 badge\r\n\r\n---\r\n\r\n## 6. UI 設計\r\n\r\n### 佈局\r\n\r\n```\r\n┌──────────────────────────────────────────────┐\r\n│  spek        [搜尋 ⌘K]        [/path/to/repo]│\r\n├─────────┬────────────────────────────────────┤\r\n│ Sidebar │  主要內容區                         │\r\n│         │                                    │\r\n│ Overview│  [根據路由渲染對應頁面]              │\r\n│ Specs   │                                    │\r\n│  ├ ...  │                                    │\r\n│ Changes │                                    │\r\n│  ├ Act  │                                    │\r\n│  └ Arc  │                                    │\r\n└─────────┴────────────────────────────────────┘\r\n```\r\n\r\n### 視覺風格\r\n\r\n- 深色主題為主（背景 #0a0c0f 系列）\r\n- Accent：琥珀色 #f59e0b\r\n- 中文行高 1.75、段落間距 1.5rem\r\n- 程式碼區塊 JetBrains Mono\r\n\r\n---\r\n\r\n## 7. 實作計畫\r\n\r\n### Phase 1：專案骨架 + API Server\r\n- 初始化 Vite + React + TypeScript 專案\r\n- Express API server 設定（concurrently 同時啟動）\r\n- OpenSpec 目錄掃描器（scanner.ts）\r\n- Tasks 解析器（tasks.ts）\r\n- 基礎 API endpoints（overview、specs、changes）\r\n\r\n### Phase 2：核心 UI 頁面\r\n- 選擇 Repo 頁面（路徑輸入 + 偵測）\r\n- 共用 Layout（sidebar + header）\r\n- Dashboard 總覽頁\r\n- Specs 列表 + 詳細頁\r\n- Changes 列表 + 詳細頁（含 Tab 切換）\r\n\r\n### Phase 3：Markdown 渲染 + 搜尋\r\n- MarkdownRenderer 元件 + BDD 語法高亮\r\n- 全文搜尋 API + SearchDialog UI\r\n- Cmd+K 快捷鍵\r\n\r\n### Phase 4：完善\r\n- 響應式佈局\r\n- 深色/淺色主題切換\r\n- 最近使用路徑記憶\r\n- Spec 演進歷史追蹤\r\n\r\n---\r\n\r\n## 8. 驗證方式\r\n\r\n1. `npm run dev` 啟動後，瀏覽器開啟 localhost\r\n2. 輸入 `/home/kewang/git/rewire` 路徑\r\n3. 確認 Dashboard 顯示正確的 specs/changes 數量\r\n4. 瀏覽幾個 spec（如 simulation-engine）確認 Markdown 渲染正確\r\n5. 瀏覽幾個 change（如 2026-02-10-main-breaker-simulation）確認四個 tab 都正常\r\n6. 搜尋「effectiveCurrent」確認跨文件搜尋正常\r\n7. 確認 BDD 關鍵字（WHEN/THEN/MUST）有視覺高亮\r\n","design":"## Context\r\n\r\nspek 是一個本地唯讀 Web 應用，讓使用者瀏覽任何包含 `openspec/` 目錄的 repo。目前 OpenSpec 內容只能透過檔案系統或文字編輯器閱讀，缺乏結構化瀏覽、搜尋與狀態總覽能力。\r\n\r\n本設計涵蓋 spek 從零開始的完整技術架構，包含 Express API server（讀取本地檔案系統）與 React SPA（渲染 UI）。\r\n\r\n## Goals / Non-Goals\r\n\r\n**Goals:**\r\n- 建立可獨立運行的本地 Web 應用，`npm run dev` 即可啟動\r\n- Express backend 提供 REST API 讀取任意路徑下的 OpenSpec 結構\r\n- React frontend 提供 Dashboard、Specs 瀏覽、Changes 瀏覽、全文搜尋\r\n- 支援 BDD 語法高亮（WHEN/THEN/AND/MUST 等關鍵字）\r\n- 支援 tasks.md checkbox 解析與進度統計\r\n- 深色主題 UI，琥珀色 accent\r\n\r\n**Non-Goals:**\r\n- 不做內容編輯（純唯讀）\r\n- 不做使用者認證或權限管理\r\n- 不做 OpenSpec 工作流程管理（建立/封存 change）\r\n- 不做雲端部署版本\r\n- 不做 SSR（純 CSR SPA 即可）\r\n\r\n## Decisions\r\n\r\n### D1: Monorepo 單一 package，前後端共存\r\n\r\n前端（Vite + React）與後端（Express）放在同一個 package 中。開發時用 `concurrently` 同時啟動 Vite dev server（port 5173）與 Express API server（port 3001）。Vite 設定 proxy 將 `/api/*` 轉發到 Express。\r\n\r\n**理由**：專案規模小，分成兩個 package 增加複雜度但沒有實質好處。單一 package 簡化安裝與啟動流程。\r\n\r\n**替代方案**：monorepo workspace — 對此規模過度工程化。\r\n\r\n### D2: Express 讀取檔案系統，前端透過 `dir` query param 指定 repo 路徑\r\n\r\n所有 `/api/openspec/*` endpoints 接受 `dir` query parameter，指定要讀取的 repo 根目錄。Express 在該路徑下尋找 `openspec/` 目錄並讀取內容。\r\n\r\n**理由**：讓使用者可以在不重啟 server 的情況下切換不同 repo。路徑驗證在 server 端進行（檢查 `openspec/` 目錄存在）。\r\n\r\n**安全考量**：僅允許讀取操作，不暴露任意檔案內容（僅讀取 `openspec/` 子目錄內的 `.md`、`.yaml` 檔案）。\r\n\r\n### D3: 前端路由結構\r\n\r\n使用 React Router v7，路由設計：\r\n\r\n- `/` — SelectRepo 頁面（輸入/選擇 repo 路徑）\r\n- `/dashboard` — Dashboard 總覽\r\n- `/specs` — Specs 列表\r\n- `/specs/:topic` — Spec 詳細頁\r\n- `/changes` — Changes 列表\r\n- `/changes/:slug` — Change 詳細頁（含 tab 切換）\r\n\r\nrepo 路徑存在 React context 中（`RepoContext`），各頁面從 context 讀取後作為 `dir` 參數傳給 API。\r\n\r\n### D4: Markdown 渲染 + BDD 語法高亮\r\n\r\n使用 `react-markdown` + `remark-gfm` 渲染 Markdown。BDD 語法高亮透過自訂 remark plugin 或 post-processing：\r\n\r\n- 在渲染後的文字節點中偵測 BDD 關鍵字（WHEN、GIVEN、THEN、AND、MUST、SHALL、ADDED、MODIFIED）\r\n- 將關鍵字包裝成帶有對應 CSS class 的 `<span>` 標籤\r\n- 各關鍵字顏色依 PRD 定義（藍/綠/灰/紅/橘）\r\n\r\n### D5: 搜尋架構 — Server-side 全文搜尋 + Client-side Fuse.js\r\n\r\n搜尋 API（`/api/openspec/search`）在 server 端遍歷所有 `.md` 檔案進行全文比對，回傳匹配結果（含檔案路徑、匹配行、上下文）。\r\n\r\n前端 SearchDialog 使用 Fuse.js 對搜尋結果做進一步的模糊排序與過濾。`Cmd+K` 快捷鍵開啟對話框。\r\n\r\n**理由**：Server 端讀取檔案內容進行搜尋最直接。Fuse.js 在前端做結果排序提供更好的 UX。\r\n\r\n### D6: Tailwind CSS v4 + 深色主題\r\n\r\n使用 Tailwind CSS v4（`@tailwindcss/vite` plugin）。以深色主題為預設：\r\n\r\n- 背景色系：`#0a0c0f` / `#0f1318` / `#1a1f2e`\r\n- Accent：琥珀色 `#f59e0b`\r\n- 文字：`#e2e8f0`（主文字）、`#94a3b8`（次要文字）\r\n- 透過 CSS custom properties 定義色彩變數，為未來淺色主題切換預留\r\n\r\n### D7: tasks.md 解析策略\r\n\r\nServer 端解析 `tasks.md` 的 checkbox 格式：\r\n- `- [x]` 計為已完成\r\n- `- [ ]` 計為未完成\r\n- 支援巢狀結構（section headers `##` 分組）\r\n- 回傳統計：`{ total, completed, sections: [{ title, total, completed }] }`\r\n\r\n## Risks / Trade-offs\r\n\r\n**[大型 repo 效能]** → OpenSpec 目錄通常不會太大（數十到數百個檔案），全文搜尋遍歷所有 .md 檔案在本地應可接受。若未來需要優化，可加入 file content cache。\r\n\r\n**[路徑安全]** → `dir` 參數允許讀取任意本地路徑。Mitigation：僅讀取 `openspec/` 子目錄內容，不暴露其他檔案。Express 路由中驗證路徑合法性。\r\n\r\n**[前後端 port 衝突]** → 開發時使用 5173（Vite）+ 3001（Express）兩個 port。Mitigation：Vite proxy 設定統一入口，使用者只需存取 5173。\r\n\r\n**[TypeScript 設定複雜度]** → 前端（ESNext + JSX）與後端（Node.js）需要不同 tsconfig。Mitigation：使用 tsconfig references，server/ 有獨立的 tsconfig.server.json。\r\n","tasks":{"total":10,"completed":10,"sections":[{"title":"1. 撰寫 PRD","tasks":[{"text":"1.1 定義產品定位與非目標","completed":true},{"text":"1.2 描述 OpenSpec 資料結構","completed":true},{"text":"1.3 選定技術架構（Vite + React + Express + Tailwind v4 + TypeScript）","completed":true},{"text":"1.4 設計專案目錄結構","completed":true},{"text":"1.5 定義 REST API endpoints","completed":true},{"text":"1.6 撰寫六項功能需求（FR-1 ~ FR-6）","completed":true},{"text":"1.7 設計 UI 佈局與視覺風格","completed":true},{"text":"1.8 規劃四階段實作計畫","completed":true},{"text":"1.9 定義驗證方式","completed":true}]},{"title":"2. 撰寫技術設計","tasks":[{"text":"2.1 撰寫 design.md（架構決策、風險評估）","completed":true}]}]},"specs":[],"metadata":{}}},"specVersions":{"api-adapter":{"2026-02-17-spec-diff-viewer":"## MODIFIED Requirements\r\n\r\n### Requirement: ApiAdapter interface\r\nThe frontend SHALL define an `ApiAdapter` interface that abstracts all API communication, allowing different implementations for web and VS Code environments. The interface SHALL include a `getSpecAtChange(topic: string, slug: string): Promise<{ content: string }>` method for fetching spec content at a specific change version.\r\n\r\n#### Scenario: Adapter interface contract\r\n- **WHEN** a component needs to fetch OpenSpec data\r\n- **THEN** it calls methods on the `ApiAdapter` interface (e.g., `getOverview()`, `getSpecs()`, `getChange(slug)`, `getSpecAtChange(topic, slug)`) which return Promises of typed data\r\n\r\n### Requirement: FetchAdapter for web\r\nThe web version SHALL use a `FetchAdapter` that calls the Express REST API via HTTP fetch.\r\n\r\n#### Scenario: Fetch adapter API call\r\n- **WHEN** `FetchAdapter.getOverview()` is called with repoPath set\r\n- **THEN** it performs `fetch('/api/openspec/overview?dir=...')` and returns the parsed JSON response\r\n\r\n#### Scenario: Fetch adapter error handling\r\n- **WHEN** a fetch request returns a non-OK HTTP status\r\n- **THEN** the adapter throws an error with the HTTP status code\r\n\r\n#### Scenario: Fetch adapter getSpecAtChange\r\n- **WHEN** `FetchAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it performs `fetch('/api/openspec/specs/user-auth/at/2026-01-15-add-oauth?dir=...')` and returns the parsed JSON response\r\n\r\n### Requirement: MessageAdapter for VS Code Webview\r\nThe VS Code version SHALL use a `MessageAdapter` that communicates with the extension host via `postMessage`.\r\n\r\n#### Scenario: Message adapter API call\r\n- **WHEN** `MessageAdapter.getOverview()` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getOverview' }` via `postMessage` and returns a Promise that resolves when the matching response arrives\r\n\r\n#### Scenario: Message adapter timeout\r\n- **WHEN** a message request does not receive a response within 10 seconds\r\n- **THEN** the adapter rejects the Promise with a timeout error\r\n\r\n#### Scenario: Message adapter error response\r\n- **WHEN** the extension host responds with `{ type: 'response', id, error: '...' }`\r\n- **THEN** the adapter rejects the Promise with the error message\r\n\r\n#### Scenario: Message adapter getSpecAtChange\r\n- **WHEN** `MessageAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getSpecAtChange', params: { topic: 'user-auth', slug: '2026-01-15-add-oauth' } }` via `postMessage`\r\n\r\n### Requirement: StaticAdapter for demo\r\nThe demo version SHALL use a `StaticAdapter` that reads all data from a pre-embedded JSON object (`window.__DEMO_DATA__`) and implements the `ApiAdapter` interface. The `DemoData` structure SHALL include a `specVersions` field mapping topic to slug to content.\r\n\r\n#### Scenario: Serve pre-embedded data\r\n- **WHEN** any API method is called (getOverview, getSpecs, getSpec, getChanges, getChange)\r\n- **THEN** it returns the corresponding data from the embedded JSON via `Promise.resolve()`\r\n\r\n#### Scenario: Client-side search\r\n- **WHEN** `search(query)` is called\r\n- **THEN** it performs case-insensitive substring matching across all spec topic names, spec content, change slugs, and change proposal/design content, returning matching results with context snippets\r\n\r\n#### Scenario: Search matches spec topic names\r\n- **WHEN** `search(\"dashboard\")` is called and a spec with topic `dashboard-view` exists\r\n- **THEN** the result includes `dashboard-view` as a match\r\n\r\n#### Scenario: No-op for inapplicable methods\r\n- **WHEN** `browse()`, `detect()`, or `resync()` is called\r\n- **THEN** it returns sensible defaults without error (empty browse, `hasOpenSpec: true`, void)\r\n\r\n#### Scenario: StaticAdapter getSpecAtChange\r\n- **WHEN** `StaticAdapter.getSpecAtChange(\"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **THEN** it reads from `window.__DEMO_DATA__.specVersions[\"user-auth\"][\"2026-01-15-add-oauth\"]` and returns `{ content: \"...\" }`\r\n\r\n#### Scenario: StaticAdapter getSpecAtChange not found\r\n- **WHEN** `StaticAdapter.getSpecAtChange(\"user-auth\", \"nonexistent\")` is called\r\n- **AND** no matching version exists in the embedded data\r\n- **THEN** it rejects with an error\r\n","2026-02-16-ui-design-polish-p0-p1":"## ADDED Requirements\r\n\r\n### Requirement: StaticAdapter for demo\r\nThe demo version SHALL use a `StaticAdapter` that reads all data from a pre-embedded JSON object (`window.__DEMO_DATA__`) and implements the `ApiAdapter` interface.\r\n\r\n#### Scenario: Serve pre-embedded data\r\n- **WHEN** any API method is called (getOverview, getSpecs, getSpec, getChanges, getChange)\r\n- **THEN** it returns the corresponding data from the embedded JSON via `Promise.resolve()`\r\n\r\n#### Scenario: Client-side search\r\n- **WHEN** `search(query)` is called\r\n- **THEN** it performs case-insensitive substring matching across all spec topic names, spec content, change slugs, and change proposal/design content, returning matching results with context snippets\r\n\r\n#### Scenario: Search matches spec topic names\r\n- **WHEN** `search(\"dashboard\")` is called and a spec with topic `dashboard-view` exists\r\n- **THEN** the result includes `dashboard-view` as a match\r\n\r\n#### Scenario: No-op for inapplicable methods\r\n- **WHEN** `browse()`, `detect()`, or `resync()` is called\r\n- **THEN** it returns sensible defaults without error (empty browse, `hasOpenSpec: true`, void)\r\n","2026-02-13-vscode-extension":"## ADDED Requirements\r\n\r\n### Requirement: ApiAdapter interface\r\nThe frontend SHALL define an `ApiAdapter` interface that abstracts all API communication, allowing different implementations for web and VS Code environments.\r\n\r\n#### Scenario: Adapter interface contract\r\n- **WHEN** a component needs to fetch OpenSpec data\r\n- **THEN** it calls methods on the `ApiAdapter` interface (e.g., `getOverview()`, `getSpecs()`, `getChange(slug)`) which return Promises of typed data\r\n\r\n### Requirement: FetchAdapter for web\r\nThe web version SHALL use a `FetchAdapter` that calls the Express REST API via HTTP fetch.\r\n\r\n#### Scenario: Fetch adapter API call\r\n- **WHEN** `FetchAdapter.getOverview()` is called with repoPath set\r\n- **THEN** it performs `fetch('/api/openspec/overview?dir=...')` and returns the parsed JSON response\r\n\r\n#### Scenario: Fetch adapter error handling\r\n- **WHEN** a fetch request returns a non-OK HTTP status\r\n- **THEN** the adapter throws an error with the HTTP status code\r\n\r\n### Requirement: MessageAdapter for VS Code Webview\r\nThe VS Code version SHALL use a `MessageAdapter` that communicates with the extension host via `postMessage`.\r\n\r\n#### Scenario: Message adapter API call\r\n- **WHEN** `MessageAdapter.getOverview()` is called\r\n- **THEN** it sends `{ type: 'request', id: '<unique>', method: 'getOverview' }` via `postMessage` and returns a Promise that resolves when the matching response arrives\r\n\r\n#### Scenario: Message adapter timeout\r\n- **WHEN** a message request does not receive a response within 10 seconds\r\n- **THEN** the adapter rejects the Promise with a timeout error\r\n\r\n#### Scenario: Message adapter error response\r\n- **WHEN** the extension host responds with `{ type: 'response', id, error: '...' }`\r\n- **THEN** the adapter rejects the Promise with the error message\r\n\r\n### Requirement: Adapter injection via React Context\r\nThe adapter SHALL be provided to the React component tree via a Context provider, allowing hooks to use the appropriate adapter without knowing the environment.\r\n\r\n#### Scenario: Web app initialization\r\n- **WHEN** the web app mounts\r\n- **THEN** it wraps the component tree with an `ApiAdapterProvider` using `FetchAdapter`\r\n\r\n#### Scenario: Webview app initialization\r\n- **WHEN** the React app mounts inside a VS Code Webview\r\n- **THEN** it wraps the component tree with an `ApiAdapterProvider` using `MessageAdapter`\r\n\r\n#### Scenario: Hook usage\r\n- **WHEN** a hook like `useOverview()` needs to fetch data\r\n- **THEN** it obtains the adapter from `useApiAdapter()` context and calls `adapter.getOverview()`\r\n"},"change-browsing":{"2026-02-21-add-change-timestamp":"## MODIFIED Requirements\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Active changes SHALL be visually distinguished with a left accent color border (4px). Changes SHALL be sorted by git timestamp descending (most recent first), falling back to slug date when timestamp is unavailable. Each change SHALL display a relative time indicator (e.g., \"3 hours ago\", \"2 days ago\") when a git timestamp is available, with the full ISO timestamp shown as a tooltip on hover. When no git timestamp is available, the system SHALL fall back to displaying the slug date in YYYY-MM-DD format.\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with a left accent color border, name, and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by timestamp descending, without accent border\r\n\r\n#### Scenario: Display relative time for changes with timestamp\r\n- **WHEN** a change has a git timestamp\r\n- **THEN** the change displays a relative time (e.g., \"2 days ago\") instead of YYYY-MM-DD\r\n- **AND** hovering shows the full ISO timestamp as a tooltip\r\n\r\n#### Scenario: Display date for changes without timestamp\r\n- **WHEN** a change has no git timestamp\r\n- **THEN** the change displays the slug date in YYYY-MM-DD format\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n","2026-02-21-sticky-change-detail-header":"## MODIFIED Requirements\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs in OpenSpec workflow order: Proposal, Design, Specs (delta specs), and Tasks. Tab content SHALL transition with a fade-in animation when switching. The change title (including back navigation link) and tab navigation bar SHALL be sticky-positioned below the main header, remaining visible when the user scrolls through long content.\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed with a fade-in transition\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics, with a fade-in transition\r\n\r\n#### Scenario: Tab order\r\n- **WHEN** the ChangeDetail page is rendered\r\n- **THEN** the tabs are displayed in order: Proposal, Design, Specs, Tasks (matching the OpenSpec workflow sequence)\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n#### Scenario: Sticky header on scroll\r\n- **WHEN** user scrolls down through long change content\r\n- **THEN** the change title (with back link) and tab navigation bar SHALL remain fixed below the main application header\r\n- **AND** the sticky area SHALL have an opaque background that covers scrolling content beneath it\r\n\r\n#### Scenario: Sticky does not overlap main header\r\n- **WHEN** the sticky area is active\r\n- **THEN** it SHALL be positioned directly below the main header (top offset equal to header height) with a z-index lower than the main header and sidebar\r\n","2026-02-16-ui-design-polish-p2":"## MODIFIED Requirements\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs in OpenSpec workflow order: Proposal, Design, Specs (delta specs), and Tasks. Tab content SHALL transition with a fade-in animation when switching.\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed with a fade-in transition\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed with a fade-in transition\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics, with a fade-in transition\r\n\r\n#### Scenario: Tab order\r\n- **WHEN** the ChangeDetail page is rendered\r\n- **THEN** the tabs are displayed in order: Proposal, Design, Specs, Tasks (matching the OpenSpec workflow sequence)\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Active changes SHALL be visually distinguished with a left accent color border (4px). Archived changes SHALL be sorted by date (most recent first).\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with a left accent color border, name, and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by date descending, without accent border\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Custom task checkbox styling\r\nThe system SHALL render task items in the Tasks tab using custom SVG icons instead of text-based `[x]`/`[ ]` markers. Completed tasks SHALL display a filled checkmark icon in green, and incomplete tasks SHALL display an empty circle icon. Completed task text SHALL have reduced opacity (0.6) in addition to the existing strikethrough styling.\r\n\r\n#### Scenario: Incomplete task display\r\n- **WHEN** a task item is not completed\r\n- **THEN** the task displays an empty circle SVG icon followed by the task text at full opacity\r\n\r\n#### Scenario: Completed task display\r\n- **WHEN** a task item is completed\r\n- **THEN** the task displays a green checkmark SVG icon followed by the task text with strikethrough and reduced opacity (0.6)\r\n","2026-02-13-fix-task-stats-and-capability-nav":"## ADDED Requirements\r\n\r\n### Requirement: Capability ID linking in proposal\r\nThe system SHALL render inline code elements in proposal markdown as navigable links when the code text matches an existing spec topic name.\r\n\r\n#### Scenario: Capability ID matches existing spec\r\n- **WHEN** a proposal markdown contains an inline code element (e.g., `` `responsive-layout` ``)\r\n- **AND** a spec with the topic name `responsive-layout` exists\r\n- **THEN** the inline code SHALL be rendered as a clickable link navigating to `/specs/responsive-layout`\r\n\r\n#### Scenario: Inline code does not match any spec\r\n- **WHEN** a proposal markdown contains an inline code element that does not match any existing spec topic\r\n- **THEN** the inline code SHALL be rendered as a normal styled code element without a link\r\n\r\n#### Scenario: MarkdownRenderer receives spec topics list\r\n- **WHEN** MarkdownRenderer is used with a `specTopics` prop containing the list of available spec topic names\r\n- **THEN** inline code matching any topic in the list SHALL be rendered as navigable links\r\n","2026-02-13-phase2-core-ui-pages":"## ADDED Requirements\r\n\r\n### Requirement: Change list with active/archived separation\r\nThe system SHALL display changes grouped into active and archived sections. Archived changes SHALL be sorted by date (most recent first).\r\n\r\n#### Scenario: Display active changes\r\n- **WHEN** user navigates to the ChangeList page and there are active changes\r\n- **THEN** active changes are listed in an \"Active\" section with name and task progress\r\n\r\n#### Scenario: Display archived changes\r\n- **WHEN** user navigates to the ChangeList page\r\n- **THEN** archived changes are listed in an \"Archived\" section sorted by date descending\r\n\r\n#### Scenario: No changes\r\n- **WHEN** there are no changes in the repo\r\n- **THEN** system displays an empty state message\r\n\r\n### Requirement: Change detail with tab navigation\r\nThe system SHALL display change details using a tabbed interface with tabs for: Proposal, Design, Tasks, and Specs (delta specs).\r\n\r\n#### Scenario: View proposal tab\r\n- **WHEN** user views a change and clicks the Proposal tab\r\n- **THEN** the proposal.md content is displayed (raw markdown)\r\n\r\n#### Scenario: View design tab\r\n- **WHEN** user clicks the Design tab\r\n- **THEN** the design.md content is displayed (raw markdown)\r\n\r\n#### Scenario: View tasks tab\r\n- **WHEN** user clicks the Tasks tab\r\n- **THEN** the tasks.md content is displayed with a TaskProgress bar showing completion statistics\r\n\r\n#### Scenario: View specs tab\r\n- **WHEN** user clicks the Specs tab and the change has delta specs\r\n- **THEN** the delta spec files are listed and their content displayed\r\n\r\n#### Scenario: Missing artifact\r\n- **WHEN** a tab's corresponding artifact file does not exist\r\n- **THEN** the tab shows a \"No content\" placeholder\r\n\r\n### Requirement: Task progress display in change detail\r\nThe Tasks tab SHALL display a progress bar and statistics (completed/total) derived from the change's task data.\r\n\r\n#### Scenario: Show task progress\r\n- **WHEN** viewing the Tasks tab of a change with tasks\r\n- **THEN** a TaskProgress component shows a visual progress bar with \"X / Y completed\" text\r\n"},"core-module":{"2026-02-13-vscode-extension":"## ADDED Requirements\r\n\r\n### Requirement: Standalone core package\r\nThe core module SHALL be an independent npm package (`@spek/core`) with no framework dependencies, usable by both the web server and the VS Code extension host.\r\n\r\n#### Scenario: Import from web server\r\n- **WHEN** the Express server imports `@spek/core`\r\n- **THEN** it can call scanner and task parser functions directly without additional adapters\r\n\r\n#### Scenario: Import from extension host\r\n- **WHEN** the VS Code extension host imports `@spek/core`\r\n- **THEN** it can call scanner and task parser functions directly without additional adapters\r\n\r\n### Requirement: Scanner functions\r\nThe core module SHALL export scanner functions that accept a base path and return structured OpenSpec data.\r\n\r\n#### Scenario: Scan overview\r\n- **WHEN** `scanOverview(basePath)` is called with a valid repo path\r\n- **THEN** it returns `{ specsCount, changesCount: { active, archived }, taskStats: { total, completed } }`\r\n\r\n#### Scenario: List specs\r\n- **WHEN** `listSpecs(basePath)` is called\r\n- **THEN** it returns an array of `{ topic, path }` for each spec directory\r\n\r\n#### Scenario: Read single spec\r\n- **WHEN** `readSpec(basePath, topic)` is called with an existing topic\r\n- **THEN** it returns `{ topic, content, relatedChanges, history }`\r\n\r\n#### Scenario: List changes\r\n- **WHEN** `listChanges(basePath)` is called\r\n- **THEN** it returns `{ active: ChangeInfo[], archived: ChangeInfo[] }`\r\n\r\n#### Scenario: Read single change\r\n- **WHEN** `readChange(basePath, slug)` is called with an existing change slug\r\n- **THEN** it returns `{ slug, proposal, design, tasks, specs, metadata }`\r\n\r\n#### Scenario: Search content\r\n- **WHEN** `searchContent(basePath, query)` is called\r\n- **THEN** it returns matching results across specs and changes with context snippets\r\n\r\n### Requirement: Task parser functions\r\nThe core module SHALL export task parsing functions that operate on raw Markdown content strings.\r\n\r\n#### Scenario: Parse tasks from content\r\n- **WHEN** `parseTasks(content)` is called with Markdown containing `- [x]` and `- [ ]` checkboxes\r\n- **THEN** it returns `{ total, completed, sections }` with tasks grouped by `##` headings\r\n\r\n### Requirement: Shared type definitions\r\nThe core module SHALL export all TypeScript type definitions used by both the web app and the extension.\r\n\r\n#### Scenario: Type imports\r\n- **WHEN** the web app or extension imports types from `@spek/core`\r\n- **THEN** types such as `OverviewData`, `SpecInfo`, `SpecDetail`, `ChangeInfo`, `ChangeDetail`, `ParsedTasks`, `SearchResult` are available\r\n"},"dashboard-view":{"2026-02-21-add-change-timestamp":"## MODIFIED Requirements\r\n\r\n### Requirement: Recent archived changes\r\nThe system SHALL display the most recent 10 archived changes. Each change SHALL display a relative time indicator (e.g., \"3 hours ago\", \"2 days ago\") when a git timestamp is available, with the full ISO timestamp shown as a tooltip on hover. When no git timestamp is available, the system SHALL fall back to displaying the slug date in YYYY-MM-DD format.\r\n\r\n#### Scenario: Show archived changes with timestamp\r\n- **WHEN** user views the Dashboard and archived changes have git timestamps\r\n- **THEN** the most recent 10 archived changes are listed with their names and relative time (e.g., \"3 hours ago\")\r\n- **AND** hovering over the time shows the full ISO timestamp as a tooltip\r\n\r\n#### Scenario: Show archived changes without timestamp\r\n- **WHEN** user views the Dashboard and archived changes have no git timestamp\r\n- **THEN** the changes are listed with their names and slug date in YYYY-MM-DD format\r\n","2026-02-16-ui-design-polish-p0-p1":"## MODIFIED Requirements\r\n\r\n### Requirement: Overview statistics display\r\nThe system SHALL display overview statistics from the overview API: total specs count, active changes count, archived changes count, and task completion rate (percentage). Statistics SHALL be displayed in stat cards with large numbers (text-4xl) and a staggered fade-in-up entry animation on page load.\r\n\r\n#### Scenario: Display statistics\r\n- **WHEN** user navigates to the Dashboard page\r\n- **THEN** system displays specs count, active changes count, archived changes count, and overall task completion percentage in stat cards with large accent-colored numbers\r\n\r\n#### Scenario: Staggered entry animation\r\n- **WHEN** the Dashboard page loads\r\n- **THEN** the four stat cards appear with a fade-in-up animation, each card delayed by an incremental amount (e.g., 0ms, 80ms, 160ms, 240ms) creating a staggered reveal effect\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** user has `prefers-reduced-motion: reduce` enabled\r\n- **THEN** stat cards appear immediately without animation\r\n","2026-02-13-phase2-core-ui-pages":"## ADDED Requirements\r\n\r\n### Requirement: Overview statistics display\r\nThe system SHALL display overview statistics from the overview API: total specs count, active changes count, archived changes count, and task completion rate (percentage).\r\n\r\n#### Scenario: Display statistics\r\n- **WHEN** user navigates to the Dashboard page\r\n- **THEN** system displays specs count, active changes count, archived changes count, and overall task completion percentage in stat cards\r\n\r\n### Requirement: Active changes list\r\nThe system SHALL display a list of active changes with their names and task progress indicators.\r\n\r\n#### Scenario: Show active changes with progress\r\n- **WHEN** there are active changes in the repo\r\n- **THEN** each active change is displayed with its name and a TaskProgress bar showing completed/total tasks\r\n\r\n#### Scenario: No active changes\r\n- **WHEN** there are no active changes\r\n- **THEN** system displays an empty state message\r\n\r\n### Requirement: Recent archived changes\r\nThe system SHALL display the most recent 10 archived changes.\r\n\r\n#### Scenario: Show archived changes\r\n- **WHEN** user views the Dashboard\r\n- **THEN** the most recent 10 archived changes are listed with their names and dates\r\n\r\n### Requirement: Navigation cards\r\nThe system SHALL provide navigation cards/links to the Specs list and Changes list pages.\r\n\r\n#### Scenario: Navigate to specs\r\n- **WHEN** user clicks the Specs navigation card\r\n- **THEN** system navigates to `/specs`\r\n\r\n#### Scenario: Navigate to changes\r\n- **WHEN** user clicks the Changes navigation card\r\n- **THEN** system navigates to `/changes`\r\n"},"filesystem-api":{"2026-02-21-fix-detect-fallback":"## MODIFIED Requirements\r\n\r\n### Requirement: Detect OpenSpec directory\r\nThe system SHALL provide an API endpoint `GET /api/fs/detect` that checks whether a given path contains a valid OpenSpec directory. Detection SHALL first check for `openspec/config.yaml`. If `config.yaml` does not exist, the system SHALL fallback to checking whether `openspec/specs/` or `openspec/changes/` directory exists.\r\n\r\n#### Scenario: Path contains valid OpenSpec directory with config.yaml\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"<schema-value>\" }`\r\n\r\n#### Scenario: Path contains OpenSpec directory without config.yaml\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` does not exist\r\n- **AND** `/home/user/my-repo/openspec/specs/` or `/home/user/my-repo/openspec/changes/` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"unknown\" }`\r\n\r\n#### Scenario: Path does not contain OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/empty-repo`\r\n- **AND** no `openspec/` directory exists at that path, or `openspec/` exists but contains neither `specs/` nor `changes/`\r\n- **THEN** system returns `{ \"hasOpenSpec\": false }`\r\n","2026-02-13-phase1-skeleton-and-api":"## ADDED Requirements\r\n\r\n### Requirement: Browse directories\r\nThe system SHALL provide an API endpoint `GET /api/fs/browse` that returns directory contents for a given path, allowing users to navigate the filesystem to find repos.\r\n\r\n#### Scenario: Browse valid directory\r\n- **WHEN** client sends `GET /api/fs/browse?path=/home/user/projects`\r\n- **THEN** system returns a JSON array of entries, each with `name`, `type` (\"file\" or \"directory\"), and `path`\r\n- **AND** entries are sorted with directories first, then alphabetically\r\n\r\n#### Scenario: Browse without path parameter\r\n- **WHEN** client sends `GET /api/fs/browse` without a `path` parameter\r\n- **THEN** system returns the contents of the user's home directory\r\n\r\n#### Scenario: Browse non-existent directory\r\n- **WHEN** client sends `GET /api/fs/browse?path=/nonexistent`\r\n- **THEN** system returns HTTP 400 with an error message\r\n\r\n### Requirement: Detect OpenSpec directory\r\nThe system SHALL provide an API endpoint `GET /api/fs/detect` that checks whether a given path contains an `openspec/` directory with a valid `config.yaml`.\r\n\r\n#### Scenario: Path contains valid OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/my-repo`\r\n- **AND** `/home/user/my-repo/openspec/config.yaml` exists\r\n- **THEN** system returns `{ \"hasOpenSpec\": true, \"schema\": \"<schema-value>\" }`\r\n\r\n#### Scenario: Path does not contain OpenSpec directory\r\n- **WHEN** client sends `GET /api/fs/detect?path=/home/user/empty-repo`\r\n- **AND** no `openspec/` directory exists at that path\r\n- **THEN** system returns `{ \"hasOpenSpec\": false }`\r\n\r\n### Requirement: Path traversal protection\r\nThe system SHALL reject any path that attempts directory traversal outside the specified root.\r\n\r\n#### Scenario: Path traversal attempt\r\n- **WHEN** client sends `GET /api/fs/browse?path=/home/user/../../../etc`\r\n- **THEN** system resolves the path and returns the directory contents of the resolved absolute path without exposing system files outside normal filesystem permissions\r\n"},"frontend-design-skill":{"2026-02-15-add-frontend-design-skill":"## ADDED Requirements\r\n\r\n### Requirement: Skill 目錄結構\r\n\r\nfrontend-design skill SHALL 存放於 `.agents/skills/frontend-design/` 目錄下，包含 `SKILL.md` 和 `LICENSE.txt` 兩個檔案。\r\n\r\n#### Scenario: Skill 檔案存在\r\n\r\n- **WHEN** 檢查 `.agents/skills/frontend-design/` 目錄\r\n- **THEN** 目錄中 SHALL 包含 `SKILL.md` 和 `LICENSE.txt`\r\n\r\n### Requirement: Claude Code Skill 註冊\r\n\r\n`.claude/skills/frontend-design` SHALL 為一個 symlink，指向 `../../.agents/skills/frontend-design`，使 Claude Code 能自動偵測並載入此 skill。\r\n\r\n#### Scenario: Symlink 正確指向\r\n\r\n- **WHEN** Claude Code 掃描 `.claude/skills/` 目錄\r\n- **THEN** `frontend-design` symlink SHALL 解析至 `.agents/skills/frontend-design/`\r\n\r\n### Requirement: SKILL.md 包含設計指引\r\n\r\n`SKILL.md` SHALL 包含 frontmatter（name、description、license）以及設計指引內容，涵蓋 Design Thinking 流程和 Frontend Aesthetics Guidelines。\r\n\r\n#### Scenario: Skill 被觸發時提供指引\r\n\r\n- **WHEN** 使用者要求建立網頁元件、頁面、dashboard 或美化 web UI\r\n- **THEN** Claude Code SHALL 載入 SKILL.md 中的設計指引，引導產出高品質前端介面\r\n"},"git-timestamp-cache":{"2026-02-13-spec-history-git-timestamp-cache":"## ADDED Requirements\r\n\r\n### Requirement: Build timestamp cache from git log\r\nThe system SHALL provide a function that executes a single `git log` command scoped to `openspec/changes/` and parses the output to build a Map of change slug to earliest commit timestamp (ISO 8601 format).\r\n\r\n#### Scenario: Build cache for repo with git history\r\n- **WHEN** the cache builder is invoked for a repo directory that is a git repository\r\n- **THEN** the system executes `git log --format=\"COMMIT %aI\" --name-only -- openspec/changes/` in the repo directory\r\n- **AND** parses the output to extract the earliest commit timestamp for each change slug\r\n- **AND** returns a `Map<string, string>` mapping slug to ISO 8601 timestamp\r\n\r\n#### Scenario: Build cache for non-git directory\r\n- **WHEN** the cache builder is invoked for a directory that is not a git repository\r\n- **THEN** the system returns an empty Map without throwing an error\r\n\r\n#### Scenario: Change exists in filesystem but not in git\r\n- **WHEN** a change directory exists but has no git commits (e.g., uncommitted new change)\r\n- **THEN** that change slug is not present in the returned Map\r\n\r\n### Requirement: In-memory cache keyed by repo path\r\nThe system SHALL maintain an in-memory cache (`Map<string, Map<string, string>>`) keyed by absolute repo directory path, storing the timestamp Map for each repo.\r\n\r\n#### Scenario: Cache hit\r\n- **WHEN** a timestamp lookup is requested for a repo that has been previously cached\r\n- **THEN** the system returns the cached Map without executing any git commands\r\n\r\n#### Scenario: Cache miss with lazy build\r\n- **WHEN** a timestamp lookup is requested for a repo that has not been cached\r\n- **THEN** the system automatically builds the cache by executing the git log command\r\n- **AND** stores the result for subsequent lookups\r\n\r\n### Requirement: Resync cache\r\nThe system SHALL provide a resync function that clears the cached timestamps for a given repo and immediately rebuilds the cache from git.\r\n\r\n#### Scenario: Resync after repo changes\r\n- **WHEN** the resync function is invoked for a repo directory\r\n- **THEN** the system clears the existing cache entry for that repo\r\n- **AND** rebuilds the cache by executing the git log command\r\n- **AND** returns the newly built timestamp Map\r\n"},"graph-view":{"2026-02-17-spec-graph-view":"## ADDED Requirements\r\n\r\n### Requirement: Graph page route\r\nThe system SHALL provide a `/graph` route that renders the Graph View page within the shared Layout. The page SHALL be accessible from all three modes (Web, VS Code Webview, Demo).\r\n\r\n#### Scenario: Navigate to graph page\r\n- **WHEN** user navigates to `/graph`\r\n- **THEN** the Graph View page is rendered within the Layout with sidebar and header visible\r\n\r\n#### Scenario: Graph page in demo mode\r\n- **WHEN** the demo build is loaded\r\n- **AND** user navigates to `/graph`\r\n- **THEN** the Graph View page renders using static graph data from `window.__DEMO_DATA__`\r\n\r\n### Requirement: Graph data fetching\r\nThe system SHALL fetch graph data (nodes and edges) from the API adapter when the Graph View page loads. While loading, the page SHALL display a loading indicator. If the fetch fails, an error message SHALL be displayed.\r\n\r\n#### Scenario: Successful data load\r\n- **WHEN** the Graph View page mounts\r\n- **THEN** the system calls `getGraphData()` on the API adapter\r\n- **AND** renders the force-directed graph with the returned nodes and edges\r\n\r\n#### Scenario: Loading state\r\n- **WHEN** graph data is being fetched\r\n- **THEN** a loading indicator is displayed in the graph container\r\n\r\n#### Scenario: Error state\r\n- **WHEN** graph data fetch fails\r\n- **THEN** an error message is displayed with the failure reason\r\n\r\n### Requirement: Force-directed graph layout\r\nThe system SHALL render an interactive force-directed graph using D3 force simulation. Spec nodes and change nodes SHALL be positioned by the simulation with forces: center force, link force (connecting edges), many-body repulsion force, and collision force to prevent overlap.\r\n\r\n#### Scenario: Initial layout\r\n- **WHEN** graph data is loaded with specs and changes\r\n- **THEN** a force-directed simulation positions all nodes within the SVG viewport\r\n- **AND** the simulation runs until convergence (alpha < 0.001)\r\n\r\n#### Scenario: Empty graph\r\n- **WHEN** graph data contains no nodes with edges (no changes have specs)\r\n- **THEN** the page displays a message indicating no relationships to visualize\r\n\r\n### Requirement: Node visual encoding\r\nThe system SHALL render spec nodes as circles and change nodes as rounded rectangles. Spec node radius SHALL scale with `historyCount` (minimum 20px, maximum 45px). Change node size SHALL scale with `specCount` (number of specs modified). Spec nodes SHALL use the accent color (amber). Change nodes SHALL use green for active status and blue-gray for archived status.\r\n\r\n#### Scenario: Spec node sizing\r\n- **WHEN** a spec has `historyCount` of 5 (highest in the dataset)\r\n- **THEN** its circle radius is at or near the maximum (45px)\r\n\r\n#### Scenario: Spec node with no history\r\n- **WHEN** a spec has `historyCount` of 0\r\n- **THEN** its circle radius is at the minimum (20px)\r\n\r\n#### Scenario: Change node coloring\r\n- **WHEN** a change has `status: \"active\"`\r\n- **THEN** its rectangle uses a green color scheme\r\n- **WHEN** a change has `status: \"archived\"`\r\n- **THEN** its rectangle uses a blue-gray color scheme\r\n\r\n### Requirement: Node labels\r\nThe system SHALL display text labels next to each node. Spec labels SHALL show the topic name. Change labels SHALL show the description (derived from slug). Labels longer than 25 characters SHALL be truncated with ellipsis.\r\n\r\n#### Scenario: Spec label display\r\n- **WHEN** a spec node with topic \"markdown-renderer\" is rendered\r\n- **THEN** a text label \"markdown-renderer\" is displayed adjacent to the node\r\n\r\n#### Scenario: Long change label truncation\r\n- **WHEN** a change with description \"phase3 markdown and search improvements\" is rendered\r\n- **THEN** the label is truncated to 25 characters with \"...\" appended\r\n\r\n### Requirement: Edge rendering\r\nThe system SHALL render edges as lines connecting change nodes to the spec nodes they modified. Edges SHALL use a muted color by default. When a node is hovered, its connected edges SHALL be highlighted.\r\n\r\n#### Scenario: Edge display\r\n- **WHEN** change \"phase3-markdown-and-search\" modified specs \"markdown-renderer\" and \"search-ui\"\r\n- **THEN** two edges are drawn from the change node to each respective spec node\r\n\r\n### Requirement: Drag interaction\r\nThe system SHALL support dragging nodes to reposition them. During drag, the dragged node's position SHALL be fixed. After releasing, the node SHALL remain at its dragged position until the simulation is restarted.\r\n\r\n#### Scenario: Drag a node\r\n- **WHEN** user clicks and drags a spec node\r\n- **THEN** the node follows the cursor\r\n- **AND** connected edges update in real-time\r\n- **AND** the force simulation reheats to adjust surrounding nodes\r\n\r\n### Requirement: Hover highlight interaction\r\nThe system SHALL highlight a node and its connected neighbors when the user hovers over it. All non-connected nodes and edges SHALL reduce opacity to 0.1. The hovered node, its neighbors, and their connecting edges SHALL remain at full opacity.\r\n\r\n#### Scenario: Hover on spec node\r\n- **WHEN** user hovers over spec node \"markdown-renderer\"\r\n- **THEN** the \"markdown-renderer\" node, all change nodes connected to it, and their edges are highlighted at full opacity\r\n- **AND** all other nodes and edges reduce to 0.1 opacity\r\n\r\n#### Scenario: Hover off\r\n- **WHEN** user moves the cursor away from all nodes\r\n- **THEN** all nodes and edges return to full opacity\r\n\r\n### Requirement: Click navigation\r\nThe system SHALL navigate to the detail page when a node is clicked (without dragging). Clicking a spec node SHALL navigate to `/specs/:topic`. Clicking a change node SHALL navigate to `/changes/:slug`.\r\n\r\n#### Scenario: Click spec node\r\n- **WHEN** user clicks (without dragging) on spec node \"api-adapter\"\r\n- **THEN** the app navigates to `/specs/api-adapter`\r\n\r\n#### Scenario: Click change node\r\n- **WHEN** user clicks (without dragging) on change node \"2026-02-13-initial-implementation\"\r\n- **THEN** the app navigates to `/changes/2026-02-13-initial-implementation`\r\n\r\n### Requirement: Zoom and pan\r\nThe system SHALL support zooming (scroll wheel or pinch) and panning (click-and-drag on empty space) of the graph viewport. Zoom SHALL be constrained between 0.3x and 3x. The graph SHALL initially be centered and scaled to fit all nodes within the viewport.\r\n\r\n#### Scenario: Zoom in\r\n- **WHEN** user scrolls up (or pinch-zooms in) on the graph\r\n- **THEN** the graph zooms in, up to a maximum of 3x\r\n\r\n#### Scenario: Zoom out\r\n- **WHEN** user scrolls down (or pinch-zooms out) on the graph\r\n- **THEN** the graph zooms out, down to a minimum of 0.3x\r\n\r\n#### Scenario: Pan\r\n- **WHEN** user clicks and drags on empty space (not on a node)\r\n- **THEN** the entire graph viewport pans in the drag direction\r\n\r\n#### Scenario: Initial fit\r\n- **WHEN** the graph first renders\r\n- **THEN** the viewport is scaled and centered to show all nodes within the visible area\r\n\r\n### Requirement: Graph legend\r\nThe system SHALL display a legend overlay in a corner of the graph container, showing the meaning of node shapes and colors: amber circle = Spec, green rectangle = Active Change, blue-gray rectangle = Archived Change.\r\n\r\n#### Scenario: Legend display\r\n- **WHEN** the graph is rendered\r\n- **THEN** a legend is visible showing node type indicators with labels\r\n"},"live-reload":{"2026-02-22-fix-change-not-found-on-refresh":"## MODIFIED Requirements\r\n\r\n### Requirement: Debounced re-fetch in useAsyncData\r\nThe `useAsyncData` hook SHALL support automatic re-fetch triggered by `refreshKey` changes with debounce to avoid excessive requests.\r\n\r\n#### Scenario: Re-fetch on refreshKey change\r\n- **WHEN** `refreshKey` changes in the `RefreshContext`\r\n- **THEN** `useAsyncData` triggers a new fetch after a 300ms debounce delay\r\n\r\n#### Scenario: Debounce coalesces rapid changes\r\n- **WHEN** `refreshKey` changes multiple times within 300ms\r\n- **THEN** only one re-fetch is triggered after the last change\r\n\r\n#### Scenario: Existing data preserved during re-fetch\r\n- **WHEN** a re-fetch is triggered by `refreshKey` change\r\n- **THEN** the existing `data` SHALL remain visible (no loading flash) until the new data arrives\r\n\r\n#### Scenario: Refresh failure with existing data\r\n- **WHEN** a re-fetch triggered by `refreshKey` change fails with an error\r\n- **AND** the hook already has existing data from a previous successful fetch\r\n- **THEN** the existing `data` SHALL be preserved\r\n- **AND** the `error` state SHALL NOT be set (remains null)\r\n\r\n#### Scenario: Refresh failure without existing data\r\n- **WHEN** a re-fetch triggered by `refreshKey` change fails with an error\r\n- **AND** the hook has no existing data (data is null)\r\n- **THEN** the `error` state SHALL be set to the error message\r\n","2026-02-18-fix-vscode-live-reload-directory-moves":"## MODIFIED Requirements\r\n\r\n### Requirement: File change detection for VS Code version\r\nThe VS Code extension SHALL monitor the workspace's `openspec/` directory for file changes and notify the webview.\r\n\r\n#### Scenario: FileSystemWatcher setup\r\n- **WHEN** the spek Webview Panel is created\r\n- **THEN** the extension host creates a `vscode.workspace.createFileSystemWatcher` for `openspec/**` to detect all changes including directory moves\r\n\r\n#### Scenario: File change notification to webview\r\n- **WHEN** a file or directory matching the watcher pattern is created, modified, deleted, or moved\r\n- **THEN** the extension host sends `{ type: \"fileChanged\" }` to the webview via `postMessage`, debounced at 500ms\r\n\r\n#### Scenario: Watcher cleanup\r\n- **WHEN** the spek Webview Panel is disposed\r\n- **THEN** the FileSystemWatcher SHALL be disposed along with other panel resources\r\n","2026-02-18-live-reload":"## ADDED Requirements\r\n\r\n### Requirement: File change detection for Web version\r\nThe Web server SHALL monitor the `openspec/` directory for file changes using `chokidar` and push notifications to connected clients via Server-Sent Events (SSE).\r\n\r\n#### Scenario: SSE endpoint connection\r\n- **WHEN** a client connects to `GET /api/openspec/watch?dir=<repoPath>`\r\n- **THEN** the server opens an SSE stream and begins monitoring `<repoPath>/openspec/` for `.md` and `.yaml` file changes\r\n\r\n#### Scenario: File change notification\r\n- **WHEN** a `.md` or `.yaml` file inside `openspec/` is created, modified, or deleted\r\n- **THEN** the server sends an SSE event `data: {\"type\":\"changed\"}` to all connected clients for that directory, debounced at 500ms\r\n\r\n#### Scenario: Client disconnect cleanup\r\n- **WHEN** a client disconnects from the SSE endpoint\r\n- **THEN** the server removes the client from the notification list and cleans up the watcher if no other clients are connected for that directory\r\n\r\n#### Scenario: Shared watcher per directory\r\n- **WHEN** multiple clients connect to the same `dir` parameter\r\n- **THEN** the server SHALL reuse the same chokidar watcher instance for that directory\r\n\r\n### Requirement: File change detection for VS Code version\r\nThe VS Code extension SHALL monitor the workspace's `openspec/` directory for file changes and notify the webview.\r\n\r\n#### Scenario: FileSystemWatcher setup\r\n- **WHEN** the spek Webview Panel is created\r\n- **THEN** the extension host creates a `vscode.workspace.createFileSystemWatcher` for `**/openspec/**/*.{md,yaml}`\r\n\r\n#### Scenario: File change notification to webview\r\n- **WHEN** a file matching the watcher pattern is created, modified, or deleted\r\n- **THEN** the extension host sends `{ type: \"fileChanged\" }` to the webview via `postMessage`, debounced at 500ms\r\n\r\n#### Scenario: Watcher cleanup\r\n- **WHEN** the spek Webview Panel is disposed\r\n- **THEN** the FileSystemWatcher SHALL be disposed along with other panel resources\r\n\r\n### Requirement: RefreshContext for frontend refresh coordination\r\nThe frontend SHALL provide a `RefreshContext` that coordinates data refresh across all hooks when file changes are detected.\r\n\r\n#### Scenario: RefreshContext provides refreshKey\r\n- **WHEN** a component or hook calls `useRefreshKey()`\r\n- **THEN** it receives the current `refreshKey` number value from the context\r\n\r\n#### Scenario: Refresh triggered by file change\r\n- **WHEN** `refresh()` from `RefreshContext` is called\r\n- **THEN** the `refreshKey` counter increments, causing all `useAsyncData` hooks to re-fetch their data\r\n\r\n### Requirement: useFileWatcher hook\r\nThe frontend SHALL provide a `useFileWatcher` hook that connects to the appropriate file change event source based on the runtime environment.\r\n\r\n#### Scenario: Web environment with SSE\r\n- **WHEN** `useFileWatcher` is active in the Web environment\r\n- **THEN** it opens an `EventSource` connection to `/api/openspec/watch?dir=<repoPath>` and calls `refresh()` on each received event\r\n\r\n#### Scenario: VS Code environment with postMessage\r\n- **WHEN** `useFileWatcher` is active in the VS Code webview environment\r\n- **THEN** it listens for `message` events with `type === \"fileChanged\"` and calls `refresh()` on each received event\r\n\r\n#### Scenario: Demo environment no-op\r\n- **WHEN** `useFileWatcher` is active in the Demo environment\r\n- **THEN** it does nothing (no event source to connect to)\r\n\r\n#### Scenario: Cleanup on unmount\r\n- **WHEN** the component using `useFileWatcher` unmounts\r\n- **THEN** the EventSource connection or message listener SHALL be cleaned up\r\n\r\n### Requirement: Debounced re-fetch in useAsyncData\r\nThe `useAsyncData` hook SHALL support automatic re-fetch triggered by `refreshKey` changes with debounce to avoid excessive requests.\r\n\r\n#### Scenario: Re-fetch on refreshKey change\r\n- **WHEN** `refreshKey` changes in the `RefreshContext`\r\n- **THEN** `useAsyncData` triggers a new fetch after a 300ms debounce delay\r\n\r\n#### Scenario: Debounce coalesces rapid changes\r\n- **WHEN** `refreshKey` changes multiple times within 300ms\r\n- **THEN** only one re-fetch is triggered after the last change\r\n\r\n#### Scenario: Existing data preserved during re-fetch\r\n- **WHEN** a re-fetch is triggered by `refreshKey` change\r\n- **THEN** the existing `data` SHALL remain visible (no loading flash) until the new data arrives\r\n"},"markdown-renderer":{"2026-02-13-phase3-markdown-and-search":"## ADDED Requirements\r\n\r\n### Requirement: Markdown content rendering\r\nThe system SHALL render Markdown content using react-markdown with remark-gfm plugin, supporting GFM features including tables, strikethrough, and task lists.\r\n\r\n#### Scenario: Standard Markdown rendering\r\n- **WHEN** MarkdownRenderer receives a string containing standard Markdown (headings, lists, bold, italic, links, code blocks)\r\n- **THEN** the content is rendered as formatted HTML with appropriate styling\r\n\r\n#### Scenario: GFM table rendering\r\n- **WHEN** MarkdownRenderer receives content containing a GFM pipe table\r\n- **THEN** the table is rendered as a styled HTML table with header row and data rows\r\n\r\n#### Scenario: GFM checkbox rendering\r\n- **WHEN** MarkdownRenderer receives content containing `- [x]` or `- [ ]` items\r\n- **THEN** the items are rendered as visual checkboxes (read-only)\r\n\r\n### Requirement: BDD keyword highlighting\r\nThe system SHALL visually highlight BDD keywords in rendered Markdown content to improve readability of spec documents.\r\n\r\n#### Scenario: WHEN/GIVEN keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `WHEN` or `GIVEN` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a blue background label style (blue text on blue-tinted background)\r\n\r\n#### Scenario: THEN keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `THEN` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a green background label style (green text on green-tinted background)\r\n\r\n#### Scenario: AND keyword highlighting\r\n- **WHEN** rendered Markdown contains the word `AND` as a standalone uppercase keyword\r\n- **THEN** the keyword is displayed with a gray background label style (gray text on gray-tinted background)\r\n\r\n#### Scenario: MUST/SHALL keyword highlighting\r\n- **WHEN** rendered Markdown contains `MUST` or `SHALL` as standalone uppercase keywords\r\n- **THEN** the keywords are displayed in red bold text\r\n\r\n#### Scenario: ADDED/MODIFIED badge rendering\r\n- **WHEN** rendered Markdown contains `ADDED` or `MODIFIED` as standalone uppercase keywords\r\n- **THEN** `ADDED` is displayed as an orange badge and `MODIFIED` is displayed as a blue badge\r\n\r\n#### Scenario: Keywords inside code blocks are not highlighted\r\n- **WHEN** BDD keywords appear inside inline code or fenced code blocks\r\n- **THEN** the keywords are NOT highlighted and remain as plain code text\r\n\r\n#### Scenario: Case-sensitive matching\r\n- **WHEN** text contains lowercase or mixed-case variations like \"when\", \"Then\", \"must\"\r\n- **THEN** the keywords are NOT highlighted (only exact uppercase matches trigger highlighting)\r\n\r\n### Requirement: Dark theme styling\r\nThe system SHALL apply dark theme styles consistent with the application's design system (background #0a0c0f series, amber accent, text #e2e8f0).\r\n\r\n#### Scenario: Code block styling\r\n- **WHEN** MarkdownRenderer renders a fenced code block\r\n- **THEN** the code block uses a dark background with monospace font and appropriate padding\r\n\r\n#### Scenario: Link styling\r\n- **WHEN** MarkdownRenderer renders a hyperlink\r\n- **THEN** the link is displayed in accent color (amber) with hover effect\r\n\r\n#### Scenario: Heading styling\r\n- **WHEN** MarkdownRenderer renders headings (h1-h6)\r\n- **THEN** headings use appropriate font sizes and weights consistent with the dark theme\r\n"},"openspec-api":{"2026-02-17-spec-graph-view":"## ADDED Requirements\r\n\r\n### Requirement: Graph data endpoint\r\nThe system SHALL provide `GET /api/openspec/graph` that returns the relationship graph between specs and changes. The response SHALL contain `nodes` (array of spec and change nodes) and `edges` (array of change-to-spec connections). Only changes that have at least one delta spec SHALL be included as nodes.\r\n\r\n#### Scenario: Get graph data\r\n- **WHEN** client sends `GET /api/openspec/graph?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `nodes` and `edges` arrays\r\n- **AND** each spec node has `id` (prefixed \"spec:\"), `type: \"spec\"`, `label` (topic name), and `historyCount`\r\n- **AND** each change node has `id` (prefixed \"change:\"), `type: \"change\"`, `label` (description), `date`, `status`, and `specCount`\r\n- **AND** each edge has `source` (change node id) and `target` (spec node id)\r\n\r\n#### Scenario: Graph with no spec-bearing changes\r\n- **WHEN** client sends `GET /api/openspec/graph?dir=/path/to/repo`\r\n- **AND** no changes have a `specs/` directory\r\n- **THEN** system returns `nodes` containing only spec nodes with no edges\r\n\r\n#### Scenario: Graph without dir parameter\r\n- **WHEN** client sends `GET /api/openspec/graph` without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Graph data in ApiAdapter\r\nThe system SHALL extend the `ApiAdapter` interface with a `getGraphData()` method. `FetchAdapter` SHALL call `GET /api/openspec/graph`. `MessageAdapter` SHALL use `postMessage` with type `\"getGraphData\"`. `StaticAdapter` SHALL read from `window.__DEMO_DATA__.graphData`.\r\n\r\n#### Scenario: FetchAdapter graph data\r\n- **WHEN** `FetchAdapter.getGraphData()` is called\r\n- **THEN** it sends `GET /api/openspec/graph?dir=...` and returns the parsed JSON response\r\n\r\n#### Scenario: StaticAdapter graph data\r\n- **WHEN** `StaticAdapter.getGraphData()` is called\r\n- **THEN** it returns `window.__DEMO_DATA__.graphData`\r\n\r\n#### Scenario: MessageAdapter graph data\r\n- **WHEN** `MessageAdapter.getGraphData()` is called\r\n- **THEN** it sends a postMessage with `{ type: \"getGraphData\" }` to the VS Code extension host\r\n- **AND** returns the response data\r\n\r\n### Requirement: Core graph data builder\r\nThe system SHALL provide a `buildGraphData(repoDir)` function in `@spek/core` that scans the openspec directory and returns structured graph data. The function SHALL reuse the existing scan logic to identify which changes contain delta specs for which topics.\r\n\r\n#### Scenario: Build graph data from repo\r\n- **WHEN** `buildGraphData(\"/path/to/repo\")` is called\r\n- **AND** the repo has 3 specs and 2 changes, where change A modifies spec 1 and spec 2, and change B modifies spec 2 and spec 3\r\n- **THEN** the function returns 5 nodes (3 specs + 2 changes) and 4 edges\r\n","2026-02-13-spec-history-git-timestamp-cache":"## ADDED Requirements\r\n\r\n### Requirement: Resync cache endpoint\r\nThe system SHALL provide `POST /api/openspec/resync` that clears and rebuilds the git timestamp cache for a given repo.\r\n\r\n#### Scenario: Successful resync\r\n- **WHEN** client sends `POST /api/openspec/resync?dir=/path/to/repo`\r\n- **THEN** the system clears the timestamp cache for that repo\r\n- **AND** rebuilds the cache from git history\r\n- **AND** returns HTTP 200 with `{ ok: true }`\r\n\r\n#### Scenario: Resync without dir parameter\r\n- **WHEN** client sends `POST /api/openspec/resync` without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n\r\n### Requirement: Resync UI control\r\nThe system SHALL display a resync button in the sidebar that triggers a cache rebuild. The button MUST show a loading state while the resync is in progress.\r\n\r\n#### Scenario: User triggers resync\r\n- **WHEN** the user clicks the resync button in the sidebar\r\n- **THEN** the system sends `POST /api/openspec/resync` with the current repo path\r\n- **AND** the button shows a loading/spinning state during the request\r\n- **AND** on success, the current page data is refreshed to reflect updated ordering\r\n\r\n#### Scenario: Resync with no repo selected\r\n- **WHEN** no repo is currently selected\r\n- **THEN** the resync button is not displayed or is disabled\r\n","2026-02-13-fix-task-stats-and-capability-nav":"## MODIFIED Requirements\r\n\r\n### Requirement: Overview endpoint\r\nThe system SHALL provide `GET /api/openspec/overview` that returns aggregate statistics for an OpenSpec repository.\r\n\r\n#### Scenario: Get overview of repo with specs and changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `specsCount`, `changesCount` (with `active` and `archived` breakdown), and `taskStats` (aggregate `total` and `completed` across all changes, including both active and archived)\r\n\r\n#### Scenario: Get overview with only archived changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** there are no active changes but archived changes have tasks\r\n- **THEN** system returns `taskStats` with correct `total` and `completed` counts from archived changes\r\n\r\n#### Scenario: Get overview of repo with no specs\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** the repo has no `openspec/specs/` directory\r\n- **THEN** system returns `specsCount: 0` with changes still counted correctly\r\n","2026-02-13-phase1-skeleton-and-api":"## ADDED Requirements\r\n\r\n### Requirement: Overview endpoint\r\nThe system SHALL provide `GET /api/openspec/overview` that returns aggregate statistics for an OpenSpec repository.\r\n\r\n#### Scenario: Get overview of repo with specs and changes\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `specsCount`, `changesCount` (with `active` and `archived` breakdown), and `taskStats` (aggregate `total` and `completed` across all active changes)\r\n\r\n#### Scenario: Get overview of repo with no specs\r\n- **WHEN** client sends `GET /api/openspec/overview?dir=/path/to/repo`\r\n- **AND** the repo has no `openspec/specs/` directory\r\n- **THEN** system returns `specsCount: 0` with changes still counted correctly\r\n\r\n### Requirement: List specs\r\nThe system SHALL provide `GET /api/openspec/specs` that returns all spec topics.\r\n\r\n#### Scenario: List all specs\r\n- **WHEN** client sends `GET /api/openspec/specs?dir=/path/to/repo`\r\n- **THEN** system returns a JSON array of spec topics, each with `topic` name and `path`\r\n- **AND** topics are sorted alphabetically\r\n\r\n#### Scenario: No specs directory\r\n- **WHEN** client sends `GET /api/openspec/specs?dir=/path/to/repo`\r\n- **AND** `openspec/specs/` does not exist\r\n- **THEN** system returns an empty array\r\n\r\n### Requirement: Get single spec\r\nThe system SHALL provide `GET /api/openspec/specs/:topic` that returns the full content of a spec.\r\n\r\n#### Scenario: Get existing spec\r\n- **WHEN** client sends `GET /api/openspec/specs/simulation-engine?dir=/path/to/repo`\r\n- **AND** `openspec/specs/simulation-engine/spec.md` exists\r\n- **THEN** system returns JSON with `topic`, `content` (raw Markdown), and `relatedChanges` (list of changes that have delta specs for this topic)\r\n\r\n#### Scenario: Get non-existent spec\r\n- **WHEN** client sends `GET /api/openspec/specs/nonexistent?dir=/path/to/repo`\r\n- **THEN** system returns HTTP 404\r\n\r\n### Requirement: List changes\r\nThe system SHALL provide `GET /api/openspec/changes` that returns all changes grouped by status.\r\n\r\n#### Scenario: List changes with active and archived\r\n- **WHEN** client sends `GET /api/openspec/changes?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `active` array and `archived` array\r\n- **AND** each change includes `slug`, `date` (parsed from slug prefix), `description` (parsed from slug), `hasProposal`, `hasDesign`, `hasTasks`, `hasSpecs`, and `taskStats`\r\n- **AND** changes are sorted by date descending (newest first)\r\n\r\n### Requirement: Get single change\r\nThe system SHALL provide `GET /api/openspec/changes/:slug` that returns full change content.\r\n\r\n#### Scenario: Get existing change with all artifacts\r\n- **WHEN** client sends `GET /api/openspec/changes/2026-02-10-my-feature?dir=/path/to/repo`\r\n- **THEN** system returns JSON with `slug`, `proposal` (Markdown content or null), `design` (Markdown content or null), `tasks` (parsed task structure or null), `specs` (array of delta spec contents), and `metadata` (from `.openspec.yaml` if present)\r\n\r\n#### Scenario: Get non-existent change\r\n- **WHEN** client sends `GET /api/openspec/changes/nonexistent?dir=/path/to/repo`\r\n- **THEN** system returns HTTP 404\r\n\r\n### Requirement: Missing dir parameter\r\nThe system SHALL require the `dir` query parameter on all openspec endpoints.\r\n\r\n#### Scenario: Request without dir parameter\r\n- **WHEN** client sends any `/api/openspec/*` request without `dir` parameter\r\n- **THEN** system returns HTTP 400 with error message \"dir parameter is required\"\r\n"},"openspec-scanner":{"2026-02-21-add-change-timestamp":"## MODIFIED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL be an async function in the `@spek/core` package that reads an OpenSpec directory and returns its complete structure including specs, active changes, and archived changes. Each `ChangeInfo` SHALL include a `timestamp` field (ISO 8601 string or null) obtained from the git timestamp cache. Changes SHALL be sorted by timestamp descending (most recent first), falling back to slug date when timestamp is unavailable. It SHALL use Node.js `fs` directly and have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n- **AND** each `ChangeInfo` in `activeChanges` and `archivedChanges` SHALL include a `timestamp` field from the git timestamp cache\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n#### Scenario: Sort changes by timestamp\r\n- **WHEN** multiple changes exist with the same slug date (e.g., `2026-02-17-foo` and `2026-02-17-bar`)\r\n- **THEN** changes SHALL be sorted by git timestamp descending (most recent first)\r\n\r\n#### Scenario: Sort changes without git timestamps\r\n- **WHEN** the repo is not a git repository or changes have no git history\r\n- **THEN** changes SHALL be sorted by slug date descending as fallback\r\n- **AND** all `timestamp` fields SHALL be null\r\n","2026-02-13-vscode-extension":"## MODIFIED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL be a pure function in the `@spek/core` package that reads an OpenSpec directory and returns its complete structure including specs, active changes, and archived changes. It SHALL use Node.js `fs/promises` directly and have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n### Requirement: Parse change artifacts\r\nThe scanner SHALL read individual change directories and extract available artifacts.\r\n\r\n#### Scenario: Change with all artifacts\r\n- **WHEN** scanner reads a change directory containing proposal.md, design.md, tasks.md, and specs/\r\n- **THEN** it returns the raw Markdown content for each artifact and a list of delta spec files\r\n\r\n#### Scenario: Change with partial artifacts\r\n- **WHEN** scanner reads a change directory containing only proposal.md\r\n- **THEN** it returns proposal content and null for missing artifacts\r\n\r\n### Requirement: Read spec content\r\nThe scanner SHALL read spec files and return their Markdown content.\r\n\r\n#### Scenario: Read existing spec\r\n- **WHEN** scanner reads `openspec/specs/{topic}/spec.md`\r\n- **THEN** it returns the raw Markdown content of the spec file\r\n\r\n### Requirement: Detect related changes for a spec\r\nThe scanner SHALL identify which changes contain delta specs for a given spec topic.\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** scanner checks for changes related to spec topic \"simulation-engine\"\r\n- **THEN** it returns all change slugs that have a `specs/simulation-engine/spec.md` delta file\r\n","2026-02-13-phase1-skeleton-and-api":"## ADDED Requirements\r\n\r\n### Requirement: Scan OpenSpec directory structure\r\nThe scanner SHALL read an OpenSpec directory and return its complete structure including specs, active changes, and archived changes.\r\n\r\n#### Scenario: Scan repo with full OpenSpec structure\r\n- **WHEN** scanner is given a repo path containing `openspec/specs/` and `openspec/changes/`\r\n- **THEN** it returns a structure with `specs` (list of topic names), `activeChanges` (changes directly under `openspec/changes/` excluding `archive/`), and `archivedChanges` (changes under `openspec/changes/archive/`)\r\n\r\n#### Scenario: Scan repo with empty OpenSpec directory\r\n- **WHEN** scanner is given a repo path where `openspec/` exists but contains only `config.yaml`\r\n- **THEN** it returns empty arrays for specs, activeChanges, and archivedChanges\r\n\r\n### Requirement: Parse change artifacts\r\nThe scanner SHALL read individual change directories and extract available artifacts.\r\n\r\n#### Scenario: Change with all artifacts\r\n- **WHEN** scanner reads a change directory containing proposal.md, design.md, tasks.md, and specs/\r\n- **THEN** it returns the raw Markdown content for each artifact and a list of delta spec files\r\n\r\n#### Scenario: Change with partial artifacts\r\n- **WHEN** scanner reads a change directory containing only proposal.md\r\n- **THEN** it returns proposal content and null for missing artifacts\r\n\r\n### Requirement: Read spec content\r\nThe scanner SHALL read spec files and return their Markdown content.\r\n\r\n#### Scenario: Read existing spec\r\n- **WHEN** scanner reads `openspec/specs/{topic}/spec.md`\r\n- **THEN** it returns the raw Markdown content of the spec file\r\n\r\n### Requirement: Detect related changes for a spec\r\nThe scanner SHALL identify which changes contain delta specs for a given spec topic.\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** scanner checks for changes related to spec topic \"simulation-engine\"\r\n- **THEN** it returns all change slugs that have a `specs/simulation-engine/spec.md` delta file\r\n"},"repo-selection":{"2026-02-13-phase4-polish-and-enhancement":"## MODIFIED Requirements\r\n\r\n### Requirement: Recent paths persistence\r\nThe system SHALL persist the most recent 5 repo paths in localStorage. On page load, previously used paths SHALL be displayed for quick selection. Each recent path SHALL be validated asynchronously against the detect API to show its current status (valid, invalid, or checking).\r\n\r\n#### Scenario: Save path on successful detection\r\n- **WHEN** user successfully opens a repo (path with valid openspec/)\r\n- **THEN** the path is saved to localStorage recent paths list (max 5, most recent first)\r\n\r\n#### Scenario: Display recent paths on load\r\n- **WHEN** user visits the SelectRepo page\r\n- **THEN** previously saved paths are displayed as clickable options\r\n\r\n#### Scenario: Validate recent paths asynchronously\r\n- **WHEN** the SelectRepo page loads with saved recent paths\r\n- **THEN** the system calls the detect API for each path in parallel\r\n- **AND** each path displays a status indicator: spinner (checking), green checkmark (valid openspec/ found), or red indicator (path invalid or no openspec/)\r\n\r\n#### Scenario: Remove invalid path\r\n- **WHEN** a recent path is determined to be invalid\r\n- **THEN** a delete button appears next to the path allowing the user to remove it from the list\r\n","2026-02-13-phase2-core-ui-pages":"## ADDED Requirements\r\n\r\n### Requirement: Path input with auto-detection\r\nThe system SHALL provide a text input for entering a filesystem path. Upon input, the system SHALL call the detect API to check for an `openspec/` directory and display the detection result.\r\n\r\n#### Scenario: Valid path with openspec directory\r\n- **WHEN** user enters a path that contains an `openspec/` directory\r\n- **THEN** system displays a success indicator and a button to open the repo\r\n\r\n#### Scenario: Valid path without openspec directory\r\n- **WHEN** user enters a path that does not contain an `openspec/` directory\r\n- **THEN** system displays a warning message indicating no openspec directory found\r\n\r\n#### Scenario: Invalid path\r\n- **WHEN** user enters a path that does not exist\r\n- **THEN** system displays an error message\r\n\r\n### Requirement: Directory browsing\r\nThe system SHALL provide a directory browser that calls the browse API, allowing users to navigate the filesystem and select a repo path.\r\n\r\n#### Scenario: Browse directories\r\n- **WHEN** user clicks the browse button\r\n- **THEN** system displays a list of directories at the current path\r\n- **AND** user can click a directory to navigate into it\r\n- **AND** user can select the current directory as the repo path\r\n\r\n### Requirement: Recent paths persistence\r\nThe system SHALL persist the most recent 5 repo paths in localStorage. On page load, previously used paths SHALL be displayed for quick selection.\r\n\r\n#### Scenario: Save path on successful detection\r\n- **WHEN** user successfully opens a repo (path with valid openspec/)\r\n- **THEN** the path is saved to localStorage recent paths list (max 5, most recent first)\r\n\r\n#### Scenario: Display recent paths on load\r\n- **WHEN** user visits the SelectRepo page\r\n- **THEN** previously saved paths are displayed as clickable options\r\n\r\n### Requirement: Auto-navigate to dashboard\r\nThe system SHALL automatically navigate to the Dashboard page after the user selects a valid repo path.\r\n\r\n#### Scenario: Navigate after selection\r\n- **WHEN** user selects a valid repo path (via input, browse, or recent paths)\r\n- **THEN** system navigates to `/dashboard` with the repo path set in RepoContext\r\n"},"responsive-layout":{"2026-02-13-phase4-polish-and-enhancement":"## ADDED Requirements\r\n\r\n### Requirement: Mobile breakpoint detection\r\nThe system SHALL detect whether the viewport width is below 768px and adapt the layout accordingly. The detection MUST use `window.matchMedia` and respond to runtime viewport changes (e.g., device rotation).\r\n\r\n#### Scenario: Viewport below 768px\r\n- **WHEN** the viewport width is less than 768px\r\n- **THEN** the sidebar is hidden by default and a hamburger menu button appears in the header\r\n\r\n#### Scenario: Viewport at or above 768px\r\n- **WHEN** the viewport width is 768px or greater\r\n- **THEN** the sidebar is displayed in its fixed position and the hamburger menu button is hidden\r\n\r\n#### Scenario: Viewport resize crossing breakpoint\r\n- **WHEN** the viewport is resized from below 768px to at or above 768px\r\n- **THEN** the sidebar transitions to fixed display and the hamburger menu button is hidden\r\n\r\n### Requirement: Mobile sidebar overlay\r\nThe system SHALL display the sidebar as a full-height overlay with a backdrop when opened on viewports below 768px.\r\n\r\n#### Scenario: Open mobile sidebar\r\n- **WHEN** the user taps the hamburger menu button on a mobile viewport\r\n- **THEN** the sidebar slides in from the left as an overlay with a semi-transparent backdrop behind it\r\n\r\n#### Scenario: Close mobile sidebar via backdrop\r\n- **WHEN** the mobile sidebar overlay is open and the user taps the backdrop area\r\n- **THEN** the sidebar closes and the backdrop disappears\r\n\r\n#### Scenario: Close mobile sidebar via navigation\r\n- **WHEN** the mobile sidebar overlay is open and the user taps a navigation link\r\n- **THEN** the system navigates to the selected route and the sidebar closes automatically\r\n\r\n### Requirement: Responsive content grids\r\nThe system SHALL adapt grid layouts for different viewport sizes. Dashboard stat cards MUST use 2 columns on mobile and 4 columns on desktop. Navigation cards MUST stack vertically on mobile.\r\n\r\n#### Scenario: Dashboard stat cards on mobile\r\n- **WHEN** the Dashboard page is rendered on a viewport below 768px\r\n- **THEN** the stat cards are displayed in a 2-column grid\r\n\r\n#### Scenario: Dashboard stat cards on desktop\r\n- **WHEN** the Dashboard page is rendered on a viewport at or above 768px\r\n- **THEN** the stat cards are displayed in a 4-column grid\r\n\r\n### Requirement: Responsive header\r\nThe system SHALL adapt the header layout for mobile viewports. The repo path display MUST be hidden on mobile to save space. The search button MUST remain accessible.\r\n\r\n#### Scenario: Header on mobile\r\n- **WHEN** the header is rendered on a viewport below 768px\r\n- **THEN** the hamburger button is shown on the left, the search button is centered, and the repo path is hidden\r\n\r\n#### Scenario: Header on desktop\r\n- **WHEN** the header is rendered on a viewport at or above 768px\r\n- **THEN** the layout shows the spek brand on the left, search button centered, and repo path on the right\r\n"},"search-api":{"2026-02-13-phase1-skeleton-and-api":"## ADDED Requirements\r\n\r\n### Requirement: Full-text search endpoint\r\nThe system SHALL provide `GET /api/openspec/search` that searches across all specs and changes content.\r\n\r\n#### Scenario: Search with matching results\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo&q=effectiveCurrent`\r\n- **THEN** system returns a JSON array of results, each with `type` (\"spec\" or \"change\"), `name` (topic or slug), `matches` (array of matching text with context), and `score`\r\n- **AND** results are sorted by relevance score (best match first)\r\n\r\n#### Scenario: Search with no results\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo&q=xyznonexistent`\r\n- **THEN** system returns an empty array\r\n\r\n#### Scenario: Search without query parameter\r\n- **WHEN** client sends `GET /api/openspec/search?dir=/path/to/repo` without `q` parameter\r\n- **THEN** system returns HTTP 400 with error message\r\n\r\n### Requirement: Search context preview\r\nEach search result SHALL include surrounding context to help users identify the relevant content.\r\n\r\n#### Scenario: Result includes context\r\n- **WHEN** a search matches text within a Markdown file\r\n- **THEN** the match includes up to 100 characters before and after the matched text as context preview\r\n"},"search-ui":{"2026-02-16-ui-design-polish-p2":"## MODIFIED Requirements\r\n\r\n### Requirement: Search query execution\r\nThe system SHALL search across all specs and changes content by calling the backend search API with debounced input. Search results SHALL highlight matching text fragments in the title and context preview.\r\n\r\n#### Scenario: Debounced search on input\r\n- **WHEN** user types a query in the search input\r\n- **THEN** the system waits 300ms after the last keystroke before sending the search request\r\n\r\n#### Scenario: Display search results with highlights\r\n- **WHEN** the search API returns results\r\n- **THEN** results are displayed grouped by type (Specs and Changes), with matching query text highlighted using a contrasting background color in both the title and context snippet\r\n\r\n#### Scenario: No results found\r\n- **WHEN** the search API returns an empty array\r\n- **THEN** the dialog displays a \"No results found\" message with a suggestion to try different keywords\r\n\r\n#### Scenario: Empty query\r\n- **WHEN** the search input is empty\r\n- **THEN** no search request is made and the results area shows a prompt to start typing\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Search type filter\r\nThe system SHALL provide a type filter in the search dialog allowing users to narrow results by category: All, Specs only, or Changes only.\r\n\r\n#### Scenario: Filter by type\r\n- **WHEN** user selects \"Specs\" filter while search results are displayed\r\n- **THEN** only spec-type results are shown, change-type results are hidden\r\n\r\n#### Scenario: Default filter\r\n- **WHEN** the search dialog opens\r\n- **THEN** the \"All\" filter is selected by default, showing both spec and change results\r\n\r\n#### Scenario: Filter with no matching results\r\n- **WHEN** user selects a type filter and no results match that type\r\n- **THEN** a \"No results found\" message is displayed for that category\r\n","2026-02-13-phase3-markdown-and-search":"## ADDED Requirements\r\n\r\n### Requirement: Search dialog activation\r\nThe system SHALL provide a search dialog that can be opened via keyboard shortcut or UI interaction.\r\n\r\n#### Scenario: Open search with keyboard shortcut\r\n- **WHEN** user presses `Cmd+K` (macOS) or `Ctrl+K` (other platforms) anywhere in the application\r\n- **THEN** a search dialog modal opens with focus on the search input field\r\n\r\n#### Scenario: Open search via header button\r\n- **WHEN** user clicks the search button in the application header\r\n- **THEN** the search dialog modal opens with focus on the search input field\r\n\r\n#### Scenario: Close search with Escape\r\n- **WHEN** the search dialog is open and user presses `Escape`\r\n- **THEN** the search dialog closes\r\n\r\n#### Scenario: Close search by clicking backdrop\r\n- **WHEN** the search dialog is open and user clicks outside the dialog\r\n- **THEN** the search dialog closes\r\n\r\n### Requirement: Search query execution\r\nThe system SHALL search across all specs and changes content by calling the backend search API with debounced input.\r\n\r\n#### Scenario: Debounced search on input\r\n- **WHEN** user types a query in the search input\r\n- **THEN** the system waits 300ms after the last keystroke before sending the search request to `GET /api/openspec/search`\r\n\r\n#### Scenario: Display search results\r\n- **WHEN** the search API returns results\r\n- **THEN** results are displayed grouped by type (Specs and Changes), each showing the name and a context preview snippet\r\n\r\n#### Scenario: No results found\r\n- **WHEN** the search API returns an empty array\r\n- **THEN** the dialog displays a \"No results found\" message\r\n\r\n#### Scenario: Empty query\r\n- **WHEN** the search input is empty\r\n- **THEN** no search request is made and the results area shows a prompt to start typing\r\n\r\n### Requirement: Search result navigation\r\nThe system SHALL allow users to navigate to search results using keyboard or mouse.\r\n\r\n#### Scenario: Click to navigate\r\n- **WHEN** user clicks on a search result\r\n- **THEN** the application navigates to the corresponding page (`/specs/:topic` for spec results, `/changes/:slug` for change results) and the search dialog closes\r\n\r\n#### Scenario: Keyboard navigation with arrow keys\r\n- **WHEN** user presses the down arrow key in the search dialog\r\n- **THEN** the next result item is highlighted\r\n- **AND** pressing the up arrow key highlights the previous result item\r\n\r\n#### Scenario: Confirm selection with Enter\r\n- **WHEN** user presses Enter with a result item highlighted\r\n- **THEN** the application navigates to that result's page and the search dialog closes\r\n"},"shared-layout":{"2026-02-17-spec-graph-view":"## MODIFIED Requirements\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, Changes, and Graph. Each link SHALL have an associated icon (LayoutDashboard for Overview, FileText for Specs, GitBranch for Changes, Share2 for Graph). The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL support two states: expanded (240px width, showing icons and labels) and collapsed (56px width, showing icons only). A toggle button at the bottom of the sidebar SHALL switch between states. The main content area left margin SHALL adjust to match the current sidebar width.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, Changes, and Graph with corresponding icons\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Graph page\r\n- **THEN** the \"Graph\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar expanded on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is expanded\r\n- **THEN** the sidebar is displayed at 240px width with icons and text labels, and main content has matching left margin\r\n\r\n#### Scenario: Sidebar collapsed on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is collapsed\r\n- **THEN** the sidebar is displayed at 56px width with icons only, and main content has matching left margin\r\n","2026-02-16-ui-design-polish-p2":"## MODIFIED Requirements\r\n\r\n### Requirement: TabView component\r\nThe system SHALL provide a reusable TabView component that renders tab headers and switches between tab content panels. When switching tabs, the new content panel SHALL fade in with a 150ms CSS animation.\r\n\r\n#### Scenario: Switch tabs\r\n- **WHEN** user clicks a tab header\r\n- **THEN** the corresponding tab content panel is displayed with a fade-in animation (150ms duration) and the previous panel is hidden\r\n\r\n#### Scenario: Default tab\r\n- **WHEN** TabView is first rendered\r\n- **THEN** the first tab is selected by default\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** user has `prefers-reduced-motion: reduce` enabled\r\n- **THEN** tab content switches instantly without fade animation\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Main content area top spacing\r\nThe system SHALL render the main content area with sufficient top spacing below the fixed header to provide visual breathing room between the navbar and page content. The top padding SHALL be at least 72px (header height 56px + 16px spacing).\r\n\r\n#### Scenario: Page title spacing\r\n- **WHEN** any page is rendered within the Layout\r\n- **THEN** the first content element (typically h1) has at least 16px of visual spacing below the header bar\r\n\r\n### Requirement: Back navigation link styling\r\nThe system SHALL render back navigation links (e.g., \"← Back to Specs\", \"← Back to Changes\") at base font size (16px) with medium font weight for adequate visibility and clickability.\r\n\r\n#### Scenario: Back link display\r\n- **WHEN** user views a detail page (SpecDetail or ChangeDetail)\r\n- **THEN** the back navigation link is displayed at 16px font size with medium weight, muted color, and accent color on hover\r\n","2026-02-16-ui-design-polish-p0-p1":"## MODIFIED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: an inline SVG logomark (S-curve with diamond accents, 24x24) followed by the \"spek\" brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button with `aria-label=\"Open navigation menu\"` and hide the repo path. The header SHALL also include a theme toggle button. The logomark SVG SHALL use `currentColor` to follow the accent color, ensuring theme compatibility.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the SVG logomark alongside \"spek\" brand text, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button with `aria-label=\"Open navigation menu\"`, the SVG logomark alongside \"spek\" brand text, search button, and theme toggle, but hides the repo path\r\n\r\n#### Scenario: Logo theme compatibility\r\n- **WHEN** the user toggles between dark and light theme\r\n- **THEN** the logomark color adjusts automatically via the accent color CSS variable\r\n\r\n### Requirement: TaskProgress component\r\nThe system SHALL provide a reusable TaskProgress component that displays a progress bar with completed/total count. The progress bar color SHALL reflect completion status: amber/accent color when incomplete, green when all tasks are completed (completed equals total).\r\n\r\n#### Scenario: Display progress\r\n- **WHEN** TaskProgress is rendered with `completed=3` and `total=5`\r\n- **THEN** a progress bar at 60% width is shown in amber/accent color with text \"3 / 5\"\r\n\r\n#### Scenario: Display completed progress\r\n- **WHEN** TaskProgress is rendered with `completed=5` and `total=5`\r\n- **THEN** a progress bar at 100% width is shown in green color with text \"5 / 5\"\r\n\r\n#### Scenario: Zero tasks\r\n- **WHEN** TaskProgress is rendered with `total=0`\r\n- **THEN** component displays \"No tasks\" or an empty state\r\n\r\n## ADDED Requirements\r\n\r\n### Requirement: Custom typography\r\nThe system SHALL use \"Plus Jakarta Sans\" as the primary font family for all UI text, loaded via Google Fonts CDN. The font stack SHALL include `sans-serif` as fallback for offline environments. Code and monospace text SHALL continue to use \"JetBrains Mono\".\r\n\r\n#### Scenario: Font loading\r\n- **WHEN** the application loads in a browser with internet access\r\n- **THEN** \"Plus Jakarta Sans\" is loaded and applied to all non-code text elements\r\n\r\n#### Scenario: Font fallback\r\n- **WHEN** the application loads without internet access (or Google Fonts is blocked)\r\n- **THEN** the browser falls back to the system default sans-serif font\r\n\r\n#### Scenario: Reduced motion preference\r\n- **WHEN** the user has `prefers-reduced-motion: reduce` set in their OS/browser\r\n- **THEN** all CSS entry animations are disabled\r\n","2026-02-14-add-sidebar-toggle":"## MODIFIED Requirements\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, and Changes. Each link SHALL have an associated icon (LayoutDashboard for Overview, FileText for Specs, GitBranch for Changes). The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL support two states: expanded (240px width, showing icons and labels) and collapsed (56px width, showing icons only). A toggle button at the bottom of the sidebar SHALL switch between states. The main content area left margin SHALL adjust to match the current sidebar width.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, and Changes with corresponding icons\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Dashboard page\r\n- **THEN** the \"Overview\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar expanded on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is expanded\r\n- **THEN** the sidebar is displayed at 240px width with icons and text labels, and main content has matching left margin\r\n\r\n#### Scenario: Sidebar collapsed on desktop viewport\r\n- **WHEN** the viewport is at or above 768px and sidebar is collapsed\r\n- **THEN** the sidebar is displayed at 56px width with icons only, and main content has matching left margin\r\n","2026-02-13-apply-brand-logo":"## MODIFIED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: an inline SVG logomark (S-curve with diamond accents, 24x24) followed by the \"spek\" brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button and hide the repo path. The header SHALL also include a theme toggle button. The logomark SVG SHALL use `currentColor` to follow the accent color, ensuring theme compatibility.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the SVG logomark alongside \"spek\" brand text, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button, the SVG logomark alongside \"spek\" brand text, search button, and theme toggle, but hides the repo path\r\n\r\n#### Scenario: Logo theme compatibility\r\n- **WHEN** the user toggles between dark and light theme\r\n- **THEN** the logomark color adjusts automatically via the accent color CSS variable\r\n","2026-02-13-phase4-polish-and-enhancement":"## MODIFIED Requirements\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a sidebar with navigation links: Overview (Dashboard), Specs, and Changes. The current route SHALL be visually highlighted. On viewports below 768px, the sidebar SHALL be hidden by default and displayed as an overlay when toggled. On viewports at or above 768px, the sidebar SHALL be displayed in a fixed position (240px width).\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, and Changes\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Dashboard page\r\n- **THEN** the \"Overview\" link in the sidebar is highlighted with the accent color\r\n\r\n#### Scenario: Sidebar on mobile viewport\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar is hidden by default and only shown when the hamburger menu is activated\r\n\r\n#### Scenario: Sidebar on desktop viewport\r\n- **WHEN** the viewport is at or above 768px\r\n- **THEN** the sidebar is displayed in its fixed position (240px width)\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: the \"spek\" logo/brand text (left), a search button (center), and the current repo path (right, desktop only). On mobile viewports, the header SHALL include a hamburger menu button and hide the repo path. The header SHALL also include a theme toggle button.\r\n\r\n#### Scenario: Display header on desktop\r\n- **WHEN** any page within the Layout is rendered on a viewport at or above 768px\r\n- **THEN** the header displays the spek brand, search button, theme toggle, and current repo path\r\n\r\n#### Scenario: Display header on mobile\r\n- **WHEN** any page within the Layout is rendered on a viewport below 768px\r\n- **THEN** the header displays a hamburger button, the spek brand, search button, and theme toggle, but hides the repo path\r\n","2026-02-13-phase2-core-ui-pages":"## ADDED Requirements\r\n\r\n### Requirement: Header component\r\nThe system SHALL render a fixed header bar (56px height) containing: the \"spek\" logo/brand text (left), a search button placeholder (center), and the current repo path (right).\r\n\r\n#### Scenario: Display header\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the header displays the spek brand, a disabled search button, and the current repo path from RepoContext\r\n\r\n### Requirement: Sidebar navigation\r\nThe system SHALL render a fixed sidebar (240px width) with navigation links: Overview (Dashboard), Specs, and Changes. The current route SHALL be visually highlighted.\r\n\r\n#### Scenario: Display sidebar links\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** the sidebar shows navigation links for Overview, Specs, and Changes\r\n\r\n#### Scenario: Highlight active route\r\n- **WHEN** user is on the Dashboard page\r\n- **THEN** the \"Overview\" link in the sidebar is highlighted with the accent color\r\n\r\n### Requirement: TaskProgress component\r\nThe system SHALL provide a reusable TaskProgress component that displays a progress bar with completed/total count.\r\n\r\n#### Scenario: Display progress\r\n- **WHEN** TaskProgress is rendered with `completed=3` and `total=5`\r\n- **THEN** a progress bar at 60% width is shown with text \"3 / 5\"\r\n\r\n#### Scenario: Zero tasks\r\n- **WHEN** TaskProgress is rendered with `total=0`\r\n- **THEN** component displays \"No tasks\" or an empty state\r\n\r\n### Requirement: TabView component\r\nThe system SHALL provide a reusable TabView component that renders tab headers and switches between tab content panels.\r\n\r\n#### Scenario: Switch tabs\r\n- **WHEN** user clicks a tab header\r\n- **THEN** the corresponding tab content panel is displayed and the previous panel is hidden\r\n\r\n#### Scenario: Default tab\r\n- **WHEN** TabView is first rendered\r\n- **THEN** the first tab is selected by default\r\n"},"sidebar-toggle":{"2026-02-14-add-sidebar-toggle":"## ADDED Requirements\r\n\r\n### Requirement: Sidebar collapse toggle button\r\nThe system SHALL display a toggle button at the bottom of the sidebar (above the Resync button) that collapses or expands the sidebar. The button SHALL display a left-pointing chevron (`«`) when the sidebar is expanded and a right-pointing chevron (`»`) when collapsed.\r\n\r\n#### Scenario: Toggle sidebar from expanded to collapsed\r\n- **WHEN** the sidebar is expanded and the user clicks the toggle button\r\n- **THEN** the sidebar collapses to 56px width showing only navigation icons\r\n\r\n#### Scenario: Toggle sidebar from collapsed to expanded\r\n- **WHEN** the sidebar is collapsed and the user clicks the toggle button\r\n- **THEN** the sidebar expands to the full 240px width showing icons and labels\r\n\r\n### Requirement: Collapsed sidebar icon-only navigation\r\nThe system SHALL display navigation items as icon-only buttons when the sidebar is collapsed. Each navigation link SHALL display a corresponding icon: LayoutDashboard icon for Overview, FileText icon for Specs, and GitBranch icon for Changes. Each icon button SHALL include a `title` attribute showing the full link label.\r\n\r\n#### Scenario: Display collapsed navigation with icons\r\n- **WHEN** the sidebar is in collapsed state\r\n- **THEN** navigation items display as icon-only buttons with tooltips\r\n\r\n#### Scenario: Navigate from collapsed sidebar\r\n- **WHEN** the user clicks a navigation icon in collapsed state\r\n- **THEN** the app navigates to the corresponding route\r\n\r\n#### Scenario: Active route indication in collapsed state\r\n- **WHEN** the user is on the Specs page and sidebar is collapsed\r\n- **THEN** the Specs icon is highlighted with the accent color\r\n\r\n### Requirement: Collapsed sidebar Resync button\r\nThe system SHALL display the Resync button as icon-only in collapsed state, without the text label, and with a `title` attribute for tooltip.\r\n\r\n#### Scenario: Resync button in collapsed state\r\n- **WHEN** the sidebar is collapsed\r\n- **THEN** the Resync button displays only the sync icon with a tooltip\r\n\r\n### Requirement: Sidebar collapse state persistence\r\nThe system SHALL persist the sidebar collapse state to localStorage (key: `spek-sidebar-collapsed`) in the web version. On page load, the sidebar SHALL restore the previously saved state. In VS Code webview, the state SHALL default to expanded and not persist across sessions.\r\n\r\n#### Scenario: Persist collapsed state in web version\r\n- **WHEN** the user collapses the sidebar and refreshes the page\r\n- **THEN** the sidebar remains collapsed after reload\r\n\r\n#### Scenario: Default state in VS Code webview\r\n- **WHEN** the webview is first opened\r\n- **THEN** the sidebar is in expanded state\r\n\r\n### Requirement: Sidebar transition animation\r\nThe system SHALL animate the sidebar width change and main content margin with a smooth CSS transition (200ms duration).\r\n\r\n#### Scenario: Smooth collapse animation\r\n- **WHEN** the user clicks the toggle button\r\n- **THEN** the sidebar width and main content margin animate smoothly over 200ms\r\n\r\n### Requirement: Mobile behavior unchanged\r\nThe sidebar toggle feature SHALL only apply to desktop viewports (768px and above). On mobile viewports, the existing overlay sidebar behavior SHALL remain unchanged.\r\n\r\n#### Scenario: Mobile viewport ignores collapse state\r\n- **WHEN** the viewport is below 768px\r\n- **THEN** the sidebar uses the existing overlay behavior regardless of collapse state\r\n"},"spa-routing":{"2026-02-13-phase2-core-ui-pages":"## ADDED Requirements\r\n\r\n### Requirement: Client-side routing\r\nThe system SHALL use React Router v7 with `createBrowserRouter` to define the following routes:\r\n\r\n| Path | Page | Layout |\r\n|------|------|--------|\r\n| `/` | SelectRepo | None |\r\n| `/dashboard` | Dashboard | Layout |\r\n| `/specs` | SpecList | Layout |\r\n| `/specs/:topic` | SpecDetail | Layout |\r\n| `/changes` | ChangeList | Layout |\r\n| `/changes/:slug` | ChangeDetail | Layout |\r\n\r\n#### Scenario: Route to SelectRepo\r\n- **WHEN** user navigates to `/`\r\n- **THEN** the SelectRepo page is rendered without Layout wrapper\r\n\r\n#### Scenario: Route to Dashboard with Layout\r\n- **WHEN** user navigates to `/dashboard`\r\n- **THEN** the Dashboard page is rendered within the shared Layout (Header + Sidebar + Main)\r\n\r\n### Requirement: RepoContext state management\r\nThe system SHALL provide a React Context (`RepoContext`) that stores the current repo path. All API hooks SHALL read the repo path from this context.\r\n\r\n#### Scenario: Set repo path\r\n- **WHEN** user selects a repo on the SelectRepo page\r\n- **THEN** `RepoContext.repoPath` is updated and available to all child components\r\n\r\n#### Scenario: Redirect when no repo selected\r\n- **WHEN** user navigates to any page other than `/` without a repo path in context\r\n- **THEN** system redirects to `/`\r\n\r\n### Requirement: API hooks\r\nThe system SHALL provide custom React hooks in `useOpenSpec.ts` that encapsulate API calls. Each hook SHALL return `{ data, loading, error }` and automatically include the `dir` query parameter from RepoContext.\r\n\r\n#### Scenario: Hook returns loading state\r\n- **WHEN** an API hook is called and the request is in flight\r\n- **THEN** hook returns `{ data: null, loading: true, error: null }`\r\n\r\n#### Scenario: Hook returns data\r\n- **WHEN** the API request succeeds\r\n- **THEN** hook returns `{ data: <response>, loading: false, error: null }`\r\n\r\n#### Scenario: Hook returns error\r\n- **WHEN** the API request fails\r\n- **THEN** hook returns `{ data: null, loading: false, error: <error message> }`\r\n"},"spec-browsing":{"2026-02-16-ui-design-polish-p2":"## MODIFIED Requirements\r\n\r\n### Requirement: Spec list with filtering\r\nThe system SHALL display all specs sorted alphabetically with history count metadata. A filter input SHALL allow instant client-side filtering by spec topic name. Each spec item SHALL display the topic name and the number of related changes (history count) as secondary information.\r\n\r\n#### Scenario: Display all specs\r\n- **WHEN** user navigates to the SpecList page\r\n- **THEN** all spec topics are listed alphabetically, each showing the topic name and history change count\r\n\r\n#### Scenario: Filter specs\r\n- **WHEN** user types in the filter input\r\n- **THEN** the list is filtered in real-time to show only specs whose topic name contains the search text (case-insensitive)\r\n\r\n#### Scenario: Spec with no history\r\n- **WHEN** a spec has zero related changes\r\n- **THEN** the history count is not displayed (or shows \"No changes\")\r\n","2026-02-13-phase2-core-ui-pages":"## ADDED Requirements\r\n\r\n### Requirement: Spec list with filtering\r\nThe system SHALL display all specs sorted alphabetically. A filter input SHALL allow instant client-side filtering by spec topic name.\r\n\r\n#### Scenario: Display all specs\r\n- **WHEN** user navigates to the SpecList page\r\n- **THEN** all spec topics are listed alphabetically\r\n\r\n#### Scenario: Filter specs\r\n- **WHEN** user types in the filter input\r\n- **THEN** the list is filtered in real-time to show only specs whose topic name contains the search text (case-insensitive)\r\n\r\n### Requirement: Spec detail display\r\nThe system SHALL display the full content of a spec when the user navigates to its detail page. The raw markdown content SHALL be shown (react-markdown rendering deferred to Phase 3).\r\n\r\n#### Scenario: View spec content\r\n- **WHEN** user navigates to `/specs/:topic`\r\n- **THEN** system displays the spec topic as title and the full spec.md content\r\n\r\n#### Scenario: Spec not found\r\n- **WHEN** user navigates to a spec topic that does not exist\r\n- **THEN** system displays a \"not found\" message\r\n\r\n### Requirement: Related changes display\r\nThe spec detail page SHALL display a list of changes that affect the spec (from the API's `relatedChanges` field). Each change SHALL be a link to its detail page.\r\n\r\n#### Scenario: Show related changes\r\n- **WHEN** viewing a spec that has related changes\r\n- **THEN** a \"Related Changes\" section lists each change as a clickable link to `/changes/:slug`\r\n\r\n#### Scenario: No related changes\r\n- **WHEN** viewing a spec with no related changes\r\n- **THEN** the \"Related Changes\" section shows an empty state message\r\n"},"spec-diff":{"2026-02-17-spec-diff-viewer":"## ADDED Requirements\r\n\r\n### Requirement: Read spec content at a specific change version\r\nThe system SHALL provide a core function `readSpecAtChange(repoDir, topic, slug)` that reads the spec content from a specific change's delta spec file. It SHALL check both active (`openspec/changes/<slug>/specs/<topic>/spec.md`) and archived (`openspec/changes/archive/<slug>/specs/<topic>/spec.md`) change directories.\r\n\r\n#### Scenario: Read spec from active change\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"2026-01-15-add-oauth\")` is called\r\n- **AND** `openspec/changes/2026-01-15-add-oauth/specs/user-auth/spec.md` exists\r\n- **THEN** it returns `{ content: \"<file contents>\" }`\r\n\r\n#### Scenario: Read spec from archived change\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"2025-12-01-init\")` is called\r\n- **AND** the change is in the archive directory\r\n- **THEN** it returns `{ content: \"<file contents>\" }` from the archive path\r\n\r\n#### Scenario: Spec version not found\r\n- **WHEN** `readSpecAtChange(repoDir, \"user-auth\", \"nonexistent-slug\")` is called\r\n- **AND** no delta spec file exists for that topic in that change\r\n- **THEN** it returns `null`\r\n\r\n### Requirement: Spec version diff API endpoint\r\nThe system SHALL expose `GET /api/openspec/specs/:topic/at/:slug?dir=...` that returns the spec content at a specific change version. The VS Code extension host SHALL handle a `getSpecAtChange` message with the same semantics.\r\n\r\n#### Scenario: Fetch spec at change version via REST\r\n- **WHEN** client calls `GET /api/openspec/specs/user-auth/at/2026-01-15-add-oauth?dir=/repo`\r\n- **THEN** the server returns `{ \"content\": \"<delta spec content>\" }` with status 200\r\n\r\n#### Scenario: Spec version not found via REST\r\n- **WHEN** client calls `GET /api/openspec/specs/user-auth/at/nonexistent?dir=/repo`\r\n- **THEN** the server returns `{ \"error\": \"Spec version not found\" }` with status 404\r\n\r\n#### Scenario: VS Code extension handles getSpecAtChange\r\n- **WHEN** the webview sends `{ type: \"request\", method: \"getSpecAtChange\", params: { topic, slug } }`\r\n- **THEN** the extension host calls `readSpecAtChange` and returns the result\r\n\r\n### Requirement: Diff viewer UI component\r\nThe system SHALL provide a `SpecDiffViewer` component that renders a unified diff between two spec content strings. Diff computation SHALL be done client-side using the `diff` npm package's `diffLines` function.\r\n\r\n#### Scenario: Display unified diff\r\n- **WHEN** the component receives two content strings (old and new)\r\n- **THEN** it renders a unified diff view with added lines highlighted in green and removed lines highlighted in red\r\n\r\n#### Scenario: Identical content\r\n- **WHEN** both content strings are identical\r\n- **THEN** it displays a message indicating no differences found\r\n\r\n#### Scenario: Empty old content\r\n- **WHEN** the old content is empty (new spec)\r\n- **THEN** all lines in the new content are shown as added\r\n\r\n### Requirement: Version comparison interaction on SpecDetail page\r\nThe system SHALL add a comparison mode to the SpecDetail page. Users can select a history entry to compare against the current spec content, or select two history entries to compare against each other.\r\n\r\n#### Scenario: Compare current vs. history version\r\n- **WHEN** the user clicks a \"Compare\" action on a history timeline entry\r\n- **THEN** the system fetches the spec content at that change version\r\n- **AND** displays a diff view comparing the change version (old) against the current spec content (new)\r\n\r\n#### Scenario: Compare two history versions\r\n- **WHEN** the user selects two history entries for comparison\r\n- **THEN** the system fetches both change versions\r\n- **AND** displays a diff view with the earlier version as old and the later version as new\r\n\r\n#### Scenario: Exit diff mode\r\n- **WHEN** the user is viewing a diff and clicks \"Close\" or \"Back to spec\"\r\n- **THEN** the diff view is dismissed and the original spec content is shown again\r\n\r\n#### Scenario: No history available\r\n- **WHEN** a spec has no history entries\r\n- **THEN** no comparison UI is shown\r\n"},"spec-history":{"2026-02-17-spec-diff-viewer":"## MODIFIED Requirements\r\n\r\n### Requirement: Spec history timeline UI\r\nThe system SHALL display a visual timeline on the SpecDetail page showing all changes that affected the spec. Each timeline entry MUST display the date, change description, and a link to the change detail page. Each timeline entry SHALL also include a \"Compare\" action that triggers diff comparison against the current spec content.\r\n\r\n#### Scenario: Display history timeline\r\n- **WHEN** the SpecDetail page is rendered for a spec with related changes\r\n- **THEN** a \"History\" section is displayed with a vertical timeline showing each change chronologically\r\n\r\n#### Scenario: Timeline entry links to change\r\n- **WHEN** the user clicks on a timeline entry's title or description\r\n- **THEN** the system navigates to the corresponding change detail page\r\n\r\n#### Scenario: No history\r\n- **WHEN** the SpecDetail page is rendered for a spec with no related changes\r\n- **THEN** the \"History\" section displays a message indicating no changes have affected this spec\r\n\r\n#### Scenario: Timeline entry compare action\r\n- **WHEN** the user clicks the \"Compare\" action on a timeline entry\r\n- **THEN** the system enters diff comparison mode showing the difference between that change version and the current spec content\r\n","2026-02-13-spec-history-git-timestamp-cache":"## MODIFIED Requirements\r\n\r\n### Requirement: Spec history data in API response\r\nThe system SHALL include a `history` array in the `GET /api/openspec/specs/:topic` response. Each entry MUST contain the change slug, date (if parseable from slug), timestamp (ISO 8601 from git commit cache, or null if unavailable), description, and status (active or archived).\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** a spec has been affected by one or more changes (i.e., changes that contain a delta spec for this topic)\r\n- **THEN** the API response includes a `history` array with entries sorted by git commit timestamp descending (most recent first)\r\n- **AND** if two entries have the same date, the git commit timestamp determines their order\r\n- **AND** each entry contains `{ slug, date, timestamp, description, status }`\r\n\r\n#### Scenario: Spec with no related changes\r\n- **WHEN** a spec has no related changes\r\n- **THEN** the API response includes an empty `history` array\r\n\r\n#### Scenario: Fallback sorting when git timestamp unavailable\r\n- **WHEN** a history entry has no git commit timestamp (e.g., uncommitted change or non-git repo)\r\n- **THEN** the entry's `timestamp` field is null\r\n- **AND** sorting falls back to the date parsed from the slug\r\n","2026-02-13-phase4-polish-and-enhancement":"## ADDED Requirements\r\n\r\n### Requirement: Spec history data in API response\r\nThe system SHALL include a `history` array in the `GET /api/openspec/specs/:topic` response. Each entry MUST contain the change slug, date (if parseable from slug), description, and status (active or archived).\r\n\r\n#### Scenario: Spec with related changes\r\n- **WHEN** a spec has been affected by one or more changes (i.e., changes that contain a delta spec for this topic)\r\n- **THEN** the API response includes a `history` array with entries sorted by date descending (most recent first)\r\n- **AND** each entry contains `{ slug, date, description, status }`\r\n\r\n#### Scenario: Spec with no related changes\r\n- **WHEN** a spec has no related changes\r\n- **THEN** the API response includes an empty `history` array\r\n\r\n### Requirement: Spec history timeline UI\r\nThe system SHALL display a visual timeline on the SpecDetail page showing all changes that affected the spec. Each timeline entry MUST display the date, change description, and a link to the change detail page.\r\n\r\n#### Scenario: Display history timeline\r\n- **WHEN** the SpecDetail page is rendered for a spec with related changes\r\n- **THEN** a \"History\" section is displayed with a vertical timeline showing each change chronologically\r\n\r\n#### Scenario: Timeline entry links to change\r\n- **WHEN** the user clicks on a timeline entry\r\n- **THEN** the system navigates to the corresponding change detail page\r\n\r\n#### Scenario: No history\r\n- **WHEN** the SpecDetail page is rendered for a spec with no related changes\r\n- **THEN** the \"History\" section displays a message indicating no changes have affected this spec\r\n"},"task-parser":{"2026-02-13-vscode-extension":"## MODIFIED Requirements\r\n\r\n### Requirement: Parse task checkboxes\r\nThe task parser SHALL be a pure function in the `@spek/core` package that reads a tasks.md content string and extracts checkbox items with their completion status. It SHALL have no dependency on Express or any HTTP framework.\r\n\r\n#### Scenario: Parse file with mixed checkboxes\r\n- **WHEN** parser receives a string containing `- [x] Done task` and `- [ ] Pending task`\r\n- **THEN** it returns each task with `text` and `completed` (boolean) fields\r\n\r\n### Requirement: Group tasks by section\r\nThe task parser SHALL group tasks under their `##` heading sections.\r\n\r\n#### Scenario: Tasks under multiple sections\r\n- **WHEN** parser receives a string with `## Phase 1` followed by tasks and `## Phase 2` followed by tasks\r\n- **THEN** it returns sections array, each with `title` and `tasks` array\r\n\r\n#### Scenario: Tasks without section headings\r\n- **WHEN** parser receives a string where tasks appear before any `##` heading\r\n- **THEN** those tasks are grouped under a default section with empty title\r\n\r\n### Requirement: Calculate task statistics\r\nThe task parser SHALL compute aggregate statistics from parsed tasks.\r\n\r\n#### Scenario: Calculate completion stats\r\n- **WHEN** parser processes a string with 10 total checkboxes where 7 are checked\r\n- **THEN** it returns `{ total: 10, completed: 7 }` along with the sections breakdown\r\n\r\n#### Scenario: Empty tasks file\r\n- **WHEN** parser processes an empty string or one with no checkboxes\r\n- **THEN** it returns `{ total: 0, completed: 0, sections: [] }`\r\n","2026-02-13-phase1-skeleton-and-api":"## ADDED Requirements\r\n\r\n### Requirement: Parse task checkboxes\r\nThe task parser SHALL read a tasks.md file and extract checkbox items with their completion status.\r\n\r\n#### Scenario: Parse file with mixed checkboxes\r\n- **WHEN** parser reads a tasks.md containing `- [x] Done task` and `- [ ] Pending task`\r\n- **THEN** it returns each task with `text` and `completed` (boolean) fields\r\n\r\n### Requirement: Group tasks by section\r\nThe task parser SHALL group tasks under their `##` heading sections.\r\n\r\n#### Scenario: Tasks under multiple sections\r\n- **WHEN** parser reads a tasks.md with `## Phase 1` followed by tasks and `## Phase 2` followed by tasks\r\n- **THEN** it returns sections array, each with `title` and `tasks` array\r\n\r\n#### Scenario: Tasks without section headings\r\n- **WHEN** parser reads a tasks.md where tasks appear before any `##` heading\r\n- **THEN** those tasks are grouped under a default section with empty title\r\n\r\n### Requirement: Calculate task statistics\r\nThe task parser SHALL compute aggregate statistics from parsed tasks.\r\n\r\n#### Scenario: Calculate completion stats\r\n- **WHEN** parser processes a tasks.md with 10 total checkboxes where 7 are checked\r\n- **THEN** it returns `{ total: 10, completed: 7 }` along with the sections breakdown\r\n\r\n#### Scenario: Empty tasks file\r\n- **WHEN** parser processes an empty tasks.md or one with no checkboxes\r\n- **THEN** it returns `{ total: 0, completed: 0, sections: [] }`\r\n"},"theme-toggle":{"2026-02-13-phase4-polish-and-enhancement":"## ADDED Requirements\r\n\r\n### Requirement: Theme state management\r\nThe system SHALL provide a ThemeContext that manages the current theme (\"dark\" or \"light\") and exposes a toggle function. The theme state MUST be persisted in localStorage under the key `spek:theme`.\r\n\r\n#### Scenario: Initialize from localStorage\r\n- **WHEN** the application loads and localStorage contains a saved theme preference\r\n- **THEN** the system applies the saved theme\r\n\r\n#### Scenario: Initialize from system preference\r\n- **WHEN** the application loads and no theme is saved in localStorage\r\n- **AND** the user's system preference is light mode (`prefers-color-scheme: light`)\r\n- **THEN** the system applies the light theme\r\n\r\n#### Scenario: Initialize default\r\n- **WHEN** the application loads and no theme is saved and no system preference is detected\r\n- **THEN** the system applies the dark theme as default\r\n\r\n#### Scenario: Toggle theme\r\n- **WHEN** the user triggers the theme toggle\r\n- **THEN** the current theme switches (dark → light or light → dark)\r\n- **AND** the new preference is saved to localStorage\r\n- **AND** the `data-theme` attribute on `<html>` is updated\r\n\r\n### Requirement: Light theme CSS variables\r\nThe system SHALL define a complete set of light theme CSS variables that override the dark theme defaults when `[data-theme=\"light\"]` is set on the `<html>` element.\r\n\r\n#### Scenario: Light theme applied\r\n- **WHEN** the `<html>` element has `data-theme=\"light\"`\r\n- **THEN** all color CSS variables (`--color-bg-primary`, `--color-bg-secondary`, `--color-bg-tertiary`, `--color-border`, `--color-text-primary`, `--color-text-secondary`, `--color-text-muted`, `--color-accent`, `--color-accent-hover`) are overridden with light-appropriate values\r\n\r\n#### Scenario: Dark theme applied\r\n- **WHEN** the `<html>` element has `data-theme=\"dark\"` or no `data-theme` attribute\r\n- **THEN** the default dark theme CSS variables are used\r\n\r\n### Requirement: Theme toggle button\r\nThe system SHALL display a theme toggle button in the header. The button MUST show a sun icon when in dark mode (indicating \"switch to light\") and a moon icon when in light mode (indicating \"switch to dark\").\r\n\r\n#### Scenario: Display toggle in header\r\n- **WHEN** any page within the Layout is rendered\r\n- **THEN** a theme toggle button is visible in the header area\r\n\r\n#### Scenario: Icon reflects current theme\r\n- **WHEN** the current theme is dark\r\n- **THEN** the toggle button displays a sun icon\r\n- **WHEN** the current theme is light\r\n- **THEN** the toggle button displays a moon icon\r\n"},"vscode-cicd":{"2026-02-14-vscode-cicd-publish":"## ADDED Requirements\r\n\r\n### Requirement: Tag-triggered publish workflow\r\n系統 SHALL 提供 GitHub Actions workflow，於 push 符合 `v*` pattern 的 tag 時自動觸發 VS Code extension 的 build 與 publish 流程。\r\n\r\n#### Scenario: Push version tag triggers workflow\r\n- **WHEN** 開發者 push 一個 `v0.2.0` 格式的 tag\r\n- **THEN** GitHub Actions workflow 自動觸發並執行完整 build chain\r\n\r\n#### Scenario: Non-matching tag does not trigger\r\n- **WHEN** 開發者 push 一個 `release-0.2.0` 或 `feat/something` 格式的 ref\r\n- **THEN** 此 workflow 不被觸發\r\n\r\n### Requirement: Full build chain execution\r\nWorkflow SHALL 依序執行完整 build chain：install dependencies → build @spek/core → build webview assets → build VS Code extension。\r\n\r\n#### Scenario: Build chain completes successfully\r\n- **WHEN** workflow 被觸發且所有 build 步驟成功\r\n- **THEN** `packages/vscode/dist/extension.js` 和 webview assets 皆存在且為最新\r\n\r\n#### Scenario: Build failure stops pipeline\r\n- **WHEN** 任一 build 步驟失敗\r\n- **THEN** 後續步驟不執行，workflow 標記為失敗\r\n\r\n### Requirement: Marketplace publish\r\nWorkflow SHALL 使用 `VSCE_PAT` secret 透過 `vsce publish` 將 extension 發佈到 VS Code Marketplace。\r\n\r\n#### Scenario: Successful publish\r\n- **WHEN** build chain 完成且 `VSCE_PAT` secret 有效\r\n- **THEN** extension 成功發佈到 VS Code Marketplace\r\n\r\n#### Scenario: Missing PAT secret\r\n- **WHEN** `VSCE_PAT` secret 未設定或已過期\r\n- **THEN** publish 步驟失敗，workflow 標記為失敗\r\n\r\n### Requirement: Manual trigger support\r\nWorkflow SHALL 支援 `workflow_dispatch` 手動觸發，方便除錯和測試。\r\n\r\n#### Scenario: Manual trigger from Actions UI\r\n- **WHEN** 開發者在 GitHub Actions UI 手動觸發此 workflow\r\n- **THEN** workflow 執行完整 build + publish 流程\r\n\r\n### Requirement: Version consistency check\r\nWorkflow SHALL 在 publish 前驗證 tag 版號與 `packages/vscode/package.json` 中的 version 欄位一致。\r\n\r\n#### Scenario: Version matches\r\n- **WHEN** tag `v0.2.0` 且 package.json version 為 `0.2.0`\r\n- **THEN** 繼續執行 publish\r\n\r\n#### Scenario: Version mismatch\r\n- **WHEN** tag `v0.3.0` 但 package.json version 為 `0.2.0`\r\n- **THEN** workflow 失敗並輸出版號不一致的錯誤訊息\r\n"},"vscode-extension-host":{"add-vscode-sidebar":"## MODIFIED Requirements\r\n\r\n### Requirement: Extension activation\r\nThe extension SHALL activate when a workspace containing an `openspec/` directory is opened, or when the user explicitly invokes a spek command. Upon activation, the extension SHALL register TreeView providers for the sidebar and display the Activity Bar icon.\r\n\r\n#### Scenario: Workspace with openspec directory\r\n- **WHEN** VS Code opens a workspace where the first workspace folder contains an `openspec/` directory\r\n- **THEN** the extension activates, displays a spek icon in the status bar, and registers the sidebar TreeView providers\r\n\r\n#### Scenario: Workspace without openspec directory\r\n- **WHEN** VS Code opens a workspace without an `openspec/` directory\r\n- **THEN** the extension remains inactive, no status bar icon is shown, and the sidebar is hidden\r\n\r\n#### Scenario: Manual activation via command\r\n- **WHEN** the user invokes the `spek.open` command from the command palette\r\n- **THEN** the extension activates and opens the spek Webview Panel\r\n\r\n### Requirement: Webview Panel lifecycle\r\nThe extension SHALL manage a single Webview Panel instance for displaying the spek UI. The panel SHALL support navigation commands from the extension host.\r\n\r\n#### Scenario: Open spek panel\r\n- **WHEN** the user invokes `spek.open` and no panel exists\r\n- **THEN** the extension creates a new Webview Panel in the active editor column with the title \"spek\"\r\n\r\n#### Scenario: Focus existing panel\r\n- **WHEN** the user invokes `spek.open` and a panel already exists\r\n- **THEN** the extension reveals (focuses) the existing panel instead of creating a new one\r\n\r\n#### Scenario: Panel disposal\r\n- **WHEN** the user closes the spek Webview Panel\r\n- **THEN** the extension cleans up the panel reference and associated message listeners\r\n\r\n#### Scenario: Navigate panel to route\r\n- **WHEN** the extension host sends a `navigate` message with a route path\r\n- **THEN** the webview navigates to the specified route using React Router\r\n","2026-02-13-vscode-extension":"## ADDED Requirements\r\n\r\n### Requirement: Extension activation\r\nThe extension SHALL activate when a workspace containing an `openspec/` directory is opened, or when the user explicitly invokes a spek command.\r\n\r\n#### Scenario: Workspace with openspec directory\r\n- **WHEN** VS Code opens a workspace where the first workspace folder contains an `openspec/` directory\r\n- **THEN** the extension activates and displays a spek icon in the status bar\r\n\r\n#### Scenario: Workspace without openspec directory\r\n- **WHEN** VS Code opens a workspace without an `openspec/` directory\r\n- **THEN** the extension remains inactive and no status bar icon is shown\r\n\r\n#### Scenario: Manual activation via command\r\n- **WHEN** the user invokes the `spek.open` command from the command palette\r\n- **THEN** the extension activates and opens the spek Webview Panel\r\n\r\n### Requirement: Webview Panel lifecycle\r\nThe extension SHALL manage a single Webview Panel instance for displaying the spek UI.\r\n\r\n#### Scenario: Open spek panel\r\n- **WHEN** the user invokes `spek.open` and no panel exists\r\n- **THEN** the extension creates a new Webview Panel in the active editor column with the title \"spek\"\r\n\r\n#### Scenario: Focus existing panel\r\n- **WHEN** the user invokes `spek.open` and a panel already exists\r\n- **THEN** the extension reveals (focuses) the existing panel instead of creating a new one\r\n\r\n#### Scenario: Panel disposal\r\n- **WHEN** the user closes the spek Webview Panel\r\n- **THEN** the extension cleans up the panel reference and associated message listeners\r\n\r\n### Requirement: Command registration\r\nThe extension SHALL register commands in the VS Code command palette.\r\n\r\n#### Scenario: Available commands\r\n- **WHEN** the extension is active\r\n- **THEN** the following commands are available: `spek.open` (Open spek) and `spek.search` (Search OpenSpec)\r\n\r\n#### Scenario: Search command\r\n- **WHEN** the user invokes `spek.search`\r\n- **THEN** the extension opens (or focuses) the spek panel and sends a message to trigger the search dialog\r\n\r\n### Requirement: Message handler for API requests\r\nThe extension host SHALL handle message-based API requests from the Webview and return responses using core module functions.\r\n\r\n#### Scenario: Handle API request\r\n- **WHEN** the Webview sends a message `{ type: 'request', id: 'req-1', method: 'getOverview' }`\r\n- **THEN** the extension host calls the corresponding core module function and replies with `{ type: 'response', id: 'req-1', data: <result> }`\r\n\r\n#### Scenario: Handle API error\r\n- **WHEN** the Webview sends a request and the core module function throws an error\r\n- **THEN** the extension host replies with `{ type: 'response', id: 'req-1', error: <error message> }`\r\n"},"vscode-marketplace-metadata":{"2026-02-14-add-changelog-entry":"## MODIFIED Requirements\r\n\r\n### Requirement: Extension version and changelog\r\nExtension SHALL 維護 CHANGELOG.md 記錄每個版本的功能異動，且 package.json version 欄位 SHALL 與最新 CHANGELOG entry 一致。\r\n\r\n#### Scenario: Version bump with new feature\r\n- **WHEN** 新功能（sidebar toggle）已實作完成\r\n- **THEN** package.json version 更新為 `0.2.0`，CHANGELOG.md 包含 `0.2.0` 區塊描述新功能\r\n","2026-02-13-vscode-marketplace-publish":"## ADDED Requirements\r\n\r\n### Requirement: Marketplace-ready package.json\r\nExtension 的 `package.json` SHALL 包含所有 VS Code Marketplace 發佈所需的欄位。\r\n\r\n#### Scenario: Required fields present\r\n- **WHEN** 執行 `vsce package` 打包 extension\r\n- **THEN** package.json 包含以下欄位且無 validation 錯誤：`publisher`、`repository`、`license`、`icon`、`categories`、`keywords`\r\n\r\n#### Scenario: Private flag removed\r\n- **WHEN** package.json 被讀取\r\n- **THEN** `\"private\"` 欄位 SHALL 不存在或為 `false`\r\n\r\n#### Scenario: Icon file exists\r\n- **WHEN** package.json 指定 `\"icon\": \"icon.png\"`\r\n- **THEN** `packages/vscode/icon.png` 檔案存在且為 128x128 以上的 PNG 圖片\r\n\r\n### Requirement: Marketplace README\r\nExtension 目錄下 SHALL 有獨立的 `README.md` 作為 Marketplace 頁面內容。\r\n\r\n#### Scenario: README content\r\n- **WHEN** Marketplace 頁面載入\r\n- **THEN** 顯示 extension 的功能說明、安裝方式與使用說明\r\n\r\n#### Scenario: README exists in extension directory\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `packages/vscode/README.md` 被包含在 `.vsix` 中\r\n\r\n### Requirement: CHANGELOG\r\nExtension 目錄下 SHALL 有 `CHANGELOG.md` 記錄版本變更。\r\n\r\n#### Scenario: CHANGELOG content\r\n- **WHEN** 使用者在 Marketplace 或 VS Code 中檢視 extension 的 changelog\r\n- **THEN** 顯示按版本分組的變更記錄\r\n\r\n### Requirement: vscodeignore configuration\r\n`.vscodeignore` SHALL 排除不需要包含在 `.vsix` 中的檔案，減少套件大小。\r\n\r\n#### Scenario: Source files excluded\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `src/`、`node_modules/`、`tsconfig.json`、`.gitignore` 不被包含在 `.vsix` 中\r\n\r\n#### Scenario: Required files included\r\n- **WHEN** 執行 `vsce package`\r\n- **THEN** `dist/`、`webview/`、`icon.png`、`README.md`、`CHANGELOG.md`、`LICENSE` 被包含在 `.vsix` 中\r\n\r\n### Requirement: Publish workflow\r\n使用者 SHALL 能透過 `vsce` CLI 將 extension 發佈到 Marketplace。\r\n\r\n#### Scenario: First-time publish\r\n- **WHEN** 使用者執行 `vsce login <publisher>` 並輸入有效的 PAT\r\n- **AND** 執行 `vsce publish`\r\n- **THEN** extension 成功發佈到 VS Code Marketplace\r\n\r\n#### Scenario: Version update publish\r\n- **WHEN** 使用者更新 package.json 版本號\r\n- **AND** 執行 `vsce publish`\r\n- **THEN** Marketplace 上的 extension 更新到新版本\r\n"},"webview-integration":{"2026-02-18-live-reload":"## MODIFIED Requirements\r\n\r\n### Requirement: Load React SPA in Webview\r\nThe Webview SHALL load the spek React application from the extension's bundled assets.\r\n\r\n#### Scenario: Webview HTML generation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** it generates an HTML document that loads the built React bundle with asset paths converted via `webview.asWebviewUri()`\r\n\r\n#### Scenario: Asset path resolution\r\n- **WHEN** the Webview HTML references JS or CSS files\r\n- **THEN** all asset paths SHALL use `webview.asWebviewUri()` to convert local file paths to Webview-safe URIs\r\n\r\n#### Scenario: File change notification forwarding\r\n- **WHEN** a file in the `openspec/` directory changes\r\n- **THEN** the Webview Panel SHALL forward the `{ type: \"fileChanged\" }` message to the React application so it can refresh its data\r\n","2026-02-17-add-vscode-tab-icon":"## ADDED Requirements\r\n\r\n### Requirement: Tab icon display\r\nThe Webview Panel SHALL display the spek logo as the tab icon for visual identification.\r\n\r\n#### Scenario: Tab icon is set on panel creation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** the panel's `iconPath` SHALL be set to the `webview/favicon.svg` file from the extension's bundled assets\r\n\r\n#### Scenario: Icon visibility across themes\r\n- **WHEN** the tab icon is displayed in either light or dark VS Code theme\r\n- **THEN** the icon SHALL be visually distinguishable against the tab bar background\r\n","2026-02-13-vscode-extension":"## ADDED Requirements\r\n\r\n### Requirement: Load React SPA in Webview\r\nThe Webview SHALL load the spek React application from the extension's bundled assets.\r\n\r\n#### Scenario: Webview HTML generation\r\n- **WHEN** the extension creates a Webview Panel\r\n- **THEN** it generates an HTML document that loads the built React bundle with asset paths converted via `webview.asWebviewUri()`\r\n\r\n#### Scenario: Asset path resolution\r\n- **WHEN** the Webview HTML references JS or CSS files\r\n- **THEN** all asset paths SHALL use `webview.asWebviewUri()` to convert local file paths to Webview-safe URIs\r\n\r\n### Requirement: Content Security Policy\r\nThe Webview SHALL enforce a Content Security Policy that allows the React application to function while preventing unauthorized content.\r\n\r\n#### Scenario: CSP configuration\r\n- **WHEN** the Webview HTML is generated\r\n- **THEN** it includes a CSP meta tag that allows scripts and styles from the extension's webview URI origin with a unique nonce, and disallows inline scripts without the nonce\r\n\r\n#### Scenario: Tailwind CSS compatibility\r\n- **WHEN** Tailwind CSS styles are loaded in the Webview\r\n- **THEN** all styles SHALL be loaded from external CSS files (not inline style tags) to comply with CSP\r\n\r\n### Requirement: Workspace path injection\r\nThe Webview SHALL receive the workspace path from the extension host so the React app can skip the repo selection page.\r\n\r\n#### Scenario: Initial workspace path\r\n- **WHEN** the Webview is created in a workspace with an `openspec/` directory\r\n- **THEN** the extension host sends a `{ type: 'init', workspacePath: '/path/to/repo' }` message after the Webview is ready\r\n\r\n#### Scenario: Webview ready handshake\r\n- **WHEN** the React app finishes mounting in the Webview\r\n- **THEN** it sends a `{ type: 'ready' }` message to the extension host to signal it can receive the workspace path\r\n\r\n### Requirement: Theme synchronization\r\nThe Webview SHALL respect the VS Code color theme.\r\n\r\n#### Scenario: Dark theme active\r\n- **WHEN** VS Code is using a dark color theme\r\n- **THEN** the Webview renders the spek dark theme\r\n\r\n#### Scenario: Light theme active\r\n- **WHEN** VS Code is using a light color theme\r\n- **THEN** the Webview renders the spek light theme\r\n\r\n#### Scenario: Theme change\r\n- **WHEN** the user changes the VS Code color theme while the Webview is open\r\n- **THEN** the Webview updates its theme to match\r\n"}},"graphData":{"nodes":[{"id":"spec:api-adapter","type":"spec","label":"api-adapter","historyCount":3},{"id":"spec:change-browsing","type":"spec","label":"change-browsing","historyCount":5},{"id":"spec:core-module","type":"spec","label":"core-module","historyCount":1},{"id":"spec:dashboard-view","type":"spec","label":"dashboard-view","historyCount":3},{"id":"spec:filesystem-api","type":"spec","label":"filesystem-api","historyCount":2},{"id":"spec:frontend-design-skill","type":"spec","label":"frontend-design-skill","historyCount":1},{"id":"spec:git-timestamp-cache","type":"spec","label":"git-timestamp-cache","historyCount":1},{"id":"spec:graph-view","type":"spec","label":"graph-view","historyCount":1},{"id":"spec:live-reload","type":"spec","label":"live-reload","historyCount":3},{"id":"spec:markdown-renderer","type":"spec","label":"markdown-renderer","historyCount":1},{"id":"spec:openspec-api","type":"spec","label":"openspec-api","historyCount":4},{"id":"spec:openspec-scanner","type":"spec","label":"openspec-scanner","historyCount":3},{"id":"spec:repo-selection","type":"spec","label":"repo-selection","historyCount":2},{"id":"spec:responsive-layout","type":"spec","label":"responsive-layout","historyCount":1},{"id":"spec:search-api","type":"spec","label":"search-api","historyCount":1},{"id":"spec:search-ui","type":"spec","label":"search-ui","historyCount":2},{"id":"spec:shared-layout","type":"spec","label":"shared-layout","historyCount":7},{"id":"spec:sidebar-toggle","type":"spec","label":"sidebar-toggle","historyCount":1},{"id":"spec:spa-routing","type":"spec","label":"spa-routing","historyCount":1},{"id":"spec:spec-browsing","type":"spec","label":"spec-browsing","historyCount":2},{"id":"spec:spec-diff","type":"spec","label":"spec-diff","historyCount":1},{"id":"spec:spec-history","type":"spec","label":"spec-history","historyCount":3},{"id":"spec:task-parser","type":"spec","label":"task-parser","historyCount":2},{"id":"spec:theme-toggle","type":"spec","label":"theme-toggle","historyCount":1},{"id":"spec:vscode-cicd","type":"spec","label":"vscode-cicd","historyCount":1},{"id":"spec:vscode-extension-host","type":"spec","label":"vscode-extension-host","historyCount":2},{"id":"spec:vscode-marketplace-metadata","type":"spec","label":"vscode-marketplace-metadata","historyCount":2},{"id":"spec:webview-integration","type":"spec","label":"webview-integration","historyCount":3},{"id":"change:add-vscode-sidebar","type":"change","label":"add vscode sidebar","date":null,"status":"active","specCount":2},{"id":"change:2026-02-13-apply-brand-logo","type":"change","label":"apply brand logo","date":"2026-02-13","status":"archived","specCount":1},{"id":"change:2026-02-13-fix-task-stats-and-capability-nav","type":"change","label":"fix task stats and capability nav","date":"2026-02-13","status":"archived","specCount":2},{"id":"change:2026-02-13-phase1-skeleton-and-api","type":"change","label":"phase1 skeleton and api","date":"2026-02-13","status":"archived","specCount":5},{"id":"change:2026-02-13-phase2-core-ui-pages","type":"change","label":"phase2 core ui pages","date":"2026-02-13","status":"archived","specCount":6},{"id":"change:2026-02-13-phase3-markdown-and-search","type":"change","label":"phase3 markdown and search","date":"2026-02-13","status":"archived","specCount":2},{"id":"change:2026-02-13-phase4-polish-and-enhancement","type":"change","label":"phase4 polish and enhancement","date":"2026-02-13","status":"archived","specCount":5},{"id":"change:2026-02-13-spec-history-git-timestamp-cache","type":"change","label":"spec history git timestamp cache","date":"2026-02-13","status":"archived","specCount":3},{"id":"change:2026-02-13-vscode-extension","type":"change","label":"vscode extension","date":"2026-02-13","status":"archived","specCount":6},{"id":"change:2026-02-13-vscode-marketplace-publish","type":"change","label":"vscode marketplace publish","date":"2026-02-13","status":"archived","specCount":1},{"id":"change:2026-02-14-add-changelog-entry","type":"change","label":"add changelog entry","date":"2026-02-14","status":"archived","specCount":1},{"id":"change:2026-02-14-add-sidebar-toggle","type":"change","label":"add sidebar toggle","date":"2026-02-14","status":"archived","specCount":2},{"id":"change:2026-02-14-vscode-cicd-publish","type":"change","label":"vscode cicd publish","date":"2026-02-14","status":"archived","specCount":1},{"id":"change:2026-02-15-add-demo-page","type":"change","label":"add demo page","date":"2026-02-15","status":"archived","specCount":1},{"id":"change:2026-02-15-add-frontend-design-skill","type":"change","label":"add frontend design skill","date":"2026-02-15","status":"archived","specCount":1},{"id":"change:2026-02-15-add-readme-acknowledgments","type":"change","label":"add readme acknowledgments","date":"2026-02-15","status":"archived","specCount":1},{"id":"change:2026-02-16-ui-design-polish-p0-p1","type":"change","label":"ui design polish p0 p1","date":"2026-02-16","status":"archived","specCount":3},{"id":"change:2026-02-16-ui-design-polish-p2","type":"change","label":"ui design polish p2","date":"2026-02-16","status":"archived","specCount":4},{"id":"change:2026-02-17-add-vscode-tab-icon","type":"change","label":"add vscode tab icon","date":"2026-02-17","status":"archived","specCount":1},{"id":"change:2026-02-17-spec-diff-viewer","type":"change","label":"spec diff viewer","date":"2026-02-17","status":"archived","specCount":3},{"id":"change:2026-02-17-spec-graph-view","type":"change","label":"spec graph view","date":"2026-02-17","status":"archived","specCount":3},{"id":"change:2026-02-18-fix-vscode-live-reload-directory-moves","type":"change","label":"fix vscode live reload directory moves","date":"2026-02-18","status":"archived","specCount":1},{"id":"change:2026-02-18-live-reload","type":"change","label":"live reload","date":"2026-02-18","status":"archived","specCount":2},{"id":"change:2026-02-21-add-change-timestamp","type":"change","label":"add change timestamp","date":"2026-02-21","status":"archived","specCount":3},{"id":"change:2026-02-21-fix-detect-fallback","type":"change","label":"fix detect fallback","date":"2026-02-21","status":"archived","specCount":1},{"id":"change:2026-02-21-sticky-change-detail-header","type":"change","label":"sticky change detail header","date":"2026-02-21","status":"archived","specCount":1},{"id":"change:2026-02-22-fix-change-not-found-on-refresh","type":"change","label":"fix change not found on refresh","date":"2026-02-22","status":"archived","specCount":1}],"edges":[{"source":"change:add-vscode-sidebar","target":"spec:vscode-extension-host"},{"source":"change:add-vscode-sidebar","target":"spec:vscode-sidebar"},{"source":"change:2026-02-13-apply-brand-logo","target":"spec:shared-layout"},{"source":"change:2026-02-13-fix-task-stats-and-capability-nav","target":"spec:change-browsing"},{"source":"change:2026-02-13-fix-task-stats-and-capability-nav","target":"spec:openspec-api"},{"source":"change:2026-02-13-phase1-skeleton-and-api","target":"spec:filesystem-api"},{"source":"change:2026-02-13-phase1-skeleton-and-api","target":"spec:openspec-api"},{"source":"change:2026-02-13-phase1-skeleton-and-api","target":"spec:openspec-scanner"},{"source":"change:2026-02-13-phase1-skeleton-and-api","target":"spec:search-api"},{"source":"change:2026-02-13-phase1-skeleton-and-api","target":"spec:task-parser"},{"source":"change:2026-02-13-phase2-core-ui-pages","target":"spec:change-browsing"},{"source":"change:2026-02-13-phase2-core-ui-pages","target":"spec:dashboard-view"},{"source":"change:2026-02-13-phase2-core-ui-pages","target":"spec:repo-selection"},{"source":"change:2026-02-13-phase2-core-ui-pages","target":"spec:shared-layout"},{"source":"change:2026-02-13-phase2-core-ui-pages","target":"spec:spa-routing"},{"source":"change:2026-02-13-phase2-core-ui-pages","target":"spec:spec-browsing"},{"source":"change:2026-02-13-phase3-markdown-and-search","target":"spec:markdown-renderer"},{"source":"change:2026-02-13-phase3-markdown-and-search","target":"spec:search-ui"},{"source":"change:2026-02-13-phase4-polish-and-enhancement","target":"spec:repo-selection"},{"source":"change:2026-02-13-phase4-polish-and-enhancement","target":"spec:responsive-layout"},{"source":"change:2026-02-13-phase4-polish-and-enhancement","target":"spec:shared-layout"},{"source":"change:2026-02-13-phase4-polish-and-enhancement","target":"spec:spec-history"},{"source":"change:2026-02-13-phase4-polish-and-enhancement","target":"spec:theme-toggle"},{"source":"change:2026-02-13-spec-history-git-timestamp-cache","target":"spec:git-timestamp-cache"},{"source":"change:2026-02-13-spec-history-git-timestamp-cache","target":"spec:openspec-api"},{"source":"change:2026-02-13-spec-history-git-timestamp-cache","target":"spec:spec-history"},{"source":"change:2026-02-13-vscode-extension","target":"spec:api-adapter"},{"source":"change:2026-02-13-vscode-extension","target":"spec:core-module"},{"source":"change:2026-02-13-vscode-extension","target":"spec:openspec-scanner"},{"source":"change:2026-02-13-vscode-extension","target":"spec:task-parser"},{"source":"change:2026-02-13-vscode-extension","target":"spec:vscode-extension-host"},{"source":"change:2026-02-13-vscode-extension","target":"spec:webview-integration"},{"source":"change:2026-02-13-vscode-marketplace-publish","target":"spec:vscode-marketplace-metadata"},{"source":"change:2026-02-14-add-changelog-entry","target":"spec:vscode-marketplace-metadata"},{"source":"change:2026-02-14-add-sidebar-toggle","target":"spec:shared-layout"},{"source":"change:2026-02-14-add-sidebar-toggle","target":"spec:sidebar-toggle"},{"source":"change:2026-02-14-vscode-cicd-publish","target":"spec:vscode-cicd"},{"source":"change:2026-02-15-add-demo-page","target":"spec:demo-page"},{"source":"change:2026-02-15-add-frontend-design-skill","target":"spec:frontend-design-skill"},{"source":"change:2026-02-15-add-readme-acknowledgments","target":"spec:readme-acknowledgments"},{"source":"change:2026-02-16-ui-design-polish-p0-p1","target":"spec:api-adapter"},{"source":"change:2026-02-16-ui-design-polish-p0-p1","target":"spec:dashboard-view"},{"source":"change:2026-02-16-ui-design-polish-p0-p1","target":"spec:shared-layout"},{"source":"change:2026-02-16-ui-design-polish-p2","target":"spec:change-browsing"},{"source":"change:2026-02-16-ui-design-polish-p2","target":"spec:search-ui"},{"source":"change:2026-02-16-ui-design-polish-p2","target":"spec:shared-layout"},{"source":"change:2026-02-16-ui-design-polish-p2","target":"spec:spec-browsing"},{"source":"change:2026-02-17-add-vscode-tab-icon","target":"spec:webview-integration"},{"source":"change:2026-02-17-spec-diff-viewer","target":"spec:api-adapter"},{"source":"change:2026-02-17-spec-diff-viewer","target":"spec:spec-diff"},{"source":"change:2026-02-17-spec-diff-viewer","target":"spec:spec-history"},{"source":"change:2026-02-17-spec-graph-view","target":"spec:graph-view"},{"source":"change:2026-02-17-spec-graph-view","target":"spec:openspec-api"},{"source":"change:2026-02-17-spec-graph-view","target":"spec:shared-layout"},{"source":"change:2026-02-18-fix-vscode-live-reload-directory-moves","target":"spec:live-reload"},{"source":"change:2026-02-18-live-reload","target":"spec:live-reload"},{"source":"change:2026-02-18-live-reload","target":"spec:webview-integration"},{"source":"change:2026-02-21-add-change-timestamp","target":"spec:change-browsing"},{"source":"change:2026-02-21-add-change-timestamp","target":"spec:dashboard-view"},{"source":"change:2026-02-21-add-change-timestamp","target":"spec:openspec-scanner"},{"source":"change:2026-02-21-fix-detect-fallback","target":"spec:filesystem-api"},{"source":"change:2026-02-21-sticky-change-detail-header","target":"spec:change-browsing"},{"source":"change:2026-02-22-fix-change-not-found-on-refresh","target":"spec:live-reload"}]}};</script>
    <script>var J5=Object.defineProperty;var W5=(Vr,fr,Fr)=>fr in Vr?J5(Vr,fr,{enumerable:!0,configurable:!0,writable:!0,value:Fr}):Vr[fr]=Fr;var Zb=(Vr,fr,Fr)=>W5(Vr,typeof fr!="symbol"?fr+"":fr,Fr);(function(){"use strict";var Vr=document.createElement("style");Vr.textContent=`/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-rotate-x:initial;--tw-rotate-y:initial;--tw-rotate-z:initial;--tw-skew-x:initial;--tw-skew-y:initial;--tw-space-y-reverse:0;--tw-border-style:solid;--tw-leading:initial;--tw-font-weight:initial;--tw-tracking:initial;--tw-shadow:0 0 #0000;--tw-shadow-color:initial;--tw-shadow-alpha:100%;--tw-inset-shadow:0 0 #0000;--tw-inset-shadow-color:initial;--tw-inset-shadow-alpha:100%;--tw-ring-color:initial;--tw-ring-shadow:0 0 #0000;--tw-inset-ring-color:initial;--tw-inset-ring-shadow:0 0 #0000;--tw-ring-inset:initial;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-offset-shadow:0 0 #0000;--tw-blur:initial;--tw-brightness:initial;--tw-contrast:initial;--tw-grayscale:initial;--tw-hue-rotate:initial;--tw-invert:initial;--tw-opacity:initial;--tw-saturate:initial;--tw-sepia:initial;--tw-drop-shadow:initial;--tw-drop-shadow-color:initial;--tw-drop-shadow-alpha:100%;--tw-drop-shadow-size:initial;--tw-duration:initial}}}@layer theme{:root,:host{--font-sans:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--font-mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--color-red-400:oklch(70.4% .191 22.216);--color-orange-400:oklch(75% .183 55.934);--color-orange-500:oklch(70.5% .213 47.604);--color-amber-500:oklch(76.9% .188 70.08);--color-yellow-400:oklch(85.2% .199 91.936);--color-green-400:oklch(79.2% .209 151.711);--color-green-500:oklch(72.3% .219 149.579);--color-blue-400:oklch(70.7% .165 254.624);--color-blue-500:oklch(62.3% .214 259.815);--color-slate-500:oklch(55.4% .046 257.417);--color-gray-400:oklch(70.7% .022 261.325);--color-gray-500:oklch(55.1% .027 264.364);--color-black:#000;--spacing:.25rem;--container-lg:32rem;--container-xl:36rem;--text-xs:.75rem;--text-xs--line-height:calc(1/.75);--text-sm:.875rem;--text-sm--line-height:calc(1.25/.875);--text-base:1rem;--text-base--line-height: 1.5 ;--text-lg:1.125rem;--text-lg--line-height:calc(1.75/1.125);--text-xl:1.25rem;--text-xl--line-height:calc(1.75/1.25);--text-2xl:1.5rem;--text-2xl--line-height:calc(2/1.5);--text-3xl:1.875rem;--text-3xl--line-height: 1.2 ;--text-4xl:2.25rem;--text-4xl--line-height:calc(2.5/2.25);--font-weight-medium:500;--font-weight-semibold:600;--font-weight-bold:700;--tracking-wider:.05em;--leading-relaxed:1.625;--radius-sm:.25rem;--radius-lg:.5rem;--animate-spin:spin 1s linear infinite;--default-transition-duration:.15s;--default-transition-timing-function:cubic-bezier(.4,0,.2,1);--default-font-family:var(--font-sans);--default-mono-font-family:var(--font-mono);--color-bg-primary:#0a0c0f;--color-bg-secondary:#111318;--color-bg-tertiary:#1a1d24;--color-border:#2a2d35;--color-text-primary:#e2e8f0;--color-text-secondary:#94a3b8;--color-text-muted:#64748b;--color-accent:#f59e0b;--color-accent-hover:#d97706}}@layer base{*,:after,:before,::backdrop{box-sizing:border-box;border:0 solid;margin:0;padding:0}::file-selector-button{box-sizing:border-box;border:0 solid;margin:0;padding:0}html,:host{-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;line-height:1.5;font-family:var(--default-font-family,ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji");font-feature-settings:var(--default-font-feature-settings,normal);font-variation-settings:var(--default-font-variation-settings,normal);-webkit-tap-highlight-color:transparent}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:var(--default-mono-font-family,ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace);font-feature-settings:var(--default-mono-font-feature-settings,normal);font-variation-settings:var(--default-mono-font-variation-settings,normal);font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}:-moz-focusring{outline:auto}progress{vertical-align:baseline}summary{display:list-item}ol,ul,menu{list-style:none}img,svg,video,canvas,audio,iframe,embed,object{vertical-align:middle;display:block}img,video{max-width:100%;height:auto}button,input,select,optgroup,textarea{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}::file-selector-button{font:inherit;font-feature-settings:inherit;font-variation-settings:inherit;letter-spacing:inherit;color:inherit;opacity:1;background-color:#0000;border-radius:0}:where(select:is([multiple],[size])) optgroup{font-weight:bolder}:where(select:is([multiple],[size])) optgroup option{padding-inline-start:20px}::file-selector-button{margin-inline-end:4px}::placeholder{opacity:1}@supports (not ((-webkit-appearance:-apple-pay-button))) or (contain-intrinsic-size:1px){::placeholder{color:currentColor}@supports (color:color-mix(in lab,red,red)){::placeholder{color:color-mix(in oklab,currentcolor 50%,transparent)}}}textarea{resize:vertical}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-date-and-time-value{min-height:1lh;text-align:inherit}::-webkit-datetime-edit{display:inline-flex}::-webkit-datetime-edit-fields-wrapper{padding:0}::-webkit-datetime-edit{padding-block:0}::-webkit-datetime-edit-year-field{padding-block:0}::-webkit-datetime-edit-month-field{padding-block:0}::-webkit-datetime-edit-day-field{padding-block:0}::-webkit-datetime-edit-hour-field{padding-block:0}::-webkit-datetime-edit-minute-field{padding-block:0}::-webkit-datetime-edit-second-field{padding-block:0}::-webkit-datetime-edit-millisecond-field{padding-block:0}::-webkit-datetime-edit-meridiem-field{padding-block:0}::-webkit-calendar-picker-indicator{line-height:1}:-moz-ui-invalid{box-shadow:none}button,input:where([type=button],[type=reset],[type=submit]){-webkit-appearance:button;-moz-appearance:button;appearance:button}::file-selector-button{-webkit-appearance:button;-moz-appearance:button;appearance:button}::-webkit-inner-spin-button{height:auto}::-webkit-outer-spin-button{height:auto}[hidden]:where(:not([hidden=until-found])){display:none!important}}@layer components;@layer utilities{.absolute{position:absolute}.fixed{position:fixed}.relative{position:relative}.sticky{position:sticky}.inset-0{inset:calc(var(--spacing)*0)}.top-0{top:calc(var(--spacing)*0)}.top-1{top:calc(var(--spacing)*1)}.top-3\\.5{top:calc(var(--spacing)*3.5)}.top-14{top:calc(var(--spacing)*14)}.right-0{right:calc(var(--spacing)*0)}.bottom-0{bottom:calc(var(--spacing)*0)}.bottom-1{bottom:calc(var(--spacing)*1)}.bottom-4{bottom:calc(var(--spacing)*4)}.-left-4{left:calc(var(--spacing)*-4)}.left-0{left:calc(var(--spacing)*0)}.left-2{left:calc(var(--spacing)*2)}.left-4{left:calc(var(--spacing)*4)}.z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.z-50{z-index:50}.z-\\[5\\]{z-index:5}.container{width:100%}@media(min-width:40rem){.container{max-width:40rem}}@media(min-width:48rem){.container{max-width:48rem}}@media(min-width:64rem){.container{max-width:64rem}}@media(min-width:80rem){.container{max-width:80rem}}@media(min-width:96rem){.container{max-width:96rem}}.-mx-6{margin-inline:calc(var(--spacing)*-6)}.my-4{margin-block:calc(var(--spacing)*4)}.my-6{margin-block:calc(var(--spacing)*6)}.mt-0\\.5{margin-top:calc(var(--spacing)*.5)}.mt-1{margin-top:calc(var(--spacing)*1)}.mt-2{margin-top:calc(var(--spacing)*2)}.mt-3{margin-top:calc(var(--spacing)*3)}.mt-4{margin-top:calc(var(--spacing)*4)}.mt-5{margin-top:calc(var(--spacing)*5)}.mt-6{margin-top:calc(var(--spacing)*6)}.mr-2{margin-right:calc(var(--spacing)*2)}.-mb-px{margin-bottom:-1px}.mb-0\\.5{margin-bottom:calc(var(--spacing)*.5)}.mb-1{margin-bottom:calc(var(--spacing)*1)}.mb-2{margin-bottom:calc(var(--spacing)*2)}.mb-3{margin-bottom:calc(var(--spacing)*3)}.mb-4{margin-bottom:calc(var(--spacing)*4)}.mb-6{margin-bottom:calc(var(--spacing)*6)}.mb-8{margin-bottom:calc(var(--spacing)*8)}.ml-2{margin-left:calc(var(--spacing)*2)}.ml-14{margin-left:calc(var(--spacing)*14)}.ml-60{margin-left:calc(var(--spacing)*60)}.block{display:block}.flex{display:flex}.grid{display:grid}.hidden{display:none}.inline{display:inline}.inline-block{display:inline-block}.h-2{height:calc(var(--spacing)*2)}.h-2\\.5{height:calc(var(--spacing)*2.5)}.h-3{height:calc(var(--spacing)*3)}.h-4{height:calc(var(--spacing)*4)}.h-5{height:calc(var(--spacing)*5)}.h-6{height:calc(var(--spacing)*6)}.h-14{height:calc(var(--spacing)*14)}.h-\\[calc\\(100vh-10rem\\)\\]{height:calc(100vh - 10rem)}.h-full{height:100%}.h-screen{height:100vh}.max-h-64{max-height:calc(var(--spacing)*64)}.max-h-80{max-height:calc(var(--spacing)*80)}.min-h-screen{min-height:100vh}.w-2\\.5{width:calc(var(--spacing)*2.5)}.w-3{width:calc(var(--spacing)*3)}.w-4{width:calc(var(--spacing)*4)}.w-5{width:calc(var(--spacing)*5)}.w-6{width:calc(var(--spacing)*6)}.w-14{width:calc(var(--spacing)*14)}.w-60{width:calc(var(--spacing)*60)}.w-full{width:100%}.w-px{width:1px}.max-w-80{max-width:calc(var(--spacing)*80)}.max-w-lg{max-width:var(--container-lg)}.max-w-xl{max-width:var(--container-xl)}.min-w-full{min-width:100%}.flex-1{flex:1}.flex-shrink-0,.shrink-0{flex-shrink:0}.border-collapse{border-collapse:collapse}.transform{transform:var(--tw-rotate-x,)var(--tw-rotate-y,)var(--tw-rotate-z,)var(--tw-skew-x,)var(--tw-skew-y,)}.animate-spin{animation:var(--animate-spin)}.cursor-pointer{cursor:pointer}.list-inside{list-style-position:inside}.list-decimal{list-style-type:decimal}.list-disc{list-style-type:disc}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.flex-col{flex-direction:column}.items-center{align-items:center}.items-start{align-items:flex-start}.justify-between{justify-content:space-between}.justify-center{justify-content:center}.gap-1{gap:calc(var(--spacing)*1)}.gap-1\\.5{gap:calc(var(--spacing)*1.5)}.gap-2{gap:calc(var(--spacing)*2)}.gap-3{gap:calc(var(--spacing)*3)}.gap-4{gap:calc(var(--spacing)*4)}:where(.space-y-0\\.5>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*.5)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*.5)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-1>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*1)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*1)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-2>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*2)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*2)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-3>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*3)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*3)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-4>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*4)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*4)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-6>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*6)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*6)*calc(1 - var(--tw-space-y-reverse)))}:where(.space-y-8>:not(:last-child)){--tw-space-y-reverse:0;margin-block-start:calc(calc(var(--spacing)*8)*var(--tw-space-y-reverse));margin-block-end:calc(calc(var(--spacing)*8)*calc(1 - var(--tw-space-y-reverse)))}.truncate{text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.overflow-hidden{overflow:hidden}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:.25rem}.rounded-full{border-radius:3.40282e38px}.rounded-lg{border-radius:var(--radius-lg)}.rounded-sm{border-radius:var(--radius-sm)}.border{border-style:var(--tw-border-style);border-width:1px}.border-2{border-style:var(--tw-border-style);border-width:2px}.border-y{border-block-style:var(--tw-border-style);border-block-width:1px}.border-t{border-top-style:var(--tw-border-style);border-top-width:1px}.border-r{border-right-style:var(--tw-border-style);border-right-width:1px}.border-b{border-bottom-style:var(--tw-border-style);border-bottom-width:1px}.border-b-2{border-bottom-style:var(--tw-border-style);border-bottom-width:2px}.border-l-4{border-left-style:var(--tw-border-style);border-left-width:4px}.border-accent{border-color:var(--color-accent)}.border-border{border-color:var(--color-border)}.border-text-muted{border-color:var(--color-text-muted)}.border-transparent{border-color:#0000}.border-t-transparent{border-top-color:#0000}.border-l-accent{border-left-color:var(--color-accent)}.bg-accent{background-color:var(--color-accent)}.bg-accent\\/10{background-color:#f59e0b1a}@supports (color:color-mix(in lab,red,red)){.bg-accent\\/10{background-color:color-mix(in oklab,var(--color-accent)10%,transparent)}}.bg-accent\\/20{background-color:#f59e0b33}@supports (color:color-mix(in lab,red,red)){.bg-accent\\/20{background-color:color-mix(in oklab,var(--color-accent)20%,transparent)}}.bg-amber-500{background-color:var(--color-amber-500)}.bg-bg-primary{background-color:var(--color-bg-primary)}.bg-bg-primary\\/50{background-color:#0a0c0f80}@supports (color:color-mix(in lab,red,red)){.bg-bg-primary\\/50{background-color:color-mix(in oklab,var(--color-bg-primary)50%,transparent)}}.bg-bg-secondary{background-color:var(--color-bg-secondary)}.bg-bg-secondary\\/90{background-color:#111318e6}@supports (color:color-mix(in lab,red,red)){.bg-bg-secondary\\/90{background-color:color-mix(in oklab,var(--color-bg-secondary)90%,transparent)}}.bg-bg-tertiary{background-color:var(--color-bg-tertiary)}.bg-black\\/50{background-color:#00000080}@supports (color:color-mix(in lab,red,red)){.bg-black\\/50{background-color:color-mix(in oklab,var(--color-black)50%,transparent)}}.bg-black\\/60{background-color:#0009}@supports (color:color-mix(in lab,red,red)){.bg-black\\/60{background-color:color-mix(in oklab,var(--color-black)60%,transparent)}}.bg-blue-500\\/20{background-color:#3080ff33}@supports (color:color-mix(in lab,red,red)){.bg-blue-500\\/20{background-color:color-mix(in oklab,var(--color-blue-500)20%,transparent)}}.bg-border{background-color:var(--color-border)}.bg-gray-500\\/20{background-color:#6a728233}@supports (color:color-mix(in lab,red,red)){.bg-gray-500\\/20{background-color:color-mix(in oklab,var(--color-gray-500)20%,transparent)}}.bg-green-400\\/10{background-color:#05df721a}@supports (color:color-mix(in lab,red,red)){.bg-green-400\\/10{background-color:color-mix(in oklab,var(--color-green-400)10%,transparent)}}.bg-green-500{background-color:var(--color-green-500)}.bg-green-500\\/20{background-color:#00c75833}@supports (color:color-mix(in lab,red,red)){.bg-green-500\\/20{background-color:color-mix(in oklab,var(--color-green-500)20%,transparent)}}.bg-orange-500\\/20{background-color:#fe6e0033}@supports (color:color-mix(in lab,red,red)){.bg-orange-500\\/20{background-color:color-mix(in oklab,var(--color-orange-500)20%,transparent)}}.bg-red-400\\/10{background-color:#ff65681a}@supports (color:color-mix(in lab,red,red)){.bg-red-400\\/10{background-color:color-mix(in oklab,var(--color-red-400)10%,transparent)}}.bg-slate-500{background-color:var(--color-slate-500)}.bg-text-muted\\/10{background-color:#64748b1a}@supports (color:color-mix(in lab,red,red)){.bg-text-muted\\/10{background-color:color-mix(in oklab,var(--color-text-muted)10%,transparent)}}.bg-transparent{background-color:#0000}.p-2{padding:calc(var(--spacing)*2)}.p-4{padding:calc(var(--spacing)*4)}.p-6{padding:calc(var(--spacing)*6)}.p-8{padding:calc(var(--spacing)*8)}.px-0\\.5{padding-inline:calc(var(--spacing)*.5)}.px-1\\.5{padding-inline:calc(var(--spacing)*1.5)}.px-2{padding-inline:calc(var(--spacing)*2)}.px-2\\.5{padding-inline:calc(var(--spacing)*2.5)}.px-3{padding-inline:calc(var(--spacing)*3)}.px-4{padding-inline:calc(var(--spacing)*4)}.px-6{padding-inline:calc(var(--spacing)*6)}.py-0\\.5{padding-block:calc(var(--spacing)*.5)}.py-1{padding-block:calc(var(--spacing)*1)}.py-1\\.5{padding-block:calc(var(--spacing)*1.5)}.py-2{padding-block:calc(var(--spacing)*2)}.py-3{padding-block:calc(var(--spacing)*3)}.pt-2{padding-top:calc(var(--spacing)*2)}.pt-3{padding-top:calc(var(--spacing)*3)}.pt-18{padding-top:calc(var(--spacing)*18)}.pt-\\[20vh\\]{padding-top:20vh}.pb-1{padding-bottom:calc(var(--spacing)*1)}.pb-2{padding-bottom:calc(var(--spacing)*2)}.pb-3{padding-bottom:calc(var(--spacing)*3)}.pb-px{padding-bottom:1px}.pl-4{padding-left:calc(var(--spacing)*4)}.pl-6{padding-left:calc(var(--spacing)*6)}.text-center{text-align:center}.text-left{text-align:left}.font-mono{font-family:var(--font-mono)}.text-2xl{font-size:var(--text-2xl);line-height:var(--tw-leading,var(--text-2xl--line-height))}.text-3xl{font-size:var(--text-3xl);line-height:var(--tw-leading,var(--text-3xl--line-height))}.text-4xl{font-size:var(--text-4xl);line-height:var(--tw-leading,var(--text-4xl--line-height))}.text-base{font-size:var(--text-base);line-height:var(--tw-leading,var(--text-base--line-height))}.text-lg{font-size:var(--text-lg);line-height:var(--tw-leading,var(--text-lg--line-height))}.text-sm{font-size:var(--text-sm);line-height:var(--tw-leading,var(--text-sm--line-height))}.text-xl{font-size:var(--text-xl);line-height:var(--tw-leading,var(--text-xl--line-height))}.text-xs{font-size:var(--text-xs);line-height:var(--tw-leading,var(--text-xs--line-height))}.leading-relaxed{--tw-leading:var(--leading-relaxed);line-height:var(--leading-relaxed)}.font-bold{--tw-font-weight:var(--font-weight-bold);font-weight:var(--font-weight-bold)}.font-medium{--tw-font-weight:var(--font-weight-medium);font-weight:var(--font-weight-medium)}.font-semibold{--tw-font-weight:var(--font-weight-semibold);font-weight:var(--font-weight-semibold)}.tracking-wider{--tw-tracking:var(--tracking-wider);letter-spacing:var(--tracking-wider)}.whitespace-nowrap{white-space:nowrap}.text-accent{color:var(--color-accent)}.text-bg-primary{color:var(--color-bg-primary)}.text-blue-400{color:var(--color-blue-400)}.text-gray-400{color:var(--color-gray-400)}.text-green-400{color:var(--color-green-400)}.text-orange-400{color:var(--color-orange-400)}.text-red-400{color:var(--color-red-400)}.text-text-muted{color:var(--color-text-muted)}.text-text-primary{color:var(--color-text-primary)}.text-text-secondary{color:var(--color-text-secondary)}.text-yellow-400{color:var(--color-yellow-400)}.uppercase{text-transform:uppercase}.italic{font-style:italic}.line-through{text-decoration-line:line-through}.underline{text-decoration-line:underline}.decoration-dotted{text-decoration-style:dotted}.accent-accent{accent-color:var(--color-accent)}.opacity-60{opacity:.6}.shadow-2xl{--tw-shadow:0 25px 50px -12px var(--tw-shadow-color,#00000040);box-shadow:var(--tw-inset-shadow),var(--tw-inset-ring-shadow),var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow)}.filter{filter:var(--tw-blur,)var(--tw-brightness,)var(--tw-contrast,)var(--tw-grayscale,)var(--tw-hue-rotate,)var(--tw-invert,)var(--tw-saturate,)var(--tw-sepia,)var(--tw-drop-shadow,)}.transition-all{transition-property:all;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.transition-colors{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function));transition-duration:var(--tw-duration,var(--default-transition-duration))}.duration-200{--tw-duration:.2s;transition-duration:.2s}.outline-none{--tw-outline-style:none;outline-style:none}.select-none{-webkit-user-select:none;user-select:none}.placeholder\\:text-text-muted::placeholder{color:var(--color-text-muted)}@media(hover:hover){.hover\\:border-accent:hover{border-color:var(--color-accent)}.hover\\:bg-accent-hover:hover{background-color:var(--color-accent-hover)}.hover\\:bg-bg-secondary:hover{background-color:var(--color-bg-secondary)}.hover\\:bg-bg-tertiary:hover{background-color:var(--color-bg-tertiary)}.hover\\:bg-bg-tertiary\\/50:hover{background-color:#1a1d2480}@supports (color:color-mix(in lab,red,red)){.hover\\:bg-bg-tertiary\\/50:hover{background-color:color-mix(in oklab,var(--color-bg-tertiary)50%,transparent)}}.hover\\:bg-bg-tertiary\\/80:hover{background-color:#1a1d24cc}@supports (color:color-mix(in lab,red,red)){.hover\\:bg-bg-tertiary\\/80:hover{background-color:color-mix(in oklab,var(--color-bg-tertiary)80%,transparent)}}.hover\\:text-accent:hover{color:var(--color-accent)}.hover\\:text-accent-hover:hover{color:var(--color-accent-hover)}.hover\\:text-red-400:hover{color:var(--color-red-400)}.hover\\:text-text-primary:hover{color:var(--color-text-primary)}.hover\\:text-text-secondary:hover{color:var(--color-text-secondary)}.hover\\:underline:hover{text-decoration-line:underline}}.focus\\:border-accent:focus{border-color:var(--color-accent)}.focus\\:outline-none:focus{--tw-outline-style:none;outline-style:none}.disabled\\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\\:opacity-50:disabled{opacity:.5}@media(min-width:48rem){.md\\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}}[data-theme=light]{--color-bg-primary:#f8fafc;--color-bg-secondary:#fff;--color-bg-tertiary:#f1f5f9;--color-border:#e2e8f0;--color-text-primary:#0f172a;--color-text-secondary:#475569;--color-text-muted:#94a3b8;--color-accent:#d97706;--color-accent-hover:#b45309}body{background-color:var(--color-bg-primary);color:var(--color-text-primary);font-family:Plus Jakarta Sans,sans-serif;line-height:1.75}code,pre{font-family:JetBrains Mono,Fira Code,monospace}@keyframes fadeInUp{0%{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}.animate-fade-in-up{animation:.4s ease-out both fadeInUp}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.animate-fade-in{animation:.15s ease-out both fadeIn}@media(prefers-reduced-motion:reduce){.animate-fade-in-up,.animate-fade-in{animation:none}}@property --tw-rotate-x{syntax:"*";inherits:false}@property --tw-rotate-y{syntax:"*";inherits:false}@property --tw-rotate-z{syntax:"*";inherits:false}@property --tw-skew-x{syntax:"*";inherits:false}@property --tw-skew-y{syntax:"*";inherits:false}@property --tw-space-y-reverse{syntax:"*";inherits:false;initial-value:0}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-leading{syntax:"*";inherits:false}@property --tw-font-weight{syntax:"*";inherits:false}@property --tw-tracking{syntax:"*";inherits:false}@property --tw-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-shadow-color{syntax:"*";inherits:false}@property --tw-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-inset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-shadow-color{syntax:"*";inherits:false}@property --tw-inset-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-ring-color{syntax:"*";inherits:false}@property --tw-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-inset-ring-color{syntax:"*";inherits:false}@property --tw-inset-ring-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-ring-inset{syntax:"*";inherits:false}@property --tw-ring-offset-width{syntax:"<length>";inherits:false;initial-value:0}@property --tw-ring-offset-color{syntax:"*";inherits:false;initial-value:#fff}@property --tw-ring-offset-shadow{syntax:"*";inherits:false;initial-value:0 0 #0000}@property --tw-blur{syntax:"*";inherits:false}@property --tw-brightness{syntax:"*";inherits:false}@property --tw-contrast{syntax:"*";inherits:false}@property --tw-grayscale{syntax:"*";inherits:false}@property --tw-hue-rotate{syntax:"*";inherits:false}@property --tw-invert{syntax:"*";inherits:false}@property --tw-opacity{syntax:"*";inherits:false}@property --tw-saturate{syntax:"*";inherits:false}@property --tw-sepia{syntax:"*";inherits:false}@property --tw-drop-shadow{syntax:"*";inherits:false}@property --tw-drop-shadow-color{syntax:"*";inherits:false}@property --tw-drop-shadow-alpha{syntax:"<percentage>";inherits:false;initial-value:100%}@property --tw-drop-shadow-size{syntax:"*";inherits:false}@property --tw-duration{syntax:"*";inherits:false}@keyframes spin{to{transform:rotate(360deg)}}
/*$vite$:1*/`,document.head.appendChild(Vr);function fr(e,r){for(var i=0;i<r.length;i++){const a=r[i];if(typeof a!="string"&&!Array.isArray(a)){for(const u in a)if(u!=="default"&&!(u in e)){const s=Object.getOwnPropertyDescriptor(a,u);s&&Object.defineProperty(e,u,s.get?s:{enumerable:!0,get:()=>a[u]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function Fr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Hs={exports:{}},ta={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fd;function Kb(){if(Fd)return ta;Fd=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.fragment");function i(a,u,s){var c=null;if(s!==void 0&&(c=""+s),u.key!==void 0&&(c=""+u.key),"key"in u){s={};for(var f in u)f!=="key"&&(s[f]=u[f])}else s=u;return u=s.ref,{$$typeof:e,type:a,key:c,ref:u!==void 0?u:null,props:s}}return ta.Fragment=r,ta.jsx=i,ta.jsxs=i,ta}var Xd;function Pb(){return Xd||(Xd=1,Hs.exports=Kb()),Hs.exports}var k=Pb(),qs={exports:{}},Ne={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gd;function Jb(){if(Gd)return Ne;Gd=1;var e=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),c=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),x=Symbol.iterator;function v(R){return R===null||typeof R!="object"?null:(R=x&&R[x]||R["@@iterator"],typeof R=="function"?R:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,C={};function E(R,Z,z){this.props=R,this.context=Z,this.refs=C,this.updater=z||w}E.prototype.isReactComponent={},E.prototype.setState=function(R,Z){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,Z,"setState")},E.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function M(){}M.prototype=E.prototype;function L(R,Z,z){this.props=R,this.context=Z,this.refs=C,this.updater=z||w}var U=L.prototype=new M;U.constructor=L,_(U,E.prototype),U.isPureReactComponent=!0;var V=Array.isArray;function B(){}var N={H:null,A:null,T:null,S:null},ee=Object.prototype.hasOwnProperty;function G(R,Z,z){var se=z.ref;return{$$typeof:e,type:R,key:Z,ref:se!==void 0?se:null,props:z}}function D(R,Z){return G(R.type,Z,R.props)}function ne(R){return typeof R=="object"&&R!==null&&R.$$typeof===e}function ae(R){var Z={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(z){return Z[z]})}var ve=/\/+/g;function H(R,Z){return typeof R=="object"&&R!==null&&R.key!=null?ae(""+R.key):Z.toString(36)}function I(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(B,B):(R.status="pending",R.then(function(Z){R.status==="pending"&&(R.status="fulfilled",R.value=Z)},function(Z){R.status==="pending"&&(R.status="rejected",R.reason=Z)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function A(R,Z,z,se,pe){var ye=typeof R;(ye==="undefined"||ye==="boolean")&&(R=null);var Te=!1;if(R===null)Te=!0;else switch(ye){case"bigint":case"string":case"number":Te=!0;break;case"object":switch(R.$$typeof){case e:case r:Te=!0;break;case g:return Te=R._init,A(Te(R._payload),Z,z,se,pe)}}if(Te)return pe=pe(R),Te=se===""?"."+H(R,0):se,V(pe)?(z="",Te!=null&&(z=Te.replace(ve,"$&/")+"/"),A(pe,Z,z,"",function(en){return en})):pe!=null&&(ne(pe)&&(pe=D(pe,z+(pe.key==null||R&&R.key===pe.key?"":(""+pe.key).replace(ve,"$&/")+"/")+Te)),Z.push(pe)),1;Te=0;var Oe=se===""?".":se+":";if(V(R))for(var Ke=0;Ke<R.length;Ke++)se=R[Ke],ye=Oe+H(se,Ke),Te+=A(se,Z,z,ye,pe);else if(Ke=v(R),typeof Ke=="function")for(R=Ke.call(R),Ke=0;!(se=R.next()).done;)se=se.value,ye=Oe+H(se,Ke++),Te+=A(se,Z,z,ye,pe);else if(ye==="object"){if(typeof R.then=="function")return A(I(R),Z,z,se,pe);throw Z=String(R),Error("Objects are not valid as a React child (found: "+(Z==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":Z)+"). If you meant to render a collection of children, use an array instead.")}return Te}function Q(R,Z,z){if(R==null)return R;var se=[],pe=0;return A(R,se,"","",function(ye){return Z.call(z,ye,pe++)}),se}function te(R){if(R._status===-1){var Z=R._result;Z=Z(),Z.then(function(z){(R._status===0||R._status===-1)&&(R._status=1,R._result=z)},function(z){(R._status===0||R._status===-1)&&(R._status=2,R._result=z)}),R._status===-1&&(R._status=0,R._result=Z)}if(R._status===1)return R._result.default;throw R._result}var oe=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(Z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},T={map:Q,forEach:function(R,Z,z){Q(R,function(){Z.apply(this,arguments)},z)},count:function(R){var Z=0;return Q(R,function(){Z++}),Z},toArray:function(R){return Q(R,function(Z){return Z})||[]},only:function(R){if(!ne(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return Ne.Activity=y,Ne.Children=T,Ne.Component=E,Ne.Fragment=i,Ne.Profiler=u,Ne.PureComponent=L,Ne.StrictMode=a,Ne.Suspense=h,Ne.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=N,Ne.__COMPILER_RUNTIME={__proto__:null,c:function(R){return N.H.useMemoCache(R)}},Ne.cache=function(R){return function(){return R.apply(null,arguments)}},Ne.cacheSignal=function(){return null},Ne.cloneElement=function(R,Z,z){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var se=_({},R.props),pe=R.key;if(Z!=null)for(ye in Z.key!==void 0&&(pe=""+Z.key),Z)!ee.call(Z,ye)||ye==="key"||ye==="__self"||ye==="__source"||ye==="ref"&&Z.ref===void 0||(se[ye]=Z[ye]);var ye=arguments.length-2;if(ye===1)se.children=z;else if(1<ye){for(var Te=Array(ye),Oe=0;Oe<ye;Oe++)Te[Oe]=arguments[Oe+2];se.children=Te}return G(R.type,pe,se)},Ne.createContext=function(R){return R={$$typeof:c,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:s,_context:R},R},Ne.createElement=function(R,Z,z){var se,pe={},ye=null;if(Z!=null)for(se in Z.key!==void 0&&(ye=""+Z.key),Z)ee.call(Z,se)&&se!=="key"&&se!=="__self"&&se!=="__source"&&(pe[se]=Z[se]);var Te=arguments.length-2;if(Te===1)pe.children=z;else if(1<Te){for(var Oe=Array(Te),Ke=0;Ke<Te;Ke++)Oe[Ke]=arguments[Ke+2];pe.children=Oe}if(R&&R.defaultProps)for(se in Te=R.defaultProps,Te)pe[se]===void 0&&(pe[se]=Te[se]);return G(R,ye,pe)},Ne.createRef=function(){return{current:null}},Ne.forwardRef=function(R){return{$$typeof:f,render:R}},Ne.isValidElement=ne,Ne.lazy=function(R){return{$$typeof:g,_payload:{_status:-1,_result:R},_init:te}},Ne.memo=function(R,Z){return{$$typeof:d,type:R,compare:Z===void 0?null:Z}},Ne.startTransition=function(R){var Z=N.T,z={};N.T=z;try{var se=R(),pe=N.S;pe!==null&&pe(z,se),typeof se=="object"&&se!==null&&typeof se.then=="function"&&se.then(B,oe)}catch(ye){oe(ye)}finally{Z!==null&&z.types!==null&&(Z.types=z.types),N.T=Z}},Ne.unstable_useCacheRefresh=function(){return N.H.useCacheRefresh()},Ne.use=function(R){return N.H.use(R)},Ne.useActionState=function(R,Z,z){return N.H.useActionState(R,Z,z)},Ne.useCallback=function(R,Z){return N.H.useCallback(R,Z)},Ne.useContext=function(R){return N.H.useContext(R)},Ne.useDebugValue=function(){},Ne.useDeferredValue=function(R,Z){return N.H.useDeferredValue(R,Z)},Ne.useEffect=function(R,Z){return N.H.useEffect(R,Z)},Ne.useEffectEvent=function(R){return N.H.useEffectEvent(R)},Ne.useId=function(){return N.H.useId()},Ne.useImperativeHandle=function(R,Z,z){return N.H.useImperativeHandle(R,Z,z)},Ne.useInsertionEffect=function(R,Z){return N.H.useInsertionEffect(R,Z)},Ne.useLayoutEffect=function(R,Z){return N.H.useLayoutEffect(R,Z)},Ne.useMemo=function(R,Z){return N.H.useMemo(R,Z)},Ne.useOptimistic=function(R,Z){return N.H.useOptimistic(R,Z)},Ne.useReducer=function(R,Z,z){return N.H.useReducer(R,Z,z)},Ne.useRef=function(R){return N.H.useRef(R)},Ne.useState=function(R){return N.H.useState(R)},Ne.useSyncExternalStore=function(R,Z,z){return N.H.useSyncExternalStore(R,Z,z)},Ne.useTransition=function(){return N.H.useTransition()},Ne.version="19.2.4",Ne}var Qd;function Ys(){return Qd||(Qd=1,qs.exports=Jb()),qs.exports}var Y=Ys();const Wb=fr({__proto__:null,default:Fr(Y)},[Y]);var Vs={exports:{}},na={},Fs={exports:{}},Xs={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $d;function e1(){return $d||($d=1,(function(e){function r(A,Q){var te=A.length;A.push(Q);e:for(;0<te;){var oe=te-1>>>1,T=A[oe];if(0<u(T,Q))A[oe]=Q,A[te]=T,te=oe;else break e}}function i(A){return A.length===0?null:A[0]}function a(A){if(A.length===0)return null;var Q=A[0],te=A.pop();if(te!==Q){A[0]=te;e:for(var oe=0,T=A.length,R=T>>>1;oe<R;){var Z=2*(oe+1)-1,z=A[Z],se=Z+1,pe=A[se];if(0>u(z,te))se<T&&0>u(pe,z)?(A[oe]=pe,A[se]=te,oe=se):(A[oe]=z,A[Z]=te,oe=Z);else if(se<T&&0>u(pe,te))A[oe]=pe,A[se]=te,oe=se;else break e}}return Q}function u(A,Q){var te=A.sortIndex-Q.sortIndex;return te!==0?te:A.id-Q.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var c=Date,f=c.now();e.unstable_now=function(){return c.now()-f}}var h=[],d=[],g=1,y=null,x=3,v=!1,w=!1,_=!1,C=!1,E=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,L=typeof setImmediate<"u"?setImmediate:null;function U(A){for(var Q=i(d);Q!==null;){if(Q.callback===null)a(d);else if(Q.startTime<=A)a(d),Q.sortIndex=Q.expirationTime,r(h,Q);else break;Q=i(d)}}function V(A){if(_=!1,U(A),!w)if(i(h)!==null)w=!0,B||(B=!0,ae());else{var Q=i(d);Q!==null&&I(V,Q.startTime-A)}}var B=!1,N=-1,ee=5,G=-1;function D(){return C?!0:!(e.unstable_now()-G<ee)}function ne(){if(C=!1,B){var A=e.unstable_now();G=A;var Q=!0;try{e:{w=!1,_&&(_=!1,M(N),N=-1),v=!0;var te=x;try{t:{for(U(A),y=i(h);y!==null&&!(y.expirationTime>A&&D());){var oe=y.callback;if(typeof oe=="function"){y.callback=null,x=y.priorityLevel;var T=oe(y.expirationTime<=A);if(A=e.unstable_now(),typeof T=="function"){y.callback=T,U(A),Q=!0;break t}y===i(h)&&a(h),U(A)}else a(h);y=i(h)}if(y!==null)Q=!0;else{var R=i(d);R!==null&&I(V,R.startTime-A),Q=!1}}break e}finally{y=null,x=te,v=!1}Q=void 0}}finally{Q?ae():B=!1}}}var ae;if(typeof L=="function")ae=function(){L(ne)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,H=ve.port2;ve.port1.onmessage=ne,ae=function(){H.postMessage(null)}}else ae=function(){E(ne,0)};function I(A,Q){N=E(function(){A(e.unstable_now())},Q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(A){A.callback=null},e.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ee=0<A?Math.floor(1e3/A):5},e.unstable_getCurrentPriorityLevel=function(){return x},e.unstable_next=function(A){switch(x){case 1:case 2:case 3:var Q=3;break;default:Q=x}var te=x;x=Q;try{return A()}finally{x=te}},e.unstable_requestPaint=function(){C=!0},e.unstable_runWithPriority=function(A,Q){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var te=x;x=A;try{return Q()}finally{x=te}},e.unstable_scheduleCallback=function(A,Q,te){var oe=e.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?oe+te:oe):te=oe,A){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=te+T,A={id:g++,callback:Q,priorityLevel:A,startTime:te,expirationTime:T,sortIndex:-1},te>oe?(A.sortIndex=te,r(d,A),i(h)===null&&A===i(d)&&(_?(M(N),N=-1):_=!0,I(V,te-oe))):(A.sortIndex=T,r(h,A),w||v||(w=!0,B||(B=!0,ae()))),A},e.unstable_shouldYield=D,e.unstable_wrapCallback=function(A){var Q=x;return function(){var te=x;x=Q;try{return A.apply(this,arguments)}finally{x=te}}}})(Xs)),Xs}var Id;function t1(){return Id||(Id=1,Fs.exports=e1()),Fs.exports}var Gs={exports:{}},Yt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zd;function n1(){if(Zd)return Yt;Zd=1;var e=Ys();function r(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(){}var a={d:{f:i,r:function(){throw Error(r(522))},D:i,C:i,L:i,m:i,X:i,S:i,M:i},p:0,findDOMNode:null},u=Symbol.for("react.portal");function s(h,d,g){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:u,key:y==null?null:""+y,children:h,containerInfo:d,implementation:g}}var c=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Yt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=a,Yt.createPortal=function(h,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(r(299));return s(h,d,null,g)},Yt.flushSync=function(h){var d=c.T,g=a.p;try{if(c.T=null,a.p=2,h)return h()}finally{c.T=d,a.p=g,a.d.f()}},Yt.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,a.d.C(h,d))},Yt.prefetchDNS=function(h){typeof h=="string"&&a.d.D(h)},Yt.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var g=d.as,y=f(g,d.crossOrigin),x=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?a.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:y,integrity:x,fetchPriority:v}):g==="script"&&a.d.X(h,{crossOrigin:y,integrity:x,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Yt.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=f(d.as,d.crossOrigin);a.d.M(h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&a.d.M(h)},Yt.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,y=f(g,d.crossOrigin);a.d.L(h,g,{crossOrigin:y,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Yt.preloadModule=function(h,d){if(typeof h=="string")if(d){var g=f(d.as,d.crossOrigin);a.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else a.d.m(h)},Yt.requestFormReset=function(h){a.d.r(h)},Yt.unstable_batchedUpdates=function(h,d){return h(d)},Yt.useFormState=function(h,d,g){return c.H.useFormState(h,d,g)},Yt.useFormStatus=function(){return c.H.useHostTransitionStatus()},Yt.version="19.2.4",Yt}var Kd;function Pd(){if(Kd)return Gs.exports;Kd=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}return e(),Gs.exports=n1(),Gs.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jd;function r1(){if(Jd)return na;Jd=1;var e=t1(),r=Ys(),i=Pd();function a(t){var n="https://react.dev/errors/"+t;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)n+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function u(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function s(t){var n=t,l=t;if(t.alternate)for(;n.return;)n=n.return;else{t=n;do n=t,(n.flags&4098)!==0&&(l=n.return),t=n.return;while(t)}return n.tag===3?l:null}function c(t){if(t.tag===13){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function f(t){if(t.tag===31){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function h(t){if(s(t)!==t)throw Error(a(188))}function d(t){var n=t.alternate;if(!n){if(n=s(t),n===null)throw Error(a(188));return n!==t?null:t}for(var l=t,o=n;;){var m=l.return;if(m===null)break;var p=m.alternate;if(p===null){if(o=m.return,o!==null){l=o;continue}break}if(m.child===p.child){for(p=m.child;p;){if(p===l)return h(m),t;if(p===o)return h(m),n;p=p.sibling}throw Error(a(188))}if(l.return!==o.return)l=m,o=p;else{for(var b=!1,S=m.child;S;){if(S===l){b=!0,l=m,o=p;break}if(S===o){b=!0,o=m,l=p;break}S=S.sibling}if(!b){for(S=p.child;S;){if(S===l){b=!0,l=p,o=m;break}if(S===o){b=!0,o=p,l=m;break}S=S.sibling}if(!b)throw Error(a(189))}}if(l.alternate!==o)throw Error(a(190))}if(l.tag!==3)throw Error(a(188));return l.stateNode.current===l?t:n}function g(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t;for(t=t.child;t!==null;){if(n=g(t),n!==null)return n;t=t.sibling}return null}var y=Object.assign,x=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),L=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),ee=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),D=Symbol.for("react.memo_cache_sentinel"),ne=Symbol.iterator;function ae(t){return t===null||typeof t!="object"?null:(t=ne&&t[ne]||t["@@iterator"],typeof t=="function"?t:null)}var ve=Symbol.for("react.client.reference");function H(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===ve?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _:return"Fragment";case E:return"Profiler";case C:return"StrictMode";case V:return"Suspense";case B:return"SuspenseList";case G:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case w:return"Portal";case L:return t.displayName||"Context";case M:return(t._context.displayName||"Context")+".Consumer";case U:var n=t.render;return t=t.displayName,t||(t=n.displayName||n.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case N:return n=t.displayName||null,n!==null?n:H(t.type)||"Memo";case ee:n=t._payload,t=t._init;try{return H(t(n))}catch{}}return null}var I=Array.isArray,A=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=i.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},oe=[],T=-1;function R(t){return{current:t}}function Z(t){0>T||(t.current=oe[T],oe[T]=null,T--)}function z(t,n){T++,oe[T]=t.current,t.current=n}var se=R(null),pe=R(null),ye=R(null),Te=R(null);function Oe(t,n){switch(z(ye,n),z(pe,t),z(se,null),n.nodeType){case 9:case 11:t=(t=n.documentElement)&&(t=t.namespaceURI)?vb(t):0;break;default:if(t=n.tagName,n=n.namespaceURI)n=vb(n),t=xb(n,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}Z(se),z(se,t)}function Ke(){Z(se),Z(pe),Z(ye)}function en(t){t.memoizedState!==null&&z(Te,t);var n=se.current,l=xb(n,t.type);n!==l&&(z(pe,t),z(se,l))}function Gn(t){pe.current===t&&(Z(se),Z(pe)),Te.current===t&&(Z(Te),zu._currentValue=te)}var yt,Qn;function An(t){if(yt===void 0)try{throw Error()}catch(l){var n=l.stack.trim().match(/\n( *(at )?)/);yt=n&&n[1]||"",Qn=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+yt+t+Qn}var Wr=!1;function tn(t,n){if(!t||Wr)return"";Wr=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var o={DetermineComponentFrameRoot:function(){try{if(n){var ue=function(){throw Error()};if(Object.defineProperty(ue.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ue,[])}catch(W){var P=W}Reflect.construct(t,[],ue)}else{try{ue.call()}catch(W){P=W}t.call(ue.prototype)}}else{try{throw Error()}catch(W){P=W}(ue=t())&&typeof ue.catch=="function"&&ue.catch(function(){})}}catch(W){if(W&&P&&typeof W.stack=="string")return[W.stack,P.stack]}return[null,null]}};o.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var m=Object.getOwnPropertyDescriptor(o.DetermineComponentFrameRoot,"name");m&&m.configurable&&Object.defineProperty(o.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=o.DetermineComponentFrameRoot(),b=p[0],S=p[1];if(b&&S){var j=b.split(`
`),K=S.split(`
`);for(m=o=0;o<j.length&&!j[o].includes("DetermineComponentFrameRoot");)o++;for(;m<K.length&&!K[m].includes("DetermineComponentFrameRoot");)m++;if(o===j.length||m===K.length)for(o=j.length-1,m=K.length-1;1<=o&&0<=m&&j[o]!==K[m];)m--;for(;1<=o&&0<=m;o--,m--)if(j[o]!==K[m]){if(o!==1||m!==1)do if(o--,m--,0>m||j[o]!==K[m]){var re=`
`+j[o].replace(" at new "," at ");return t.displayName&&re.includes("<anonymous>")&&(re=re.replace("<anonymous>",t.displayName)),re}while(1<=o&&0<=m);break}}}finally{Wr=!1,Error.prepareStackTrace=l}return(l=t?t.displayName||t.name:"")?An(l):""}function bl(t,n){switch(t.tag){case 26:case 27:case 5:return An(t.type);case 16:return An("Lazy");case 13:return t.child!==n&&n!==null?An("Suspense Fallback"):An("Suspense");case 19:return An("SuspenseList");case 0:case 15:return tn(t.type,!1);case 11:return tn(t.type.render,!1);case 1:return tn(t.type,!0);case 31:return An("Activity");default:return""}}function wl(t){try{var n="",l=null;do n+=bl(t,l),l=t,t=t.return;while(t);return n}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}var br=Object.prototype.hasOwnProperty,ei=e.unstable_scheduleCallback,Li=e.unstable_cancelCallback,Va=e.unstable_shouldYield,Fa=e.unstable_requestPaint,pt=e.unstable_now,wr=e.unstable_getCurrentPriorityLevel,ie=e.unstable_ImmediatePriority,he=e.unstable_UserBlockingPriority,ke=e.unstable_NormalPriority,Me=e.unstable_LowPriority,Pe=e.unstable_IdlePriority,Zt=e.log,pn=e.unstable_setDisableYieldValue,Ot=null,nt=null;function jt(t){if(typeof Zt=="function"&&pn(t),nt&&typeof nt.setStrictMode=="function")try{nt.setStrictMode(Ot,t)}catch{}}var tt=Math.clz32?Math.clz32:_o,$n=Math.log,gn=Math.LN2;function _o(t){return t>>>=0,t===0?32:31-($n(t)/gn|0)|0}var Sr=256,Ui=262144,ti=4194304;function Er(t){var n=t&42;if(n!==0)return n;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Bi(t,n,l){var o=t.pendingLanes;if(o===0)return 0;var m=0,p=t.suspendedLanes,b=t.pingedLanes;t=t.warmLanes;var S=o&134217727;return S!==0?(o=S&~p,o!==0?m=Er(o):(b&=S,b!==0?m=Er(b):l||(l=S&~t,l!==0&&(m=Er(l))))):(S=o&~p,S!==0?m=Er(S):b!==0?m=Er(b):l||(l=o&~t,l!==0&&(m=Er(l)))),m===0?0:n!==0&&n!==m&&(n&p)===0&&(p=m&-m,l=n&-n,p>=l||p===32&&(l&4194048)!==0)?n:m}function Hi(t,n){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&n)===0}function Co(t,n){switch(t){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qi(){var t=ti;return ti<<=1,(ti&62914560)===0&&(ti=4194304),t}function ni(t){for(var n=[],l=0;31>l;l++)n.push(t);return n}function ri(t,n){t.pendingLanes|=n,n!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Lf(t,n,l,o,m,p){var b=t.pendingLanes;t.pendingLanes=l,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=l,t.entangledLanes&=l,t.errorRecoveryDisabledLanes&=l,t.shellSuspendCounter=0;var S=t.entanglements,j=t.expirationTimes,K=t.hiddenUpdates;for(l=b&~l;0<l;){var re=31-tt(l),ue=1<<re;S[re]=0,j[re]=-1;var P=K[re];if(P!==null)for(K[re]=null,re=0;re<P.length;re++){var W=P[re];W!==null&&(W.lane&=-536870913)}l&=~ue}o!==0&&To(t,o,0),p!==0&&m===0&&t.tag!==0&&(t.suspendedLanes|=p&~(b&~n))}function To(t,n,l){t.pendingLanes|=n,t.suspendedLanes&=~n;var o=31-tt(n);t.entangledLanes|=n,t.entanglements[o]=t.entanglements[o]|1073741824|l&261930}function O(t,n){var l=t.entangledLanes|=n;for(t=t.entanglements;l;){var o=31-tt(l),m=1<<o;m&n|t[o]&n&&(t[o]|=n),l&=~m}}function F(t,n){var l=n&-n;return l=(l&42)!==0?1:J(l),(l&(t.suspendedLanes|n))!==0?0:l}function J(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function ce(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function de(){var t=Q.p;return t!==0?t:(t=window.event,t===void 0?32:Vb(t.type))}function Ee(t,n){var l=Q.p;try{return Q.p=t,n()}finally{Q.p=l}}var be=Math.random().toString(36).slice(2),me="__reactFiber$"+be,ge="__reactProps$"+be,we="__reactContainer$"+be,Re="__reactEvents$"+be,_e="__reactListeners$"+be,De="__reactHandles$"+be,qe="__reactResources$"+be,gt="__reactMarker$"+be;function vt(t){delete t[me],delete t[ge],delete t[Re],delete t[_e],delete t[De]}function xt(t){var n=t[me];if(n)return n;for(var l=t.parentNode;l;){if(n=l[we]||l[me]){if(l=n.alternate,n.child!==null||l!==null&&l.child!==null)for(t=Cb(t);t!==null;){if(l=t[me])return l;t=Cb(t)}return n}t=l,l=t.parentNode}return null}function Ge(t){if(t=t[me]||t[we]){var n=t.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return t}return null}function Nt(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t.stateNode;throw Error(a(33))}function nn(t){var n=t[qe];return n||(n=t[qe]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function dt(t){t[gt]=!0}var In=new Set,yn={};function Zn(t,n){Mn(t,n),Mn(t+"Capture",n)}function Mn(t,n){for(yn[t]=n,t=0;t<n.length;t++)In.add(n[t])}var kr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Yi={},Vi={};function Qe(t){return br.call(Vi,t)?!0:br.call(Yi,t)?!1:kr.test(t)?Vi[t]=!0:(Yi[t]=!0,!1)}function Et(t,n,l){if(Qe(n))if(l===null)t.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":t.removeAttribute(n);return;case"boolean":var o=n.toLowerCase().slice(0,5);if(o!=="data-"&&o!=="aria-"){t.removeAttribute(n);return}}t.setAttribute(n,""+l)}}function Kn(t,n,l){if(l===null)t.removeAttribute(n);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttribute(n,""+l)}}function Lt(t,n,l,o){if(o===null)t.removeAttribute(l);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(l);return}t.setAttributeNS(n,l,""+o)}}function $e(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Fi(t){var n=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function zo(t,n,l){var o=Object.getOwnPropertyDescriptor(t.constructor.prototype,n);if(!t.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var m=o.get,p=o.set;return Object.defineProperty(t,n,{configurable:!0,get:function(){return m.call(this)},set:function(b){l=""+b,p.call(this,b)}}),Object.defineProperty(t,n,{enumerable:o.enumerable}),{getValue:function(){return l},setValue:function(b){l=""+b},stopTracking:function(){t._valueTracker=null,delete t[n]}}}}function Xa(t){if(!t._valueTracker){var n=Fi(t)?"checked":"value";t._valueTracker=zo(t,n,""+t[n])}}function f0(t){if(!t)return!1;var n=t._valueTracker;if(!n)return!0;var l=n.getValue(),o="";return t&&(o=Fi(t)?t.checked?"true":"false":t.value),t=o,t!==l?(n.setValue(t),!0):!1}function Ao(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var QM=/[\n"\\]/g;function Rn(t){return t.replace(QM,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Uf(t,n,l,o,m,p,b,S){t.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?t.type=b:t.removeAttribute("type"),n!=null?b==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+$e(n)):t.value!==""+$e(n)&&(t.value=""+$e(n)):b!=="submit"&&b!=="reset"||t.removeAttribute("value"),n!=null?Bf(t,b,$e(n)):l!=null?Bf(t,b,$e(l)):o!=null&&t.removeAttribute("value"),m==null&&p!=null&&(t.defaultChecked=!!p),m!=null&&(t.checked=m&&typeof m!="function"&&typeof m!="symbol"),S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?t.name=""+$e(S):t.removeAttribute("name")}function h0(t,n,l,o,m,p,b,S){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(t.type=p),n!=null||l!=null){if(!(p!=="submit"&&p!=="reset"||n!=null)){Xa(t);return}l=l!=null?""+$e(l):"",n=n!=null?""+$e(n):l,S||n===t.value||(t.value=n),t.defaultValue=n}o=o??m,o=typeof o!="function"&&typeof o!="symbol"&&!!o,t.checked=S?t.checked:!!o,t.defaultChecked=!!o,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(t.name=b),Xa(t)}function Bf(t,n,l){n==="number"&&Ao(t.ownerDocument)===t||t.defaultValue===""+l||(t.defaultValue=""+l)}function Sl(t,n,l,o){if(t=t.options,n){n={};for(var m=0;m<l.length;m++)n["$"+l[m]]=!0;for(l=0;l<t.length;l++)m=n.hasOwnProperty("$"+t[l].value),t[l].selected!==m&&(t[l].selected=m),m&&o&&(t[l].defaultSelected=!0)}else{for(l=""+$e(l),n=null,m=0;m<t.length;m++){if(t[m].value===l){t[m].selected=!0,o&&(t[m].defaultSelected=!0);return}n!==null||t[m].disabled||(n=t[m])}n!==null&&(n.selected=!0)}}function d0(t,n,l){if(n!=null&&(n=""+$e(n),n!==t.value&&(t.value=n),l==null)){t.defaultValue!==n&&(t.defaultValue=n);return}t.defaultValue=l!=null?""+$e(l):""}function m0(t,n,l,o){if(n==null){if(o!=null){if(l!=null)throw Error(a(92));if(I(o)){if(1<o.length)throw Error(a(93));o=o[0]}l=o}l==null&&(l=""),n=l}l=$e(n),t.defaultValue=l,o=t.textContent,o===l&&o!==""&&o!==null&&(t.value=o),Xa(t)}function El(t,n){if(n){var l=t.firstChild;if(l&&l===t.lastChild&&l.nodeType===3){l.nodeValue=n;return}}t.textContent=n}var $M=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function p0(t,n,l){var o=n.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?o?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="":o?t.setProperty(n,l):typeof l!="number"||l===0||$M.has(n)?n==="float"?t.cssFloat=l:t[n]=(""+l).trim():t[n]=l+"px"}function g0(t,n,l){if(n!=null&&typeof n!="object")throw Error(a(62));if(t=t.style,l!=null){for(var o in l)!l.hasOwnProperty(o)||n!=null&&n.hasOwnProperty(o)||(o.indexOf("--")===0?t.setProperty(o,""):o==="float"?t.cssFloat="":t[o]="");for(var m in n)o=n[m],n.hasOwnProperty(m)&&l[m]!==o&&p0(t,m,o)}else for(var p in n)n.hasOwnProperty(p)&&p0(t,p,n[p])}function Hf(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var IM=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ZM=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mo(t){return ZM.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function _r(){}var qf=null;function Yf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var kl=null,_l=null;function y0(t){var n=Ge(t);if(n&&(t=n.stateNode)){var l=t[ge]||null;e:switch(t=n.stateNode,n.type){case"input":if(Uf(t,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),n=l.name,l.type==="radio"&&n!=null){for(l=t;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Rn(""+n)+'"][type="radio"]'),n=0;n<l.length;n++){var o=l[n];if(o!==t&&o.form===t.form){var m=o[ge]||null;if(!m)throw Error(a(90));Uf(o,m.value,m.defaultValue,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name)}}for(n=0;n<l.length;n++)o=l[n],o.form===t.form&&f0(o)}break e;case"textarea":d0(t,l.value,l.defaultValue);break e;case"select":n=l.value,n!=null&&Sl(t,!!l.multiple,n,!1)}}}var Vf=!1;function v0(t,n,l){if(Vf)return t(n,l);Vf=!0;try{var o=t(n);return o}finally{if(Vf=!1,(kl!==null||_l!==null)&&(ys(),kl&&(n=kl,t=_l,_l=kl=null,y0(n),t)))for(n=0;n<t.length;n++)y0(t[n])}}function Ga(t,n){var l=t.stateNode;if(l===null)return null;var o=l[ge]||null;if(o===null)return null;l=o[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(t=t.type,o=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!o;break e;default:t=!1}if(t)return null;if(l&&typeof l!="function")throw Error(a(231,n,typeof l));return l}var Cr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ff=!1;if(Cr)try{var Qa={};Object.defineProperty(Qa,"passive",{get:function(){Ff=!0}}),window.addEventListener("test",Qa,Qa),window.removeEventListener("test",Qa,Qa)}catch{Ff=!1}var ii=null,Xf=null,Ro=null;function x0(){if(Ro)return Ro;var t,n=Xf,l=n.length,o,m="value"in ii?ii.value:ii.textContent,p=m.length;for(t=0;t<l&&n[t]===m[t];t++);var b=l-t;for(o=1;o<=b&&n[l-o]===m[p-o];o++);return Ro=m.slice(t,1<o?1-o:void 0)}function No(t){var n=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&n===13&&(t=13)):t=n,t===10&&(t=13),32<=t||t===13?t:0}function Do(){return!0}function b0(){return!1}function rn(t){function n(l,o,m,p,b){this._reactName=l,this._targetInst=m,this.type=o,this.nativeEvent=p,this.target=b,this.currentTarget=null;for(var S in t)t.hasOwnProperty(S)&&(l=t[S],this[S]=l?l(p):p[S]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Do:b0,this.isPropagationStopped=b0,this}return y(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),n}var Xi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Oo=rn(Xi),$a=y({},Xi,{view:0,detail:0}),KM=rn($a),Gf,Qf,Ia,jo=y({},$a,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:If,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ia&&(Ia&&t.type==="mousemove"?(Gf=t.screenX-Ia.screenX,Qf=t.screenY-Ia.screenY):Qf=Gf=0,Ia=t),Gf)},movementY:function(t){return"movementY"in t?t.movementY:Qf}}),w0=rn(jo),PM=y({},jo,{dataTransfer:0}),JM=rn(PM),WM=y({},$a,{relatedTarget:0}),$f=rn(WM),eR=y({},Xi,{animationName:0,elapsedTime:0,pseudoElement:0}),tR=rn(eR),nR=y({},Xi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),rR=rn(nR),iR=y({},Xi,{data:0}),S0=rn(iR),lR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},aR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},uR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function oR(t){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(t):(t=uR[t])?!!n[t]:!1}function If(){return oR}var sR=y({},$a,{key:function(t){if(t.key){var n=lR[t.key]||t.key;if(n!=="Unidentified")return n}return t.type==="keypress"?(t=No(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?aR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:If,charCode:function(t){return t.type==="keypress"?No(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?No(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),cR=rn(sR),fR=y({},jo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),E0=rn(fR),hR=y({},$a,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:If}),dR=rn(hR),mR=y({},Xi,{propertyName:0,elapsedTime:0,pseudoElement:0}),pR=rn(mR),gR=y({},jo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),yR=rn(gR),vR=y({},Xi,{newState:0,oldState:0}),xR=rn(vR),bR=[9,13,27,32],Zf=Cr&&"CompositionEvent"in window,Za=null;Cr&&"documentMode"in document&&(Za=document.documentMode);var wR=Cr&&"TextEvent"in window&&!Za,k0=Cr&&(!Zf||Za&&8<Za&&11>=Za),_0=" ",C0=!1;function T0(t,n){switch(t){case"keyup":return bR.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function z0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Cl=!1;function SR(t,n){switch(t){case"compositionend":return z0(n);case"keypress":return n.which!==32?null:(C0=!0,_0);case"textInput":return t=n.data,t===_0&&C0?null:t;default:return null}}function ER(t,n){if(Cl)return t==="compositionend"||!Zf&&T0(t,n)?(t=x0(),Ro=Xf=ii=null,Cl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return k0&&n.locale!=="ko"?null:n.data;default:return null}}var kR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function A0(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n==="input"?!!kR[t.type]:n==="textarea"}function M0(t,n,l,o){kl?_l?_l.push(o):_l=[o]:kl=o,n=ks(n,"onChange"),0<n.length&&(l=new Oo("onChange","change",null,l,o),t.push({event:l,listeners:n}))}var Ka=null,Pa=null;function _R(t){hb(t,0)}function Lo(t){var n=Nt(t);if(f0(n))return t}function R0(t,n){if(t==="change")return n}var N0=!1;if(Cr){var Kf;if(Cr){var Pf="oninput"in document;if(!Pf){var D0=document.createElement("div");D0.setAttribute("oninput","return;"),Pf=typeof D0.oninput=="function"}Kf=Pf}else Kf=!1;N0=Kf&&(!document.documentMode||9<document.documentMode)}function O0(){Ka&&(Ka.detachEvent("onpropertychange",j0),Pa=Ka=null)}function j0(t){if(t.propertyName==="value"&&Lo(Pa)){var n=[];M0(n,Pa,t,Yf(t)),v0(_R,n)}}function CR(t,n,l){t==="focusin"?(O0(),Ka=n,Pa=l,Ka.attachEvent("onpropertychange",j0)):t==="focusout"&&O0()}function TR(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Lo(Pa)}function zR(t,n){if(t==="click")return Lo(n)}function AR(t,n){if(t==="input"||t==="change")return Lo(n)}function MR(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var vn=typeof Object.is=="function"?Object.is:MR;function Ja(t,n){if(vn(t,n))return!0;if(typeof t!="object"||t===null||typeof n!="object"||n===null)return!1;var l=Object.keys(t),o=Object.keys(n);if(l.length!==o.length)return!1;for(o=0;o<l.length;o++){var m=l[o];if(!br.call(n,m)||!vn(t[m],n[m]))return!1}return!0}function L0(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function U0(t,n){var l=L0(t);t=0;for(var o;l;){if(l.nodeType===3){if(o=t+l.textContent.length,t<=n&&o>=n)return{node:l,offset:n-t};t=o}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=L0(l)}}function B0(t,n){return t&&n?t===n?!0:t&&t.nodeType===3?!1:n&&n.nodeType===3?B0(t,n.parentNode):"contains"in t?t.contains(n):t.compareDocumentPosition?!!(t.compareDocumentPosition(n)&16):!1:!1}function H0(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var n=Ao(t.document);n instanceof t.HTMLIFrameElement;){try{var l=typeof n.contentWindow.location.href=="string"}catch{l=!1}if(l)t=n.contentWindow;else break;n=Ao(t.document)}return n}function Jf(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n&&(n==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||n==="textarea"||t.contentEditable==="true")}var RR=Cr&&"documentMode"in document&&11>=document.documentMode,Tl=null,Wf=null,Wa=null,eh=!1;function q0(t,n,l){var o=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;eh||Tl==null||Tl!==Ao(o)||(o=Tl,"selectionStart"in o&&Jf(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),Wa&&Ja(Wa,o)||(Wa=o,o=ks(Wf,"onSelect"),0<o.length&&(n=new Oo("onSelect","select",null,n,l),t.push({event:n,listeners:o}),n.target=Tl)))}function Gi(t,n){var l={};return l[t.toLowerCase()]=n.toLowerCase(),l["Webkit"+t]="webkit"+n,l["Moz"+t]="moz"+n,l}var zl={animationend:Gi("Animation","AnimationEnd"),animationiteration:Gi("Animation","AnimationIteration"),animationstart:Gi("Animation","AnimationStart"),transitionrun:Gi("Transition","TransitionRun"),transitionstart:Gi("Transition","TransitionStart"),transitioncancel:Gi("Transition","TransitionCancel"),transitionend:Gi("Transition","TransitionEnd")},th={},Y0={};Cr&&(Y0=document.createElement("div").style,"AnimationEvent"in window||(delete zl.animationend.animation,delete zl.animationiteration.animation,delete zl.animationstart.animation),"TransitionEvent"in window||delete zl.transitionend.transition);function Qi(t){if(th[t])return th[t];if(!zl[t])return t;var n=zl[t],l;for(l in n)if(n.hasOwnProperty(l)&&l in Y0)return th[t]=n[l];return t}var V0=Qi("animationend"),F0=Qi("animationiteration"),X0=Qi("animationstart"),NR=Qi("transitionrun"),DR=Qi("transitionstart"),OR=Qi("transitioncancel"),G0=Qi("transitionend"),Q0=new Map,nh="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nh.push("scrollEnd");function Pn(t,n){Q0.set(t,n),Zn(n,[t])}var Uo=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Nn=[],Al=0,rh=0;function Bo(){for(var t=Al,n=rh=Al=0;n<t;){var l=Nn[n];Nn[n++]=null;var o=Nn[n];Nn[n++]=null;var m=Nn[n];Nn[n++]=null;var p=Nn[n];if(Nn[n++]=null,o!==null&&m!==null){var b=o.pending;b===null?m.next=m:(m.next=b.next,b.next=m),o.pending=m}p!==0&&$0(l,m,p)}}function Ho(t,n,l,o){Nn[Al++]=t,Nn[Al++]=n,Nn[Al++]=l,Nn[Al++]=o,rh|=o,t.lanes|=o,t=t.alternate,t!==null&&(t.lanes|=o)}function ih(t,n,l,o){return Ho(t,n,l,o),qo(t)}function $i(t,n){return Ho(t,null,null,n),qo(t)}function $0(t,n,l){t.lanes|=l;var o=t.alternate;o!==null&&(o.lanes|=l);for(var m=!1,p=t.return;p!==null;)p.childLanes|=l,o=p.alternate,o!==null&&(o.childLanes|=l),p.tag===22&&(t=p.stateNode,t===null||t._visibility&1||(m=!0)),t=p,p=p.return;return t.tag===3?(p=t.stateNode,m&&n!==null&&(m=31-tt(l),t=p.hiddenUpdates,o=t[m],o===null?t[m]=[n]:o.push(n),n.lane=l|536870912),p):null}function qo(t){if(50<wu)throw wu=0,dd=null,Error(a(185));for(var n=t.return;n!==null;)t=n,n=t.return;return t.tag===3?t.stateNode:null}var Ml={};function jR(t,n,l,o){this.tag=t,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xn(t,n,l,o){return new jR(t,n,l,o)}function lh(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Tr(t,n){var l=t.alternate;return l===null?(l=xn(t.tag,n,t.key,t.mode),l.elementType=t.elementType,l.type=t.type,l.stateNode=t.stateNode,l.alternate=t,t.alternate=l):(l.pendingProps=n,l.type=t.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=t.flags&65011712,l.childLanes=t.childLanes,l.lanes=t.lanes,l.child=t.child,l.memoizedProps=t.memoizedProps,l.memoizedState=t.memoizedState,l.updateQueue=t.updateQueue,n=t.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},l.sibling=t.sibling,l.index=t.index,l.ref=t.ref,l.refCleanup=t.refCleanup,l}function I0(t,n){t.flags&=65011714;var l=t.alternate;return l===null?(t.childLanes=0,t.lanes=n,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=l.childLanes,t.lanes=l.lanes,t.child=l.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=l.memoizedProps,t.memoizedState=l.memoizedState,t.updateQueue=l.updateQueue,t.type=l.type,n=l.dependencies,t.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t}function Yo(t,n,l,o,m,p){var b=0;if(o=t,typeof t=="function")lh(t)&&(b=1);else if(typeof t=="string")b=q5(t,l,se.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case G:return t=xn(31,l,n,m),t.elementType=G,t.lanes=p,t;case _:return Ii(l.children,m,p,n);case C:b=8,m|=24;break;case E:return t=xn(12,l,n,m|2),t.elementType=E,t.lanes=p,t;case V:return t=xn(13,l,n,m),t.elementType=V,t.lanes=p,t;case B:return t=xn(19,l,n,m),t.elementType=B,t.lanes=p,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case L:b=10;break e;case M:b=9;break e;case U:b=11;break e;case N:b=14;break e;case ee:b=16,o=null;break e}b=29,l=Error(a(130,t===null?"null":typeof t,"")),o=null}return n=xn(b,l,n,m),n.elementType=t,n.type=o,n.lanes=p,n}function Ii(t,n,l,o){return t=xn(7,t,o,n),t.lanes=l,t}function ah(t,n,l){return t=xn(6,t,null,n),t.lanes=l,t}function Z0(t){var n=xn(18,null,null,0);return n.stateNode=t,n}function uh(t,n,l){return n=xn(4,t.children!==null?t.children:[],t.key,n),n.lanes=l,n.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},n}var K0=new WeakMap;function Dn(t,n){if(typeof t=="object"&&t!==null){var l=K0.get(t);return l!==void 0?l:(n={value:t,source:n,stack:wl(n)},K0.set(t,n),n)}return{value:t,source:n,stack:wl(n)}}var Rl=[],Nl=0,Vo=null,eu=0,On=[],jn=0,li=null,ur=1,or="";function zr(t,n){Rl[Nl++]=eu,Rl[Nl++]=Vo,Vo=t,eu=n}function P0(t,n,l){On[jn++]=ur,On[jn++]=or,On[jn++]=li,li=t;var o=ur;t=or;var m=32-tt(o)-1;o&=~(1<<m),l+=1;var p=32-tt(n)+m;if(30<p){var b=m-m%5;p=(o&(1<<b)-1).toString(32),o>>=b,m-=b,ur=1<<32-tt(n)+m|l<<m|o,or=p+t}else ur=1<<p|l<<m|o,or=t}function oh(t){t.return!==null&&(zr(t,1),P0(t,1,0))}function sh(t){for(;t===Vo;)Vo=Rl[--Nl],Rl[Nl]=null,eu=Rl[--Nl],Rl[Nl]=null;for(;t===li;)li=On[--jn],On[jn]=null,or=On[--jn],On[jn]=null,ur=On[--jn],On[jn]=null}function J0(t,n){On[jn++]=ur,On[jn++]=or,On[jn++]=li,ur=n.id,or=n.overflow,li=t}var Ut=null,ft=null,Ie=!1,ai=null,Ln=!1,ch=Error(a(519));function ui(t){var n=Error(a(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw tu(Dn(n,t)),ch}function W0(t){var n=t.stateNode,l=t.type,o=t.memoizedProps;switch(n[me]=t,n[ge]=o,l){case"dialog":Ve("cancel",n),Ve("close",n);break;case"iframe":case"object":case"embed":Ve("load",n);break;case"video":case"audio":for(l=0;l<Eu.length;l++)Ve(Eu[l],n);break;case"source":Ve("error",n);break;case"img":case"image":case"link":Ve("error",n),Ve("load",n);break;case"details":Ve("toggle",n);break;case"input":Ve("invalid",n),h0(n,o.value,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name,!0);break;case"select":Ve("invalid",n);break;case"textarea":Ve("invalid",n),m0(n,o.value,o.defaultValue,o.children)}l=o.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||n.textContent===""+l||o.suppressHydrationWarning===!0||gb(n.textContent,l)?(o.popover!=null&&(Ve("beforetoggle",n),Ve("toggle",n)),o.onScroll!=null&&Ve("scroll",n),o.onScrollEnd!=null&&Ve("scrollend",n),o.onClick!=null&&(n.onclick=_r),n=!0):n=!1,n||ui(t,!0)}function ev(t){for(Ut=t.return;Ut;)switch(Ut.tag){case 5:case 31:case 13:Ln=!1;return;case 27:case 3:Ln=!0;return;default:Ut=Ut.return}}function Dl(t){if(t!==Ut)return!1;if(!Ie)return ev(t),Ie=!0,!1;var n=t.tag,l;if((l=n!==3&&n!==27)&&((l=n===5)&&(l=t.type,l=!(l!=="form"&&l!=="button")||zd(t.type,t.memoizedProps)),l=!l),l&&ft&&ui(t),ev(t),n===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));ft=_b(t)}else if(n===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(317));ft=_b(t)}else n===27?(n=ft,wi(t.type)?(t=Dd,Dd=null,ft=t):ft=n):ft=Ut?Bn(t.stateNode.nextSibling):null;return!0}function Zi(){ft=Ut=null,Ie=!1}function fh(){var t=ai;return t!==null&&(on===null?on=t:on.push.apply(on,t),ai=null),t}function tu(t){ai===null?ai=[t]:ai.push(t)}var hh=R(null),Ki=null,Ar=null;function oi(t,n,l){z(hh,n._currentValue),n._currentValue=l}function Mr(t){t._currentValue=hh.current,Z(hh)}function dh(t,n,l){for(;t!==null;){var o=t.alternate;if((t.childLanes&n)!==n?(t.childLanes|=n,o!==null&&(o.childLanes|=n)):o!==null&&(o.childLanes&n)!==n&&(o.childLanes|=n),t===l)break;t=t.return}}function mh(t,n,l,o){var m=t.child;for(m!==null&&(m.return=t);m!==null;){var p=m.dependencies;if(p!==null){var b=m.child;p=p.firstContext;e:for(;p!==null;){var S=p;p=m;for(var j=0;j<n.length;j++)if(S.context===n[j]){p.lanes|=l,S=p.alternate,S!==null&&(S.lanes|=l),dh(p.return,l,t),o||(b=null);break e}p=S.next}}else if(m.tag===18){if(b=m.return,b===null)throw Error(a(341));b.lanes|=l,p=b.alternate,p!==null&&(p.lanes|=l),dh(b,l,t),b=null}else b=m.child;if(b!==null)b.return=m;else for(b=m;b!==null;){if(b===t){b=null;break}if(m=b.sibling,m!==null){m.return=b.return,b=m;break}b=b.return}m=b}}function Ol(t,n,l,o){t=null;for(var m=n,p=!1;m!==null;){if(!p){if((m.flags&524288)!==0)p=!0;else if((m.flags&262144)!==0)break}if(m.tag===10){var b=m.alternate;if(b===null)throw Error(a(387));if(b=b.memoizedProps,b!==null){var S=m.type;vn(m.pendingProps.value,b.value)||(t!==null?t.push(S):t=[S])}}else if(m===Te.current){if(b=m.alternate,b===null)throw Error(a(387));b.memoizedState.memoizedState!==m.memoizedState.memoizedState&&(t!==null?t.push(zu):t=[zu])}m=m.return}t!==null&&mh(n,t,l,o),n.flags|=262144}function Fo(t){for(t=t.firstContext;t!==null;){if(!vn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Pi(t){Ki=t,Ar=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Bt(t){return tv(Ki,t)}function Xo(t,n){return Ki===null&&Pi(t),tv(t,n)}function tv(t,n){var l=n._currentValue;if(n={context:n,memoizedValue:l,next:null},Ar===null){if(t===null)throw Error(a(308));Ar=n,t.dependencies={lanes:0,firstContext:n},t.flags|=524288}else Ar=Ar.next=n;return l}var LR=typeof AbortController<"u"?AbortController:function(){var t=[],n=this.signal={aborted:!1,addEventListener:function(l,o){t.push(o)}};this.abort=function(){n.aborted=!0,t.forEach(function(l){return l()})}},UR=e.unstable_scheduleCallback,BR=e.unstable_NormalPriority,Tt={$$typeof:L,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ph(){return{controller:new LR,data:new Map,refCount:0}}function nu(t){t.refCount--,t.refCount===0&&UR(BR,function(){t.controller.abort()})}var ru=null,gh=0,jl=0,Ll=null;function HR(t,n){if(ru===null){var l=ru=[];gh=0,jl=xd(),Ll={status:"pending",value:void 0,then:function(o){l.push(o)}}}return gh++,n.then(nv,nv),n}function nv(){if(--gh===0&&ru!==null){Ll!==null&&(Ll.status="fulfilled");var t=ru;ru=null,jl=0,Ll=null;for(var n=0;n<t.length;n++)(0,t[n])()}}function qR(t,n){var l=[],o={status:"pending",value:null,reason:null,then:function(m){l.push(m)}};return t.then(function(){o.status="fulfilled",o.value=n;for(var m=0;m<l.length;m++)(0,l[m])(n)},function(m){for(o.status="rejected",o.reason=m,m=0;m<l.length;m++)(0,l[m])(void 0)}),o}var rv=A.S;A.S=function(t,n){qx=pt(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&HR(t,n),rv!==null&&rv(t,n)};var Ji=R(null);function yh(){var t=Ji.current;return t!==null?t:st.pooledCache}function Go(t,n){n===null?z(Ji,Ji.current):z(Ji,n.pool)}function iv(){var t=yh();return t===null?null:{parent:Tt._currentValue,pool:t}}var Ul=Error(a(460)),vh=Error(a(474)),Qo=Error(a(542)),$o={then:function(){}};function lv(t){return t=t.status,t==="fulfilled"||t==="rejected"}function av(t,n,l){switch(l=t[l],l===void 0?t.push(n):l!==n&&(n.then(_r,_r),n=l),n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,ov(t),t;default:if(typeof n.status=="string")n.then(_r,_r);else{if(t=st,t!==null&&100<t.shellSuspendCounter)throw Error(a(482));t=n,t.status="pending",t.then(function(o){if(n.status==="pending"){var m=n;m.status="fulfilled",m.value=o}},function(o){if(n.status==="pending"){var m=n;m.status="rejected",m.reason=o}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,ov(t),t}throw el=n,Ul}}function Wi(t){try{var n=t._init;return n(t._payload)}catch(l){throw l!==null&&typeof l=="object"&&typeof l.then=="function"?(el=l,Ul):l}}var el=null;function uv(){if(el===null)throw Error(a(459));var t=el;return el=null,t}function ov(t){if(t===Ul||t===Qo)throw Error(a(483))}var Bl=null,iu=0;function Io(t){var n=iu;return iu+=1,Bl===null&&(Bl=[]),av(Bl,t,n)}function lu(t,n){n=n.props.ref,t.ref=n!==void 0?n:null}function Zo(t,n){throw n.$$typeof===x?Error(a(525)):(t=Object.prototype.toString.call(n),Error(a(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t)))}function sv(t){function n(X,q){if(t){var $=X.deletions;$===null?(X.deletions=[q],X.flags|=16):$.push(q)}}function l(X,q){if(!t)return null;for(;q!==null;)n(X,q),q=q.sibling;return null}function o(X){for(var q=new Map;X!==null;)X.key!==null?q.set(X.key,X):q.set(X.index,X),X=X.sibling;return q}function m(X,q){return X=Tr(X,q),X.index=0,X.sibling=null,X}function p(X,q,$){return X.index=$,t?($=X.alternate,$!==null?($=$.index,$<q?(X.flags|=67108866,q):$):(X.flags|=67108866,q)):(X.flags|=1048576,q)}function b(X){return t&&X.alternate===null&&(X.flags|=67108866),X}function S(X,q,$,le){return q===null||q.tag!==6?(q=ah($,X.mode,le),q.return=X,q):(q=m(q,$),q.return=X,q)}function j(X,q,$,le){var Ce=$.type;return Ce===_?re(X,q,$.props.children,le,$.key):q!==null&&(q.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===ee&&Wi(Ce)===q.type)?(q=m(q,$.props),lu(q,$),q.return=X,q):(q=Yo($.type,$.key,$.props,null,X.mode,le),lu(q,$),q.return=X,q)}function K(X,q,$,le){return q===null||q.tag!==4||q.stateNode.containerInfo!==$.containerInfo||q.stateNode.implementation!==$.implementation?(q=uh($,X.mode,le),q.return=X,q):(q=m(q,$.children||[]),q.return=X,q)}function re(X,q,$,le,Ce){return q===null||q.tag!==7?(q=Ii($,X.mode,le,Ce),q.return=X,q):(q=m(q,$),q.return=X,q)}function ue(X,q,$){if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return q=ah(""+q,X.mode,$),q.return=X,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case v:return $=Yo(q.type,q.key,q.props,null,X.mode,$),lu($,q),$.return=X,$;case w:return q=uh(q,X.mode,$),q.return=X,q;case ee:return q=Wi(q),ue(X,q,$)}if(I(q)||ae(q))return q=Ii(q,X.mode,$,null),q.return=X,q;if(typeof q.then=="function")return ue(X,Io(q),$);if(q.$$typeof===L)return ue(X,Xo(X,q),$);Zo(X,q)}return null}function P(X,q,$,le){var Ce=q!==null?q.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return Ce!==null?null:S(X,q,""+$,le);if(typeof $=="object"&&$!==null){switch($.$$typeof){case v:return $.key===Ce?j(X,q,$,le):null;case w:return $.key===Ce?K(X,q,$,le):null;case ee:return $=Wi($),P(X,q,$,le)}if(I($)||ae($))return Ce!==null?null:re(X,q,$,le,null);if(typeof $.then=="function")return P(X,q,Io($),le);if($.$$typeof===L)return P(X,q,Xo(X,$),le);Zo(X,$)}return null}function W(X,q,$,le,Ce){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return X=X.get($)||null,S(q,X,""+le,Ce);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case v:return X=X.get(le.key===null?$:le.key)||null,j(q,X,le,Ce);case w:return X=X.get(le.key===null?$:le.key)||null,K(q,X,le,Ce);case ee:return le=Wi(le),W(X,q,$,le,Ce)}if(I(le)||ae(le))return X=X.get($)||null,re(q,X,le,Ce,null);if(typeof le.then=="function")return W(X,q,$,Io(le),Ce);if(le.$$typeof===L)return W(X,q,$,Xo(q,le),Ce);Zo(q,le)}return null}function xe(X,q,$,le){for(var Ce=null,Je=null,Se=q,Ue=q=0,Xe=null;Se!==null&&Ue<$.length;Ue++){Se.index>Ue?(Xe=Se,Se=null):Xe=Se.sibling;var We=P(X,Se,$[Ue],le);if(We===null){Se===null&&(Se=Xe);break}t&&Se&&We.alternate===null&&n(X,Se),q=p(We,q,Ue),Je===null?Ce=We:Je.sibling=We,Je=We,Se=Xe}if(Ue===$.length)return l(X,Se),Ie&&zr(X,Ue),Ce;if(Se===null){for(;Ue<$.length;Ue++)Se=ue(X,$[Ue],le),Se!==null&&(q=p(Se,q,Ue),Je===null?Ce=Se:Je.sibling=Se,Je=Se);return Ie&&zr(X,Ue),Ce}for(Se=o(Se);Ue<$.length;Ue++)Xe=W(Se,X,Ue,$[Ue],le),Xe!==null&&(t&&Xe.alternate!==null&&Se.delete(Xe.key===null?Ue:Xe.key),q=p(Xe,q,Ue),Je===null?Ce=Xe:Je.sibling=Xe,Je=Xe);return t&&Se.forEach(function(Ci){return n(X,Ci)}),Ie&&zr(X,Ue),Ce}function Ae(X,q,$,le){if($==null)throw Error(a(151));for(var Ce=null,Je=null,Se=q,Ue=q=0,Xe=null,We=$.next();Se!==null&&!We.done;Ue++,We=$.next()){Se.index>Ue?(Xe=Se,Se=null):Xe=Se.sibling;var Ci=P(X,Se,We.value,le);if(Ci===null){Se===null&&(Se=Xe);break}t&&Se&&Ci.alternate===null&&n(X,Se),q=p(Ci,q,Ue),Je===null?Ce=Ci:Je.sibling=Ci,Je=Ci,Se=Xe}if(We.done)return l(X,Se),Ie&&zr(X,Ue),Ce;if(Se===null){for(;!We.done;Ue++,We=$.next())We=ue(X,We.value,le),We!==null&&(q=p(We,q,Ue),Je===null?Ce=We:Je.sibling=We,Je=We);return Ie&&zr(X,Ue),Ce}for(Se=o(Se);!We.done;Ue++,We=$.next())We=W(Se,X,Ue,We.value,le),We!==null&&(t&&We.alternate!==null&&Se.delete(We.key===null?Ue:We.key),q=p(We,q,Ue),Je===null?Ce=We:Je.sibling=We,Je=We);return t&&Se.forEach(function(P5){return n(X,P5)}),Ie&&zr(X,Ue),Ce}function ut(X,q,$,le){if(typeof $=="object"&&$!==null&&$.type===_&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case v:e:{for(var Ce=$.key;q!==null;){if(q.key===Ce){if(Ce=$.type,Ce===_){if(q.tag===7){l(X,q.sibling),le=m(q,$.props.children),le.return=X,X=le;break e}}else if(q.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===ee&&Wi(Ce)===q.type){l(X,q.sibling),le=m(q,$.props),lu(le,$),le.return=X,X=le;break e}l(X,q);break}else n(X,q);q=q.sibling}$.type===_?(le=Ii($.props.children,X.mode,le,$.key),le.return=X,X=le):(le=Yo($.type,$.key,$.props,null,X.mode,le),lu(le,$),le.return=X,X=le)}return b(X);case w:e:{for(Ce=$.key;q!==null;){if(q.key===Ce)if(q.tag===4&&q.stateNode.containerInfo===$.containerInfo&&q.stateNode.implementation===$.implementation){l(X,q.sibling),le=m(q,$.children||[]),le.return=X,X=le;break e}else{l(X,q);break}else n(X,q);q=q.sibling}le=uh($,X.mode,le),le.return=X,X=le}return b(X);case ee:return $=Wi($),ut(X,q,$,le)}if(I($))return xe(X,q,$,le);if(ae($)){if(Ce=ae($),typeof Ce!="function")throw Error(a(150));return $=Ce.call($),Ae(X,q,$,le)}if(typeof $.then=="function")return ut(X,q,Io($),le);if($.$$typeof===L)return ut(X,q,Xo(X,$),le);Zo(X,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,q!==null&&q.tag===6?(l(X,q.sibling),le=m(q,$),le.return=X,X=le):(l(X,q),le=ah($,X.mode,le),le.return=X,X=le),b(X)):l(X,q)}return function(X,q,$,le){try{iu=0;var Ce=ut(X,q,$,le);return Bl=null,Ce}catch(Se){if(Se===Ul||Se===Qo)throw Se;var Je=xn(29,Se,null,X.mode);return Je.lanes=le,Je.return=X,Je}finally{}}}var tl=sv(!0),cv=sv(!1),si=!1;function xh(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bh(t,n){t=t.updateQueue,n.updateQueue===t&&(n.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function ci(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function fi(t,n,l){var o=t.updateQueue;if(o===null)return null;if(o=o.shared,(et&2)!==0){var m=o.pending;return m===null?n.next=n:(n.next=m.next,m.next=n),o.pending=n,n=qo(t),$0(t,null,l),n}return Ho(t,o,n,l),qo(t)}function au(t,n,l){if(n=n.updateQueue,n!==null&&(n=n.shared,(l&4194048)!==0)){var o=n.lanes;o&=t.pendingLanes,l|=o,n.lanes=l,O(t,l)}}function wh(t,n){var l=t.updateQueue,o=t.alternate;if(o!==null&&(o=o.updateQueue,l===o)){var m=null,p=null;if(l=l.firstBaseUpdate,l!==null){do{var b={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};p===null?m=p=b:p=p.next=b,l=l.next}while(l!==null);p===null?m=p=n:p=p.next=n}else m=p=n;l={baseState:o.baseState,firstBaseUpdate:m,lastBaseUpdate:p,shared:o.shared,callbacks:o.callbacks},t.updateQueue=l;return}t=l.lastBaseUpdate,t===null?l.firstBaseUpdate=n:t.next=n,l.lastBaseUpdate=n}var Sh=!1;function uu(){if(Sh){var t=Ll;if(t!==null)throw t}}function ou(t,n,l,o){Sh=!1;var m=t.updateQueue;si=!1;var p=m.firstBaseUpdate,b=m.lastBaseUpdate,S=m.shared.pending;if(S!==null){m.shared.pending=null;var j=S,K=j.next;j.next=null,b===null?p=K:b.next=K,b=j;var re=t.alternate;re!==null&&(re=re.updateQueue,S=re.lastBaseUpdate,S!==b&&(S===null?re.firstBaseUpdate=K:S.next=K,re.lastBaseUpdate=j))}if(p!==null){var ue=m.baseState;b=0,re=K=j=null,S=p;do{var P=S.lane&-536870913,W=P!==S.lane;if(W?(Fe&P)===P:(o&P)===P){P!==0&&P===jl&&(Sh=!0),re!==null&&(re=re.next={lane:0,tag:S.tag,payload:S.payload,callback:null,next:null});e:{var xe=t,Ae=S;P=n;var ut=l;switch(Ae.tag){case 1:if(xe=Ae.payload,typeof xe=="function"){ue=xe.call(ut,ue,P);break e}ue=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=Ae.payload,P=typeof xe=="function"?xe.call(ut,ue,P):xe,P==null)break e;ue=y({},ue,P);break e;case 2:si=!0}}P=S.callback,P!==null&&(t.flags|=64,W&&(t.flags|=8192),W=m.callbacks,W===null?m.callbacks=[P]:W.push(P))}else W={lane:P,tag:S.tag,payload:S.payload,callback:S.callback,next:null},re===null?(K=re=W,j=ue):re=re.next=W,b|=P;if(S=S.next,S===null){if(S=m.shared.pending,S===null)break;W=S,S=W.next,W.next=null,m.lastBaseUpdate=W,m.shared.pending=null}}while(!0);re===null&&(j=ue),m.baseState=j,m.firstBaseUpdate=K,m.lastBaseUpdate=re,p===null&&(m.shared.lanes=0),gi|=b,t.lanes=b,t.memoizedState=ue}}function fv(t,n){if(typeof t!="function")throw Error(a(191,t));t.call(n)}function hv(t,n){var l=t.callbacks;if(l!==null)for(t.callbacks=null,t=0;t<l.length;t++)fv(l[t],n)}var Hl=R(null),Ko=R(0);function dv(t,n){t=Hr,z(Ko,t),z(Hl,n),Hr=t|n.baseLanes}function Eh(){z(Ko,Hr),z(Hl,Hl.current)}function kh(){Hr=Ko.current,Z(Hl),Z(Ko)}var bn=R(null),Un=null;function hi(t){var n=t.alternate;z(kt,kt.current&1),z(bn,t),Un===null&&(n===null||Hl.current!==null||n.memoizedState!==null)&&(Un=t)}function _h(t){z(kt,kt.current),z(bn,t),Un===null&&(Un=t)}function mv(t){t.tag===22?(z(kt,kt.current),z(bn,t),Un===null&&(Un=t)):di()}function di(){z(kt,kt.current),z(bn,bn.current)}function wn(t){Z(bn),Un===t&&(Un=null),Z(kt)}var kt=R(0);function Po(t){for(var n=t;n!==null;){if(n.tag===13){var l=n.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||Rd(l)||Nd(l)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var Rr=0,je=null,lt=null,zt=null,Jo=!1,ql=!1,nl=!1,Wo=0,su=0,Yl=null,YR=0;function bt(){throw Error(a(321))}function Ch(t,n){if(n===null)return!1;for(var l=0;l<n.length&&l<t.length;l++)if(!vn(t[l],n[l]))return!1;return!0}function Th(t,n,l,o,m,p){return Rr=p,je=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,A.H=t===null||t.memoizedState===null?Pv:Vh,nl=!1,p=l(o,m),nl=!1,ql&&(p=gv(n,l,o,m)),pv(t),p}function pv(t){A.H=hu;var n=lt!==null&&lt.next!==null;if(Rr=0,zt=lt=je=null,Jo=!1,su=0,Yl=null,n)throw Error(a(300));t===null||At||(t=t.dependencies,t!==null&&Fo(t)&&(At=!0))}function gv(t,n,l,o){je=t;var m=0;do{if(ql&&(Yl=null),su=0,ql=!1,25<=m)throw Error(a(301));if(m+=1,zt=lt=null,t.updateQueue!=null){var p=t.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}A.H=Jv,p=n(l,o)}while(ql);return p}function VR(){var t=A.H,n=t.useState()[0];return n=typeof n.then=="function"?cu(n):n,t=t.useState()[0],(lt!==null?lt.memoizedState:null)!==t&&(je.flags|=1024),n}function zh(){var t=Wo!==0;return Wo=0,t}function Ah(t,n,l){n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~l}function Mh(t){if(Jo){for(t=t.memoizedState;t!==null;){var n=t.queue;n!==null&&(n.pending=null),t=t.next}Jo=!1}Rr=0,zt=lt=je=null,ql=!1,su=Wo=0,Yl=null}function Kt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zt===null?je.memoizedState=zt=t:zt=zt.next=t,zt}function _t(){if(lt===null){var t=je.alternate;t=t!==null?t.memoizedState:null}else t=lt.next;var n=zt===null?je.memoizedState:zt.next;if(n!==null)zt=n,lt=t;else{if(t===null)throw je.alternate===null?Error(a(467)):Error(a(310));lt=t,t={memoizedState:lt.memoizedState,baseState:lt.baseState,baseQueue:lt.baseQueue,queue:lt.queue,next:null},zt===null?je.memoizedState=zt=t:zt=zt.next=t}return zt}function es(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function cu(t){var n=su;return su+=1,Yl===null&&(Yl=[]),t=av(Yl,t,n),n=je,(zt===null?n.memoizedState:zt.next)===null&&(n=n.alternate,A.H=n===null||n.memoizedState===null?Pv:Vh),t}function ts(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return cu(t);if(t.$$typeof===L)return Bt(t)}throw Error(a(438,String(t)))}function Rh(t){var n=null,l=je.updateQueue;if(l!==null&&(n=l.memoCache),n==null){var o=je.alternate;o!==null&&(o=o.updateQueue,o!==null&&(o=o.memoCache,o!=null&&(n={data:o.data.map(function(m){return m.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),l===null&&(l=es(),je.updateQueue=l),l.memoCache=n,l=n.data[n.index],l===void 0)for(l=n.data[n.index]=Array(t),o=0;o<t;o++)l[o]=D;return n.index++,l}function Nr(t,n){return typeof n=="function"?n(t):n}function ns(t){var n=_t();return Nh(n,lt,t)}function Nh(t,n,l){var o=t.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=l;var m=t.baseQueue,p=o.pending;if(p!==null){if(m!==null){var b=m.next;m.next=p.next,p.next=b}n.baseQueue=m=p,o.pending=null}if(p=t.baseState,m===null)t.memoizedState=p;else{n=m.next;var S=b=null,j=null,K=n,re=!1;do{var ue=K.lane&-536870913;if(ue!==K.lane?(Fe&ue)===ue:(Rr&ue)===ue){var P=K.revertLane;if(P===0)j!==null&&(j=j.next={lane:0,revertLane:0,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),ue===jl&&(re=!0);else if((Rr&P)===P){K=K.next,P===jl&&(re=!0);continue}else ue={lane:0,revertLane:K.revertLane,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},j===null?(S=j=ue,b=p):j=j.next=ue,je.lanes|=P,gi|=P;ue=K.action,nl&&l(p,ue),p=K.hasEagerState?K.eagerState:l(p,ue)}else P={lane:ue,revertLane:K.revertLane,gesture:K.gesture,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},j===null?(S=j=P,b=p):j=j.next=P,je.lanes|=ue,gi|=ue;K=K.next}while(K!==null&&K!==n);if(j===null?b=p:j.next=S,!vn(p,t.memoizedState)&&(At=!0,re&&(l=Ll,l!==null)))throw l;t.memoizedState=p,t.baseState=b,t.baseQueue=j,o.lastRenderedState=p}return m===null&&(o.lanes=0),[t.memoizedState,o.dispatch]}function Dh(t){var n=_t(),l=n.queue;if(l===null)throw Error(a(311));l.lastRenderedReducer=t;var o=l.dispatch,m=l.pending,p=n.memoizedState;if(m!==null){l.pending=null;var b=m=m.next;do p=t(p,b.action),b=b.next;while(b!==m);vn(p,n.memoizedState)||(At=!0),n.memoizedState=p,n.baseQueue===null&&(n.baseState=p),l.lastRenderedState=p}return[p,o]}function yv(t,n,l){var o=je,m=_t(),p=Ie;if(p){if(l===void 0)throw Error(a(407));l=l()}else l=n();var b=!vn((lt||m).memoizedState,l);if(b&&(m.memoizedState=l,At=!0),m=m.queue,Lh(bv.bind(null,o,m,t),[t]),m.getSnapshot!==n||b||zt!==null&&zt.memoizedState.tag&1){if(o.flags|=2048,Vl(9,{destroy:void 0},xv.bind(null,o,m,l,n),null),st===null)throw Error(a(349));p||(Rr&127)!==0||vv(o,n,l)}return l}function vv(t,n,l){t.flags|=16384,t={getSnapshot:n,value:l},n=je.updateQueue,n===null?(n=es(),je.updateQueue=n,n.stores=[t]):(l=n.stores,l===null?n.stores=[t]:l.push(t))}function xv(t,n,l,o){n.value=l,n.getSnapshot=o,wv(n)&&Sv(t)}function bv(t,n,l){return l(function(){wv(n)&&Sv(t)})}function wv(t){var n=t.getSnapshot;t=t.value;try{var l=n();return!vn(t,l)}catch{return!0}}function Sv(t){var n=$i(t,2);n!==null&&sn(n,t,2)}function Oh(t){var n=Kt();if(typeof t=="function"){var l=t;if(t=l(),nl){jt(!0);try{l()}finally{jt(!1)}}}return n.memoizedState=n.baseState=t,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Nr,lastRenderedState:t},n}function Ev(t,n,l,o){return t.baseState=l,Nh(t,lt,typeof o=="function"?o:Nr)}function FR(t,n,l,o,m){if(ls(t))throw Error(a(485));if(t=n.action,t!==null){var p={payload:m,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){p.listeners.push(b)}};A.T!==null?l(!0):p.isTransition=!1,o(p),l=n.pending,l===null?(p.next=n.pending=p,kv(n,p)):(p.next=l.next,n.pending=l.next=p)}}function kv(t,n){var l=n.action,o=n.payload,m=t.state;if(n.isTransition){var p=A.T,b={};A.T=b;try{var S=l(m,o),j=A.S;j!==null&&j(b,S),_v(t,n,S)}catch(K){jh(t,n,K)}finally{p!==null&&b.types!==null&&(p.types=b.types),A.T=p}}else try{p=l(m,o),_v(t,n,p)}catch(K){jh(t,n,K)}}function _v(t,n,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(o){Cv(t,n,o)},function(o){return jh(t,n,o)}):Cv(t,n,l)}function Cv(t,n,l){n.status="fulfilled",n.value=l,Tv(n),t.state=l,n=t.pending,n!==null&&(l=n.next,l===n?t.pending=null:(l=l.next,n.next=l,kv(t,l)))}function jh(t,n,l){var o=t.pending;if(t.pending=null,o!==null){o=o.next;do n.status="rejected",n.reason=l,Tv(n),n=n.next;while(n!==o)}t.action=null}function Tv(t){t=t.listeners;for(var n=0;n<t.length;n++)(0,t[n])()}function zv(t,n){return n}function Av(t,n){if(Ie){var l=st.formState;if(l!==null){e:{var o=je;if(Ie){if(ft){t:{for(var m=ft,p=Ln;m.nodeType!==8;){if(!p){m=null;break t}if(m=Bn(m.nextSibling),m===null){m=null;break t}}p=m.data,m=p==="F!"||p==="F"?m:null}if(m){ft=Bn(m.nextSibling),o=m.data==="F!";break e}}ui(o)}o=!1}o&&(n=l[0])}}return l=Kt(),l.memoizedState=l.baseState=n,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zv,lastRenderedState:n},l.queue=o,l=Iv.bind(null,je,o),o.dispatch=l,o=Oh(!1),p=Yh.bind(null,je,!1,o.queue),o=Kt(),m={state:n,dispatch:null,action:t,pending:null},o.queue=m,l=FR.bind(null,je,m,p,l),m.dispatch=l,o.memoizedState=t,[n,l,!1]}function Mv(t){var n=_t();return Rv(n,lt,t)}function Rv(t,n,l){if(n=Nh(t,n,zv)[0],t=ns(Nr)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var o=cu(n)}catch(b){throw b===Ul?Qo:b}else o=n;n=_t();var m=n.queue,p=m.dispatch;return l!==n.memoizedState&&(je.flags|=2048,Vl(9,{destroy:void 0},XR.bind(null,m,l),null)),[o,p,t]}function XR(t,n){t.action=n}function Nv(t){var n=_t(),l=lt;if(l!==null)return Rv(n,l,t);_t(),n=n.memoizedState,l=_t();var o=l.queue.dispatch;return l.memoizedState=t,[n,o,!1]}function Vl(t,n,l,o){return t={tag:t,create:l,deps:o,inst:n,next:null},n=je.updateQueue,n===null&&(n=es(),je.updateQueue=n),l=n.lastEffect,l===null?n.lastEffect=t.next=t:(o=l.next,l.next=t,t.next=o,n.lastEffect=t),t}function Dv(){return _t().memoizedState}function rs(t,n,l,o){var m=Kt();je.flags|=t,m.memoizedState=Vl(1|n,{destroy:void 0},l,o===void 0?null:o)}function is(t,n,l,o){var m=_t();o=o===void 0?null:o;var p=m.memoizedState.inst;lt!==null&&o!==null&&Ch(o,lt.memoizedState.deps)?m.memoizedState=Vl(n,p,l,o):(je.flags|=t,m.memoizedState=Vl(1|n,p,l,o))}function Ov(t,n){rs(8390656,8,t,n)}function Lh(t,n){is(2048,8,t,n)}function GR(t){je.flags|=4;var n=je.updateQueue;if(n===null)n=es(),je.updateQueue=n,n.events=[t];else{var l=n.events;l===null?n.events=[t]:l.push(t)}}function jv(t){var n=_t().memoizedState;return GR({ref:n,nextImpl:t}),function(){if((et&2)!==0)throw Error(a(440));return n.impl.apply(void 0,arguments)}}function Lv(t,n){return is(4,2,t,n)}function Uv(t,n){return is(4,4,t,n)}function Bv(t,n){if(typeof n=="function"){t=t();var l=n(t);return function(){typeof l=="function"?l():n(null)}}if(n!=null)return t=t(),n.current=t,function(){n.current=null}}function Hv(t,n,l){l=l!=null?l.concat([t]):null,is(4,4,Bv.bind(null,n,t),l)}function Uh(){}function qv(t,n){var l=_t();n=n===void 0?null:n;var o=l.memoizedState;return n!==null&&Ch(n,o[1])?o[0]:(l.memoizedState=[t,n],t)}function Yv(t,n){var l=_t();n=n===void 0?null:n;var o=l.memoizedState;if(n!==null&&Ch(n,o[1]))return o[0];if(o=t(),nl){jt(!0);try{t()}finally{jt(!1)}}return l.memoizedState=[o,n],o}function Bh(t,n,l){return l===void 0||(Rr&1073741824)!==0&&(Fe&261930)===0?t.memoizedState=n:(t.memoizedState=l,t=Vx(),je.lanes|=t,gi|=t,l)}function Vv(t,n,l,o){return vn(l,n)?l:Hl.current!==null?(t=Bh(t,l,o),vn(t,n)||(At=!0),t):(Rr&42)===0||(Rr&1073741824)!==0&&(Fe&261930)===0?(At=!0,t.memoizedState=l):(t=Vx(),je.lanes|=t,gi|=t,n)}function Fv(t,n,l,o,m){var p=Q.p;Q.p=p!==0&&8>p?p:8;var b=A.T,S={};A.T=S,Yh(t,!1,n,l);try{var j=m(),K=A.S;if(K!==null&&K(S,j),j!==null&&typeof j=="object"&&typeof j.then=="function"){var re=qR(j,o);fu(t,n,re,kn(t))}else fu(t,n,o,kn(t))}catch(ue){fu(t,n,{then:function(){},status:"rejected",reason:ue},kn())}finally{Q.p=p,b!==null&&S.types!==null&&(b.types=S.types),A.T=b}}function QR(){}function Hh(t,n,l,o){if(t.tag!==5)throw Error(a(476));var m=Xv(t).queue;Fv(t,m,n,te,l===null?QR:function(){return Gv(t),l(o)})}function Xv(t){var n=t.memoizedState;if(n!==null)return n;n={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Nr,lastRenderedState:te},next:null};var l={};return n.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Nr,lastRenderedState:l},next:null},t.memoizedState=n,t=t.alternate,t!==null&&(t.memoizedState=n),n}function Gv(t){var n=Xv(t);n.next===null&&(n=t.alternate.memoizedState),fu(t,n.next.queue,{},kn())}function qh(){return Bt(zu)}function Qv(){return _t().memoizedState}function $v(){return _t().memoizedState}function $R(t){for(var n=t.return;n!==null;){switch(n.tag){case 24:case 3:var l=kn();t=ci(l);var o=fi(n,t,l);o!==null&&(sn(o,n,l),au(o,n,l)),n={cache:ph()},t.payload=n;return}n=n.return}}function IR(t,n,l){var o=kn();l={lane:o,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},ls(t)?Zv(n,l):(l=ih(t,n,l,o),l!==null&&(sn(l,t,o),Kv(l,n,o)))}function Iv(t,n,l){var o=kn();fu(t,n,l,o)}function fu(t,n,l,o){var m={lane:o,revertLane:0,gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null};if(ls(t))Zv(n,m);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=n.lastRenderedReducer,p!==null))try{var b=n.lastRenderedState,S=p(b,l);if(m.hasEagerState=!0,m.eagerState=S,vn(S,b))return Ho(t,n,m,0),st===null&&Bo(),!1}catch{}finally{}if(l=ih(t,n,m,o),l!==null)return sn(l,t,o),Kv(l,n,o),!0}return!1}function Yh(t,n,l,o){if(o={lane:2,revertLane:xd(),gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},ls(t)){if(n)throw Error(a(479))}else n=ih(t,l,o,2),n!==null&&sn(n,t,2)}function ls(t){var n=t.alternate;return t===je||n!==null&&n===je}function Zv(t,n){ql=Jo=!0;var l=t.pending;l===null?n.next=n:(n.next=l.next,l.next=n),t.pending=n}function Kv(t,n,l){if((l&4194048)!==0){var o=n.lanes;o&=t.pendingLanes,l|=o,n.lanes=l,O(t,l)}}var hu={readContext:Bt,use:ts,useCallback:bt,useContext:bt,useEffect:bt,useImperativeHandle:bt,useLayoutEffect:bt,useInsertionEffect:bt,useMemo:bt,useReducer:bt,useRef:bt,useState:bt,useDebugValue:bt,useDeferredValue:bt,useTransition:bt,useSyncExternalStore:bt,useId:bt,useHostTransitionStatus:bt,useFormState:bt,useActionState:bt,useOptimistic:bt,useMemoCache:bt,useCacheRefresh:bt};hu.useEffectEvent=bt;var Pv={readContext:Bt,use:ts,useCallback:function(t,n){return Kt().memoizedState=[t,n===void 0?null:n],t},useContext:Bt,useEffect:Ov,useImperativeHandle:function(t,n,l){l=l!=null?l.concat([t]):null,rs(4194308,4,Bv.bind(null,n,t),l)},useLayoutEffect:function(t,n){return rs(4194308,4,t,n)},useInsertionEffect:function(t,n){rs(4,2,t,n)},useMemo:function(t,n){var l=Kt();n=n===void 0?null:n;var o=t();if(nl){jt(!0);try{t()}finally{jt(!1)}}return l.memoizedState=[o,n],o},useReducer:function(t,n,l){var o=Kt();if(l!==void 0){var m=l(n);if(nl){jt(!0);try{l(n)}finally{jt(!1)}}}else m=n;return o.memoizedState=o.baseState=m,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:m},o.queue=t,t=t.dispatch=IR.bind(null,je,t),[o.memoizedState,t]},useRef:function(t){var n=Kt();return t={current:t},n.memoizedState=t},useState:function(t){t=Oh(t);var n=t.queue,l=Iv.bind(null,je,n);return n.dispatch=l,[t.memoizedState,l]},useDebugValue:Uh,useDeferredValue:function(t,n){var l=Kt();return Bh(l,t,n)},useTransition:function(){var t=Oh(!1);return t=Fv.bind(null,je,t.queue,!0,!1),Kt().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,n,l){var o=je,m=Kt();if(Ie){if(l===void 0)throw Error(a(407));l=l()}else{if(l=n(),st===null)throw Error(a(349));(Fe&127)!==0||vv(o,n,l)}m.memoizedState=l;var p={value:l,getSnapshot:n};return m.queue=p,Ov(bv.bind(null,o,p,t),[t]),o.flags|=2048,Vl(9,{destroy:void 0},xv.bind(null,o,p,l,n),null),l},useId:function(){var t=Kt(),n=st.identifierPrefix;if(Ie){var l=or,o=ur;l=(o&~(1<<32-tt(o)-1)).toString(32)+l,n="_"+n+"R_"+l,l=Wo++,0<l&&(n+="H"+l.toString(32)),n+="_"}else l=YR++,n="_"+n+"r_"+l.toString(32)+"_";return t.memoizedState=n},useHostTransitionStatus:qh,useFormState:Av,useActionState:Av,useOptimistic:function(t){var n=Kt();n.memoizedState=n.baseState=t;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=l,n=Yh.bind(null,je,!0,l),l.dispatch=n,[t,n]},useMemoCache:Rh,useCacheRefresh:function(){return Kt().memoizedState=$R.bind(null,je)},useEffectEvent:function(t){var n=Kt(),l={impl:t};return n.memoizedState=l,function(){if((et&2)!==0)throw Error(a(440));return l.impl.apply(void 0,arguments)}}},Vh={readContext:Bt,use:ts,useCallback:qv,useContext:Bt,useEffect:Lh,useImperativeHandle:Hv,useInsertionEffect:Lv,useLayoutEffect:Uv,useMemo:Yv,useReducer:ns,useRef:Dv,useState:function(){return ns(Nr)},useDebugValue:Uh,useDeferredValue:function(t,n){var l=_t();return Vv(l,lt.memoizedState,t,n)},useTransition:function(){var t=ns(Nr)[0],n=_t().memoizedState;return[typeof t=="boolean"?t:cu(t),n]},useSyncExternalStore:yv,useId:Qv,useHostTransitionStatus:qh,useFormState:Mv,useActionState:Mv,useOptimistic:function(t,n){var l=_t();return Ev(l,lt,t,n)},useMemoCache:Rh,useCacheRefresh:$v};Vh.useEffectEvent=jv;var Jv={readContext:Bt,use:ts,useCallback:qv,useContext:Bt,useEffect:Lh,useImperativeHandle:Hv,useInsertionEffect:Lv,useLayoutEffect:Uv,useMemo:Yv,useReducer:Dh,useRef:Dv,useState:function(){return Dh(Nr)},useDebugValue:Uh,useDeferredValue:function(t,n){var l=_t();return lt===null?Bh(l,t,n):Vv(l,lt.memoizedState,t,n)},useTransition:function(){var t=Dh(Nr)[0],n=_t().memoizedState;return[typeof t=="boolean"?t:cu(t),n]},useSyncExternalStore:yv,useId:Qv,useHostTransitionStatus:qh,useFormState:Nv,useActionState:Nv,useOptimistic:function(t,n){var l=_t();return lt!==null?Ev(l,lt,t,n):(l.baseState=t,[t,l.queue.dispatch])},useMemoCache:Rh,useCacheRefresh:$v};Jv.useEffectEvent=jv;function Fh(t,n,l,o){n=t.memoizedState,l=l(o,n),l=l==null?n:y({},n,l),t.memoizedState=l,t.lanes===0&&(t.updateQueue.baseState=l)}var Xh={enqueueSetState:function(t,n,l){t=t._reactInternals;var o=kn(),m=ci(o);m.payload=n,l!=null&&(m.callback=l),n=fi(t,m,o),n!==null&&(sn(n,t,o),au(n,t,o))},enqueueReplaceState:function(t,n,l){t=t._reactInternals;var o=kn(),m=ci(o);m.tag=1,m.payload=n,l!=null&&(m.callback=l),n=fi(t,m,o),n!==null&&(sn(n,t,o),au(n,t,o))},enqueueForceUpdate:function(t,n){t=t._reactInternals;var l=kn(),o=ci(l);o.tag=2,n!=null&&(o.callback=n),n=fi(t,o,l),n!==null&&(sn(n,t,l),au(n,t,l))}};function Wv(t,n,l,o,m,p,b){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(o,p,b):n.prototype&&n.prototype.isPureReactComponent?!Ja(l,o)||!Ja(m,p):!0}function ex(t,n,l,o){t=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(l,o),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(l,o),n.state!==t&&Xh.enqueueReplaceState(n,n.state,null)}function rl(t,n){var l=n;if("ref"in n){l={};for(var o in n)o!=="ref"&&(l[o]=n[o])}if(t=t.defaultProps){l===n&&(l=y({},l));for(var m in t)l[m]===void 0&&(l[m]=t[m])}return l}function tx(t){Uo(t)}function nx(t){console.error(t)}function rx(t){Uo(t)}function as(t,n){try{var l=t.onUncaughtError;l(n.value,{componentStack:n.stack})}catch(o){setTimeout(function(){throw o})}}function ix(t,n,l){try{var o=t.onCaughtError;o(l.value,{componentStack:l.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(m){setTimeout(function(){throw m})}}function Gh(t,n,l){return l=ci(l),l.tag=3,l.payload={element:null},l.callback=function(){as(t,n)},l}function lx(t){return t=ci(t),t.tag=3,t}function ax(t,n,l,o){var m=l.type.getDerivedStateFromError;if(typeof m=="function"){var p=o.value;t.payload=function(){return m(p)},t.callback=function(){ix(n,l,o)}}var b=l.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(t.callback=function(){ix(n,l,o),typeof m!="function"&&(yi===null?yi=new Set([this]):yi.add(this));var S=o.stack;this.componentDidCatch(o.value,{componentStack:S!==null?S:""})})}function ZR(t,n,l,o,m){if(l.flags|=32768,o!==null&&typeof o=="object"&&typeof o.then=="function"){if(n=l.alternate,n!==null&&Ol(n,l,m,!0),l=bn.current,l!==null){switch(l.tag){case 31:case 13:return Un===null?vs():l.alternate===null&&wt===0&&(wt=3),l.flags&=-257,l.flags|=65536,l.lanes=m,o===$o?l.flags|=16384:(n=l.updateQueue,n===null?l.updateQueue=new Set([o]):n.add(o),gd(t,o,m)),!1;case 22:return l.flags|=65536,o===$o?l.flags|=16384:(n=l.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([o])},l.updateQueue=n):(l=n.retryQueue,l===null?n.retryQueue=new Set([o]):l.add(o)),gd(t,o,m)),!1}throw Error(a(435,l.tag))}return gd(t,o,m),vs(),!1}if(Ie)return n=bn.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=m,o!==ch&&(t=Error(a(422),{cause:o}),tu(Dn(t,l)))):(o!==ch&&(n=Error(a(423),{cause:o}),tu(Dn(n,l))),t=t.current.alternate,t.flags|=65536,m&=-m,t.lanes|=m,o=Dn(o,l),m=Gh(t.stateNode,o,m),wh(t,m),wt!==4&&(wt=2)),!1;var p=Error(a(520),{cause:o});if(p=Dn(p,l),bu===null?bu=[p]:bu.push(p),wt!==4&&(wt=2),n===null)return!0;o=Dn(o,l),l=n;do{switch(l.tag){case 3:return l.flags|=65536,t=m&-m,l.lanes|=t,t=Gh(l.stateNode,o,t),wh(l,t),!1;case 1:if(n=l.type,p=l.stateNode,(l.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(yi===null||!yi.has(p))))return l.flags|=65536,m&=-m,l.lanes|=m,m=lx(m),ax(m,t,l,o),wh(l,m),!1}l=l.return}while(l!==null);return!1}var Qh=Error(a(461)),At=!1;function Ht(t,n,l,o){n.child=t===null?cv(n,null,l,o):tl(n,t.child,l,o)}function ux(t,n,l,o,m){l=l.render;var p=n.ref;if("ref"in o){var b={};for(var S in o)S!=="ref"&&(b[S]=o[S])}else b=o;return Pi(n),o=Th(t,n,l,b,p,m),S=zh(),t!==null&&!At?(Ah(t,n,m),Dr(t,n,m)):(Ie&&S&&oh(n),n.flags|=1,Ht(t,n,o,m),n.child)}function ox(t,n,l,o,m){if(t===null){var p=l.type;return typeof p=="function"&&!lh(p)&&p.defaultProps===void 0&&l.compare===null?(n.tag=15,n.type=p,sx(t,n,p,o,m)):(t=Yo(l.type,null,o,n,n.mode,m),t.ref=n.ref,t.return=n,n.child=t)}if(p=t.child,!ed(t,m)){var b=p.memoizedProps;if(l=l.compare,l=l!==null?l:Ja,l(b,o)&&t.ref===n.ref)return Dr(t,n,m)}return n.flags|=1,t=Tr(p,o),t.ref=n.ref,t.return=n,n.child=t}function sx(t,n,l,o,m){if(t!==null){var p=t.memoizedProps;if(Ja(p,o)&&t.ref===n.ref)if(At=!1,n.pendingProps=o=p,ed(t,m))(t.flags&131072)!==0&&(At=!0);else return n.lanes=t.lanes,Dr(t,n,m)}return $h(t,n,l,o,m)}function cx(t,n,l,o){var m=o.children,p=t!==null?t.memoizedState:null;if(t===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.mode==="hidden"){if((n.flags&128)!==0){if(p=p!==null?p.baseLanes|l:l,t!==null){for(o=n.child=t.child,m=0;o!==null;)m=m|o.lanes|o.childLanes,o=o.sibling;o=m&~p}else o=0,n.child=null;return fx(t,n,p,l,o)}if((l&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},t!==null&&Go(n,p!==null?p.cachePool:null),p!==null?dv(n,p):Eh(),mv(n);else return o=n.lanes=536870912,fx(t,n,p!==null?p.baseLanes|l:l,l,o)}else p!==null?(Go(n,p.cachePool),dv(n,p),di(),n.memoizedState=null):(t!==null&&Go(n,null),Eh(),di());return Ht(t,n,m,l),n.child}function du(t,n){return t!==null&&t.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function fx(t,n,l,o,m){var p=yh();return p=p===null?null:{parent:Tt._currentValue,pool:p},n.memoizedState={baseLanes:l,cachePool:p},t!==null&&Go(n,null),Eh(),mv(n),t!==null&&Ol(t,n,o,!0),n.childLanes=m,null}function us(t,n){return n=ss({mode:n.mode,children:n.children},t.mode),n.ref=t.ref,t.child=n,n.return=t,n}function hx(t,n,l){return tl(n,t.child,null,l),t=us(n,n.pendingProps),t.flags|=2,wn(n),n.memoizedState=null,t}function KR(t,n,l){var o=n.pendingProps,m=(n.flags&128)!==0;if(n.flags&=-129,t===null){if(Ie){if(o.mode==="hidden")return t=us(n,o),n.lanes=536870912,du(null,t);if(_h(n),(t=ft)?(t=kb(t,Ln),t=t!==null&&t.data==="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:li!==null?{id:ur,overflow:or}:null,retryLane:536870912,hydrationErrors:null},l=Z0(t),l.return=n,n.child=l,Ut=n,ft=null)):t=null,t===null)throw ui(n);return n.lanes=536870912,null}return us(n,o)}var p=t.memoizedState;if(p!==null){var b=p.dehydrated;if(_h(n),m)if(n.flags&256)n.flags&=-257,n=hx(t,n,l);else if(n.memoizedState!==null)n.child=t.child,n.flags|=128,n=null;else throw Error(a(558));else if(At||Ol(t,n,l,!1),m=(l&t.childLanes)!==0,At||m){if(o=st,o!==null&&(b=F(o,l),b!==0&&b!==p.retryLane))throw p.retryLane=b,$i(t,b),sn(o,t,b),Qh;vs(),n=hx(t,n,l)}else t=p.treeContext,ft=Bn(b.nextSibling),Ut=n,Ie=!0,ai=null,Ln=!1,t!==null&&J0(n,t),n=us(n,o),n.flags|=4096;return n}return t=Tr(t.child,{mode:o.mode,children:o.children}),t.ref=n.ref,n.child=t,t.return=n,t}function os(t,n){var l=n.ref;if(l===null)t!==null&&t.ref!==null&&(n.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(a(284));(t===null||t.ref!==l)&&(n.flags|=4194816)}}function $h(t,n,l,o,m){return Pi(n),l=Th(t,n,l,o,void 0,m),o=zh(),t!==null&&!At?(Ah(t,n,m),Dr(t,n,m)):(Ie&&o&&oh(n),n.flags|=1,Ht(t,n,l,m),n.child)}function dx(t,n,l,o,m,p){return Pi(n),n.updateQueue=null,l=gv(n,o,l,m),pv(t),o=zh(),t!==null&&!At?(Ah(t,n,p),Dr(t,n,p)):(Ie&&o&&oh(n),n.flags|=1,Ht(t,n,l,p),n.child)}function mx(t,n,l,o,m){if(Pi(n),n.stateNode===null){var p=Ml,b=l.contextType;typeof b=="object"&&b!==null&&(p=Bt(b)),p=new l(o,p),n.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Xh,n.stateNode=p,p._reactInternals=n,p=n.stateNode,p.props=o,p.state=n.memoizedState,p.refs={},xh(n),b=l.contextType,p.context=typeof b=="object"&&b!==null?Bt(b):Ml,p.state=n.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(Fh(n,l,b,o),p.state=n.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(b=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),b!==p.state&&Xh.enqueueReplaceState(p,p.state,null),ou(n,o,p,m),uu(),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308),o=!0}else if(t===null){p=n.stateNode;var S=n.memoizedProps,j=rl(l,S);p.props=j;var K=p.context,re=l.contextType;b=Ml,typeof re=="object"&&re!==null&&(b=Bt(re));var ue=l.getDerivedStateFromProps;re=typeof ue=="function"||typeof p.getSnapshotBeforeUpdate=="function",S=n.pendingProps!==S,re||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(S||K!==b)&&ex(n,p,o,b),si=!1;var P=n.memoizedState;p.state=P,ou(n,o,p,m),uu(),K=n.memoizedState,S||P!==K||si?(typeof ue=="function"&&(Fh(n,l,ue,o),K=n.memoizedState),(j=si||Wv(n,l,j,o,P,K,b))?(re||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(n.flags|=4194308)):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=o,n.memoizedState=K),p.props=o,p.state=K,p.context=b,o=j):(typeof p.componentDidMount=="function"&&(n.flags|=4194308),o=!1)}else{p=n.stateNode,bh(t,n),b=n.memoizedProps,re=rl(l,b),p.props=re,ue=n.pendingProps,P=p.context,K=l.contextType,j=Ml,typeof K=="object"&&K!==null&&(j=Bt(K)),S=l.getDerivedStateFromProps,(K=typeof S=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(b!==ue||P!==j)&&ex(n,p,o,j),si=!1,P=n.memoizedState,p.state=P,ou(n,o,p,m),uu();var W=n.memoizedState;b!==ue||P!==W||si||t!==null&&t.dependencies!==null&&Fo(t.dependencies)?(typeof S=="function"&&(Fh(n,l,S,o),W=n.memoizedState),(re=si||Wv(n,l,re,o,P,W,j)||t!==null&&t.dependencies!==null&&Fo(t.dependencies))?(K||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(o,W,j),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(o,W,j)),typeof p.componentDidUpdate=="function"&&(n.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof p.componentDidUpdate!="function"||b===t.memoizedProps&&P===t.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||b===t.memoizedProps&&P===t.memoizedState||(n.flags|=1024),n.memoizedProps=o,n.memoizedState=W),p.props=o,p.state=W,p.context=j,o=re):(typeof p.componentDidUpdate!="function"||b===t.memoizedProps&&P===t.memoizedState||(n.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||b===t.memoizedProps&&P===t.memoizedState||(n.flags|=1024),o=!1)}return p=o,os(t,n),o=(n.flags&128)!==0,p||o?(p=n.stateNode,l=o&&typeof l.getDerivedStateFromError!="function"?null:p.render(),n.flags|=1,t!==null&&o?(n.child=tl(n,t.child,null,m),n.child=tl(n,null,l,m)):Ht(t,n,l,m),n.memoizedState=p.state,t=n.child):t=Dr(t,n,m),t}function px(t,n,l,o){return Zi(),n.flags|=256,Ht(t,n,l,o),n.child}var Ih={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zh(t){return{baseLanes:t,cachePool:iv()}}function Kh(t,n,l){return t=t!==null?t.childLanes&~l:0,n&&(t|=En),t}function gx(t,n,l){var o=n.pendingProps,m=!1,p=(n.flags&128)!==0,b;if((b=p)||(b=t!==null&&t.memoizedState===null?!1:(kt.current&2)!==0),b&&(m=!0,n.flags&=-129),b=(n.flags&32)!==0,n.flags&=-33,t===null){if(Ie){if(m?hi(n):di(),(t=ft)?(t=kb(t,Ln),t=t!==null&&t.data!=="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:li!==null?{id:ur,overflow:or}:null,retryLane:536870912,hydrationErrors:null},l=Z0(t),l.return=n,n.child=l,Ut=n,ft=null)):t=null,t===null)throw ui(n);return Nd(t)?n.lanes=32:n.lanes=536870912,null}var S=o.children;return o=o.fallback,m?(di(),m=n.mode,S=ss({mode:"hidden",children:S},m),o=Ii(o,m,l,null),S.return=n,o.return=n,S.sibling=o,n.child=S,o=n.child,o.memoizedState=Zh(l),o.childLanes=Kh(t,b,l),n.memoizedState=Ih,du(null,o)):(hi(n),Ph(n,S))}var j=t.memoizedState;if(j!==null&&(S=j.dehydrated,S!==null)){if(p)n.flags&256?(hi(n),n.flags&=-257,n=Jh(t,n,l)):n.memoizedState!==null?(di(),n.child=t.child,n.flags|=128,n=null):(di(),S=o.fallback,m=n.mode,o=ss({mode:"visible",children:o.children},m),S=Ii(S,m,l,null),S.flags|=2,o.return=n,S.return=n,o.sibling=S,n.child=o,tl(n,t.child,null,l),o=n.child,o.memoizedState=Zh(l),o.childLanes=Kh(t,b,l),n.memoizedState=Ih,n=du(null,o));else if(hi(n),Nd(S)){if(b=S.nextSibling&&S.nextSibling.dataset,b)var K=b.dgst;b=K,o=Error(a(419)),o.stack="",o.digest=b,tu({value:o,source:null,stack:null}),n=Jh(t,n,l)}else if(At||Ol(t,n,l,!1),b=(l&t.childLanes)!==0,At||b){if(b=st,b!==null&&(o=F(b,l),o!==0&&o!==j.retryLane))throw j.retryLane=o,$i(t,o),sn(b,t,o),Qh;Rd(S)||vs(),n=Jh(t,n,l)}else Rd(S)?(n.flags|=192,n.child=t.child,n=null):(t=j.treeContext,ft=Bn(S.nextSibling),Ut=n,Ie=!0,ai=null,Ln=!1,t!==null&&J0(n,t),n=Ph(n,o.children),n.flags|=4096);return n}return m?(di(),S=o.fallback,m=n.mode,j=t.child,K=j.sibling,o=Tr(j,{mode:"hidden",children:o.children}),o.subtreeFlags=j.subtreeFlags&65011712,K!==null?S=Tr(K,S):(S=Ii(S,m,l,null),S.flags|=2),S.return=n,o.return=n,o.sibling=S,n.child=o,du(null,o),o=n.child,S=t.child.memoizedState,S===null?S=Zh(l):(m=S.cachePool,m!==null?(j=Tt._currentValue,m=m.parent!==j?{parent:j,pool:j}:m):m=iv(),S={baseLanes:S.baseLanes|l,cachePool:m}),o.memoizedState=S,o.childLanes=Kh(t,b,l),n.memoizedState=Ih,du(t.child,o)):(hi(n),l=t.child,t=l.sibling,l=Tr(l,{mode:"visible",children:o.children}),l.return=n,l.sibling=null,t!==null&&(b=n.deletions,b===null?(n.deletions=[t],n.flags|=16):b.push(t)),n.child=l,n.memoizedState=null,l)}function Ph(t,n){return n=ss({mode:"visible",children:n},t.mode),n.return=t,t.child=n}function ss(t,n){return t=xn(22,t,null,n),t.lanes=0,t}function Jh(t,n,l){return tl(n,t.child,null,l),t=Ph(n,n.pendingProps.children),t.flags|=2,n.memoizedState=null,t}function yx(t,n,l){t.lanes|=n;var o=t.alternate;o!==null&&(o.lanes|=n),dh(t.return,n,l)}function Wh(t,n,l,o,m,p){var b=t.memoizedState;b===null?t.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:o,tail:l,tailMode:m,treeForkCount:p}:(b.isBackwards=n,b.rendering=null,b.renderingStartTime=0,b.last=o,b.tail=l,b.tailMode=m,b.treeForkCount=p)}function vx(t,n,l){var o=n.pendingProps,m=o.revealOrder,p=o.tail;o=o.children;var b=kt.current,S=(b&2)!==0;if(S?(b=b&1|2,n.flags|=128):b&=1,z(kt,b),Ht(t,n,o,l),o=Ie?eu:0,!S&&t!==null&&(t.flags&128)!==0)e:for(t=n.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&yx(t,l,n);else if(t.tag===19)yx(t,l,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break e;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(m){case"forwards":for(l=n.child,m=null;l!==null;)t=l.alternate,t!==null&&Po(t)===null&&(m=l),l=l.sibling;l=m,l===null?(m=n.child,n.child=null):(m=l.sibling,l.sibling=null),Wh(n,!1,m,l,p,o);break;case"backwards":case"unstable_legacy-backwards":for(l=null,m=n.child,n.child=null;m!==null;){if(t=m.alternate,t!==null&&Po(t)===null){n.child=m;break}t=m.sibling,m.sibling=l,l=m,m=t}Wh(n,!0,l,null,p,o);break;case"together":Wh(n,!1,null,null,void 0,o);break;default:n.memoizedState=null}return n.child}function Dr(t,n,l){if(t!==null&&(n.dependencies=t.dependencies),gi|=n.lanes,(l&n.childLanes)===0)if(t!==null){if(Ol(t,n,l,!1),(l&n.childLanes)===0)return null}else return null;if(t!==null&&n.child!==t.child)throw Error(a(153));if(n.child!==null){for(t=n.child,l=Tr(t,t.pendingProps),n.child=l,l.return=n;t.sibling!==null;)t=t.sibling,l=l.sibling=Tr(t,t.pendingProps),l.return=n;l.sibling=null}return n.child}function ed(t,n){return(t.lanes&n)!==0?!0:(t=t.dependencies,!!(t!==null&&Fo(t)))}function PR(t,n,l){switch(n.tag){case 3:Oe(n,n.stateNode.containerInfo),oi(n,Tt,t.memoizedState.cache),Zi();break;case 27:case 5:en(n);break;case 4:Oe(n,n.stateNode.containerInfo);break;case 10:oi(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,_h(n),null;break;case 13:var o=n.memoizedState;if(o!==null)return o.dehydrated!==null?(hi(n),n.flags|=128,null):(l&n.child.childLanes)!==0?gx(t,n,l):(hi(n),t=Dr(t,n,l),t!==null?t.sibling:null);hi(n);break;case 19:var m=(t.flags&128)!==0;if(o=(l&n.childLanes)!==0,o||(Ol(t,n,l,!1),o=(l&n.childLanes)!==0),m){if(o)return vx(t,n,l);n.flags|=128}if(m=n.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),z(kt,kt.current),o)break;return null;case 22:return n.lanes=0,cx(t,n,l,n.pendingProps);case 24:oi(n,Tt,t.memoizedState.cache)}return Dr(t,n,l)}function xx(t,n,l){if(t!==null)if(t.memoizedProps!==n.pendingProps)At=!0;else{if(!ed(t,l)&&(n.flags&128)===0)return At=!1,PR(t,n,l);At=(t.flags&131072)!==0}else At=!1,Ie&&(n.flags&1048576)!==0&&P0(n,eu,n.index);switch(n.lanes=0,n.tag){case 16:e:{var o=n.pendingProps;if(t=Wi(n.elementType),n.type=t,typeof t=="function")lh(t)?(o=rl(t,o),n.tag=1,n=mx(null,n,t,o,l)):(n.tag=0,n=$h(null,n,t,o,l));else{if(t!=null){var m=t.$$typeof;if(m===U){n.tag=11,n=ux(null,n,t,o,l);break e}else if(m===N){n.tag=14,n=ox(null,n,t,o,l);break e}}throw n=H(t)||t,Error(a(306,n,""))}}return n;case 0:return $h(t,n,n.type,n.pendingProps,l);case 1:return o=n.type,m=rl(o,n.pendingProps),mx(t,n,o,m,l);case 3:e:{if(Oe(n,n.stateNode.containerInfo),t===null)throw Error(a(387));o=n.pendingProps;var p=n.memoizedState;m=p.element,bh(t,n),ou(n,o,null,l);var b=n.memoizedState;if(o=b.cache,oi(n,Tt,o),o!==p.cache&&mh(n,[Tt],l,!0),uu(),o=b.element,p.isDehydrated)if(p={element:o,isDehydrated:!1,cache:b.cache},n.updateQueue.baseState=p,n.memoizedState=p,n.flags&256){n=px(t,n,o,l);break e}else if(o!==m){m=Dn(Error(a(424)),n),tu(m),n=px(t,n,o,l);break e}else{switch(t=n.stateNode.containerInfo,t.nodeType){case 9:t=t.body;break;default:t=t.nodeName==="HTML"?t.ownerDocument.body:t}for(ft=Bn(t.firstChild),Ut=n,Ie=!0,ai=null,Ln=!0,l=cv(n,null,o,l),n.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(Zi(),o===m){n=Dr(t,n,l);break e}Ht(t,n,o,l)}n=n.child}return n;case 26:return os(t,n),t===null?(l=Mb(n.type,null,n.pendingProps,null))?n.memoizedState=l:Ie||(l=n.type,t=n.pendingProps,o=_s(ye.current).createElement(l),o[me]=n,o[ge]=t,qt(o,l,t),dt(o),n.stateNode=o):n.memoizedState=Mb(n.type,t.memoizedProps,n.pendingProps,t.memoizedState),null;case 27:return en(n),t===null&&Ie&&(o=n.stateNode=Tb(n.type,n.pendingProps,ye.current),Ut=n,Ln=!0,m=ft,wi(n.type)?(Dd=m,ft=Bn(o.firstChild)):ft=m),Ht(t,n,n.pendingProps.children,l),os(t,n),t===null&&(n.flags|=4194304),n.child;case 5:return t===null&&Ie&&((m=o=ft)&&(o=T5(o,n.type,n.pendingProps,Ln),o!==null?(n.stateNode=o,Ut=n,ft=Bn(o.firstChild),Ln=!1,m=!0):m=!1),m||ui(n)),en(n),m=n.type,p=n.pendingProps,b=t!==null?t.memoizedProps:null,o=p.children,zd(m,p)?o=null:b!==null&&zd(m,b)&&(n.flags|=32),n.memoizedState!==null&&(m=Th(t,n,VR,null,null,l),zu._currentValue=m),os(t,n),Ht(t,n,o,l),n.child;case 6:return t===null&&Ie&&((t=l=ft)&&(l=z5(l,n.pendingProps,Ln),l!==null?(n.stateNode=l,Ut=n,ft=null,t=!0):t=!1),t||ui(n)),null;case 13:return gx(t,n,l);case 4:return Oe(n,n.stateNode.containerInfo),o=n.pendingProps,t===null?n.child=tl(n,null,o,l):Ht(t,n,o,l),n.child;case 11:return ux(t,n,n.type,n.pendingProps,l);case 7:return Ht(t,n,n.pendingProps,l),n.child;case 8:return Ht(t,n,n.pendingProps.children,l),n.child;case 12:return Ht(t,n,n.pendingProps.children,l),n.child;case 10:return o=n.pendingProps,oi(n,n.type,o.value),Ht(t,n,o.children,l),n.child;case 9:return m=n.type._context,o=n.pendingProps.children,Pi(n),m=Bt(m),o=o(m),n.flags|=1,Ht(t,n,o,l),n.child;case 14:return ox(t,n,n.type,n.pendingProps,l);case 15:return sx(t,n,n.type,n.pendingProps,l);case 19:return vx(t,n,l);case 31:return KR(t,n,l);case 22:return cx(t,n,l,n.pendingProps);case 24:return Pi(n),o=Bt(Tt),t===null?(m=yh(),m===null&&(m=st,p=ph(),m.pooledCache=p,p.refCount++,p!==null&&(m.pooledCacheLanes|=l),m=p),n.memoizedState={parent:o,cache:m},xh(n),oi(n,Tt,m)):((t.lanes&l)!==0&&(bh(t,n),ou(n,null,null,l),uu()),m=t.memoizedState,p=n.memoizedState,m.parent!==o?(m={parent:o,cache:o},n.memoizedState=m,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=m),oi(n,Tt,o)):(o=p.cache,oi(n,Tt,o),o!==m.cache&&mh(n,[Tt],l,!0))),Ht(t,n,n.pendingProps.children,l),n.child;case 29:throw n.pendingProps}throw Error(a(156,n.tag))}function Or(t){t.flags|=4}function td(t,n,l,o,m){if((n=(t.mode&32)!==0)&&(n=!1),n){if(t.flags|=16777216,(m&335544128)===m)if(t.stateNode.complete)t.flags|=8192;else if(Qx())t.flags|=8192;else throw el=$o,vh}else t.flags&=-16777217}function bx(t,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!jb(n))if(Qx())t.flags|=8192;else throw el=$o,vh}function cs(t,n){n!==null&&(t.flags|=4),t.flags&16384&&(n=t.tag!==22?qi():536870912,t.lanes|=n,Ql|=n)}function mu(t,n){if(!Ie)switch(t.tailMode){case"hidden":n=t.tail;for(var l=null;n!==null;)n.alternate!==null&&(l=n),n=n.sibling;l===null?t.tail=null:l.sibling=null;break;case"collapsed":l=t.tail;for(var o=null;l!==null;)l.alternate!==null&&(o=l),l=l.sibling;o===null?n||t.tail===null?t.tail=null:t.tail.sibling=null:o.sibling=null}}function ht(t){var n=t.alternate!==null&&t.alternate.child===t.child,l=0,o=0;if(n)for(var m=t.child;m!==null;)l|=m.lanes|m.childLanes,o|=m.subtreeFlags&65011712,o|=m.flags&65011712,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)l|=m.lanes|m.childLanes,o|=m.subtreeFlags,o|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=o,t.childLanes=l,n}function JR(t,n,l){var o=n.pendingProps;switch(sh(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ht(n),null;case 1:return ht(n),null;case 3:return l=n.stateNode,o=null,t!==null&&(o=t.memoizedState.cache),n.memoizedState.cache!==o&&(n.flags|=2048),Mr(Tt),Ke(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(t===null||t.child===null)&&(Dl(n)?Or(n):t===null||t.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,fh())),ht(n),null;case 26:var m=n.type,p=n.memoizedState;return t===null?(Or(n),p!==null?(ht(n),bx(n,p)):(ht(n),td(n,m,null,o,l))):p?p!==t.memoizedState?(Or(n),ht(n),bx(n,p)):(ht(n),n.flags&=-16777217):(t=t.memoizedProps,t!==o&&Or(n),ht(n),td(n,m,t,o,l)),null;case 27:if(Gn(n),l=ye.current,m=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==o&&Or(n);else{if(!o){if(n.stateNode===null)throw Error(a(166));return ht(n),null}t=se.current,Dl(n)?W0(n):(t=Tb(m,o,l),n.stateNode=t,Or(n))}return ht(n),null;case 5:if(Gn(n),m=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==o&&Or(n);else{if(!o){if(n.stateNode===null)throw Error(a(166));return ht(n),null}if(p=se.current,Dl(n))W0(n);else{var b=_s(ye.current);switch(p){case 1:p=b.createElementNS("http://www.w3.org/2000/svg",m);break;case 2:p=b.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;default:switch(m){case"svg":p=b.createElementNS("http://www.w3.org/2000/svg",m);break;case"math":p=b.createElementNS("http://www.w3.org/1998/Math/MathML",m);break;case"script":p=b.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof o.is=="string"?b.createElement("select",{is:o.is}):b.createElement("select"),o.multiple?p.multiple=!0:o.size&&(p.size=o.size);break;default:p=typeof o.is=="string"?b.createElement(m,{is:o.is}):b.createElement(m)}}p[me]=n,p[ge]=o;e:for(b=n.child;b!==null;){if(b.tag===5||b.tag===6)p.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===n)break e;for(;b.sibling===null;){if(b.return===null||b.return===n)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}n.stateNode=p;e:switch(qt(p,m,o),m){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&Or(n)}}return ht(n),td(n,n.type,t===null?null:t.memoizedProps,n.pendingProps,l),null;case 6:if(t&&n.stateNode!=null)t.memoizedProps!==o&&Or(n);else{if(typeof o!="string"&&n.stateNode===null)throw Error(a(166));if(t=ye.current,Dl(n)){if(t=n.stateNode,l=n.memoizedProps,o=null,m=Ut,m!==null)switch(m.tag){case 27:case 5:o=m.memoizedProps}t[me]=n,t=!!(t.nodeValue===l||o!==null&&o.suppressHydrationWarning===!0||gb(t.nodeValue,l)),t||ui(n,!0)}else t=_s(t).createTextNode(o),t[me]=n,n.stateNode=t}return ht(n),null;case 31:if(l=n.memoizedState,t===null||t.memoizedState!==null){if(o=Dl(n),l!==null){if(t===null){if(!o)throw Error(a(318));if(t=n.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(a(557));t[me]=n}else Zi(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;ht(n),t=!1}else l=fh(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=l),t=!0;if(!t)return n.flags&256?(wn(n),n):(wn(n),null);if((n.flags&128)!==0)throw Error(a(558))}return ht(n),null;case 13:if(o=n.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(m=Dl(n),o!==null&&o.dehydrated!==null){if(t===null){if(!m)throw Error(a(318));if(m=n.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(a(317));m[me]=n}else Zi(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;ht(n),m=!1}else m=fh(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=m),m=!0;if(!m)return n.flags&256?(wn(n),n):(wn(n),null)}return wn(n),(n.flags&128)!==0?(n.lanes=l,n):(l=o!==null,t=t!==null&&t.memoizedState!==null,l&&(o=n.child,m=null,o.alternate!==null&&o.alternate.memoizedState!==null&&o.alternate.memoizedState.cachePool!==null&&(m=o.alternate.memoizedState.cachePool.pool),p=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),p!==m&&(o.flags|=2048)),l!==t&&l&&(n.child.flags|=8192),cs(n,n.updateQueue),ht(n),null);case 4:return Ke(),t===null&&Ed(n.stateNode.containerInfo),ht(n),null;case 10:return Mr(n.type),ht(n),null;case 19:if(Z(kt),o=n.memoizedState,o===null)return ht(n),null;if(m=(n.flags&128)!==0,p=o.rendering,p===null)if(m)mu(o,!1);else{if(wt!==0||t!==null&&(t.flags&128)!==0)for(t=n.child;t!==null;){if(p=Po(t),p!==null){for(n.flags|=128,mu(o,!1),t=p.updateQueue,n.updateQueue=t,cs(n,t),n.subtreeFlags=0,t=l,l=n.child;l!==null;)I0(l,t),l=l.sibling;return z(kt,kt.current&1|2),Ie&&zr(n,o.treeForkCount),n.child}t=t.sibling}o.tail!==null&&pt()>ps&&(n.flags|=128,m=!0,mu(o,!1),n.lanes=4194304)}else{if(!m)if(t=Po(p),t!==null){if(n.flags|=128,m=!0,t=t.updateQueue,n.updateQueue=t,cs(n,t),mu(o,!0),o.tail===null&&o.tailMode==="hidden"&&!p.alternate&&!Ie)return ht(n),null}else 2*pt()-o.renderingStartTime>ps&&l!==536870912&&(n.flags|=128,m=!0,mu(o,!1),n.lanes=4194304);o.isBackwards?(p.sibling=n.child,n.child=p):(t=o.last,t!==null?t.sibling=p:n.child=p,o.last=p)}return o.tail!==null?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=pt(),t.sibling=null,l=kt.current,z(kt,m?l&1|2:l&1),Ie&&zr(n,o.treeForkCount),t):(ht(n),null);case 22:case 23:return wn(n),kh(),o=n.memoizedState!==null,t!==null?t.memoizedState!==null!==o&&(n.flags|=8192):o&&(n.flags|=8192),o?(l&536870912)!==0&&(n.flags&128)===0&&(ht(n),n.subtreeFlags&6&&(n.flags|=8192)):ht(n),l=n.updateQueue,l!==null&&cs(n,l.retryQueue),l=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(l=t.memoizedState.cachePool.pool),o=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(o=n.memoizedState.cachePool.pool),o!==l&&(n.flags|=2048),t!==null&&Z(Ji),null;case 24:return l=null,t!==null&&(l=t.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),Mr(Tt),ht(n),null;case 25:return null;case 30:return null}throw Error(a(156,n.tag))}function WR(t,n){switch(sh(n),n.tag){case 1:return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 3:return Mr(Tt),Ke(),t=n.flags,(t&65536)!==0&&(t&128)===0?(n.flags=t&-65537|128,n):null;case 26:case 27:case 5:return Gn(n),null;case 31:if(n.memoizedState!==null){if(wn(n),n.alternate===null)throw Error(a(340));Zi()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 13:if(wn(n),t=n.memoizedState,t!==null&&t.dehydrated!==null){if(n.alternate===null)throw Error(a(340));Zi()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 19:return Z(kt),null;case 4:return Ke(),null;case 10:return Mr(n.type),null;case 22:case 23:return wn(n),kh(),t!==null&&Z(Ji),t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 24:return Mr(Tt),null;case 25:return null;default:return null}}function wx(t,n){switch(sh(n),n.tag){case 3:Mr(Tt),Ke();break;case 26:case 27:case 5:Gn(n);break;case 4:Ke();break;case 31:n.memoizedState!==null&&wn(n);break;case 13:wn(n);break;case 19:Z(kt);break;case 10:Mr(n.type);break;case 22:case 23:wn(n),kh(),t!==null&&Z(Ji);break;case 24:Mr(Tt)}}function pu(t,n){try{var l=n.updateQueue,o=l!==null?l.lastEffect:null;if(o!==null){var m=o.next;l=m;do{if((l.tag&t)===t){o=void 0;var p=l.create,b=l.inst;o=p(),b.destroy=o}l=l.next}while(l!==m)}}catch(S){it(n,n.return,S)}}function mi(t,n,l){try{var o=n.updateQueue,m=o!==null?o.lastEffect:null;if(m!==null){var p=m.next;o=p;do{if((o.tag&t)===t){var b=o.inst,S=b.destroy;if(S!==void 0){b.destroy=void 0,m=n;var j=l,K=S;try{K()}catch(re){it(m,j,re)}}}o=o.next}while(o!==p)}}catch(re){it(n,n.return,re)}}function Sx(t){var n=t.updateQueue;if(n!==null){var l=t.stateNode;try{hv(n,l)}catch(o){it(t,t.return,o)}}}function Ex(t,n,l){l.props=rl(t.type,t.memoizedProps),l.state=t.memoizedState;try{l.componentWillUnmount()}catch(o){it(t,n,o)}}function gu(t,n){try{var l=t.ref;if(l!==null){switch(t.tag){case 26:case 27:case 5:var o=t.stateNode;break;case 30:o=t.stateNode;break;default:o=t.stateNode}typeof l=="function"?t.refCleanup=l(o):l.current=o}}catch(m){it(t,n,m)}}function sr(t,n){var l=t.ref,o=t.refCleanup;if(l!==null)if(typeof o=="function")try{o()}catch(m){it(t,n,m)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(m){it(t,n,m)}else l.current=null}function kx(t){var n=t.type,l=t.memoizedProps,o=t.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":l.autoFocus&&o.focus();break e;case"img":l.src?o.src=l.src:l.srcSet&&(o.srcset=l.srcSet)}}catch(m){it(t,t.return,m)}}function nd(t,n,l){try{var o=t.stateNode;w5(o,t.type,l,n),o[ge]=n}catch(m){it(t,t.return,m)}}function _x(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&wi(t.type)||t.tag===4}function rd(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_x(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&wi(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function id(t,n,l){var o=t.tag;if(o===5||o===6)t=t.stateNode,n?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(t,n):(n=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,n.appendChild(t),l=l._reactRootContainer,l!=null||n.onclick!==null||(n.onclick=_r));else if(o!==4&&(o===27&&wi(t.type)&&(l=t.stateNode,n=null),t=t.child,t!==null))for(id(t,n,l),t=t.sibling;t!==null;)id(t,n,l),t=t.sibling}function fs(t,n,l){var o=t.tag;if(o===5||o===6)t=t.stateNode,n?l.insertBefore(t,n):l.appendChild(t);else if(o!==4&&(o===27&&wi(t.type)&&(l=t.stateNode),t=t.child,t!==null))for(fs(t,n,l),t=t.sibling;t!==null;)fs(t,n,l),t=t.sibling}function Cx(t){var n=t.stateNode,l=t.memoizedProps;try{for(var o=t.type,m=n.attributes;m.length;)n.removeAttributeNode(m[0]);qt(n,o,l),n[me]=t,n[ge]=l}catch(p){it(t,t.return,p)}}var jr=!1,Mt=!1,ld=!1,Tx=typeof WeakSet=="function"?WeakSet:Set,Dt=null;function e5(t,n){if(t=t.containerInfo,Cd=Ns,t=H0(t),Jf(t)){if("selectionStart"in t)var l={start:t.selectionStart,end:t.selectionEnd};else e:{l=(l=t.ownerDocument)&&l.defaultView||window;var o=l.getSelection&&l.getSelection();if(o&&o.rangeCount!==0){l=o.anchorNode;var m=o.anchorOffset,p=o.focusNode;o=o.focusOffset;try{l.nodeType,p.nodeType}catch{l=null;break e}var b=0,S=-1,j=-1,K=0,re=0,ue=t,P=null;t:for(;;){for(var W;ue!==l||m!==0&&ue.nodeType!==3||(S=b+m),ue!==p||o!==0&&ue.nodeType!==3||(j=b+o),ue.nodeType===3&&(b+=ue.nodeValue.length),(W=ue.firstChild)!==null;)P=ue,ue=W;for(;;){if(ue===t)break t;if(P===l&&++K===m&&(S=b),P===p&&++re===o&&(j=b),(W=ue.nextSibling)!==null)break;ue=P,P=ue.parentNode}ue=W}l=S===-1||j===-1?null:{start:S,end:j}}else l=null}l=l||{start:0,end:0}}else l=null;for(Td={focusedElem:t,selectionRange:l},Ns=!1,Dt=n;Dt!==null;)if(n=Dt,t=n.child,(n.subtreeFlags&1028)!==0&&t!==null)t.return=n,Dt=t;else for(;Dt!==null;){switch(n=Dt,p=n.alternate,t=n.flags,n.tag){case 0:if((t&4)!==0&&(t=n.updateQueue,t=t!==null?t.events:null,t!==null))for(l=0;l<t.length;l++)m=t[l],m.ref.impl=m.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&p!==null){t=void 0,l=n,m=p.memoizedProps,p=p.memoizedState,o=l.stateNode;try{var xe=rl(l.type,m);t=o.getSnapshotBeforeUpdate(xe,p),o.__reactInternalSnapshotBeforeUpdate=t}catch(Ae){it(l,l.return,Ae)}}break;case 3:if((t&1024)!==0){if(t=n.stateNode.containerInfo,l=t.nodeType,l===9)Md(t);else if(l===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Md(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(a(163))}if(t=n.sibling,t!==null){t.return=n.return,Dt=t;break}Dt=n.return}}function zx(t,n,l){var o=l.flags;switch(l.tag){case 0:case 11:case 15:Ur(t,l),o&4&&pu(5,l);break;case 1:if(Ur(t,l),o&4)if(t=l.stateNode,n===null)try{t.componentDidMount()}catch(b){it(l,l.return,b)}else{var m=rl(l.type,n.memoizedProps);n=n.memoizedState;try{t.componentDidUpdate(m,n,t.__reactInternalSnapshotBeforeUpdate)}catch(b){it(l,l.return,b)}}o&64&&Sx(l),o&512&&gu(l,l.return);break;case 3:if(Ur(t,l),o&64&&(t=l.updateQueue,t!==null)){if(n=null,l.child!==null)switch(l.child.tag){case 27:case 5:n=l.child.stateNode;break;case 1:n=l.child.stateNode}try{hv(t,n)}catch(b){it(l,l.return,b)}}break;case 27:n===null&&o&4&&Cx(l);case 26:case 5:Ur(t,l),n===null&&o&4&&kx(l),o&512&&gu(l,l.return);break;case 12:Ur(t,l);break;case 31:Ur(t,l),o&4&&Rx(t,l);break;case 13:Ur(t,l),o&4&&Nx(t,l),o&64&&(t=l.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(l=s5.bind(null,l),A5(t,l))));break;case 22:if(o=l.memoizedState!==null||jr,!o){n=n!==null&&n.memoizedState!==null||Mt,m=jr;var p=Mt;jr=o,(Mt=n)&&!p?Br(t,l,(l.subtreeFlags&8772)!==0):Ur(t,l),jr=m,Mt=p}break;case 30:break;default:Ur(t,l)}}function Ax(t){var n=t.alternate;n!==null&&(t.alternate=null,Ax(n)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(n=t.stateNode,n!==null&&vt(n)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var mt=null,ln=!1;function Lr(t,n,l){for(l=l.child;l!==null;)Mx(t,n,l),l=l.sibling}function Mx(t,n,l){if(nt&&typeof nt.onCommitFiberUnmount=="function")try{nt.onCommitFiberUnmount(Ot,l)}catch{}switch(l.tag){case 26:Mt||sr(l,n),Lr(t,n,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:Mt||sr(l,n);var o=mt,m=ln;wi(l.type)&&(mt=l.stateNode,ln=!1),Lr(t,n,l),_u(l.stateNode),mt=o,ln=m;break;case 5:Mt||sr(l,n);case 6:if(o=mt,m=ln,mt=null,Lr(t,n,l),mt=o,ln=m,mt!==null)if(ln)try{(mt.nodeType===9?mt.body:mt.nodeName==="HTML"?mt.ownerDocument.body:mt).removeChild(l.stateNode)}catch(p){it(l,n,p)}else try{mt.removeChild(l.stateNode)}catch(p){it(l,n,p)}break;case 18:mt!==null&&(ln?(t=mt,Sb(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,l.stateNode),ea(t)):Sb(mt,l.stateNode));break;case 4:o=mt,m=ln,mt=l.stateNode.containerInfo,ln=!0,Lr(t,n,l),mt=o,ln=m;break;case 0:case 11:case 14:case 15:mi(2,l,n),Mt||mi(4,l,n),Lr(t,n,l);break;case 1:Mt||(sr(l,n),o=l.stateNode,typeof o.componentWillUnmount=="function"&&Ex(l,n,o)),Lr(t,n,l);break;case 21:Lr(t,n,l);break;case 22:Mt=(o=Mt)||l.memoizedState!==null,Lr(t,n,l),Mt=o;break;default:Lr(t,n,l)}}function Rx(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{ea(t)}catch(l){it(n,n.return,l)}}}function Nx(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{ea(t)}catch(l){it(n,n.return,l)}}function t5(t){switch(t.tag){case 31:case 13:case 19:var n=t.stateNode;return n===null&&(n=t.stateNode=new Tx),n;case 22:return t=t.stateNode,n=t._retryCache,n===null&&(n=t._retryCache=new Tx),n;default:throw Error(a(435,t.tag))}}function hs(t,n){var l=t5(t);n.forEach(function(o){if(!l.has(o)){l.add(o);var m=c5.bind(null,t,o);o.then(m,m)}})}function an(t,n){var l=n.deletions;if(l!==null)for(var o=0;o<l.length;o++){var m=l[o],p=t,b=n,S=b;e:for(;S!==null;){switch(S.tag){case 27:if(wi(S.type)){mt=S.stateNode,ln=!1;break e}break;case 5:mt=S.stateNode,ln=!1;break e;case 3:case 4:mt=S.stateNode.containerInfo,ln=!0;break e}S=S.return}if(mt===null)throw Error(a(160));Mx(p,b,m),mt=null,ln=!1,p=m.alternate,p!==null&&(p.return=null),m.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)Dx(n,t),n=n.sibling}var Jn=null;function Dx(t,n){var l=t.alternate,o=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:an(n,t),un(t),o&4&&(mi(3,t,t.return),pu(3,t),mi(5,t,t.return));break;case 1:an(n,t),un(t),o&512&&(Mt||l===null||sr(l,l.return)),o&64&&jr&&(t=t.updateQueue,t!==null&&(o=t.callbacks,o!==null&&(l=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=l===null?o:l.concat(o))));break;case 26:var m=Jn;if(an(n,t),un(t),o&512&&(Mt||l===null||sr(l,l.return)),o&4){var p=l!==null?l.memoizedState:null;if(o=t.memoizedState,l===null)if(o===null)if(t.stateNode===null){e:{o=t.type,l=t.memoizedProps,m=m.ownerDocument||m;t:switch(o){case"title":p=m.getElementsByTagName("title")[0],(!p||p[gt]||p[me]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=m.createElement(o),m.head.insertBefore(p,m.querySelector("head > title"))),qt(p,o,l),p[me]=t,dt(p),o=p;break e;case"link":var b=Db("link","href",m).get(o+(l.href||""));if(b){for(var S=0;S<b.length;S++)if(p=b[S],p.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&p.getAttribute("rel")===(l.rel==null?null:l.rel)&&p.getAttribute("title")===(l.title==null?null:l.title)&&p.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){b.splice(S,1);break t}}p=m.createElement(o),qt(p,o,l),m.head.appendChild(p);break;case"meta":if(b=Db("meta","content",m).get(o+(l.content||""))){for(S=0;S<b.length;S++)if(p=b[S],p.getAttribute("content")===(l.content==null?null:""+l.content)&&p.getAttribute("name")===(l.name==null?null:l.name)&&p.getAttribute("property")===(l.property==null?null:l.property)&&p.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&p.getAttribute("charset")===(l.charSet==null?null:l.charSet)){b.splice(S,1);break t}}p=m.createElement(o),qt(p,o,l),m.head.appendChild(p);break;default:throw Error(a(468,o))}p[me]=t,dt(p),o=p}t.stateNode=o}else Ob(m,t.type,t.stateNode);else t.stateNode=Nb(m,o,t.memoizedProps);else p!==o?(p===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):p.count--,o===null?Ob(m,t.type,t.stateNode):Nb(m,o,t.memoizedProps)):o===null&&t.stateNode!==null&&nd(t,t.memoizedProps,l.memoizedProps)}break;case 27:an(n,t),un(t),o&512&&(Mt||l===null||sr(l,l.return)),l!==null&&o&4&&nd(t,t.memoizedProps,l.memoizedProps);break;case 5:if(an(n,t),un(t),o&512&&(Mt||l===null||sr(l,l.return)),t.flags&32){m=t.stateNode;try{El(m,"")}catch(xe){it(t,t.return,xe)}}o&4&&t.stateNode!=null&&(m=t.memoizedProps,nd(t,m,l!==null?l.memoizedProps:m)),o&1024&&(ld=!0);break;case 6:if(an(n,t),un(t),o&4){if(t.stateNode===null)throw Error(a(162));o=t.memoizedProps,l=t.stateNode;try{l.nodeValue=o}catch(xe){it(t,t.return,xe)}}break;case 3:if(zs=null,m=Jn,Jn=Cs(n.containerInfo),an(n,t),Jn=m,un(t),o&4&&l!==null&&l.memoizedState.isDehydrated)try{ea(n.containerInfo)}catch(xe){it(t,t.return,xe)}ld&&(ld=!1,Ox(t));break;case 4:o=Jn,Jn=Cs(t.stateNode.containerInfo),an(n,t),un(t),Jn=o;break;case 12:an(n,t),un(t);break;case 31:an(n,t),un(t),o&4&&(o=t.updateQueue,o!==null&&(t.updateQueue=null,hs(t,o)));break;case 13:an(n,t),un(t),t.child.flags&8192&&t.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(ms=pt()),o&4&&(o=t.updateQueue,o!==null&&(t.updateQueue=null,hs(t,o)));break;case 22:m=t.memoizedState!==null;var j=l!==null&&l.memoizedState!==null,K=jr,re=Mt;if(jr=K||m,Mt=re||j,an(n,t),Mt=re,jr=K,un(t),o&8192)e:for(n=t.stateNode,n._visibility=m?n._visibility&-2:n._visibility|1,m&&(l===null||j||jr||Mt||il(t)),l=null,n=t;;){if(n.tag===5||n.tag===26){if(l===null){j=l=n;try{if(p=j.stateNode,m)b=p.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{S=j.stateNode;var ue=j.memoizedProps.style,P=ue!=null&&ue.hasOwnProperty("display")?ue.display:null;S.style.display=P==null||typeof P=="boolean"?"":(""+P).trim()}}catch(xe){it(j,j.return,xe)}}}else if(n.tag===6){if(l===null){j=n;try{j.stateNode.nodeValue=m?"":j.memoizedProps}catch(xe){it(j,j.return,xe)}}}else if(n.tag===18){if(l===null){j=n;try{var W=j.stateNode;m?Eb(W,!0):Eb(j.stateNode,!1)}catch(xe){it(j,j.return,xe)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break e;for(;n.sibling===null;){if(n.return===null||n.return===t)break e;l===n&&(l=null),n=n.return}l===n&&(l=null),n.sibling.return=n.return,n=n.sibling}o&4&&(o=t.updateQueue,o!==null&&(l=o.retryQueue,l!==null&&(o.retryQueue=null,hs(t,l))));break;case 19:an(n,t),un(t),o&4&&(o=t.updateQueue,o!==null&&(t.updateQueue=null,hs(t,o)));break;case 30:break;case 21:break;default:an(n,t),un(t)}}function un(t){var n=t.flags;if(n&2){try{for(var l,o=t.return;o!==null;){if(_x(o)){l=o;break}o=o.return}if(l==null)throw Error(a(160));switch(l.tag){case 27:var m=l.stateNode,p=rd(t);fs(t,p,m);break;case 5:var b=l.stateNode;l.flags&32&&(El(b,""),l.flags&=-33);var S=rd(t);fs(t,S,b);break;case 3:case 4:var j=l.stateNode.containerInfo,K=rd(t);id(t,K,j);break;default:throw Error(a(161))}}catch(re){it(t,t.return,re)}t.flags&=-3}n&4096&&(t.flags&=-4097)}function Ox(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var n=t;Ox(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),t=t.sibling}}function Ur(t,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)zx(t,n.alternate,n),n=n.sibling}function il(t){for(t=t.child;t!==null;){var n=t;switch(n.tag){case 0:case 11:case 14:case 15:mi(4,n,n.return),il(n);break;case 1:sr(n,n.return);var l=n.stateNode;typeof l.componentWillUnmount=="function"&&Ex(n,n.return,l),il(n);break;case 27:_u(n.stateNode);case 26:case 5:sr(n,n.return),il(n);break;case 22:n.memoizedState===null&&il(n);break;case 30:il(n);break;default:il(n)}t=t.sibling}}function Br(t,n,l){for(l=l&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var o=n.alternate,m=t,p=n,b=p.flags;switch(p.tag){case 0:case 11:case 15:Br(m,p,l),pu(4,p);break;case 1:if(Br(m,p,l),o=p,m=o.stateNode,typeof m.componentDidMount=="function")try{m.componentDidMount()}catch(K){it(o,o.return,K)}if(o=p,m=o.updateQueue,m!==null){var S=o.stateNode;try{var j=m.shared.hiddenCallbacks;if(j!==null)for(m.shared.hiddenCallbacks=null,m=0;m<j.length;m++)fv(j[m],S)}catch(K){it(o,o.return,K)}}l&&b&64&&Sx(p),gu(p,p.return);break;case 27:Cx(p);case 26:case 5:Br(m,p,l),l&&o===null&&b&4&&kx(p),gu(p,p.return);break;case 12:Br(m,p,l);break;case 31:Br(m,p,l),l&&b&4&&Rx(m,p);break;case 13:Br(m,p,l),l&&b&4&&Nx(m,p);break;case 22:p.memoizedState===null&&Br(m,p,l),gu(p,p.return);break;case 30:break;default:Br(m,p,l)}n=n.sibling}}function ad(t,n){var l=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(l=t.memoizedState.cachePool.pool),t=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),t!==l&&(t!=null&&t.refCount++,l!=null&&nu(l))}function ud(t,n){t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&nu(t))}function Wn(t,n,l,o){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)jx(t,n,l,o),n=n.sibling}function jx(t,n,l,o){var m=n.flags;switch(n.tag){case 0:case 11:case 15:Wn(t,n,l,o),m&2048&&pu(9,n);break;case 1:Wn(t,n,l,o);break;case 3:Wn(t,n,l,o),m&2048&&(t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&nu(t)));break;case 12:if(m&2048){Wn(t,n,l,o),t=n.stateNode;try{var p=n.memoizedProps,b=p.id,S=p.onPostCommit;typeof S=="function"&&S(b,n.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(j){it(n,n.return,j)}}else Wn(t,n,l,o);break;case 31:Wn(t,n,l,o);break;case 13:Wn(t,n,l,o);break;case 23:break;case 22:p=n.stateNode,b=n.alternate,n.memoizedState!==null?p._visibility&2?Wn(t,n,l,o):yu(t,n):p._visibility&2?Wn(t,n,l,o):(p._visibility|=2,Fl(t,n,l,o,(n.subtreeFlags&10256)!==0||!1)),m&2048&&ad(b,n);break;case 24:Wn(t,n,l,o),m&2048&&ud(n.alternate,n);break;default:Wn(t,n,l,o)}}function Fl(t,n,l,o,m){for(m=m&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var p=t,b=n,S=l,j=o,K=b.flags;switch(b.tag){case 0:case 11:case 15:Fl(p,b,S,j,m),pu(8,b);break;case 23:break;case 22:var re=b.stateNode;b.memoizedState!==null?re._visibility&2?Fl(p,b,S,j,m):yu(p,b):(re._visibility|=2,Fl(p,b,S,j,m)),m&&K&2048&&ad(b.alternate,b);break;case 24:Fl(p,b,S,j,m),m&&K&2048&&ud(b.alternate,b);break;default:Fl(p,b,S,j,m)}n=n.sibling}}function yu(t,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var l=t,o=n,m=o.flags;switch(o.tag){case 22:yu(l,o),m&2048&&ad(o.alternate,o);break;case 24:yu(l,o),m&2048&&ud(o.alternate,o);break;default:yu(l,o)}n=n.sibling}}var vu=8192;function Xl(t,n,l){if(t.subtreeFlags&vu)for(t=t.child;t!==null;)Lx(t,n,l),t=t.sibling}function Lx(t,n,l){switch(t.tag){case 26:Xl(t,n,l),t.flags&vu&&t.memoizedState!==null&&Y5(l,Jn,t.memoizedState,t.memoizedProps);break;case 5:Xl(t,n,l);break;case 3:case 4:var o=Jn;Jn=Cs(t.stateNode.containerInfo),Xl(t,n,l),Jn=o;break;case 22:t.memoizedState===null&&(o=t.alternate,o!==null&&o.memoizedState!==null?(o=vu,vu=16777216,Xl(t,n,l),vu=o):Xl(t,n,l));break;default:Xl(t,n,l)}}function Ux(t){var n=t.alternate;if(n!==null&&(t=n.child,t!==null)){n.child=null;do n=t.sibling,t.sibling=null,t=n;while(t!==null)}}function xu(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var l=0;l<n.length;l++){var o=n[l];Dt=o,Hx(o,t)}Ux(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Bx(t),t=t.sibling}function Bx(t){switch(t.tag){case 0:case 11:case 15:xu(t),t.flags&2048&&mi(9,t,t.return);break;case 3:xu(t);break;case 12:xu(t);break;case 22:var n=t.stateNode;t.memoizedState!==null&&n._visibility&2&&(t.return===null||t.return.tag!==13)?(n._visibility&=-3,ds(t)):xu(t);break;default:xu(t)}}function ds(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var l=0;l<n.length;l++){var o=n[l];Dt=o,Hx(o,t)}Ux(t)}for(t=t.child;t!==null;){switch(n=t,n.tag){case 0:case 11:case 15:mi(8,n,n.return),ds(n);break;case 22:l=n.stateNode,l._visibility&2&&(l._visibility&=-3,ds(n));break;default:ds(n)}t=t.sibling}}function Hx(t,n){for(;Dt!==null;){var l=Dt;switch(l.tag){case 0:case 11:case 15:mi(8,l,n);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var o=l.memoizedState.cachePool.pool;o!=null&&o.refCount++}break;case 24:nu(l.memoizedState.cache)}if(o=l.child,o!==null)o.return=l,Dt=o;else e:for(l=t;Dt!==null;){o=Dt;var m=o.sibling,p=o.return;if(Ax(o),o===l){Dt=null;break e}if(m!==null){m.return=p,Dt=m;break e}Dt=p}}}var n5={getCacheForType:function(t){var n=Bt(Tt),l=n.data.get(t);return l===void 0&&(l=t(),n.data.set(t,l)),l},cacheSignal:function(){return Bt(Tt).controller.signal}},r5=typeof WeakMap=="function"?WeakMap:Map,et=0,st=null,Ye=null,Fe=0,rt=0,Sn=null,pi=!1,Gl=!1,od=!1,Hr=0,wt=0,gi=0,ll=0,sd=0,En=0,Ql=0,bu=null,on=null,cd=!1,ms=0,qx=0,ps=1/0,gs=null,yi=null,Rt=0,vi=null,$l=null,qr=0,fd=0,hd=null,Yx=null,wu=0,dd=null;function kn(){return(et&2)!==0&&Fe!==0?Fe&-Fe:A.T!==null?xd():de()}function Vx(){if(En===0)if((Fe&536870912)===0||Ie){var t=Ui;Ui<<=1,(Ui&3932160)===0&&(Ui=262144),En=t}else En=536870912;return t=bn.current,t!==null&&(t.flags|=32),En}function sn(t,n,l){(t===st&&(rt===2||rt===9)||t.cancelPendingCommit!==null)&&(Il(t,0),xi(t,Fe,En,!1)),ri(t,l),((et&2)===0||t!==st)&&(t===st&&((et&2)===0&&(ll|=l),wt===4&&xi(t,Fe,En,!1)),cr(t))}function Fx(t,n,l){if((et&6)!==0)throw Error(a(327));var o=!l&&(n&127)===0&&(n&t.expiredLanes)===0||Hi(t,n),m=o?a5(t,n):pd(t,n,!0),p=o;do{if(m===0){Gl&&!o&&xi(t,n,0,!1);break}else{if(l=t.current.alternate,p&&!i5(l)){m=pd(t,n,!1),p=!1;continue}if(m===2){if(p=n,t.errorRecoveryDisabledLanes&p)var b=0;else b=t.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){n=b;e:{var S=t;m=bu;var j=S.current.memoizedState.isDehydrated;if(j&&(Il(S,b).flags|=256),b=pd(S,b,!1),b!==2){if(od&&!j){S.errorRecoveryDisabledLanes|=p,ll|=p,m=4;break e}p=on,on=m,p!==null&&(on===null?on=p:on.push.apply(on,p))}m=b}if(p=!1,m!==2)continue}}if(m===1){Il(t,0),xi(t,n,0,!0);break}e:{switch(o=t,p=m,p){case 0:case 1:throw Error(a(345));case 4:if((n&4194048)!==n)break;case 6:xi(o,n,En,!pi);break e;case 2:on=null;break;case 3:case 5:break;default:throw Error(a(329))}if((n&62914560)===n&&(m=ms+300-pt(),10<m)){if(xi(o,n,En,!pi),Bi(o,0,!0)!==0)break e;qr=n,o.timeoutHandle=bb(Xx.bind(null,o,l,on,gs,cd,n,En,ll,Ql,pi,p,"Throttled",-0,0),m);break e}Xx(o,l,on,gs,cd,n,En,ll,Ql,pi,p,null,-0,0)}}break}while(!0);cr(t)}function Xx(t,n,l,o,m,p,b,S,j,K,re,ue,P,W){if(t.timeoutHandle=-1,ue=n.subtreeFlags,ue&8192||(ue&16785408)===16785408){ue={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:_r},Lx(n,p,ue);var xe=(p&62914560)===p?ms-pt():(p&4194048)===p?qx-pt():0;if(xe=V5(ue,xe),xe!==null){qr=p,t.cancelPendingCommit=xe(Jx.bind(null,t,n,p,l,o,m,b,S,j,re,ue,null,P,W)),xi(t,p,b,!K);return}}Jx(t,n,p,l,o,m,b,S,j)}function i5(t){for(var n=t;;){var l=n.tag;if((l===0||l===11||l===15)&&n.flags&16384&&(l=n.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var o=0;o<l.length;o++){var m=l[o],p=m.getSnapshot;m=m.value;try{if(!vn(p(),m))return!1}catch{return!1}}if(l=n.child,n.subtreeFlags&16384&&l!==null)l.return=n,n=l;else{if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function xi(t,n,l,o){n&=~sd,n&=~ll,t.suspendedLanes|=n,t.pingedLanes&=~n,o&&(t.warmLanes|=n),o=t.expirationTimes;for(var m=n;0<m;){var p=31-tt(m),b=1<<p;o[p]=-1,m&=~b}l!==0&&To(t,l,n)}function ys(){return(et&6)===0?(Su(0),!1):!0}function md(){if(Ye!==null){if(rt===0)var t=Ye.return;else t=Ye,Ar=Ki=null,Mh(t),Bl=null,iu=0,t=Ye;for(;t!==null;)wx(t.alternate,t),t=t.return;Ye=null}}function Il(t,n){var l=t.timeoutHandle;l!==-1&&(t.timeoutHandle=-1,k5(l)),l=t.cancelPendingCommit,l!==null&&(t.cancelPendingCommit=null,l()),qr=0,md(),st=t,Ye=l=Tr(t.current,null),Fe=n,rt=0,Sn=null,pi=!1,Gl=Hi(t,n),od=!1,Ql=En=sd=ll=gi=wt=0,on=bu=null,cd=!1,(n&8)!==0&&(n|=n&32);var o=t.entangledLanes;if(o!==0)for(t=t.entanglements,o&=n;0<o;){var m=31-tt(o),p=1<<m;n|=t[m],o&=~p}return Hr=n,Bo(),l}function Gx(t,n){je=null,A.H=hu,n===Ul||n===Qo?(n=uv(),rt=3):n===vh?(n=uv(),rt=4):rt=n===Qh?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,Sn=n,Ye===null&&(wt=1,as(t,Dn(n,t.current)))}function Qx(){var t=bn.current;return t===null?!0:(Fe&4194048)===Fe?Un===null:(Fe&62914560)===Fe||(Fe&536870912)!==0?t===Un:!1}function $x(){var t=A.H;return A.H=hu,t===null?hu:t}function Ix(){var t=A.A;return A.A=n5,t}function vs(){wt=4,pi||(Fe&4194048)!==Fe&&bn.current!==null||(Gl=!0),(gi&134217727)===0&&(ll&134217727)===0||st===null||xi(st,Fe,En,!1)}function pd(t,n,l){var o=et;et|=2;var m=$x(),p=Ix();(st!==t||Fe!==n)&&(gs=null,Il(t,n)),n=!1;var b=wt;e:do try{if(rt!==0&&Ye!==null){var S=Ye,j=Sn;switch(rt){case 8:md(),b=6;break e;case 3:case 2:case 9:case 6:bn.current===null&&(n=!0);var K=rt;if(rt=0,Sn=null,Zl(t,S,j,K),l&&Gl){b=0;break e}break;default:K=rt,rt=0,Sn=null,Zl(t,S,j,K)}}l5(),b=wt;break}catch(re){Gx(t,re)}while(!0);return n&&t.shellSuspendCounter++,Ar=Ki=null,et=o,A.H=m,A.A=p,Ye===null&&(st=null,Fe=0,Bo()),b}function l5(){for(;Ye!==null;)Zx(Ye)}function a5(t,n){var l=et;et|=2;var o=$x(),m=Ix();st!==t||Fe!==n?(gs=null,ps=pt()+500,Il(t,n)):Gl=Hi(t,n);e:do try{if(rt!==0&&Ye!==null){n=Ye;var p=Sn;t:switch(rt){case 1:rt=0,Sn=null,Zl(t,n,p,1);break;case 2:case 9:if(lv(p)){rt=0,Sn=null,Kx(n);break}n=function(){rt!==2&&rt!==9||st!==t||(rt=7),cr(t)},p.then(n,n);break e;case 3:rt=7;break e;case 4:rt=5;break e;case 7:lv(p)?(rt=0,Sn=null,Kx(n)):(rt=0,Sn=null,Zl(t,n,p,7));break;case 5:var b=null;switch(Ye.tag){case 26:b=Ye.memoizedState;case 5:case 27:var S=Ye;if(b?jb(b):S.stateNode.complete){rt=0,Sn=null;var j=S.sibling;if(j!==null)Ye=j;else{var K=S.return;K!==null?(Ye=K,xs(K)):Ye=null}break t}}rt=0,Sn=null,Zl(t,n,p,5);break;case 6:rt=0,Sn=null,Zl(t,n,p,6);break;case 8:md(),wt=6;break e;default:throw Error(a(462))}}u5();break}catch(re){Gx(t,re)}while(!0);return Ar=Ki=null,A.H=o,A.A=m,et=l,Ye!==null?0:(st=null,Fe=0,Bo(),wt)}function u5(){for(;Ye!==null&&!Va();)Zx(Ye)}function Zx(t){var n=xx(t.alternate,t,Hr);t.memoizedProps=t.pendingProps,n===null?xs(t):Ye=n}function Kx(t){var n=t,l=n.alternate;switch(n.tag){case 15:case 0:n=dx(l,n,n.pendingProps,n.type,void 0,Fe);break;case 11:n=dx(l,n,n.pendingProps,n.type.render,n.ref,Fe);break;case 5:Mh(n);default:wx(l,n),n=Ye=I0(n,Hr),n=xx(l,n,Hr)}t.memoizedProps=t.pendingProps,n===null?xs(t):Ye=n}function Zl(t,n,l,o){Ar=Ki=null,Mh(n),Bl=null,iu=0;var m=n.return;try{if(ZR(t,m,n,l,Fe)){wt=1,as(t,Dn(l,t.current)),Ye=null;return}}catch(p){if(m!==null)throw Ye=m,p;wt=1,as(t,Dn(l,t.current)),Ye=null;return}n.flags&32768?(Ie||o===1?t=!0:Gl||(Fe&536870912)!==0?t=!1:(pi=t=!0,(o===2||o===9||o===3||o===6)&&(o=bn.current,o!==null&&o.tag===13&&(o.flags|=16384))),Px(n,t)):xs(n)}function xs(t){var n=t;do{if((n.flags&32768)!==0){Px(n,pi);return}t=n.return;var l=JR(n.alternate,n,Hr);if(l!==null){Ye=l;return}if(n=n.sibling,n!==null){Ye=n;return}Ye=n=t}while(n!==null);wt===0&&(wt=5)}function Px(t,n){do{var l=WR(t.alternate,t);if(l!==null){l.flags&=32767,Ye=l;return}if(l=t.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!n&&(t=t.sibling,t!==null)){Ye=t;return}Ye=t=l}while(t!==null);wt=6,Ye=null}function Jx(t,n,l,o,m,p,b,S,j){t.cancelPendingCommit=null;do bs();while(Rt!==0);if((et&6)!==0)throw Error(a(327));if(n!==null){if(n===t.current)throw Error(a(177));if(p=n.lanes|n.childLanes,p|=rh,Lf(t,l,p,b,S,j),t===st&&(Ye=st=null,Fe=0),$l=n,vi=t,qr=l,fd=p,hd=m,Yx=o,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,f5(ke,function(){return rb(),null})):(t.callbackNode=null,t.callbackPriority=0),o=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||o){o=A.T,A.T=null,m=Q.p,Q.p=2,b=et,et|=4;try{e5(t,n,l)}finally{et=b,Q.p=m,A.T=o}}Rt=1,Wx(),eb(),tb()}}function Wx(){if(Rt===1){Rt=0;var t=vi,n=$l,l=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||l){l=A.T,A.T=null;var o=Q.p;Q.p=2;var m=et;et|=4;try{Dx(n,t);var p=Td,b=H0(t.containerInfo),S=p.focusedElem,j=p.selectionRange;if(b!==S&&S&&S.ownerDocument&&B0(S.ownerDocument.documentElement,S)){if(j!==null&&Jf(S)){var K=j.start,re=j.end;if(re===void 0&&(re=K),"selectionStart"in S)S.selectionStart=K,S.selectionEnd=Math.min(re,S.value.length);else{var ue=S.ownerDocument||document,P=ue&&ue.defaultView||window;if(P.getSelection){var W=P.getSelection(),xe=S.textContent.length,Ae=Math.min(j.start,xe),ut=j.end===void 0?Ae:Math.min(j.end,xe);!W.extend&&Ae>ut&&(b=ut,ut=Ae,Ae=b);var X=U0(S,Ae),q=U0(S,ut);if(X&&q&&(W.rangeCount!==1||W.anchorNode!==X.node||W.anchorOffset!==X.offset||W.focusNode!==q.node||W.focusOffset!==q.offset)){var $=ue.createRange();$.setStart(X.node,X.offset),W.removeAllRanges(),Ae>ut?(W.addRange($),W.extend(q.node,q.offset)):($.setEnd(q.node,q.offset),W.addRange($))}}}}for(ue=[],W=S;W=W.parentNode;)W.nodeType===1&&ue.push({element:W,left:W.scrollLeft,top:W.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<ue.length;S++){var le=ue[S];le.element.scrollLeft=le.left,le.element.scrollTop=le.top}}Ns=!!Cd,Td=Cd=null}finally{et=m,Q.p=o,A.T=l}}t.current=n,Rt=2}}function eb(){if(Rt===2){Rt=0;var t=vi,n=$l,l=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||l){l=A.T,A.T=null;var o=Q.p;Q.p=2;var m=et;et|=4;try{zx(t,n.alternate,n)}finally{et=m,Q.p=o,A.T=l}}Rt=3}}function tb(){if(Rt===4||Rt===3){Rt=0,Fa();var t=vi,n=$l,l=qr,o=Yx;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Rt=5:(Rt=0,$l=vi=null,nb(t,t.pendingLanes));var m=t.pendingLanes;if(m===0&&(yi=null),ce(l),n=n.stateNode,nt&&typeof nt.onCommitFiberRoot=="function")try{nt.onCommitFiberRoot(Ot,n,void 0,(n.current.flags&128)===128)}catch{}if(o!==null){n=A.T,m=Q.p,Q.p=2,A.T=null;try{for(var p=t.onRecoverableError,b=0;b<o.length;b++){var S=o[b];p(S.value,{componentStack:S.stack})}}finally{A.T=n,Q.p=m}}(qr&3)!==0&&bs(),cr(t),m=t.pendingLanes,(l&261930)!==0&&(m&42)!==0?t===dd?wu++:(wu=0,dd=t):wu=0,Su(0)}}function nb(t,n){(t.pooledCacheLanes&=n)===0&&(n=t.pooledCache,n!=null&&(t.pooledCache=null,nu(n)))}function bs(){return Wx(),eb(),tb(),rb()}function rb(){if(Rt!==5)return!1;var t=vi,n=fd;fd=0;var l=ce(qr),o=A.T,m=Q.p;try{Q.p=32>l?32:l,A.T=null,l=hd,hd=null;var p=vi,b=qr;if(Rt=0,$l=vi=null,qr=0,(et&6)!==0)throw Error(a(331));var S=et;if(et|=4,Bx(p.current),jx(p,p.current,b,l),et=S,Su(0,!1),nt&&typeof nt.onPostCommitFiberRoot=="function")try{nt.onPostCommitFiberRoot(Ot,p)}catch{}return!0}finally{Q.p=m,A.T=o,nb(t,n)}}function ib(t,n,l){n=Dn(l,n),n=Gh(t.stateNode,n,2),t=fi(t,n,2),t!==null&&(ri(t,2),cr(t))}function it(t,n,l){if(t.tag===3)ib(t,t,l);else for(;n!==null;){if(n.tag===3){ib(n,t,l);break}else if(n.tag===1){var o=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(yi===null||!yi.has(o))){t=Dn(l,t),l=lx(2),o=fi(n,l,2),o!==null&&(ax(l,o,n,t),ri(o,2),cr(o));break}}n=n.return}}function gd(t,n,l){var o=t.pingCache;if(o===null){o=t.pingCache=new r5;var m=new Set;o.set(n,m)}else m=o.get(n),m===void 0&&(m=new Set,o.set(n,m));m.has(l)||(od=!0,m.add(l),t=o5.bind(null,t,n,l),n.then(t,t))}function o5(t,n,l){var o=t.pingCache;o!==null&&o.delete(n),t.pingedLanes|=t.suspendedLanes&l,t.warmLanes&=~l,st===t&&(Fe&l)===l&&(wt===4||wt===3&&(Fe&62914560)===Fe&&300>pt()-ms?(et&2)===0&&Il(t,0):sd|=l,Ql===Fe&&(Ql=0)),cr(t)}function lb(t,n){n===0&&(n=qi()),t=$i(t,n),t!==null&&(ri(t,n),cr(t))}function s5(t){var n=t.memoizedState,l=0;n!==null&&(l=n.retryLane),lb(t,l)}function c5(t,n){var l=0;switch(t.tag){case 31:case 13:var o=t.stateNode,m=t.memoizedState;m!==null&&(l=m.retryLane);break;case 19:o=t.stateNode;break;case 22:o=t.stateNode._retryCache;break;default:throw Error(a(314))}o!==null&&o.delete(n),lb(t,l)}function f5(t,n){return ei(t,n)}var ws=null,Kl=null,yd=!1,Ss=!1,vd=!1,bi=0;function cr(t){t!==Kl&&t.next===null&&(Kl===null?ws=Kl=t:Kl=Kl.next=t),Ss=!0,yd||(yd=!0,d5())}function Su(t,n){if(!vd&&Ss){vd=!0;do for(var l=!1,o=ws;o!==null;){if(t!==0){var m=o.pendingLanes;if(m===0)var p=0;else{var b=o.suspendedLanes,S=o.pingedLanes;p=(1<<31-tt(42|t)+1)-1,p&=m&~(b&~S),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(l=!0,sb(o,p))}else p=Fe,p=Bi(o,o===st?p:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),(p&3)===0||Hi(o,p)||(l=!0,sb(o,p));o=o.next}while(l);vd=!1}}function h5(){ab()}function ab(){Ss=yd=!1;var t=0;bi!==0&&E5()&&(t=bi);for(var n=pt(),l=null,o=ws;o!==null;){var m=o.next,p=ub(o,n);p===0?(o.next=null,l===null?ws=m:l.next=m,m===null&&(Kl=l)):(l=o,(t!==0||(p&3)!==0)&&(Ss=!0)),o=m}Rt!==0&&Rt!==5||Su(t),bi!==0&&(bi=0)}function ub(t,n){for(var l=t.suspendedLanes,o=t.pingedLanes,m=t.expirationTimes,p=t.pendingLanes&-62914561;0<p;){var b=31-tt(p),S=1<<b,j=m[b];j===-1?((S&l)===0||(S&o)!==0)&&(m[b]=Co(S,n)):j<=n&&(t.expiredLanes|=S),p&=~S}if(n=st,l=Fe,l=Bi(t,t===n?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),o=t.callbackNode,l===0||t===n&&(rt===2||rt===9)||t.cancelPendingCommit!==null)return o!==null&&o!==null&&Li(o),t.callbackNode=null,t.callbackPriority=0;if((l&3)===0||Hi(t,l)){if(n=l&-l,n===t.callbackPriority)return n;switch(o!==null&&Li(o),ce(l)){case 2:case 8:l=he;break;case 32:l=ke;break;case 268435456:l=Pe;break;default:l=ke}return o=ob.bind(null,t),l=ei(l,o),t.callbackPriority=n,t.callbackNode=l,n}return o!==null&&o!==null&&Li(o),t.callbackPriority=2,t.callbackNode=null,2}function ob(t,n){if(Rt!==0&&Rt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var l=t.callbackNode;if(bs()&&t.callbackNode!==l)return null;var o=Fe;return o=Bi(t,t===st?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),o===0?null:(Fx(t,o,n),ub(t,pt()),t.callbackNode!=null&&t.callbackNode===l?ob.bind(null,t):null)}function sb(t,n){if(bs())return null;Fx(t,n,!0)}function d5(){_5(function(){(et&6)!==0?ei(ie,h5):ab()})}function xd(){if(bi===0){var t=jl;t===0&&(t=Sr,Sr<<=1,(Sr&261888)===0&&(Sr=256)),bi=t}return bi}function cb(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Mo(""+t)}function fb(t,n){var l=n.ownerDocument.createElement("input");return l.name=n.name,l.value=n.value,t.id&&l.setAttribute("form",t.id),n.parentNode.insertBefore(l,n),t=new FormData(t),l.parentNode.removeChild(l),t}function m5(t,n,l,o,m){if(n==="submit"&&l&&l.stateNode===m){var p=cb((m[ge]||null).action),b=o.submitter;b&&(n=(n=b[ge]||null)?cb(n.formAction):b.getAttribute("formAction"),n!==null&&(p=n,b=null));var S=new Oo("action","action",null,o,m);t.push({event:S,listeners:[{instance:null,listener:function(){if(o.defaultPrevented){if(bi!==0){var j=b?fb(m,b):new FormData(m);Hh(l,{pending:!0,data:j,method:m.method,action:p},null,j)}}else typeof p=="function"&&(S.preventDefault(),j=b?fb(m,b):new FormData(m),Hh(l,{pending:!0,data:j,method:m.method,action:p},p,j))},currentTarget:m}]})}}for(var bd=0;bd<nh.length;bd++){var wd=nh[bd],p5=wd.toLowerCase(),g5=wd[0].toUpperCase()+wd.slice(1);Pn(p5,"on"+g5)}Pn(V0,"onAnimationEnd"),Pn(F0,"onAnimationIteration"),Pn(X0,"onAnimationStart"),Pn("dblclick","onDoubleClick"),Pn("focusin","onFocus"),Pn("focusout","onBlur"),Pn(NR,"onTransitionRun"),Pn(DR,"onTransitionStart"),Pn(OR,"onTransitionCancel"),Pn(G0,"onTransitionEnd"),Mn("onMouseEnter",["mouseout","mouseover"]),Mn("onMouseLeave",["mouseout","mouseover"]),Mn("onPointerEnter",["pointerout","pointerover"]),Mn("onPointerLeave",["pointerout","pointerover"]),Zn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Zn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Zn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Zn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Zn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Zn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Eu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),y5=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Eu));function hb(t,n){n=(n&4)!==0;for(var l=0;l<t.length;l++){var o=t[l],m=o.event;o=o.listeners;e:{var p=void 0;if(n)for(var b=o.length-1;0<=b;b--){var S=o[b],j=S.instance,K=S.currentTarget;if(S=S.listener,j!==p&&m.isPropagationStopped())break e;p=S,m.currentTarget=K;try{p(m)}catch(re){Uo(re)}m.currentTarget=null,p=j}else for(b=0;b<o.length;b++){if(S=o[b],j=S.instance,K=S.currentTarget,S=S.listener,j!==p&&m.isPropagationStopped())break e;p=S,m.currentTarget=K;try{p(m)}catch(re){Uo(re)}m.currentTarget=null,p=j}}}}function Ve(t,n){var l=n[Re];l===void 0&&(l=n[Re]=new Set);var o=t+"__bubble";l.has(o)||(db(n,t,2,!1),l.add(o))}function Sd(t,n,l){var o=0;n&&(o|=4),db(l,t,o,n)}var Es="_reactListening"+Math.random().toString(36).slice(2);function Ed(t){if(!t[Es]){t[Es]=!0,In.forEach(function(l){l!=="selectionchange"&&(y5.has(l)||Sd(l,!1,t),Sd(l,!0,t))});var n=t.nodeType===9?t:t.ownerDocument;n===null||n[Es]||(n[Es]=!0,Sd("selectionchange",!1,n))}}function db(t,n,l,o){switch(Vb(n)){case 2:var m=G5;break;case 8:m=Q5;break;default:m=Bd}l=m.bind(null,n,l,t),m=void 0,!Ff||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(m=!0),o?m!==void 0?t.addEventListener(n,l,{capture:!0,passive:m}):t.addEventListener(n,l,!0):m!==void 0?t.addEventListener(n,l,{passive:m}):t.addEventListener(n,l,!1)}function kd(t,n,l,o,m){var p=o;if((n&1)===0&&(n&2)===0&&o!==null)e:for(;;){if(o===null)return;var b=o.tag;if(b===3||b===4){var S=o.stateNode.containerInfo;if(S===m)break;if(b===4)for(b=o.return;b!==null;){var j=b.tag;if((j===3||j===4)&&b.stateNode.containerInfo===m)return;b=b.return}for(;S!==null;){if(b=xt(S),b===null)return;if(j=b.tag,j===5||j===6||j===26||j===27){o=p=b;continue e}S=S.parentNode}}o=o.return}v0(function(){var K=p,re=Yf(l),ue=[];e:{var P=Q0.get(t);if(P!==void 0){var W=Oo,xe=t;switch(t){case"keypress":if(No(l)===0)break e;case"keydown":case"keyup":W=cR;break;case"focusin":xe="focus",W=$f;break;case"focusout":xe="blur",W=$f;break;case"beforeblur":case"afterblur":W=$f;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=w0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=JM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=dR;break;case V0:case F0:case X0:W=tR;break;case G0:W=pR;break;case"scroll":case"scrollend":W=KM;break;case"wheel":W=yR;break;case"copy":case"cut":case"paste":W=rR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=E0;break;case"toggle":case"beforetoggle":W=xR}var Ae=(n&4)!==0,ut=!Ae&&(t==="scroll"||t==="scrollend"),X=Ae?P!==null?P+"Capture":null:P;Ae=[];for(var q=K,$;q!==null;){var le=q;if($=le.stateNode,le=le.tag,le!==5&&le!==26&&le!==27||$===null||X===null||(le=Ga(q,X),le!=null&&Ae.push(ku(q,le,$))),ut)break;q=q.return}0<Ae.length&&(P=new W(P,xe,null,l,re),ue.push({event:P,listeners:Ae}))}}if((n&7)===0){e:{if(P=t==="mouseover"||t==="pointerover",W=t==="mouseout"||t==="pointerout",P&&l!==qf&&(xe=l.relatedTarget||l.fromElement)&&(xt(xe)||xe[we]))break e;if((W||P)&&(P=re.window===re?re:(P=re.ownerDocument)?P.defaultView||P.parentWindow:window,W?(xe=l.relatedTarget||l.toElement,W=K,xe=xe?xt(xe):null,xe!==null&&(ut=s(xe),Ae=xe.tag,xe!==ut||Ae!==5&&Ae!==27&&Ae!==6)&&(xe=null)):(W=null,xe=K),W!==xe)){if(Ae=w0,le="onMouseLeave",X="onMouseEnter",q="mouse",(t==="pointerout"||t==="pointerover")&&(Ae=E0,le="onPointerLeave",X="onPointerEnter",q="pointer"),ut=W==null?P:Nt(W),$=xe==null?P:Nt(xe),P=new Ae(le,q+"leave",W,l,re),P.target=ut,P.relatedTarget=$,le=null,xt(re)===K&&(Ae=new Ae(X,q+"enter",xe,l,re),Ae.target=$,Ae.relatedTarget=ut,le=Ae),ut=le,W&&xe)t:{for(Ae=v5,X=W,q=xe,$=0,le=X;le;le=Ae(le))$++;le=0;for(var Ce=q;Ce;Ce=Ae(Ce))le++;for(;0<$-le;)X=Ae(X),$--;for(;0<le-$;)q=Ae(q),le--;for(;$--;){if(X===q||q!==null&&X===q.alternate){Ae=X;break t}X=Ae(X),q=Ae(q)}Ae=null}else Ae=null;W!==null&&mb(ue,P,W,Ae,!1),xe!==null&&ut!==null&&mb(ue,ut,xe,Ae,!0)}}e:{if(P=K?Nt(K):window,W=P.nodeName&&P.nodeName.toLowerCase(),W==="select"||W==="input"&&P.type==="file")var Je=R0;else if(A0(P))if(N0)Je=AR;else{Je=TR;var Se=CR}else W=P.nodeName,!W||W.toLowerCase()!=="input"||P.type!=="checkbox"&&P.type!=="radio"?K&&Hf(K.elementType)&&(Je=R0):Je=zR;if(Je&&(Je=Je(t,K))){M0(ue,Je,l,re);break e}Se&&Se(t,P,K),t==="focusout"&&K&&P.type==="number"&&K.memoizedProps.value!=null&&Bf(P,"number",P.value)}switch(Se=K?Nt(K):window,t){case"focusin":(A0(Se)||Se.contentEditable==="true")&&(Tl=Se,Wf=K,Wa=null);break;case"focusout":Wa=Wf=Tl=null;break;case"mousedown":eh=!0;break;case"contextmenu":case"mouseup":case"dragend":eh=!1,q0(ue,l,re);break;case"selectionchange":if(RR)break;case"keydown":case"keyup":q0(ue,l,re)}var Ue;if(Zf)e:{switch(t){case"compositionstart":var Xe="onCompositionStart";break e;case"compositionend":Xe="onCompositionEnd";break e;case"compositionupdate":Xe="onCompositionUpdate";break e}Xe=void 0}else Cl?T0(t,l)&&(Xe="onCompositionEnd"):t==="keydown"&&l.keyCode===229&&(Xe="onCompositionStart");Xe&&(k0&&l.locale!=="ko"&&(Cl||Xe!=="onCompositionStart"?Xe==="onCompositionEnd"&&Cl&&(Ue=x0()):(ii=re,Xf="value"in ii?ii.value:ii.textContent,Cl=!0)),Se=ks(K,Xe),0<Se.length&&(Xe=new S0(Xe,t,null,l,re),ue.push({event:Xe,listeners:Se}),Ue?Xe.data=Ue:(Ue=z0(l),Ue!==null&&(Xe.data=Ue)))),(Ue=wR?SR(t,l):ER(t,l))&&(Xe=ks(K,"onBeforeInput"),0<Xe.length&&(Se=new S0("onBeforeInput","beforeinput",null,l,re),ue.push({event:Se,listeners:Xe}),Se.data=Ue)),m5(ue,t,K,l,re)}hb(ue,n)})}function ku(t,n,l){return{instance:t,listener:n,currentTarget:l}}function ks(t,n){for(var l=n+"Capture",o=[];t!==null;){var m=t,p=m.stateNode;if(m=m.tag,m!==5&&m!==26&&m!==27||p===null||(m=Ga(t,l),m!=null&&o.unshift(ku(t,m,p)),m=Ga(t,n),m!=null&&o.push(ku(t,m,p))),t.tag===3)return o;t=t.return}return[]}function v5(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function mb(t,n,l,o,m){for(var p=n._reactName,b=[];l!==null&&l!==o;){var S=l,j=S.alternate,K=S.stateNode;if(S=S.tag,j!==null&&j===o)break;S!==5&&S!==26&&S!==27||K===null||(j=K,m?(K=Ga(l,p),K!=null&&b.unshift(ku(l,K,j))):m||(K=Ga(l,p),K!=null&&b.push(ku(l,K,j)))),l=l.return}b.length!==0&&t.push({event:n,listeners:b})}var x5=/\r\n?/g,b5=/\u0000|\uFFFD/g;function pb(t){return(typeof t=="string"?t:""+t).replace(x5,`
`).replace(b5,"")}function gb(t,n){return n=pb(n),pb(t)===n}function at(t,n,l,o,m,p){switch(l){case"children":typeof o=="string"?n==="body"||n==="textarea"&&o===""||El(t,o):(typeof o=="number"||typeof o=="bigint")&&n!=="body"&&El(t,""+o);break;case"className":Kn(t,"class",o);break;case"tabIndex":Kn(t,"tabindex",o);break;case"dir":case"role":case"viewBox":case"width":case"height":Kn(t,l,o);break;case"style":g0(t,o,p);break;case"data":if(n!=="object"){Kn(t,"data",o);break}case"src":case"href":if(o===""&&(n!=="a"||l!=="href")){t.removeAttribute(l);break}if(o==null||typeof o=="function"||typeof o=="symbol"||typeof o=="boolean"){t.removeAttribute(l);break}o=Mo(""+o),t.setAttribute(l,o);break;case"action":case"formAction":if(typeof o=="function"){t.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(l==="formAction"?(n!=="input"&&at(t,n,"name",m.name,m,null),at(t,n,"formEncType",m.formEncType,m,null),at(t,n,"formMethod",m.formMethod,m,null),at(t,n,"formTarget",m.formTarget,m,null)):(at(t,n,"encType",m.encType,m,null),at(t,n,"method",m.method,m,null),at(t,n,"target",m.target,m,null)));if(o==null||typeof o=="symbol"||typeof o=="boolean"){t.removeAttribute(l);break}o=Mo(""+o),t.setAttribute(l,o);break;case"onClick":o!=null&&(t.onclick=_r);break;case"onScroll":o!=null&&Ve("scroll",t);break;case"onScrollEnd":o!=null&&Ve("scrollend",t);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(a(61));if(l=o.__html,l!=null){if(m.children!=null)throw Error(a(60));t.innerHTML=l}}break;case"multiple":t.multiple=o&&typeof o!="function"&&typeof o!="symbol";break;case"muted":t.muted=o&&typeof o!="function"&&typeof o!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(o==null||typeof o=="function"||typeof o=="boolean"||typeof o=="symbol"){t.removeAttribute("xlink:href");break}l=Mo(""+o),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":o!=null&&typeof o!="function"&&typeof o!="symbol"?t.setAttribute(l,""+o):t.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":o&&typeof o!="function"&&typeof o!="symbol"?t.setAttribute(l,""):t.removeAttribute(l);break;case"capture":case"download":o===!0?t.setAttribute(l,""):o!==!1&&o!=null&&typeof o!="function"&&typeof o!="symbol"?t.setAttribute(l,o):t.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":o!=null&&typeof o!="function"&&typeof o!="symbol"&&!isNaN(o)&&1<=o?t.setAttribute(l,o):t.removeAttribute(l);break;case"rowSpan":case"start":o==null||typeof o=="function"||typeof o=="symbol"||isNaN(o)?t.removeAttribute(l):t.setAttribute(l,o);break;case"popover":Ve("beforetoggle",t),Ve("toggle",t),Et(t,"popover",o);break;case"xlinkActuate":Lt(t,"http://www.w3.org/1999/xlink","xlink:actuate",o);break;case"xlinkArcrole":Lt(t,"http://www.w3.org/1999/xlink","xlink:arcrole",o);break;case"xlinkRole":Lt(t,"http://www.w3.org/1999/xlink","xlink:role",o);break;case"xlinkShow":Lt(t,"http://www.w3.org/1999/xlink","xlink:show",o);break;case"xlinkTitle":Lt(t,"http://www.w3.org/1999/xlink","xlink:title",o);break;case"xlinkType":Lt(t,"http://www.w3.org/1999/xlink","xlink:type",o);break;case"xmlBase":Lt(t,"http://www.w3.org/XML/1998/namespace","xml:base",o);break;case"xmlLang":Lt(t,"http://www.w3.org/XML/1998/namespace","xml:lang",o);break;case"xmlSpace":Lt(t,"http://www.w3.org/XML/1998/namespace","xml:space",o);break;case"is":Et(t,"is",o);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=IM.get(l)||l,Et(t,l,o))}}function _d(t,n,l,o,m,p){switch(l){case"style":g0(t,o,p);break;case"dangerouslySetInnerHTML":if(o!=null){if(typeof o!="object"||!("__html"in o))throw Error(a(61));if(l=o.__html,l!=null){if(m.children!=null)throw Error(a(60));t.innerHTML=l}}break;case"children":typeof o=="string"?El(t,o):(typeof o=="number"||typeof o=="bigint")&&El(t,""+o);break;case"onScroll":o!=null&&Ve("scroll",t);break;case"onScrollEnd":o!=null&&Ve("scrollend",t);break;case"onClick":o!=null&&(t.onclick=_r);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!yn.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(m=l.endsWith("Capture"),n=l.slice(2,m?l.length-7:void 0),p=t[ge]||null,p=p!=null?p[l]:null,typeof p=="function"&&t.removeEventListener(n,p,m),typeof o=="function")){typeof p!="function"&&p!==null&&(l in t?t[l]=null:t.hasAttribute(l)&&t.removeAttribute(l)),t.addEventListener(n,o,m);break e}l in t?t[l]=o:o===!0?t.setAttribute(l,""):Et(t,l,o)}}}function qt(t,n,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ve("error",t),Ve("load",t);var o=!1,m=!1,p;for(p in l)if(l.hasOwnProperty(p)){var b=l[p];if(b!=null)switch(p){case"src":o=!0;break;case"srcSet":m=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:at(t,n,p,b,l,null)}}m&&at(t,n,"srcSet",l.srcSet,l,null),o&&at(t,n,"src",l.src,l,null);return;case"input":Ve("invalid",t);var S=p=b=m=null,j=null,K=null;for(o in l)if(l.hasOwnProperty(o)){var re=l[o];if(re!=null)switch(o){case"name":m=re;break;case"type":b=re;break;case"checked":j=re;break;case"defaultChecked":K=re;break;case"value":p=re;break;case"defaultValue":S=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(a(137,n));break;default:at(t,n,o,re,l,null)}}h0(t,p,S,j,K,b,m,!1);return;case"select":Ve("invalid",t),o=b=p=null;for(m in l)if(l.hasOwnProperty(m)&&(S=l[m],S!=null))switch(m){case"value":p=S;break;case"defaultValue":b=S;break;case"multiple":o=S;default:at(t,n,m,S,l,null)}n=p,l=b,t.multiple=!!o,n!=null?Sl(t,!!o,n,!1):l!=null&&Sl(t,!!o,l,!0);return;case"textarea":Ve("invalid",t),p=m=o=null;for(b in l)if(l.hasOwnProperty(b)&&(S=l[b],S!=null))switch(b){case"value":o=S;break;case"defaultValue":m=S;break;case"children":p=S;break;case"dangerouslySetInnerHTML":if(S!=null)throw Error(a(91));break;default:at(t,n,b,S,l,null)}m0(t,o,m,p);return;case"option":for(j in l)if(l.hasOwnProperty(j)&&(o=l[j],o!=null))switch(j){case"selected":t.selected=o&&typeof o!="function"&&typeof o!="symbol";break;default:at(t,n,j,o,l,null)}return;case"dialog":Ve("beforetoggle",t),Ve("toggle",t),Ve("cancel",t),Ve("close",t);break;case"iframe":case"object":Ve("load",t);break;case"video":case"audio":for(o=0;o<Eu.length;o++)Ve(Eu[o],t);break;case"image":Ve("error",t),Ve("load",t);break;case"details":Ve("toggle",t);break;case"embed":case"source":case"link":Ve("error",t),Ve("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in l)if(l.hasOwnProperty(K)&&(o=l[K],o!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(a(137,n));default:at(t,n,K,o,l,null)}return;default:if(Hf(n)){for(re in l)l.hasOwnProperty(re)&&(o=l[re],o!==void 0&&_d(t,n,re,o,l,void 0));return}}for(S in l)l.hasOwnProperty(S)&&(o=l[S],o!=null&&at(t,n,S,o,l,null))}function w5(t,n,l,o){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var m=null,p=null,b=null,S=null,j=null,K=null,re=null;for(W in l){var ue=l[W];if(l.hasOwnProperty(W)&&ue!=null)switch(W){case"checked":break;case"value":break;case"defaultValue":j=ue;default:o.hasOwnProperty(W)||at(t,n,W,null,o,ue)}}for(var P in o){var W=o[P];if(ue=l[P],o.hasOwnProperty(P)&&(W!=null||ue!=null))switch(P){case"type":p=W;break;case"name":m=W;break;case"checked":K=W;break;case"defaultChecked":re=W;break;case"value":b=W;break;case"defaultValue":S=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(a(137,n));break;default:W!==ue&&at(t,n,P,W,o,ue)}}Uf(t,b,S,j,K,re,p,m);return;case"select":W=b=S=P=null;for(p in l)if(j=l[p],l.hasOwnProperty(p)&&j!=null)switch(p){case"value":break;case"multiple":W=j;default:o.hasOwnProperty(p)||at(t,n,p,null,o,j)}for(m in o)if(p=o[m],j=l[m],o.hasOwnProperty(m)&&(p!=null||j!=null))switch(m){case"value":P=p;break;case"defaultValue":S=p;break;case"multiple":b=p;default:p!==j&&at(t,n,m,p,o,j)}n=S,l=b,o=W,P!=null?Sl(t,!!l,P,!1):!!o!=!!l&&(n!=null?Sl(t,!!l,n,!0):Sl(t,!!l,l?[]:"",!1));return;case"textarea":W=P=null;for(S in l)if(m=l[S],l.hasOwnProperty(S)&&m!=null&&!o.hasOwnProperty(S))switch(S){case"value":break;case"children":break;default:at(t,n,S,null,o,m)}for(b in o)if(m=o[b],p=l[b],o.hasOwnProperty(b)&&(m!=null||p!=null))switch(b){case"value":P=m;break;case"defaultValue":W=m;break;case"children":break;case"dangerouslySetInnerHTML":if(m!=null)throw Error(a(91));break;default:m!==p&&at(t,n,b,m,o,p)}d0(t,P,W);return;case"option":for(var xe in l)if(P=l[xe],l.hasOwnProperty(xe)&&P!=null&&!o.hasOwnProperty(xe))switch(xe){case"selected":t.selected=!1;break;default:at(t,n,xe,null,o,P)}for(j in o)if(P=o[j],W=l[j],o.hasOwnProperty(j)&&P!==W&&(P!=null||W!=null))switch(j){case"selected":t.selected=P&&typeof P!="function"&&typeof P!="symbol";break;default:at(t,n,j,P,o,W)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ae in l)P=l[Ae],l.hasOwnProperty(Ae)&&P!=null&&!o.hasOwnProperty(Ae)&&at(t,n,Ae,null,o,P);for(K in o)if(P=o[K],W=l[K],o.hasOwnProperty(K)&&P!==W&&(P!=null||W!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(P!=null)throw Error(a(137,n));break;default:at(t,n,K,P,o,W)}return;default:if(Hf(n)){for(var ut in l)P=l[ut],l.hasOwnProperty(ut)&&P!==void 0&&!o.hasOwnProperty(ut)&&_d(t,n,ut,void 0,o,P);for(re in o)P=o[re],W=l[re],!o.hasOwnProperty(re)||P===W||P===void 0&&W===void 0||_d(t,n,re,P,o,W);return}}for(var X in l)P=l[X],l.hasOwnProperty(X)&&P!=null&&!o.hasOwnProperty(X)&&at(t,n,X,null,o,P);for(ue in o)P=o[ue],W=l[ue],!o.hasOwnProperty(ue)||P===W||P==null&&W==null||at(t,n,ue,P,o,W)}function yb(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function S5(){if(typeof performance.getEntriesByType=="function"){for(var t=0,n=0,l=performance.getEntriesByType("resource"),o=0;o<l.length;o++){var m=l[o],p=m.transferSize,b=m.initiatorType,S=m.duration;if(p&&S&&yb(b)){for(b=0,S=m.responseEnd,o+=1;o<l.length;o++){var j=l[o],K=j.startTime;if(K>S)break;var re=j.transferSize,ue=j.initiatorType;re&&yb(ue)&&(j=j.responseEnd,b+=re*(j<S?1:(S-K)/(j-K)))}if(--o,n+=8*(p+b)/(m.duration/1e3),t++,10<t)break}}if(0<t)return n/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Cd=null,Td=null;function _s(t){return t.nodeType===9?t:t.ownerDocument}function vb(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function xb(t,n){if(t===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&n==="foreignObject"?0:t}function zd(t,n){return t==="textarea"||t==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Ad=null;function E5(){var t=window.event;return t&&t.type==="popstate"?t===Ad?!1:(Ad=t,!0):(Ad=null,!1)}var bb=typeof setTimeout=="function"?setTimeout:void 0,k5=typeof clearTimeout=="function"?clearTimeout:void 0,wb=typeof Promise=="function"?Promise:void 0,_5=typeof queueMicrotask=="function"?queueMicrotask:typeof wb<"u"?function(t){return wb.resolve(null).then(t).catch(C5)}:bb;function C5(t){setTimeout(function(){throw t})}function wi(t){return t==="head"}function Sb(t,n){var l=n,o=0;do{var m=l.nextSibling;if(t.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"||l==="/&"){if(o===0){t.removeChild(m),ea(n);return}o--}else if(l==="$"||l==="$?"||l==="$~"||l==="$!"||l==="&")o++;else if(l==="html")_u(t.ownerDocument.documentElement);else if(l==="head"){l=t.ownerDocument.head,_u(l);for(var p=l.firstChild;p;){var b=p.nextSibling,S=p.nodeName;p[gt]||S==="SCRIPT"||S==="STYLE"||S==="LINK"&&p.rel.toLowerCase()==="stylesheet"||l.removeChild(p),p=b}}else l==="body"&&_u(t.ownerDocument.body);l=m}while(l);ea(n)}function Eb(t,n){var l=t;t=0;do{var o=l.nextSibling;if(l.nodeType===1?n?(l._stashedDisplay=l.style.display,l.style.display="none"):(l.style.display=l._stashedDisplay||"",l.getAttribute("style")===""&&l.removeAttribute("style")):l.nodeType===3&&(n?(l._stashedText=l.nodeValue,l.nodeValue=""):l.nodeValue=l._stashedText||""),o&&o.nodeType===8)if(l=o.data,l==="/$"){if(t===0)break;t--}else l!=="$"&&l!=="$?"&&l!=="$~"&&l!=="$!"||t++;l=o}while(l)}function Md(t){var n=t.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var l=n;switch(n=n.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":Md(l),vt(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}t.removeChild(l)}}function T5(t,n,l,o){for(;t.nodeType===1;){var m=l;if(t.nodeName.toLowerCase()!==n.toLowerCase()){if(!o&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(o){if(!t[gt])switch(n){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(p=t.getAttribute("rel"),p==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(p!==m.rel||t.getAttribute("href")!==(m.href==null||m.href===""?null:m.href)||t.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin)||t.getAttribute("title")!==(m.title==null?null:m.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(p=t.getAttribute("src"),(p!==(m.src==null?null:m.src)||t.getAttribute("type")!==(m.type==null?null:m.type)||t.getAttribute("crossorigin")!==(m.crossOrigin==null?null:m.crossOrigin))&&p&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(n==="input"&&t.type==="hidden"){var p=m.name==null?null:""+m.name;if(m.type==="hidden"&&t.getAttribute("name")===p)return t}else return t;if(t=Bn(t.nextSibling),t===null)break}return null}function z5(t,n,l){if(n==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!l||(t=Bn(t.nextSibling),t===null))return null;return t}function kb(t,n){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=Bn(t.nextSibling),t===null))return null;return t}function Rd(t){return t.data==="$?"||t.data==="$~"}function Nd(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function A5(t,n){var l=t.ownerDocument;if(t.data==="$~")t._reactRetry=n;else if(t.data!=="$?"||l.readyState!=="loading")n();else{var o=function(){n(),l.removeEventListener("DOMContentLoaded",o)};l.addEventListener("DOMContentLoaded",o),t._reactRetry=o}}function Bn(t){for(;t!=null;t=t.nextSibling){var n=t.nodeType;if(n===1||n===3)break;if(n===8){if(n=t.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return t}var Dd=null;function _b(t){t=t.nextSibling;for(var n=0;t;){if(t.nodeType===8){var l=t.data;if(l==="/$"||l==="/&"){if(n===0)return Bn(t.nextSibling);n--}else l!=="$"&&l!=="$!"&&l!=="$?"&&l!=="$~"&&l!=="&"||n++}t=t.nextSibling}return null}function Cb(t){t=t.previousSibling;for(var n=0;t;){if(t.nodeType===8){var l=t.data;if(l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"){if(n===0)return t;n--}else l!=="/$"&&l!=="/&"||n++}t=t.previousSibling}return null}function Tb(t,n,l){switch(n=_s(l),t){case"html":if(t=n.documentElement,!t)throw Error(a(452));return t;case"head":if(t=n.head,!t)throw Error(a(453));return t;case"body":if(t=n.body,!t)throw Error(a(454));return t;default:throw Error(a(451))}}function _u(t){for(var n=t.attributes;n.length;)t.removeAttributeNode(n[0]);vt(t)}var Hn=new Map,zb=new Set;function Cs(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Yr=Q.d;Q.d={f:M5,r:R5,D:N5,C:D5,L:O5,m:j5,X:U5,S:L5,M:B5};function M5(){var t=Yr.f(),n=ys();return t||n}function R5(t){var n=Ge(t);n!==null&&n.tag===5&&n.type==="form"?Gv(n):Yr.r(t)}var Pl=typeof document>"u"?null:document;function Ab(t,n,l){var o=Pl;if(o&&typeof n=="string"&&n){var m=Rn(n);m='link[rel="'+t+'"][href="'+m+'"]',typeof l=="string"&&(m+='[crossorigin="'+l+'"]'),zb.has(m)||(zb.add(m),t={rel:t,crossOrigin:l,href:n},o.querySelector(m)===null&&(n=o.createElement("link"),qt(n,"link",t),dt(n),o.head.appendChild(n)))}}function N5(t){Yr.D(t),Ab("dns-prefetch",t,null)}function D5(t,n){Yr.C(t,n),Ab("preconnect",t,n)}function O5(t,n,l){Yr.L(t,n,l);var o=Pl;if(o&&t&&n){var m='link[rel="preload"][as="'+Rn(n)+'"]';n==="image"&&l&&l.imageSrcSet?(m+='[imagesrcset="'+Rn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(m+='[imagesizes="'+Rn(l.imageSizes)+'"]')):m+='[href="'+Rn(t)+'"]';var p=m;switch(n){case"style":p=Jl(t);break;case"script":p=Wl(t)}Hn.has(p)||(t=y({rel:"preload",href:n==="image"&&l&&l.imageSrcSet?void 0:t,as:n},l),Hn.set(p,t),o.querySelector(m)!==null||n==="style"&&o.querySelector(Cu(p))||n==="script"&&o.querySelector(Tu(p))||(n=o.createElement("link"),qt(n,"link",t),dt(n),o.head.appendChild(n)))}}function j5(t,n){Yr.m(t,n);var l=Pl;if(l&&t){var o=n&&typeof n.as=="string"?n.as:"script",m='link[rel="modulepreload"][as="'+Rn(o)+'"][href="'+Rn(t)+'"]',p=m;switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=Wl(t)}if(!Hn.has(p)&&(t=y({rel:"modulepreload",href:t},n),Hn.set(p,t),l.querySelector(m)===null)){switch(o){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Tu(p)))return}o=l.createElement("link"),qt(o,"link",t),dt(o),l.head.appendChild(o)}}}function L5(t,n,l){Yr.S(t,n,l);var o=Pl;if(o&&t){var m=nn(o).hoistableStyles,p=Jl(t);n=n||"default";var b=m.get(p);if(!b){var S={loading:0,preload:null};if(b=o.querySelector(Cu(p)))S.loading=5;else{t=y({rel:"stylesheet",href:t,"data-precedence":n},l),(l=Hn.get(p))&&Od(t,l);var j=b=o.createElement("link");dt(j),qt(j,"link",t),j._p=new Promise(function(K,re){j.onload=K,j.onerror=re}),j.addEventListener("load",function(){S.loading|=1}),j.addEventListener("error",function(){S.loading|=2}),S.loading|=4,Ts(b,n,o)}b={type:"stylesheet",instance:b,count:1,state:S},m.set(p,b)}}}function U5(t,n){Yr.X(t,n);var l=Pl;if(l&&t){var o=nn(l).hoistableScripts,m=Wl(t),p=o.get(m);p||(p=l.querySelector(Tu(m)),p||(t=y({src:t,async:!0},n),(n=Hn.get(m))&&jd(t,n),p=l.createElement("script"),dt(p),qt(p,"link",t),l.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},o.set(m,p))}}function B5(t,n){Yr.M(t,n);var l=Pl;if(l&&t){var o=nn(l).hoistableScripts,m=Wl(t),p=o.get(m);p||(p=l.querySelector(Tu(m)),p||(t=y({src:t,async:!0,type:"module"},n),(n=Hn.get(m))&&jd(t,n),p=l.createElement("script"),dt(p),qt(p,"link",t),l.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},o.set(m,p))}}function Mb(t,n,l,o){var m=(m=ye.current)?Cs(m):null;if(!m)throw Error(a(446));switch(t){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(n=Jl(l.href),l=nn(m).hoistableStyles,o=l.get(n),o||(o={type:"style",instance:null,count:0,state:null},l.set(n,o)),o):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){t=Jl(l.href);var p=nn(m).hoistableStyles,b=p.get(t);if(b||(m=m.ownerDocument||m,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(t,b),(p=m.querySelector(Cu(t)))&&!p._p&&(b.instance=p,b.state.loading=5),Hn.has(t)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Hn.set(t,l),p||H5(m,t,l,b.state))),n&&o===null)throw Error(a(528,""));return b}if(n&&o!==null)throw Error(a(529,""));return null;case"script":return n=l.async,l=l.src,typeof l=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=Wl(l),l=nn(m).hoistableScripts,o=l.get(n),o||(o={type:"script",instance:null,count:0,state:null},l.set(n,o)),o):{type:"void",instance:null,count:0,state:null};default:throw Error(a(444,t))}}function Jl(t){return'href="'+Rn(t)+'"'}function Cu(t){return'link[rel="stylesheet"]['+t+"]"}function Rb(t){return y({},t,{"data-precedence":t.precedence,precedence:null})}function H5(t,n,l,o){t.querySelector('link[rel="preload"][as="style"]['+n+"]")?o.loading=1:(n=t.createElement("link"),o.preload=n,n.addEventListener("load",function(){return o.loading|=1}),n.addEventListener("error",function(){return o.loading|=2}),qt(n,"link",l),dt(n),t.head.appendChild(n))}function Wl(t){return'[src="'+Rn(t)+'"]'}function Tu(t){return"script[async]"+t}function Nb(t,n,l){if(n.count++,n.instance===null)switch(n.type){case"style":var o=t.querySelector('style[data-href~="'+Rn(l.href)+'"]');if(o)return n.instance=o,dt(o),o;var m=y({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return o=(t.ownerDocument||t).createElement("style"),dt(o),qt(o,"style",m),Ts(o,l.precedence,t),n.instance=o;case"stylesheet":m=Jl(l.href);var p=t.querySelector(Cu(m));if(p)return n.state.loading|=4,n.instance=p,dt(p),p;o=Rb(l),(m=Hn.get(m))&&Od(o,m),p=(t.ownerDocument||t).createElement("link"),dt(p);var b=p;return b._p=new Promise(function(S,j){b.onload=S,b.onerror=j}),qt(p,"link",o),n.state.loading|=4,Ts(p,l.precedence,t),n.instance=p;case"script":return p=Wl(l.src),(m=t.querySelector(Tu(p)))?(n.instance=m,dt(m),m):(o=l,(m=Hn.get(p))&&(o=y({},l),jd(o,m)),t=t.ownerDocument||t,m=t.createElement("script"),dt(m),qt(m,"link",o),t.head.appendChild(m),n.instance=m);case"void":return null;default:throw Error(a(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(o=n.instance,n.state.loading|=4,Ts(o,l.precedence,t));return n.instance}function Ts(t,n,l){for(var o=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),m=o.length?o[o.length-1]:null,p=m,b=0;b<o.length;b++){var S=o[b];if(S.dataset.precedence===n)p=S;else if(p!==m)break}p?p.parentNode.insertBefore(t,p.nextSibling):(n=l.nodeType===9?l.head:l,n.insertBefore(t,n.firstChild))}function Od(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.title==null&&(t.title=n.title)}function jd(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.integrity==null&&(t.integrity=n.integrity)}var zs=null;function Db(t,n,l){if(zs===null){var o=new Map,m=zs=new Map;m.set(l,o)}else m=zs,o=m.get(l),o||(o=new Map,m.set(l,o));if(o.has(t))return o;for(o.set(t,null),l=l.getElementsByTagName(t),m=0;m<l.length;m++){var p=l[m];if(!(p[gt]||p[me]||t==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var b=p.getAttribute(n)||"";b=t+b;var S=o.get(b);S?S.push(p):o.set(b,[p])}}return o}function Ob(t,n,l){t=t.ownerDocument||t,t.head.insertBefore(l,n==="title"?t.querySelector("head > title"):null)}function q5(t,n,l){if(l===1||n.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;switch(n.rel){case"stylesheet":return t=n.disabled,typeof n.precedence=="string"&&t==null;default:return!0}case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function jb(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function Y5(t,n,l,o){if(l.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var m=Jl(o.href),p=n.querySelector(Cu(m));if(p){n=p._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(t.count++,t=As.bind(t),n.then(t,t)),l.state.loading|=4,l.instance=p,dt(p);return}p=n.ownerDocument||n,o=Rb(o),(m=Hn.get(m))&&Od(o,m),p=p.createElement("link"),dt(p);var b=p;b._p=new Promise(function(S,j){b.onload=S,b.onerror=j}),qt(p,"link",o),l.instance=p}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(l,n),(n=l.state.preload)&&(l.state.loading&3)===0&&(t.count++,l=As.bind(t),n.addEventListener("load",l),n.addEventListener("error",l))}}var Ld=0;function V5(t,n){return t.stylesheets&&t.count===0&&Rs(t,t.stylesheets),0<t.count||0<t.imgCount?function(l){var o=setTimeout(function(){if(t.stylesheets&&Rs(t,t.stylesheets),t.unsuspend){var p=t.unsuspend;t.unsuspend=null,p()}},6e4+n);0<t.imgBytes&&Ld===0&&(Ld=62500*S5());var m=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Rs(t,t.stylesheets),t.unsuspend)){var p=t.unsuspend;t.unsuspend=null,p()}},(t.imgBytes>Ld?50:800)+n);return t.unsuspend=l,function(){t.unsuspend=null,clearTimeout(o),clearTimeout(m)}}:null}function As(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rs(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Ms=null;function Rs(t,n){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Ms=new Map,n.forEach(F5,t),Ms=null,As.call(t))}function F5(t,n){if(!(n.state.loading&4)){var l=Ms.get(t);if(l)var o=l.get(null);else{l=new Map,Ms.set(t,l);for(var m=t.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<m.length;p++){var b=m[p];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(l.set(b.dataset.precedence,b),o=b)}o&&l.set(null,o)}m=n.instance,b=m.getAttribute("data-precedence"),p=l.get(b)||o,p===o&&l.set(null,m),l.set(b,m),this.count++,o=As.bind(this),m.addEventListener("load",o),m.addEventListener("error",o),p?p.parentNode.insertBefore(m,p.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(m,t.firstChild)),n.state.loading|=4}}var zu={$$typeof:L,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function X5(t,n,l,o,m,p,b,S,j){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ni(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ni(0),this.hiddenUpdates=ni(null),this.identifierPrefix=o,this.onUncaughtError=m,this.onCaughtError=p,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=j,this.incompleteTransitions=new Map}function Lb(t,n,l,o,m,p,b,S,j,K,re,ue){return t=new X5(t,n,l,b,j,K,re,ue,S),n=1,p===!0&&(n|=24),p=xn(3,null,null,n),t.current=p,p.stateNode=t,n=ph(),n.refCount++,t.pooledCache=n,n.refCount++,p.memoizedState={element:o,isDehydrated:l,cache:n},xh(p),t}function Ub(t){return t?(t=Ml,t):Ml}function Bb(t,n,l,o,m,p){m=Ub(m),o.context===null?o.context=m:o.pendingContext=m,o=ci(n),o.payload={element:l},p=p===void 0?null:p,p!==null&&(o.callback=p),l=fi(t,o,n),l!==null&&(sn(l,t,n),au(l,t,n))}function Hb(t,n){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var l=t.retryLane;t.retryLane=l!==0&&l<n?l:n}}function Ud(t,n){Hb(t,n),(t=t.alternate)&&Hb(t,n)}function qb(t){if(t.tag===13||t.tag===31){var n=$i(t,67108864);n!==null&&sn(n,t,67108864),Ud(t,67108864)}}function Yb(t){if(t.tag===13||t.tag===31){var n=kn();n=J(n);var l=$i(t,n);l!==null&&sn(l,t,n),Ud(t,n)}}var Ns=!0;function G5(t,n,l,o){var m=A.T;A.T=null;var p=Q.p;try{Q.p=2,Bd(t,n,l,o)}finally{Q.p=p,A.T=m}}function Q5(t,n,l,o){var m=A.T;A.T=null;var p=Q.p;try{Q.p=8,Bd(t,n,l,o)}finally{Q.p=p,A.T=m}}function Bd(t,n,l,o){if(Ns){var m=Hd(o);if(m===null)kd(t,n,o,Ds,l),Fb(t,o);else if(I5(m,t,n,l,o))o.stopPropagation();else if(Fb(t,o),n&4&&-1<$5.indexOf(t)){for(;m!==null;){var p=Ge(m);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var b=Er(p.pendingLanes);if(b!==0){var S=p;for(S.pendingLanes|=2,S.entangledLanes|=2;b;){var j=1<<31-tt(b);S.entanglements[1]|=j,b&=~j}cr(p),(et&6)===0&&(ps=pt()+500,Su(0))}}break;case 31:case 13:S=$i(p,2),S!==null&&sn(S,p,2),ys(),Ud(p,2)}if(p=Hd(o),p===null&&kd(t,n,o,Ds,l),p===m)break;m=p}m!==null&&o.stopPropagation()}else kd(t,n,o,null,l)}}function Hd(t){return t=Yf(t),qd(t)}var Ds=null;function qd(t){if(Ds=null,t=xt(t),t!==null){var n=s(t);if(n===null)t=null;else{var l=n.tag;if(l===13){if(t=c(n),t!==null)return t;t=null}else if(l===31){if(t=f(n),t!==null)return t;t=null}else if(l===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;t=null}else n!==t&&(t=null)}}return Ds=t,null}function Vb(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(wr()){case ie:return 2;case he:return 8;case ke:case Me:return 32;case Pe:return 268435456;default:return 32}default:return 32}}var Yd=!1,Si=null,Ei=null,ki=null,Au=new Map,Mu=new Map,_i=[],$5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Fb(t,n){switch(t){case"focusin":case"focusout":Si=null;break;case"dragenter":case"dragleave":Ei=null;break;case"mouseover":case"mouseout":ki=null;break;case"pointerover":case"pointerout":Au.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mu.delete(n.pointerId)}}function Ru(t,n,l,o,m,p){return t===null||t.nativeEvent!==p?(t={blockedOn:n,domEventName:l,eventSystemFlags:o,nativeEvent:p,targetContainers:[m]},n!==null&&(n=Ge(n),n!==null&&qb(n)),t):(t.eventSystemFlags|=o,n=t.targetContainers,m!==null&&n.indexOf(m)===-1&&n.push(m),t)}function I5(t,n,l,o,m){switch(n){case"focusin":return Si=Ru(Si,t,n,l,o,m),!0;case"dragenter":return Ei=Ru(Ei,t,n,l,o,m),!0;case"mouseover":return ki=Ru(ki,t,n,l,o,m),!0;case"pointerover":var p=m.pointerId;return Au.set(p,Ru(Au.get(p)||null,t,n,l,o,m)),!0;case"gotpointercapture":return p=m.pointerId,Mu.set(p,Ru(Mu.get(p)||null,t,n,l,o,m)),!0}return!1}function Xb(t){var n=xt(t.target);if(n!==null){var l=s(n);if(l!==null){if(n=l.tag,n===13){if(n=c(l),n!==null){t.blockedOn=n,Ee(t.priority,function(){Yb(l)});return}}else if(n===31){if(n=f(l),n!==null){t.blockedOn=n,Ee(t.priority,function(){Yb(l)});return}}else if(n===3&&l.stateNode.current.memoizedState.isDehydrated){t.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Os(t){if(t.blockedOn!==null)return!1;for(var n=t.targetContainers;0<n.length;){var l=Hd(t.nativeEvent);if(l===null){l=t.nativeEvent;var o=new l.constructor(l.type,l);qf=o,l.target.dispatchEvent(o),qf=null}else return n=Ge(l),n!==null&&qb(n),t.blockedOn=l,!1;n.shift()}return!0}function Gb(t,n,l){Os(t)&&l.delete(n)}function Z5(){Yd=!1,Si!==null&&Os(Si)&&(Si=null),Ei!==null&&Os(Ei)&&(Ei=null),ki!==null&&Os(ki)&&(ki=null),Au.forEach(Gb),Mu.forEach(Gb)}function js(t,n){t.blockedOn===n&&(t.blockedOn=null,Yd||(Yd=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Z5)))}var Ls=null;function Qb(t){Ls!==t&&(Ls=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Ls===t&&(Ls=null);for(var n=0;n<t.length;n+=3){var l=t[n],o=t[n+1],m=t[n+2];if(typeof o!="function"){if(qd(o||l)===null)continue;break}var p=Ge(l);p!==null&&(t.splice(n,3),n-=3,Hh(p,{pending:!0,data:m,method:l.method,action:o},o,m))}}))}function ea(t){function n(j){return js(j,t)}Si!==null&&js(Si,t),Ei!==null&&js(Ei,t),ki!==null&&js(ki,t),Au.forEach(n),Mu.forEach(n);for(var l=0;l<_i.length;l++){var o=_i[l];o.blockedOn===t&&(o.blockedOn=null)}for(;0<_i.length&&(l=_i[0],l.blockedOn===null);)Xb(l),l.blockedOn===null&&_i.shift();if(l=(t.ownerDocument||t).$$reactFormReplay,l!=null)for(o=0;o<l.length;o+=3){var m=l[o],p=l[o+1],b=m[ge]||null;if(typeof p=="function")b||Qb(l);else if(b){var S=null;if(p&&p.hasAttribute("formAction")){if(m=p,b=p[ge]||null)S=b.formAction;else if(qd(m)!==null)continue}else S=b.action;typeof S=="function"?l[o+1]=S:(l.splice(o,3),o-=3),Qb(l)}}}function $b(){function t(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(b){return m=b})},focusReset:"manual",scroll:"manual"})}function n(){m!==null&&(m(),m=null),o||setTimeout(l,20)}function l(){if(!o&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var o=!1,m=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(l,100),function(){o=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),m!==null&&(m(),m=null)}}}function Vd(t){this._internalRoot=t}Us.prototype.render=Vd.prototype.render=function(t){var n=this._internalRoot;if(n===null)throw Error(a(409));var l=n.current,o=kn();Bb(l,o,t,n,null,null)},Us.prototype.unmount=Vd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var n=t.containerInfo;Bb(t.current,2,null,t,null,null),ys(),n[we]=null}};function Us(t){this._internalRoot=t}Us.prototype.unstable_scheduleHydration=function(t){if(t){var n=de();t={blockedOn:null,target:t,priority:n};for(var l=0;l<_i.length&&n!==0&&n<_i[l].priority;l++);_i.splice(l,0,t),l===0&&Xb(t)}};var Ib=r.version;if(Ib!=="19.2.4")throw Error(a(527,Ib,"19.2.4"));Q.findDOMNode=function(t){var n=t._reactInternals;if(n===void 0)throw typeof t.render=="function"?Error(a(188)):(t=Object.keys(t).join(","),Error(a(268,t)));return t=d(n),t=t!==null?g(t):null,t=t===null?null:t.stateNode,t};var K5={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:A,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Bs=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Bs.isDisabled&&Bs.supportsFiber)try{Ot=Bs.inject(K5),nt=Bs}catch{}}return na.createRoot=function(t,n){if(!u(t))throw Error(a(299));var l=!1,o="",m=tx,p=nx,b=rx;return n!=null&&(n.unstable_strictMode===!0&&(l=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onUncaughtError!==void 0&&(m=n.onUncaughtError),n.onCaughtError!==void 0&&(p=n.onCaughtError),n.onRecoverableError!==void 0&&(b=n.onRecoverableError)),n=Lb(t,1,!1,null,null,l,o,null,m,p,b,$b),t[we]=n.current,Ed(t),new Vd(n)},na.hydrateRoot=function(t,n,l){if(!u(t))throw Error(a(299));var o=!1,m="",p=tx,b=nx,S=rx,j=null;return l!=null&&(l.unstable_strictMode===!0&&(o=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(p=l.onUncaughtError),l.onCaughtError!==void 0&&(b=l.onCaughtError),l.onRecoverableError!==void 0&&(S=l.onRecoverableError),l.formState!==void 0&&(j=l.formState)),n=Lb(t,1,!0,n,l??null,o,m,j,p,b,S,$b),n.context=Ub(null),l=n.current,o=kn(),o=J(o),m=ci(o),m.callback=null,fi(l,m,o),l=o,n.current.lanes=l,ri(n,l),cr(n),t[we]=n.current,Ed(t),new Us(n)},na.version="19.2.4",na}var Wd;function i1(){if(Wd)return Vs.exports;Wd=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(r){console.error(r)}}return e(),Vs.exports=r1(),Vs.exports}var l1=i1();/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var em=e=>{throw TypeError(e)},a1=(e,r,i)=>r.has(e)||em("Cannot "+i),Qs=(e,r,i)=>(a1(e,r,"read from private field"),i?i.call(e):r.get(e)),u1=(e,r,i)=>r.has(e)?em("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,i),tm="popstate";function o1(e={}){function r(u,s){let{pathname:c="/",search:f="",hash:h=""}=hr(u.location.hash.substring(1));return!c.startsWith("/")&&!c.startsWith(".")&&(c="/"+c),ra("",{pathname:c,search:f,hash:h},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function i(u,s){let c=u.document.querySelector("base"),f="";if(c&&c.getAttribute("href")){let h=u.location.href,d=h.indexOf("#");f=d===-1?h:h.slice(0,d)}return f+"#"+(typeof s=="string"?s:er(s))}function a(u,s){St(u.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(s)})`)}return c1(r,i,a,e)}function Be(e,r){if(e===!1||e===null||typeof e>"u")throw new Error(r)}function St(e,r){if(!e){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function s1(){return Math.random().toString(36).substring(2,10)}function nm(e,r){return{usr:e.state,key:e.key,idx:r}}function ra(e,r,i=null,a){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof r=="string"?hr(r):r,state:i,key:r&&r.key||a||s1()}}function er({pathname:e="/",search:r="",hash:i=""}){return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function hr(e){let r={};if(e){let i=e.indexOf("#");i>=0&&(r.hash=e.substring(i),e=e.substring(0,i));let a=e.indexOf("?");a>=0&&(r.search=e.substring(a),e=e.substring(0,a)),e&&(r.pathname=e)}return r}function c1(e,r,i,a={}){let{window:u=document.defaultView,v5Compat:s=!1}=a,c=u.history,f="POP",h=null,d=g();d==null&&(d=0,c.replaceState({...c.state,idx:d},""));function g(){return(c.state||{idx:null}).idx}function y(){f="POP";let C=g(),E=C==null?null:C-d;d=C,h&&h({action:f,location:_.location,delta:E})}function x(C,E){f="PUSH";let M=ra(_.location,C,E);i&&i(M,C),d=g()+1;let L=nm(M,d),U=_.createHref(M);try{c.pushState(L,"",U)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;u.location.assign(U)}s&&h&&h({action:f,location:_.location,delta:1})}function v(C,E){f="REPLACE";let M=ra(_.location,C,E);i&&i(M,C),d=g();let L=nm(M,d),U=_.createHref(M);c.replaceState(L,"",U),s&&h&&h({action:f,location:_.location,delta:0})}function w(C){return rm(C)}let _={get action(){return f},get location(){return e(u,c)},listen(C){if(h)throw new Error("A history only accepts one active listener");return u.addEventListener(tm,y),h=C,()=>{u.removeEventListener(tm,y),h=null}},createHref(C){return r(u,C)},createURL:w,encodeLocation(C){let E=w(C);return{pathname:E.pathname,search:E.search,hash:E.hash}},push:x,replace:v,go(C){return c.go(C)}};return _}function rm(e,r=!1){let i="http://localhost";typeof window<"u"&&(i=window.location.origin!=="null"?window.location.origin:window.location.href),Be(i,"No window.location.(origin|href) available to create URL");let a=typeof e=="string"?e:er(e);return a=a.replace(/ $/,"%20"),!r&&a.startsWith("//")&&(a=i+a),new URL(a,i)}var ia,im=class{constructor(e){if(u1(this,ia,new Map),e)for(let[r,i]of e)this.set(r,i)}get(e){if(Qs(this,ia).has(e))return Qs(this,ia).get(e);if(e.defaultValue!==void 0)return e.defaultValue;throw new Error("No value found for context")}set(e,r){Qs(this,ia).set(e,r)}};ia=new WeakMap;var f1=new Set(["lazy","caseSensitive","path","id","index","children"]);function h1(e){return f1.has(e)}var d1=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function m1(e){return d1.has(e)}function p1(e){return e.index===!0}function la(e,r,i=[],a={},u=!1){return e.map((s,c)=>{let f=[...i,String(c)],h=typeof s.id=="string"?s.id:f.join("-");if(Be(s.index!==!0||!s.children,"Cannot specify children on an index route"),Be(u||!a[h],`Found a route id collision on id "${h}".  Route id's must be globally unique within Data Router usages`),p1(s)){let d={...s,id:h};return a[h]=lm(d,r(d)),d}else{let d={...s,id:h,children:void 0};return a[h]=lm(d,r(d)),s.children&&(d.children=la(s.children,r,f,a,u)),d}})}function lm(e,r){return Object.assign(e,{...r,...typeof r.lazy=="object"&&r.lazy!=null?{lazy:{...e.lazy,...r.lazy}}:{}})}function Xr(e,r,i="/"){return aa(e,r,i,!1)}function aa(e,r,i,a){let u=typeof r=="string"?hr(r):r,s=_n(u.pathname||"/",i);if(s==null)return null;let c=am(e);y1(c);let f=null;for(let h=0;f==null&&h<c.length;++h){let d=z1(s);f=C1(c[h],d,a)}return f}function g1(e,r){let{route:i,pathname:a,params:u}=e;return{id:i.id,pathname:a,params:u,data:r[i.id],loaderData:r[i.id],handle:i.handle}}function am(e,r=[],i=[],a="",u=!1){let s=(c,f,h=u,d)=>{let g={relativePath:d===void 0?c.path||"":d,caseSensitive:c.caseSensitive===!0,childrenIndex:f,route:c};if(g.relativePath.startsWith("/")){if(!g.relativePath.startsWith(a)&&h)return;Be(g.relativePath.startsWith(a),`Absolute route path "${g.relativePath}" nested under path "${a}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),g.relativePath=g.relativePath.slice(a.length)}let y=tr([a,g.relativePath]),x=i.concat(g);c.children&&c.children.length>0&&(Be(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${y}".`),am(c.children,r,x,y,h)),!(c.path==null&&!c.index)&&r.push({path:y,score:k1(y,c.index),routesMeta:x})};return e.forEach((c,f)=>{var h;if(c.path===""||!((h=c.path)!=null&&h.includes("?")))s(c,f);else for(let d of um(c.path))s(c,f,!0,d)}),r}function um(e){let r=e.split("/");if(r.length===0)return[];let[i,...a]=r,u=i.endsWith("?"),s=i.replace(/\?$/,"");if(a.length===0)return u?[s,""]:[s];let c=um(a.join("/")),f=[];return f.push(...c.map(h=>h===""?s:[s,h].join("/"))),u&&f.push(...c),f.map(h=>e.startsWith("/")&&h===""?"/":h)}function y1(e){e.sort((r,i)=>r.score!==i.score?i.score-r.score:_1(r.routesMeta.map(a=>a.childrenIndex),i.routesMeta.map(a=>a.childrenIndex)))}var v1=/^:[\w-]+$/,x1=3,b1=2,w1=1,S1=10,E1=-2,om=e=>e==="*";function k1(e,r){let i=e.split("/"),a=i.length;return i.some(om)&&(a+=E1),r&&(a+=b1),i.filter(u=>!om(u)).reduce((u,s)=>u+(v1.test(s)?x1:s===""?w1:S1),a)}function _1(e,r){return e.length===r.length&&e.slice(0,-1).every((a,u)=>a===r[u])?e[e.length-1]-r[r.length-1]:0}function C1(e,r,i=!1){let{routesMeta:a}=e,u={},s="/",c=[];for(let f=0;f<a.length;++f){let h=a[f],d=f===a.length-1,g=s==="/"?r:r.slice(s.length)||"/",y=Nu({path:h.relativePath,caseSensitive:h.caseSensitive,end:d},g),x=h.route;if(!y&&d&&i&&!a[a.length-1].route.index&&(y=Nu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},g)),!y)return null;Object.assign(u,y.params),c.push({params:u,pathname:tr([s,y.pathname]),pathnameBase:R1(tr([s,y.pathnameBase])),route:x}),y.pathnameBase!=="/"&&(s=tr([s,y.pathnameBase]))}return c}function Nu(e,r){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[i,a]=T1(e.path,e.caseSensitive,e.end),u=r.match(i);if(!u)return null;let s=u[0],c=s.replace(/(.)\/+$/,"$1"),f=u.slice(1);return{params:a.reduce((d,{paramName:g,isOptional:y},x)=>{if(g==="*"){let w=f[x]||"";c=s.slice(0,s.length-w.length).replace(/(.)\/+$/,"$1")}const v=f[x];return y&&!v?d[g]=void 0:d[g]=(v||"").replace(/%2F/g,"/"),d},{}),pathname:s,pathnameBase:c,pattern:e}}function T1(e,r=!1,i=!0){St(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let a=[],u="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,f,h)=>(a.push({paramName:f,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(a.push({paramName:"*"}),u+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?u+="\\/*$":e!==""&&e!=="/"&&(u+="(?:(?=\\/|$))"),[new RegExp(u,r?void 0:"i"),a]}function z1(e){try{return e.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return St(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${r}).`),e}}function _n(e,r){if(r==="/")return e;if(!e.toLowerCase().startsWith(r.toLowerCase()))return null;let i=r.endsWith("/")?r.length-1:r.length,a=e.charAt(i);return a&&a!=="/"?null:e.slice(i)||"/"}function A1({basename:e,pathname:r}){return r==="/"?e:tr([e,r])}var sm=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$s=e=>sm.test(e);function M1(e,r="/"){let{pathname:i,search:a="",hash:u=""}=typeof e=="string"?hr(e):e,s;return i?(i=i.replace(/\/\/+/g,"/"),i.startsWith("/")?s=cm(i.substring(1),"/"):s=cm(i,r)):s=r,{pathname:s,search:N1(a),hash:D1(u)}}function cm(e,r){let i=r.replace(/\/+$/,"").split("/");return e.split("/").forEach(u=>{u===".."?i.length>1&&i.pop():u!=="."&&i.push(u)}),i.length>1?i.join("/"):"/"}function Is(e,r,i,a){return`Cannot include a '${e}' character in a manually specified \`to.${r}\` field [${JSON.stringify(a)}].  Please separate it out to the \`to.${i}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function fm(e){return e.filter((r,i)=>i===0||r.route.path&&r.route.path.length>0)}function Zs(e){let r=fm(e);return r.map((i,a)=>a===r.length-1?i.pathname:i.pathnameBase)}function Ks(e,r,i,a=!1){let u;typeof e=="string"?u=hr(e):(u={...e},Be(!u.pathname||!u.pathname.includes("?"),Is("?","pathname","search",u)),Be(!u.pathname||!u.pathname.includes("#"),Is("#","pathname","hash",u)),Be(!u.search||!u.search.includes("#"),Is("#","search","hash",u)));let s=e===""||u.pathname==="",c=s?"/":u.pathname,f;if(c==null)f=i;else{let y=r.length-1;if(!a&&c.startsWith("..")){let x=c.split("/");for(;x[0]==="..";)x.shift(),y-=1;u.pathname=x.join("/")}f=y>=0?r[y]:"/"}let h=M1(u,f),d=c&&c!=="/"&&c.endsWith("/"),g=(s||c===".")&&i.endsWith("/");return!h.pathname.endsWith("/")&&(d||g)&&(h.pathname+="/"),h}var tr=e=>e.join("/").replace(/\/\/+/g,"/"),R1=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),N1=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,D1=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,ua=class{constructor(e,r,i,a=!1){this.status=e,this.statusText=r||"",this.internal=a,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}};function oa(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}function sa(e){return e.map(r=>r.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var hm=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function dm(e,r){let i=e;if(typeof i!="string"||!sm.test(i))return{absoluteURL:void 0,isExternal:!1,to:i};let a=i,u=!1;if(hm)try{let s=new URL(window.location.href),c=i.startsWith("//")?new URL(s.protocol+i):new URL(i),f=_n(c.pathname,r);c.origin===s.origin&&f!=null?i=f+c.search+c.hash:u=!0}catch{St(!1,`<Link to="${i}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:a,isExternal:u,to:i}}var Gr=Symbol("Uninstrumented");function O1(e,r){let i={lazy:[],"lazy.loader":[],"lazy.action":[],"lazy.middleware":[],middleware:[],loader:[],action:[]};e.forEach(u=>u({id:r.id,index:r.index,path:r.path,instrument(s){let c=Object.keys(i);for(let f of c)s[f]&&i[f].push(s[f])}}));let a={};if(typeof r.lazy=="function"&&i.lazy.length>0){let u=al(i.lazy,r.lazy,()=>{});u&&(a.lazy=u)}if(typeof r.lazy=="object"){let u=r.lazy;["middleware","loader","action"].forEach(s=>{let c=u[s],f=i[`lazy.${s}`];if(typeof c=="function"&&f.length>0){let h=al(f,c,()=>{});h&&(a.lazy=Object.assign(a.lazy||{},{[s]:h}))}})}return["loader","action"].forEach(u=>{let s=r[u];if(typeof s=="function"&&i[u].length>0){let c=s[Gr]??s,f=al(i[u],c,(...h)=>pm(h[0]));f&&(u==="loader"&&c.hydrate===!0&&(f.hydrate=!0),f[Gr]=c,a[u]=f)}}),r.middleware&&r.middleware.length>0&&i.middleware.length>0&&(a.middleware=r.middleware.map(u=>{let s=u[Gr]??u,c=al(i.middleware,s,(...f)=>pm(f[0]));return c?(c[Gr]=s,c):u})),a}function j1(e,r){let i={navigate:[],fetch:[]};if(r.forEach(a=>a({instrument(u){let s=Object.keys(u);for(let c of s)u[c]&&i[c].push(u[c])}})),i.navigate.length>0){let a=e.navigate[Gr]??e.navigate,u=al(i.navigate,a,(...s)=>{let[c,f]=s;return{to:typeof c=="number"||typeof c=="string"?c:c?er(c):".",...gm(e,f??{})}});u&&(u[Gr]=a,e.navigate=u)}if(i.fetch.length>0){let a=e.fetch[Gr]??e.fetch,u=al(i.fetch,a,(...s)=>{let[c,,f,h]=s;return{href:f??".",fetcherKey:c,...gm(e,h??{})}});u&&(u[Gr]=a,e.fetch=u)}return e}function al(e,r,i){return e.length===0?null:async(...a)=>{let u=await mm(e,i(...a),()=>r(...a),e.length-1);if(u.type==="error")throw u.value;return u.value}}async function mm(e,r,i,a){let u=e[a],s;if(u){let c,f=async()=>(c?console.error("You cannot call instrumented handlers more than once"):c=mm(e,r,i,a-1),s=await c,Be(s,"Expected a result"),s.type==="error"&&s.value instanceof Error?{status:"error",error:s.value}:{status:"success",error:void 0});try{await u(f,r)}catch(h){console.error("An instrumentation function threw an error:",h)}c||await f(),await c}else try{s={type:"success",value:await i()}}catch(c){s={type:"error",value:c}}return s||{type:"error",value:new Error("No result assigned in instrumentation chain.")}}function pm(e){let{request:r,context:i,params:a,unstable_pattern:u}=e;return{request:L1(r),params:{...a},unstable_pattern:u,context:U1(i)}}function gm(e,r){return{currentUrl:er(e.state.location),..."formMethod"in r?{formMethod:r.formMethod}:{},..."formEncType"in r?{formEncType:r.formEncType}:{},..."formData"in r?{formData:r.formData}:{},..."body"in r?{body:r.body}:{}}}function L1(e){return{method:e.method,url:e.url,headers:{get:(...r)=>e.headers.get(...r)}}}function U1(e){if(H1(e)){let r={...e};return Object.freeze(r),r}else return{get:r=>e.get(r)}}var B1=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function H1(e){if(e===null||typeof e!="object")return!1;const r=Object.getPrototypeOf(e);return r===Object.prototype||r===null||Object.getOwnPropertyNames(r).sort().join("\0")===B1}var ym=["POST","PUT","PATCH","DELETE"],q1=new Set(ym),Y1=["GET",...ym],V1=new Set(Y1),vm=new Set([301,302,303,307,308]),F1=new Set([307,308]),Ps={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},X1={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},ca={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},G1=e=>({hasErrorBoundary:!!e.hasErrorBoundary}),xm="remix-router-transitions",bm=Symbol("ResetLoaderData");function Q1(e){const r=e.window?e.window:typeof window<"u"?window:void 0,i=typeof r<"u"&&typeof r.document<"u"&&typeof r.document.createElement<"u";Be(e.routes.length>0,"You must provide a non-empty routes array to createRouter");let a=e.hydrationRouteProperties||[],u=e.mapRouteProperties||G1,s=u;if(e.unstable_instrumentations){let O=e.unstable_instrumentations;s=F=>({...u(F),...O1(O.map(J=>J.route).filter(Boolean),F)})}let c={},f=la(e.routes,s,void 0,c),h,d=e.basename||"/";d.startsWith("/")||(d=`/${d}`);let g=e.dataStrategy||P1,y={...e.future},x=null,v=new Set,w=null,_=null,C=null,E=e.hydrationData!=null,M=Xr(f,e.history.location,d),L=!1,U=null,V;if(M==null&&!e.patchRoutesOnNavigation){let O=Cn(404,{pathname:e.history.location.pathname}),{matches:F,route:J}=Du(f);V=!0,M=F,U={[J.id]:O}}else if(M&&!e.hydrationData&&qi(M,f,e.history.location.pathname).active&&(M=null),M)if(M.some(O=>O.route.lazy))V=!1;else if(!M.some(O=>Ws(O.route)))V=!0;else{let O=e.hydrationData?e.hydrationData.loaderData:null,F=e.hydrationData?e.hydrationData.errors:null;if(F){let J=M.findIndex(ce=>F[ce.route.id]!==void 0);V=M.slice(0,J+1).every(ce=>!ec(ce.route,O,F))}else V=M.every(J=>!ec(J.route,O,F))}else{V=!1,M=[];let O=qi(null,f,e.history.location.pathname);O.active&&O.matches&&(L=!0,M=O.matches)}let B,N={historyAction:e.history.action,location:e.history.location,matches:M,initialized:V,navigation:Ps,restoreScrollPosition:e.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:e.hydrationData&&e.hydrationData.loaderData||{},actionData:e.hydrationData&&e.hydrationData.actionData||null,errors:e.hydrationData&&e.hydrationData.errors||U,fetchers:new Map,blockers:new Map},ee="POP",G=null,D=!1,ne,ae=!1,ve=new Map,H=null,I=!1,A=!1,Q=new Set,te=new Map,oe=0,T=-1,R=new Map,Z=new Set,z=new Map,se=new Map,pe=new Set,ye=new Map,Te,Oe=null;function Ke(){if(x=e.history.listen(({action:O,location:F,delta:J})=>{if(Te){Te(),Te=void 0;return}St(ye.size===0||J!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ce=Ui({currentLocation:N.location,nextLocation:F,historyAction:O});if(ce&&J!=null){let de=new Promise(Ee=>{Te=Ee});e.history.go(J*-1),Sr(ce,{state:"blocked",location:F,proceed(){Sr(ce,{state:"proceeding",proceed:void 0,reset:void 0,location:F}),de.then(()=>e.history.go(J))},reset(){let Ee=new Map(N.blockers);Ee.set(ce,ca),yt({blockers:Ee})}}),G==null||G.resolve(),G=null;return}return tn(O,F)}),i){pw(r,ve);let O=()=>gw(r,ve);r.addEventListener("pagehide",O),H=()=>r.removeEventListener("pagehide",O)}return N.initialized||tn("POP",N.location,{initialHydration:!0}),B}function en(){x&&x(),H&&H(),v.clear(),ne&&ne.abort(),N.fetchers.forEach((O,F)=>pn(F)),N.blockers.forEach((O,F)=>_o(F))}function Gn(O){return v.add(O),()=>v.delete(O)}function yt(O,F={}){O.matches&&(O.matches=O.matches.map(de=>{let Ee=c[de.route.id],be=de.route;return be.element!==Ee.element||be.errorElement!==Ee.errorElement||be.hydrateFallbackElement!==Ee.hydrateFallbackElement?{...de,route:Ee}:de})),N={...N,...O};let J=[],ce=[];N.fetchers.forEach((de,Ee)=>{de.state==="idle"&&(pe.has(Ee)?J.push(Ee):ce.push(Ee))}),pe.forEach(de=>{!N.fetchers.has(de)&&!te.has(de)&&J.push(de)}),[...v].forEach(de=>de(N,{deletedFetchers:J,newErrors:O.errors??null,viewTransitionOpts:F.viewTransitionOpts,flushSync:F.flushSync===!0})),J.forEach(de=>pn(de)),ce.forEach(de=>N.fetchers.delete(de))}function Qn(O,F,{flushSync:J}={}){var Re,_e;let ce=N.actionData!=null&&N.navigation.formMethod!=null&&Vt(N.navigation.formMethod)&&N.navigation.state==="loading"&&((Re=O.state)==null?void 0:Re._isRedirect)!==!0,de;F.actionData?Object.keys(F.actionData).length>0?de=F.actionData:de=null:ce?de=N.actionData:de=null;let Ee=F.loaderData?jm(N.loaderData,F.loaderData,F.matches||[],F.errors):N.loaderData,be=N.blockers;be.size>0&&(be=new Map(be),be.forEach((De,qe)=>be.set(qe,ca)));let me=I?!1:Co(O,F.matches||N.matches),ge=D===!0||N.navigation.formMethod!=null&&Vt(N.navigation.formMethod)&&((_e=O.state)==null?void 0:_e._isRedirect)!==!0;h&&(f=h,h=void 0),I||ee==="POP"||(ee==="PUSH"?e.history.push(O,O.state):ee==="REPLACE"&&e.history.replace(O,O.state));let we;if(ee==="POP"){let De=ve.get(N.location.pathname);De&&De.has(O.pathname)?we={currentLocation:N.location,nextLocation:O}:ve.has(O.pathname)&&(we={currentLocation:O,nextLocation:N.location})}else if(ae){let De=ve.get(N.location.pathname);De?De.add(O.pathname):(De=new Set([O.pathname]),ve.set(N.location.pathname,De)),we={currentLocation:N.location,nextLocation:O}}yt({...F,actionData:de,loaderData:Ee,historyAction:ee,location:O,initialized:!0,navigation:Ps,revalidation:"idle",restoreScrollPosition:me,preventScrollReset:ge,blockers:be},{viewTransitionOpts:we,flushSync:J===!0}),ee="POP",D=!1,ae=!1,I=!1,A=!1,G==null||G.resolve(),G=null,Oe==null||Oe.resolve(),Oe=null}async function An(O,F){if(G==null||G.resolve(),G=null,typeof O=="number"){G||(G=qm());let qe=G.promise;return e.history.go(O),qe}let J=Js(N.location,N.matches,d,O,F==null?void 0:F.fromRouteId,F==null?void 0:F.relative),{path:ce,submission:de,error:Ee}=wm(!1,J,F),be=N.location,me=ra(N.location,ce,F&&F.state);me={...me,...e.history.encodeLocation(me)};let ge=F&&F.replace!=null?F.replace:void 0,we="PUSH";ge===!0?we="REPLACE":ge===!1||de!=null&&Vt(de.formMethod)&&de.formAction===N.location.pathname+N.location.search&&(we="REPLACE");let Re=F&&"preventScrollReset"in F?F.preventScrollReset===!0:void 0,_e=(F&&F.flushSync)===!0,De=Ui({currentLocation:be,nextLocation:me,historyAction:we});if(De){Sr(De,{state:"blocked",location:me,proceed(){Sr(De,{state:"proceeding",proceed:void 0,reset:void 0,location:me}),An(O,F)},reset(){let qe=new Map(N.blockers);qe.set(De,ca),yt({blockers:qe})}});return}await tn(we,me,{submission:de,pendingError:Ee,preventScrollReset:Re,replace:F&&F.replace,enableViewTransition:F&&F.viewTransition,flushSync:_e,callSiteDefaultShouldRevalidate:F&&F.unstable_defaultShouldRevalidate})}function Wr(){Oe||(Oe=qm()),he(),yt({revalidation:"loading"});let O=Oe.promise;return N.navigation.state==="submitting"?O:N.navigation.state==="idle"?(tn(N.historyAction,N.location,{startUninterruptedRevalidation:!0}),O):(tn(ee||N.historyAction,N.navigation.location,{overrideNavigation:N.navigation,enableViewTransition:ae===!0}),O)}async function tn(O,F,J){ne&&ne.abort(),ne=null,ee=O,I=(J&&J.startUninterruptedRevalidation)===!0,Hi(N.location,N.matches),D=(J&&J.preventScrollReset)===!0,ae=(J&&J.enableViewTransition)===!0;let ce=h||f,de=J&&J.overrideNavigation,Ee=J!=null&&J.initialHydration&&N.matches&&N.matches.length>0&&!L?N.matches:Xr(ce,F,d),be=(J&&J.flushSync)===!0;if(Ee&&N.initialized&&!A&&lw(N.location,F)&&!(J&&J.submission&&Vt(J.submission.formMethod))){Qn(F,{matches:Ee},{flushSync:be});return}let me=qi(Ee,ce,F.pathname);if(me.active&&me.matches&&(Ee=me.matches),!Ee){let{error:vt,notFoundMatches:xt,route:Ge}=ti(F.pathname);Qn(F,{matches:xt,loaderData:{},errors:{[Ge.id]:vt}},{flushSync:be});return}ne=new AbortController;let ge=ol(e.history,F,ne.signal,J&&J.submission),we=e.getContext?await e.getContext():new im,Re;if(J&&J.pendingError)Re=[Qr(Ee).route.id,{type:"error",error:J.pendingError}];else if(J&&J.submission&&Vt(J.submission.formMethod)){let vt=await bl(ge,F,J.submission,Ee,we,me.active,J&&J.initialHydration===!0,{replace:J.replace,flushSync:be});if(vt.shortCircuited)return;if(vt.pendingActionResult){let[xt,Ge]=vt.pendingActionResult;if(cn(Ge)&&oa(Ge.error)&&Ge.error.status===404){ne=null,Qn(F,{matches:vt.matches,loaderData:{},errors:{[xt]:Ge.error}});return}}Ee=vt.matches||Ee,Re=vt.pendingActionResult,de=lc(F,J.submission),be=!1,me.active=!1,ge=ol(e.history,ge.url,ge.signal)}let{shortCircuited:_e,matches:De,loaderData:qe,errors:gt}=await wl(ge,F,Ee,we,me.active,de,J&&J.submission,J&&J.fetcherSubmission,J&&J.replace,J&&J.initialHydration===!0,be,Re,J&&J.callSiteDefaultShouldRevalidate);_e||(ne=null,Qn(F,{matches:De||Ee,...Lm(Re),loaderData:qe,errors:gt}))}async function bl(O,F,J,ce,de,Ee,be,me={}){he();let ge=dw(F,J);if(yt({navigation:ge},{flushSync:me.flushSync===!0}),Ee){let _e=await ni(ce,F.pathname,O.signal);if(_e.type==="aborted")return{shortCircuited:!0};if(_e.type==="error"){if(_e.partialMatches.length===0){let{matches:qe,route:gt}=Du(f);return{matches:qe,pendingActionResult:[gt.id,{type:"error",error:_e.error}]}}let De=Qr(_e.partialMatches).route.id;return{matches:_e.partialMatches,pendingActionResult:[De,{type:"error",error:_e.error}]}}else if(_e.matches)ce=_e.matches;else{let{notFoundMatches:De,error:qe,route:gt}=ti(F.pathname);return{matches:De,pendingActionResult:[gt.id,{type:"error",error:qe}]}}}let we,Re=ju(ce,F);if(!Re.route.action&&!Re.route.lazy)we={type:"error",error:Cn(405,{method:O.method,pathname:F.pathname,routeId:Re.route.id})};else{let _e=ul(s,c,O,ce,Re,be?[]:a,de),De=await wr(O,_e,de,null);if(we=De[Re.route.id],!we){for(let qe of ce)if(De[qe.route.id]){we=De[qe.route.id];break}}if(O.signal.aborted)return{shortCircuited:!0}}if(Ti(we)){let _e;return me&&me.replace!=null?_e=me.replace:_e=Nm(we.response.headers.get("Location"),new URL(O.url),d,e.history)===N.location.pathname+N.location.search,await pt(O,we,!0,{submission:J,replace:_e}),{shortCircuited:!0}}if(cn(we)){let _e=Qr(ce,Re.route.id);return(me&&me.replace)!==!0&&(ee="PUSH"),{matches:ce,pendingActionResult:[_e.route.id,we,Re.route.id]}}return{matches:ce,pendingActionResult:[Re.route.id,we]}}async function wl(O,F,J,ce,de,Ee,be,me,ge,we,Re,_e,De){let qe=Ee||lc(F,be),gt=be||me||Hm(qe),vt=!I&&!we;if(de){if(vt){let Et=br(_e);yt({navigation:qe,...Et!==void 0?{actionData:Et}:{}},{flushSync:Re})}let Qe=await ni(J,F.pathname,O.signal);if(Qe.type==="aborted")return{shortCircuited:!0};if(Qe.type==="error"){if(Qe.partialMatches.length===0){let{matches:Kn,route:Lt}=Du(f);return{matches:Kn,loaderData:{},errors:{[Lt.id]:Qe.error}}}let Et=Qr(Qe.partialMatches).route.id;return{matches:Qe.partialMatches,loaderData:{},errors:{[Et]:Qe.error}}}else if(Qe.matches)J=Qe.matches;else{let{error:Et,notFoundMatches:Kn,route:Lt}=ti(F.pathname);return{matches:Kn,loaderData:{},errors:{[Lt.id]:Et}}}}let xt=h||f,{dsMatches:Ge,revalidatingFetchers:Nt}=Sm(O,ce,s,c,e.history,N,J,gt,F,we?[]:a,we===!0,A,Q,pe,z,Z,xt,d,e.patchRoutesOnNavigation!=null,_e,De);if(T=++oe,!e.dataStrategy&&!Ge.some(Qe=>Qe.shouldLoad)&&!Ge.some(Qe=>Qe.route.middleware&&Qe.route.middleware.length>0)&&Nt.length===0){let Qe=tt();return Qn(F,{matches:J,loaderData:{},errors:_e&&cn(_e[1])?{[_e[0]]:_e[1].error}:null,...Lm(_e),...Qe?{fetchers:new Map(N.fetchers)}:{}},{flushSync:Re}),{shortCircuited:!0}}if(vt){let Qe={};if(!de){Qe.navigation=qe;let Et=br(_e);Et!==void 0&&(Qe.actionData=Et)}Nt.length>0&&(Qe.fetchers=ei(Nt)),yt(Qe,{flushSync:Re})}Nt.forEach(Qe=>{nt(Qe.key),Qe.controller&&te.set(Qe.key,Qe.controller)});let nn=()=>Nt.forEach(Qe=>nt(Qe.key));ne&&ne.signal.addEventListener("abort",nn);let{loaderResults:dt,fetcherResults:In}=await ie(Ge,Nt,O,ce);if(O.signal.aborted)return{shortCircuited:!0};ne&&ne.signal.removeEventListener("abort",nn),Nt.forEach(Qe=>te.delete(Qe.key));let yn=Ou(dt);if(yn)return await pt(O,yn.result,!0,{replace:ge}),{shortCircuited:!0};if(yn=Ou(In),yn)return Z.add(yn.key),await pt(O,yn.result,!0,{replace:ge}),{shortCircuited:!0};let{loaderData:Zn,errors:Mn}=Om(N,J,dt,_e,Nt,In);we&&N.errors&&(Mn={...N.errors,...Mn});let kr=tt(),Yi=$n(T),Vi=kr||Yi||Nt.length>0;return{matches:J,loaderData:Zn,errors:Mn,...Vi?{fetchers:new Map(N.fetchers)}:{}}}function br(O){if(O&&!cn(O[1]))return{[O[0]]:O[1].data};if(N.actionData)return Object.keys(N.actionData).length===0?null:N.actionData}function ei(O){return O.forEach(F=>{let J=N.fetchers.get(F.key),ce=ha(void 0,J?J.data:void 0);N.fetchers.set(F.key,ce)}),new Map(N.fetchers)}async function Li(O,F,J,ce){nt(O);let de=(ce&&ce.flushSync)===!0,Ee=h||f,be=Js(N.location,N.matches,d,J,F,ce==null?void 0:ce.relative),me=Xr(Ee,be,d),ge=qi(me,Ee,be);if(ge.active&&ge.matches&&(me=ge.matches),!me){Me(O,F,Cn(404,{pathname:be}),{flushSync:de});return}let{path:we,submission:Re,error:_e}=wm(!0,be,ce);if(_e){Me(O,F,_e,{flushSync:de});return}let De=e.getContext?await e.getContext():new im,qe=(ce&&ce.preventScrollReset)===!0;if(Re&&Vt(Re.formMethod)){await Va(O,F,we,me,De,ge.active,de,qe,Re,ce&&ce.unstable_defaultShouldRevalidate);return}z.set(O,{routeId:F,path:we}),await Fa(O,F,we,me,De,ge.active,de,qe,Re)}async function Va(O,F,J,ce,de,Ee,be,me,ge,we){he(),z.delete(O);let Re=N.fetchers.get(O);ke(O,mw(ge,Re),{flushSync:be});let _e=new AbortController,De=ol(e.history,J,_e.signal,ge);if(Ee){let $e=await ni(ce,new URL(De.url).pathname,De.signal,O);if($e.type==="aborted")return;if($e.type==="error"){Me(O,F,$e.error,{flushSync:be});return}else if($e.matches)ce=$e.matches;else{Me(O,F,Cn(404,{pathname:J}),{flushSync:be});return}}let qe=ju(ce,J);if(!qe.route.action&&!qe.route.lazy){let $e=Cn(405,{method:ge.formMethod,pathname:J,routeId:F});Me(O,F,$e,{flushSync:be});return}te.set(O,_e);let gt=oe,vt=ul(s,c,De,ce,qe,a,de),xt=await wr(De,vt,de,O),Ge=xt[qe.route.id];if(!Ge){for(let $e of vt)if(xt[$e.route.id]){Ge=xt[$e.route.id];break}}if(De.signal.aborted){te.get(O)===_e&&te.delete(O);return}if(pe.has(O)){if(Ti(Ge)||cn(Ge)){ke(O,dr(void 0));return}}else{if(Ti(Ge))if(te.delete(O),T>gt){ke(O,dr(void 0));return}else return Z.add(O),ke(O,ha(ge)),pt(De,Ge,!1,{fetcherSubmission:ge,preventScrollReset:me});if(cn(Ge)){Me(O,F,Ge.error);return}}let Nt=N.navigation.location||N.location,nn=ol(e.history,Nt,_e.signal),dt=h||f,In=N.navigation.state!=="idle"?Xr(dt,N.navigation.location,d):N.matches;Be(In,"Didn't find any matches after fetcher action");let yn=++oe;R.set(O,yn);let Zn=ha(ge,Ge.data);N.fetchers.set(O,Zn);let{dsMatches:Mn,revalidatingFetchers:kr}=Sm(nn,de,s,c,e.history,N,In,ge,Nt,a,!1,A,Q,pe,z,Z,dt,d,e.patchRoutesOnNavigation!=null,[qe.route.id,Ge],we);kr.filter($e=>$e.key!==O).forEach($e=>{let Fi=$e.key,zo=N.fetchers.get(Fi),Xa=ha(void 0,zo?zo.data:void 0);N.fetchers.set(Fi,Xa),nt(Fi),$e.controller&&te.set(Fi,$e.controller)}),yt({fetchers:new Map(N.fetchers)});let Yi=()=>kr.forEach($e=>nt($e.key));_e.signal.addEventListener("abort",Yi);let{loaderResults:Vi,fetcherResults:Qe}=await ie(Mn,kr,nn,de);if(_e.signal.aborted)return;if(_e.signal.removeEventListener("abort",Yi),R.delete(O),te.delete(O),kr.forEach($e=>te.delete($e.key)),N.fetchers.has(O)){let $e=dr(Ge.data);N.fetchers.set(O,$e)}let Et=Ou(Vi);if(Et)return pt(nn,Et.result,!1,{preventScrollReset:me});if(Et=Ou(Qe),Et)return Z.add(Et.key),pt(nn,Et.result,!1,{preventScrollReset:me});let{loaderData:Kn,errors:Lt}=Om(N,In,Vi,void 0,kr,Qe);$n(yn),N.navigation.state==="loading"&&yn>T?(Be(ee,"Expected pending action"),ne&&ne.abort(),Qn(N.navigation.location,{matches:In,loaderData:Kn,errors:Lt,fetchers:new Map(N.fetchers)})):(yt({errors:Lt,loaderData:jm(N.loaderData,Kn,In,Lt),fetchers:new Map(N.fetchers)}),A=!1)}async function Fa(O,F,J,ce,de,Ee,be,me,ge){let we=N.fetchers.get(O);ke(O,ha(ge,we?we.data:void 0),{flushSync:be});let Re=new AbortController,_e=ol(e.history,J,Re.signal);if(Ee){let Ge=await ni(ce,new URL(_e.url).pathname,_e.signal,O);if(Ge.type==="aborted")return;if(Ge.type==="error"){Me(O,F,Ge.error,{flushSync:be});return}else if(Ge.matches)ce=Ge.matches;else{Me(O,F,Cn(404,{pathname:J}),{flushSync:be});return}}let De=ju(ce,J);te.set(O,Re);let qe=oe,gt=ul(s,c,_e,ce,De,a,de),xt=(await wr(_e,gt,de,O))[De.route.id];if(te.get(O)===Re&&te.delete(O),!_e.signal.aborted){if(pe.has(O)){ke(O,dr(void 0));return}if(Ti(xt))if(T>qe){ke(O,dr(void 0));return}else{Z.add(O),await pt(_e,xt,!1,{preventScrollReset:me});return}if(cn(xt)){Me(O,F,xt.error);return}ke(O,dr(xt.data))}}async function pt(O,F,J,{submission:ce,fetcherSubmission:de,preventScrollReset:Ee,replace:be}={}){J||(G==null||G.resolve(),G=null),F.response.headers.has("X-Remix-Revalidate")&&(A=!0);let me=F.response.headers.get("Location");Be(me,"Expected a Location header on the redirect Response"),me=Nm(me,new URL(O.url),d,e.history);let ge=ra(N.location,me,{_isRedirect:!0});if(i){let gt=!1;if(F.response.headers.has("X-Remix-Reload-Document"))gt=!0;else if($s(me)){const vt=rm(me,!0);gt=vt.origin!==r.location.origin||_n(vt.pathname,d)==null}if(gt){be?r.location.replace(me):r.location.assign(me);return}}ne=null;let we=be===!0||F.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:Re,formAction:_e,formEncType:De}=N.navigation;!ce&&!de&&Re&&_e&&De&&(ce=Hm(N.navigation));let qe=ce||de;if(F1.has(F.response.status)&&qe&&Vt(qe.formMethod))await tn(we,ge,{submission:{...qe,formAction:me},preventScrollReset:Ee||D,enableViewTransition:J?ae:void 0});else{let gt=lc(ge,ce);await tn(we,ge,{overrideNavigation:gt,fetcherSubmission:de,preventScrollReset:Ee||D,enableViewTransition:J?ae:void 0})}}async function wr(O,F,J,ce){var be;let de,Ee={};try{de=await W1(g,O,F,ce,J,!1)}catch(me){return F.filter(ge=>ge.shouldLoad).forEach(ge=>{Ee[ge.route.id]={type:"error",error:me}}),Ee}if(O.signal.aborted)return Ee;if(!Vt(O.method))for(let me of F){if(((be=de[me.route.id])==null?void 0:be.type)==="error")break;!de.hasOwnProperty(me.route.id)&&!N.loaderData.hasOwnProperty(me.route.id)&&(!N.errors||!N.errors.hasOwnProperty(me.route.id))&&me.shouldCallHandler()&&(de[me.route.id]={type:"error",result:new Error(`No result returned from dataStrategy for route ${me.route.id}`)})}for(let[me,ge]of Object.entries(de))if(sw(ge)){let we=ge.result;Ee[me]={type:"redirect",response:rw(we,O,me,F,d)}}else Ee[me]=await nw(ge);return Ee}async function ie(O,F,J,ce){let de=wr(J,O,ce,null),Ee=Promise.all(F.map(async ge=>{if(ge.matches&&ge.match&&ge.request&&ge.controller){let Re=(await wr(ge.request,ge.matches,ce,ge.key))[ge.match.route.id];return{[ge.key]:Re}}else return Promise.resolve({[ge.key]:{type:"error",error:Cn(404,{pathname:ge.path})}})})),be=await de,me=(await Ee).reduce((ge,we)=>Object.assign(ge,we),{});return{loaderResults:be,fetcherResults:me}}function he(){A=!0,z.forEach((O,F)=>{te.has(F)&&Q.add(F),nt(F)})}function ke(O,F,J={}){N.fetchers.set(O,F),yt({fetchers:new Map(N.fetchers)},{flushSync:(J&&J.flushSync)===!0})}function Me(O,F,J,ce={}){let de=Qr(N.matches,F);pn(O),yt({errors:{[de.route.id]:J},fetchers:new Map(N.fetchers)},{flushSync:(ce&&ce.flushSync)===!0})}function Pe(O){return se.set(O,(se.get(O)||0)+1),pe.has(O)&&pe.delete(O),N.fetchers.get(O)||X1}function Zt(O,F){nt(O,F==null?void 0:F.reason),ke(O,dr(null))}function pn(O){let F=N.fetchers.get(O);te.has(O)&&!(F&&F.state==="loading"&&R.has(O))&&nt(O),z.delete(O),R.delete(O),Z.delete(O),pe.delete(O),Q.delete(O),N.fetchers.delete(O)}function Ot(O){let F=(se.get(O)||0)-1;F<=0?(se.delete(O),pe.add(O)):se.set(O,F),yt({fetchers:new Map(N.fetchers)})}function nt(O,F){let J=te.get(O);J&&(J.abort(F),te.delete(O))}function jt(O){for(let F of O){let J=Pe(F),ce=dr(J.data);N.fetchers.set(F,ce)}}function tt(){let O=[],F=!1;for(let J of Z){let ce=N.fetchers.get(J);Be(ce,`Expected fetcher: ${J}`),ce.state==="loading"&&(Z.delete(J),O.push(J),F=!0)}return jt(O),F}function $n(O){let F=[];for(let[J,ce]of R)if(ce<O){let de=N.fetchers.get(J);Be(de,`Expected fetcher: ${J}`),de.state==="loading"&&(nt(J),R.delete(J),F.push(J))}return jt(F),F.length>0}function gn(O,F){let J=N.blockers.get(O)||ca;return ye.get(O)!==F&&ye.set(O,F),J}function _o(O){N.blockers.delete(O),ye.delete(O)}function Sr(O,F){let J=N.blockers.get(O)||ca;Be(J.state==="unblocked"&&F.state==="blocked"||J.state==="blocked"&&F.state==="blocked"||J.state==="blocked"&&F.state==="proceeding"||J.state==="blocked"&&F.state==="unblocked"||J.state==="proceeding"&&F.state==="unblocked",`Invalid blocker state transition: ${J.state} -> ${F.state}`);let ce=new Map(N.blockers);ce.set(O,F),yt({blockers:ce})}function Ui({currentLocation:O,nextLocation:F,historyAction:J}){if(ye.size===0)return;ye.size>1&&St(!1,"A router only supports one blocker at a time");let ce=Array.from(ye.entries()),[de,Ee]=ce[ce.length-1],be=N.blockers.get(de);if(!(be&&be.state==="proceeding")&&Ee({currentLocation:O,nextLocation:F,historyAction:J}))return de}function ti(O){let F=Cn(404,{pathname:O}),J=h||f,{matches:ce,route:de}=Du(J);return{notFoundMatches:ce,route:de,error:F}}function Er(O,F,J){if(w=O,C=F,_=J||null,!E&&N.navigation===Ps){E=!0;let ce=Co(N.location,N.matches);ce!=null&&yt({restoreScrollPosition:ce})}return()=>{w=null,C=null,_=null}}function Bi(O,F){return _&&_(O,F.map(ce=>g1(ce,N.loaderData)))||O.key}function Hi(O,F){if(w&&C){let J=Bi(O,F);w[J]=C()}}function Co(O,F){if(w){let J=Bi(O,F),ce=w[J];if(typeof ce=="number")return ce}return null}function qi(O,F,J){if(e.patchRoutesOnNavigation)if(O){if(Object.keys(O[0].params).length>0)return{active:!0,matches:aa(F,J,d,!0)}}else return{active:!0,matches:aa(F,J,d,!0)||[]};return{active:!1,matches:null}}async function ni(O,F,J,ce){if(!e.patchRoutesOnNavigation)return{type:"success",matches:O};let de=O;for(;;){let Ee=h==null,be=h||f,me=c;try{await e.patchRoutesOnNavigation({signal:J,path:F,matches:de,fetcherKey:ce,patch:(Re,_e)=>{J.aborted||Em(Re,_e,be,me,s,!1)}})}catch(Re){return{type:"error",error:Re,partialMatches:de}}finally{Ee&&!J.aborted&&(f=[...f])}if(J.aborted)return{type:"aborted"};let ge=Xr(be,F,d),we=null;if(ge){if(Object.keys(ge[0].params).length===0)return{type:"success",matches:ge};if(we=aa(be,F,d,!0),!(we&&de.length<we.length&&ri(de,we.slice(0,de.length))))return{type:"success",matches:ge}}if(we||(we=aa(be,F,d,!0)),!we||ri(de,we))return{type:"success",matches:null};de=we}}function ri(O,F){return O.length===F.length&&O.every((J,ce)=>J.route.id===F[ce].route.id)}function Lf(O){c={},h=la(O,s,void 0,c)}function To(O,F,J=!1){let ce=h==null;Em(O,F,h||f,c,s,J),ce&&(f=[...f],yt({}))}return B={get basename(){return d},get future(){return y},get state(){return N},get routes(){return f},get window(){return r},initialize:Ke,subscribe:Gn,enableScrollRestoration:Er,navigate:An,fetch:Li,revalidate:Wr,createHref:O=>e.history.createHref(O),encodeLocation:O=>e.history.encodeLocation(O),getFetcher:Pe,resetFetcher:Zt,deleteFetcher:Ot,dispose:en,getBlocker:gn,deleteBlocker:_o,patchRoutes:To,_internalFetchControllers:te,_internalSetRoutes:Lf,_internalSetStateDoNotUseOrYouWillBreakYourApp(O){yt(O)}},e.unstable_instrumentations&&(B=j1(B,e.unstable_instrumentations.map(O=>O.router).filter(Boolean))),B}function $1(e){return e!=null&&("formData"in e&&e.formData!=null||"body"in e&&e.body!==void 0)}function Js(e,r,i,a,u,s){let c,f;if(u){c=[];for(let d of r)if(c.push(d),d.route.id===u){f=d;break}}else c=r,f=r[r.length-1];let h=Ks(a||".",Zs(c),_n(e.pathname,i)||e.pathname,s==="path");if(a==null&&(h.search=e.search,h.hash=e.hash),(a==null||a===""||a===".")&&f){let d=ic(h.search);if(f.route.index&&!d)h.search=h.search?h.search.replace(/^\?/,"?index&"):"?index";else if(!f.route.index&&d){let g=new URLSearchParams(h.search),y=g.getAll("index");g.delete("index"),y.filter(v=>v).forEach(v=>g.append("index",v));let x=g.toString();h.search=x?`?${x}`:""}}return i!=="/"&&(h.pathname=A1({basename:i,pathname:h.pathname})),er(h)}function wm(e,r,i){if(!i||!$1(i))return{path:r};if(i.formMethod&&!hw(i.formMethod))return{path:r,error:Cn(405,{method:i.formMethod})};let a=()=>({path:r,error:Cn(400,{type:"invalid-body"})}),s=(i.formMethod||"get").toUpperCase(),c=Um(r);if(i.body!==void 0){if(i.formEncType==="text/plain"){if(!Vt(s))return a();let y=typeof i.body=="string"?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce((x,[v,w])=>`${x}${v}=${w}
`,""):String(i.body);return{path:r,submission:{formMethod:s,formAction:c,formEncType:i.formEncType,formData:void 0,json:void 0,text:y}}}else if(i.formEncType==="application/json"){if(!Vt(s))return a();try{let y=typeof i.body=="string"?JSON.parse(i.body):i.body;return{path:r,submission:{formMethod:s,formAction:c,formEncType:i.formEncType,formData:void 0,json:y,text:void 0}}}catch{return a()}}}Be(typeof FormData=="function","FormData is not available in this environment");let f,h;if(i.formData)f=nc(i.formData),h=i.formData;else if(i.body instanceof FormData)f=nc(i.body),h=i.body;else if(i.body instanceof URLSearchParams)f=i.body,h=Dm(f);else if(i.body==null)f=new URLSearchParams,h=new FormData;else try{f=new URLSearchParams(i.body),h=Dm(f)}catch{return a()}let d={formMethod:s,formAction:c,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:h,json:void 0,text:void 0};if(Vt(d.formMethod))return{path:r,submission:d};let g=hr(r);return e&&g.search&&ic(g.search)&&f.append("index",""),g.search=`?${f}`,{path:er(g),submission:d}}function Sm(e,r,i,a,u,s,c,f,h,d,g,y,x,v,w,_,C,E,M,L,U){var I;let V=L?cn(L[1])?L[1].error:L[1].data:void 0,B=u.createURL(s.location),N=u.createURL(h),ee;if(g&&s.errors){let A=Object.keys(s.errors)[0];ee=c.findIndex(Q=>Q.route.id===A)}else if(L&&cn(L[1])){let A=L[0];ee=c.findIndex(Q=>Q.route.id===A)-1}let G=L?L[1].statusCode:void 0,D=G&&G>=400,ne={currentUrl:B,currentParams:((I=s.matches[0])==null?void 0:I.params)||{},nextUrl:N,nextParams:c[0].params,...f,actionResult:V,actionStatus:G},ae=sa(c),ve=c.map((A,Q)=>{let{route:te}=A,oe=null;if(ee!=null&&Q>ee?oe=!1:te.lazy?oe=!0:Ws(te)?g?oe=ec(te,s.loaderData,s.errors):I1(s.loaderData,s.matches[Q],A)&&(oe=!0):oe=!1,oe!==null)return tc(i,a,e,ae,A,d,r,oe);let T=!1;typeof U=="boolean"?T=U:D?T=!1:(y||B.pathname+B.search===N.pathname+N.search||B.search!==N.search||Z1(s.matches[Q],A))&&(T=!0);let R={...ne,defaultShouldRevalidate:T},Z=fa(A,R);return tc(i,a,e,ae,A,d,r,Z,R,U)}),H=[];return w.forEach((A,Q)=>{if(g||!c.some(pe=>pe.route.id===A.routeId)||v.has(Q))return;let te=s.fetchers.get(Q),oe=te&&te.state!=="idle"&&te.data===void 0,T=Xr(C,A.path,E);if(!T){if(M&&oe)return;H.push({key:Q,routeId:A.routeId,path:A.path,matches:null,match:null,request:null,controller:null});return}if(_.has(Q))return;let R=ju(T,A.path),Z=new AbortController,z=ol(u,A.path,Z.signal),se=null;if(x.has(Q))x.delete(Q),se=ul(i,a,z,T,R,d,r);else if(oe)y&&(se=ul(i,a,z,T,R,d,r));else{let pe;typeof U=="boolean"?pe=U:D?pe=!1:pe=y;let ye={...ne,defaultShouldRevalidate:pe};fa(R,ye)&&(se=ul(i,a,z,T,R,d,r,ye))}se&&H.push({key:Q,routeId:A.routeId,path:A.path,matches:se,match:R,request:z,controller:Z})}),{dsMatches:ve,revalidatingFetchers:H}}function Ws(e){return e.loader!=null||e.middleware!=null&&e.middleware.length>0}function ec(e,r,i){if(e.lazy)return!0;if(!Ws(e))return!1;let a=r!=null&&e.id in r,u=i!=null&&i[e.id]!==void 0;return!a&&u?!1:typeof e.loader=="function"&&e.loader.hydrate===!0?!0:!a&&!u}function I1(e,r,i){let a=!r||i.route.id!==r.route.id,u=!e.hasOwnProperty(i.route.id);return a||u}function Z1(e,r){let i=e.route.path;return e.pathname!==r.pathname||i!=null&&i.endsWith("*")&&e.params["*"]!==r.params["*"]}function fa(e,r){if(e.route.shouldRevalidate){let i=e.route.shouldRevalidate(r);if(typeof i=="boolean")return i}return r.defaultShouldRevalidate}function Em(e,r,i,a,u,s){let c;if(e){let d=a[e];Be(d,`No route found to patch children into: routeId = ${e}`),d.children||(d.children=[]),c=d.children}else c=i;let f=[],h=[];if(r.forEach(d=>{let g=c.find(y=>km(d,y));g?h.push({existingRoute:g,newRoute:d}):f.push(d)}),f.length>0){let d=la(f,u,[e||"_","patch",String((c==null?void 0:c.length)||"0")],a);c.push(...d)}if(s&&h.length>0)for(let d=0;d<h.length;d++){let{existingRoute:g,newRoute:y}=h[d],x=g,[v]=la([y],u,[],{},!0);Object.assign(x,{element:v.element?v.element:x.element,errorElement:v.errorElement?v.errorElement:x.errorElement,hydrateFallbackElement:v.hydrateFallbackElement?v.hydrateFallbackElement:x.hydrateFallbackElement})}}function km(e,r){return"id"in e&&"id"in r&&e.id===r.id?!0:e.index===r.index&&e.path===r.path&&e.caseSensitive===r.caseSensitive?(!e.children||e.children.length===0)&&(!r.children||r.children.length===0)?!0:e.children.every((i,a)=>{var u;return(u=r.children)==null?void 0:u.some(s=>km(i,s))}):!1}var _m=new WeakMap,Cm=({key:e,route:r,manifest:i,mapRouteProperties:a})=>{let u=i[r.id];if(Be(u,"No route found in manifest"),!u.lazy||typeof u.lazy!="object")return;let s=u.lazy[e];if(!s)return;let c=_m.get(u);c||(c={},_m.set(u,c));let f=c[e];if(f)return f;let h=(async()=>{let d=h1(e),y=u[e]!==void 0&&e!=="hasErrorBoundary";if(d)St(!d,"Route property "+e+" is not a supported lazy route property. This property will be ignored."),c[e]=Promise.resolve();else if(y)St(!1,`Route "${u.id}" has a static property "${e}" defined. The lazy property will be ignored.`);else{let x=await s();x!=null&&(Object.assign(u,{[e]:x}),Object.assign(u,a(u)))}typeof u.lazy=="object"&&(u.lazy[e]=void 0,Object.values(u.lazy).every(x=>x===void 0)&&(u.lazy=void 0))})();return c[e]=h,h},Tm=new WeakMap;function K1(e,r,i,a,u){let s=i[e.id];if(Be(s,"No route found in manifest"),!e.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof e.lazy=="function"){let g=Tm.get(s);if(g)return{lazyRoutePromise:g,lazyHandlerPromise:g};let y=(async()=>{Be(typeof e.lazy=="function","No lazy route function found");let x=await e.lazy(),v={};for(let w in x){let _=x[w];if(_===void 0)continue;let C=m1(w),M=s[w]!==void 0&&w!=="hasErrorBoundary";C?St(!C,"Route property "+w+" is not a supported property to be returned from a lazy route function. This property will be ignored."):M?St(!M,`Route "${s.id}" has a static property "${w}" defined but its lazy function is also returning a value for this property. The lazy route property "${w}" will be ignored.`):v[w]=_}Object.assign(s,v),Object.assign(s,{...a(s),lazy:void 0})})();return Tm.set(s,y),y.catch(()=>{}),{lazyRoutePromise:y,lazyHandlerPromise:y}}let c=Object.keys(e.lazy),f=[],h;for(let g of c){if(u&&u.includes(g))continue;let y=Cm({key:g,route:e,manifest:i,mapRouteProperties:a});y&&(f.push(y),g===r&&(h=y))}let d=f.length>0?Promise.all(f).then(()=>{}):void 0;return d==null||d.catch(()=>{}),h==null||h.catch(()=>{}),{lazyRoutePromise:d,lazyHandlerPromise:h}}async function zm(e){let r=e.matches.filter(u=>u.shouldLoad),i={};return(await Promise.all(r.map(u=>u.resolve()))).forEach((u,s)=>{i[r[s].route.id]=u}),i}async function P1(e){return e.matches.some(r=>r.route.middleware)?Am(e,()=>zm(e)):zm(e)}function Am(e,r){return J1(e,r,a=>{if(fw(a))throw a;return a},uw,i);function i(a,u,s){if(s)return Promise.resolve(Object.assign(s.value,{[u]:{type:"error",result:a}}));{let{matches:c}=e,f=Math.min(Math.max(c.findIndex(d=>d.route.id===u),0),Math.max(c.findIndex(d=>d.shouldCallHandler()),0)),h=Qr(c,c[f].route.id).route.id;return Promise.resolve({[h]:{type:"error",result:a}})}}}async function J1(e,r,i,a,u){let{matches:s,request:c,params:f,context:h,unstable_pattern:d}=e,g=s.flatMap(x=>x.route.middleware?x.route.middleware.map(v=>[x.route.id,v]):[]);return await Mm({request:c,params:f,context:h,unstable_pattern:d},g,r,i,a,u)}async function Mm(e,r,i,a,u,s,c=0){let{request:f}=e;if(f.signal.aborted)throw f.signal.reason??new Error(`Request aborted: ${f.method} ${f.url}`);let h=r[c];if(!h)return await i();let[d,g]=h,y,x=async()=>{if(y)throw new Error("You may only call `next()` once per middleware");try{return y={value:await Mm(e,r,i,a,u,s,c+1)},y.value}catch(v){return y={value:await s(v,d,y)},y.value}};try{let v=await g(e,x),w=v!=null?a(v):void 0;return u(w)?w:y?w??y.value:(y={value:await x()},y.value)}catch(v){return await s(v,d,y)}}function Rm(e,r,i,a,u){let s=Cm({key:"middleware",route:a.route,manifest:r,mapRouteProperties:e}),c=K1(a.route,Vt(i.method)?"action":"loader",r,e,u);return{middleware:s,route:c.lazyRoutePromise,handler:c.lazyHandlerPromise}}function tc(e,r,i,a,u,s,c,f,h=null,d){let g=!1,y=Rm(e,r,i,u,s);return{...u,_lazyPromises:y,shouldLoad:f,shouldRevalidateArgs:h,shouldCallHandler(x){return g=!0,h?typeof d=="boolean"?fa(u,{...h,defaultShouldRevalidate:d}):typeof x=="boolean"?fa(u,{...h,defaultShouldRevalidate:x}):fa(u,h):f},resolve(x){let{lazy:v,loader:w,middleware:_}=u.route,C=g||f||x&&!Vt(i.method)&&(v||w),E=_&&_.length>0&&!w&&!v;return C&&(Vt(i.method)||!E)?ew({request:i,unstable_pattern:a,match:u,lazyHandlerPromise:y==null?void 0:y.handler,lazyRoutePromise:y==null?void 0:y.route,handlerOverride:x,scopedContext:c}):Promise.resolve({type:"data",result:void 0})}}}function ul(e,r,i,a,u,s,c,f=null){return a.map(h=>h.route.id!==u.route.id?{...h,shouldLoad:!1,shouldRevalidateArgs:f,shouldCallHandler:()=>!1,_lazyPromises:Rm(e,r,i,h,s),resolve:()=>Promise.resolve({type:"data",result:void 0})}:tc(e,r,i,sa(a),h,s,c,!0,f))}async function W1(e,r,i,a,u,s){i.some(d=>{var g;return(g=d._lazyPromises)==null?void 0:g.middleware})&&await Promise.all(i.map(d=>{var g;return(g=d._lazyPromises)==null?void 0:g.middleware}));let c={request:r,unstable_pattern:sa(i),params:i[0].params,context:u,matches:i},h=await e({...c,fetcherKey:a,runClientMiddleware:d=>{let g=c;return Am(g,()=>d({...g,fetcherKey:a,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(i.flatMap(d=>{var g,y;return[(g=d._lazyPromises)==null?void 0:g.handler,(y=d._lazyPromises)==null?void 0:y.route]}))}catch{}return h}async function ew({request:e,unstable_pattern:r,match:i,lazyHandlerPromise:a,lazyRoutePromise:u,handlerOverride:s,scopedContext:c}){let f,h,d=Vt(e.method),g=d?"action":"loader",y=x=>{let v,w=new Promise((E,M)=>v=M);h=()=>v(),e.signal.addEventListener("abort",h);let _=E=>typeof x!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${g}" [routeId: ${i.route.id}]`)):x({request:e,unstable_pattern:r,params:i.params,context:c},...E!==void 0?[E]:[]),C=(async()=>{try{return{type:"data",result:await(s?s(M=>_(M)):_())}}catch(E){return{type:"error",result:E}}})();return Promise.race([C,w])};try{let x=d?i.route.action:i.route.loader;if(a||u)if(x){let v,[w]=await Promise.all([y(x).catch(_=>{v=_}),a,u]);if(v!==void 0)throw v;f=w}else{await a;let v=d?i.route.action:i.route.loader;if(v)[f]=await Promise.all([y(v),u]);else if(g==="action"){let w=new URL(e.url),_=w.pathname+w.search;throw Cn(405,{method:e.method,pathname:_,routeId:i.route.id})}else return{type:"data",result:void 0}}else if(x)f=await y(x);else{let v=new URL(e.url),w=v.pathname+v.search;throw Cn(404,{pathname:w})}}catch(x){return{type:"error",result:x}}finally{h&&e.signal.removeEventListener("abort",h)}return f}async function tw(e){let r=e.headers.get("Content-Type");return r&&/\bapplication\/json\b/.test(r)?e.body==null?null:e.json():e.text()}async function nw(e){var a,u,s,c,f;let{result:r,type:i}=e;if(rc(r)){let h;try{h=await tw(r)}catch(d){return{type:"error",error:d}}return i==="error"?{type:"error",error:new ua(r.status,r.statusText,h),statusCode:r.status,headers:r.headers}:{type:"data",data:h,statusCode:r.status,headers:r.headers}}return i==="error"?Bm(r)?r.data instanceof Error?{type:"error",error:r.data,statusCode:(a=r.init)==null?void 0:a.status,headers:(u=r.init)!=null&&u.headers?new Headers(r.init.headers):void 0}:{type:"error",error:aw(r),statusCode:oa(r)?r.status:void 0,headers:(s=r.init)!=null&&s.headers?new Headers(r.init.headers):void 0}:{type:"error",error:r,statusCode:oa(r)?r.status:void 0}:Bm(r)?{type:"data",data:r.data,statusCode:(c=r.init)==null?void 0:c.status,headers:(f=r.init)!=null&&f.headers?new Headers(r.init.headers):void 0}:{type:"data",data:r}}function rw(e,r,i,a,u){let s=e.headers.get("Location");if(Be(s,"Redirects returned/thrown from loaders/actions must have a Location header"),!$s(s)){let c=a.slice(0,a.findIndex(f=>f.route.id===i)+1);s=Js(new URL(r.url),c,u,s),e.headers.set("Location",s)}return e}function Nm(e,r,i,a){let u=["about:","blob:","chrome:","chrome-untrusted:","content:","data:","devtools:","file:","filesystem:","javascript:"];if($s(e)){let s=e,c=s.startsWith("//")?new URL(r.protocol+s):new URL(s);if(u.includes(c.protocol))throw new Error("Invalid redirect location");let f=_n(c.pathname,i)!=null;if(c.origin===r.origin&&f)return c.pathname+c.search+c.hash}try{let s=a.createURL(e);if(u.includes(s.protocol))throw new Error("Invalid redirect location")}catch{}return e}function ol(e,r,i,a){let u=e.createURL(Um(r)).toString(),s={signal:i};if(a&&Vt(a.formMethod)){let{formMethod:c,formEncType:f}=a;s.method=c.toUpperCase(),f==="application/json"?(s.headers=new Headers({"Content-Type":f}),s.body=JSON.stringify(a.json)):f==="text/plain"?s.body=a.text:f==="application/x-www-form-urlencoded"&&a.formData?s.body=nc(a.formData):s.body=a.formData}return new Request(u,s)}function nc(e){let r=new URLSearchParams;for(let[i,a]of e.entries())r.append(i,typeof a=="string"?a:a.name);return r}function Dm(e){let r=new FormData;for(let[i,a]of e.entries())r.append(i,a);return r}function iw(e,r,i,a=!1,u=!1){let s={},c=null,f,h=!1,d={},g=i&&cn(i[1])?i[1].error:void 0;return e.forEach(y=>{if(!(y.route.id in r))return;let x=y.route.id,v=r[x];if(Be(!Ti(v),"Cannot handle redirect results in processLoaderData"),cn(v)){let w=v.error;if(g!==void 0&&(w=g,g=void 0),c=c||{},u)c[x]=w;else{let _=Qr(e,x);c[_.route.id]==null&&(c[_.route.id]=w)}a||(s[x]=bm),h||(h=!0,f=oa(v.error)?v.error.status:500),v.headers&&(d[x]=v.headers)}else s[x]=v.data,v.statusCode&&v.statusCode!==200&&!h&&(f=v.statusCode),v.headers&&(d[x]=v.headers)}),g!==void 0&&i&&(c={[i[0]]:g},i[2]&&(s[i[2]]=void 0)),{loaderData:s,errors:c,statusCode:f||200,loaderHeaders:d}}function Om(e,r,i,a,u,s){let{loaderData:c,errors:f}=iw(r,i,a);return u.filter(h=>!h.matches||h.matches.some(d=>d.shouldLoad)).forEach(h=>{let{key:d,match:g,controller:y}=h;if(y&&y.signal.aborted)return;let x=s[d];if(Be(x,"Did not find corresponding fetcher result"),cn(x)){let v=Qr(e.matches,g==null?void 0:g.route.id);f&&f[v.route.id]||(f={...f,[v.route.id]:x.error}),e.fetchers.delete(d)}else if(Ti(x))Be(!1,"Unhandled fetcher revalidation redirect");else{let v=dr(x.data);e.fetchers.set(d,v)}}),{loaderData:c,errors:f}}function jm(e,r,i,a){let u=Object.entries(r).filter(([,s])=>s!==bm).reduce((s,[c,f])=>(s[c]=f,s),{});for(let s of i){let c=s.route.id;if(!r.hasOwnProperty(c)&&e.hasOwnProperty(c)&&s.route.loader&&(u[c]=e[c]),a&&a.hasOwnProperty(c))break}return u}function Lm(e){return e?cn(e[1])?{actionData:{}}:{actionData:{[e[0]]:e[1].data}}:{}}function Qr(e,r){return(r?e.slice(0,e.findIndex(a=>a.route.id===r)+1):[...e]).reverse().find(a=>a.route.hasErrorBoundary===!0)||e[0]}function Du(e){let r=e.length===1?e[0]:e.find(i=>i.index||!i.path||i.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:r}],route:r}}function Cn(e,{pathname:r,routeId:i,method:a,type:u,message:s}={}){let c="Unknown Server Error",f="Unknown @remix-run/router error";return e===400?(c="Bad Request",a&&r&&i?f=`You made a ${a} request to "${r}" but did not provide a \`loader\` for route "${i}", so there is no way to handle the request.`:u==="invalid-body"&&(f="Unable to encode submission body")):e===403?(c="Forbidden",f=`Route "${i}" does not match URL "${r}"`):e===404?(c="Not Found",f=`No route matches URL "${r}"`):e===405&&(c="Method Not Allowed",a&&r&&i?f=`You made a ${a.toUpperCase()} request to "${r}" but did not provide an \`action\` for route "${i}", so there is no way to handle the request.`:a&&(f=`Invalid request method "${a.toUpperCase()}"`)),new ua(e||500,c,new Error(f),!0)}function Ou(e){let r=Object.entries(e);for(let i=r.length-1;i>=0;i--){let[a,u]=r[i];if(Ti(u))return{key:a,result:u}}}function Um(e){let r=typeof e=="string"?hr(e):e;return er({...r,hash:""})}function lw(e,r){return e.pathname!==r.pathname||e.search!==r.search?!1:e.hash===""?r.hash!=="":e.hash===r.hash?!0:r.hash!==""}function aw(e){var r,i;return new ua(((r=e.init)==null?void 0:r.status)??500,((i=e.init)==null?void 0:i.statusText)??"Internal Server Error",e.data)}function uw(e){return e!=null&&typeof e=="object"&&Object.entries(e).every(([r,i])=>typeof r=="string"&&ow(i))}function ow(e){return e!=null&&typeof e=="object"&&"type"in e&&"result"in e&&(e.type==="data"||e.type==="error")}function sw(e){return rc(e.result)&&vm.has(e.result.status)}function cn(e){return e.type==="error"}function Ti(e){return(e&&e.type)==="redirect"}function Bm(e){return typeof e=="object"&&e!=null&&"type"in e&&"data"in e&&"init"in e&&e.type==="DataWithResponseInit"}function rc(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.headers=="object"&&typeof e.body<"u"}function cw(e){return vm.has(e)}function fw(e){return rc(e)&&cw(e.status)&&e.headers.has("Location")}function hw(e){return V1.has(e.toUpperCase())}function Vt(e){return q1.has(e.toUpperCase())}function ic(e){return new URLSearchParams(e).getAll("index").some(r=>r==="")}function ju(e,r){let i=typeof r=="string"?hr(r).search:r.search;if(e[e.length-1].route.index&&ic(i||""))return e[e.length-1];let a=fm(e);return a[a.length-1]}function Hm(e){let{formMethod:r,formAction:i,formEncType:a,text:u,formData:s,json:c}=e;if(!(!r||!i||!a)){if(u!=null)return{formMethod:r,formAction:i,formEncType:a,formData:void 0,json:void 0,text:u};if(s!=null)return{formMethod:r,formAction:i,formEncType:a,formData:s,json:void 0,text:void 0};if(c!==void 0)return{formMethod:r,formAction:i,formEncType:a,formData:void 0,json:c,text:void 0}}}function lc(e,r){return r?{state:"loading",location:e,formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text}:{state:"loading",location:e,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function dw(e,r){return{state:"submitting",location:e,formMethod:r.formMethod,formAction:r.formAction,formEncType:r.formEncType,formData:r.formData,json:r.json,text:r.text}}function ha(e,r){return e?{state:"loading",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:r}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:r}}function mw(e,r){return{state:"submitting",formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text,data:r?r.data:void 0}}function dr(e){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function pw(e,r){try{let i=e.sessionStorage.getItem(xm);if(i){let a=JSON.parse(i);for(let[u,s]of Object.entries(a||{}))s&&Array.isArray(s)&&r.set(u,new Set(s||[]))}}catch{}}function gw(e,r){if(r.size>0){let i={};for(let[a,u]of r)i[a]=[...u];try{e.sessionStorage.setItem(xm,JSON.stringify(i))}catch(a){St(!1,`Failed to save applied view transitions in sessionStorage (${a}).`)}}}function qm(){let e,r,i=new Promise((a,u)=>{e=async s=>{a(s);try{await i}catch{}},r=async s=>{u(s);try{await i}catch{}}});return{promise:i,resolve:e,reject:r}}var zi=Y.createContext(null);zi.displayName="DataRouter";var da=Y.createContext(null);da.displayName="DataRouterState";var Ym=Y.createContext(!1);function yw(){return Y.useContext(Ym)}var ac=Y.createContext({isTransitioning:!1});ac.displayName="ViewTransition";var Vm=Y.createContext(new Map);Vm.displayName="Fetchers";var vw=Y.createContext(null);vw.displayName="Await";var Tn=Y.createContext(null);Tn.displayName="Navigation";var Lu=Y.createContext(null);Lu.displayName="Location";var qn=Y.createContext({outlet:null,matches:[],isDataRoute:!1});qn.displayName="Route";var uc=Y.createContext(null);uc.displayName="RouteError";var Fm="REACT_ROUTER_ERROR",xw="REDIRECT",bw="ROUTE_ERROR_RESPONSE";function ww(e){if(e.startsWith(`${Fm}:${xw}:{`))try{let r=JSON.parse(e.slice(28));if(typeof r=="object"&&r&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.location=="string"&&typeof r.reloadDocument=="boolean"&&typeof r.replace=="boolean")return r}catch{}}function Sw(e){if(e.startsWith(`${Fm}:${bw}:{`))try{let r=JSON.parse(e.slice(40));if(typeof r=="object"&&r&&typeof r.status=="number"&&typeof r.statusText=="string")return new ua(r.status,r.statusText,r.data)}catch{}}function Ew(e,{relative:r}={}){Be(ma(),"useHref() may be used only in the context of a <Router> component.");let{basename:i,navigator:a}=Y.useContext(Tn),{hash:u,pathname:s,search:c}=pa(e,{relative:r}),f=s;return i!=="/"&&(f=s==="/"?i:tr([i,s])),a.createHref({pathname:f,search:c,hash:u})}function ma(){return Y.useContext(Lu)!=null}function $r(){return Be(ma(),"useLocation() may be used only in the context of a <Router> component."),Y.useContext(Lu).location}var Xm="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Gm(e){Y.useContext(Tn).static||Y.useLayoutEffect(e)}function Uu(){let{isDataRoute:e}=Y.useContext(qn);return e?Bw():kw()}function kw(){Be(ma(),"useNavigate() may be used only in the context of a <Router> component.");let e=Y.useContext(zi),{basename:r,navigator:i}=Y.useContext(Tn),{matches:a}=Y.useContext(qn),{pathname:u}=$r(),s=JSON.stringify(Zs(a)),c=Y.useRef(!1);return Gm(()=>{c.current=!0}),Y.useCallback((h,d={})=>{if(St(c.current,Xm),!c.current)return;if(typeof h=="number"){i.go(h);return}let g=Ks(h,JSON.parse(s),u,d.relative==="path");e==null&&r!=="/"&&(g.pathname=g.pathname==="/"?r:tr([r,g.pathname])),(d.replace?i.replace:i.push)(g,d.state,d)},[r,i,s,u,e])}var _w=Y.createContext(null);function Cw(e){let r=Y.useContext(qn).outlet;return Y.useMemo(()=>r&&Y.createElement(_w.Provider,{value:e},r),[r,e])}function Qm(){let{matches:e}=Y.useContext(qn),r=e[e.length-1];return r?r.params:{}}function pa(e,{relative:r}={}){let{matches:i}=Y.useContext(qn),{pathname:a}=$r(),u=JSON.stringify(Zs(i));return Y.useMemo(()=>Ks(e,JSON.parse(u),a,r==="path"),[e,u,a,r])}function Tw(e,r,i,a,u){Be(ma(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=Y.useContext(Tn),{matches:c}=Y.useContext(qn),f=c[c.length-1],h=f?f.params:{},d=f?f.pathname:"/",g=f?f.pathnameBase:"/",y=f&&f.route;{let M=y&&y.path||"";Zm(d,!y||M.endsWith("*")||M.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${M}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${M}"> to <Route path="${M==="/"?"*":`${M}/*`}">.`)}let x=$r(),v;v=x;let w=v.pathname||"/",_=w;if(g!=="/"){let M=g.replace(/^\//,"").split("/");_="/"+w.replace(/^\//,"").split("/").slice(M.length).join("/")}let C=Xr(e,{pathname:_});return St(y||C!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),St(C==null||C[C.length-1].route.element!==void 0||C[C.length-1].route.Component!==void 0||C[C.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),Nw(C&&C.map(M=>Object.assign({},M,{params:Object.assign({},h,M.params),pathname:tr([g,s.encodeLocation?s.encodeLocation(M.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:M.pathname]),pathnameBase:M.pathnameBase==="/"?g:tr([g,s.encodeLocation?s.encodeLocation(M.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:M.pathnameBase])})),c,i,a,u)}function zw(){let e=Uw(),r=oa(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),i=e instanceof Error?e.stack:null,a="rgba(200,200,200, 0.5)",u={padding:"0.5rem",backgroundColor:a},s={padding:"2px 4px",backgroundColor:a},c=null;return console.error("Error handled by React Router default ErrorBoundary:",e),c=Y.createElement(Y.Fragment,null,Y.createElement("p",null,"💿 Hey developer 👋"),Y.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Y.createElement("code",{style:s},"ErrorBoundary")," or"," ",Y.createElement("code",{style:s},"errorElement")," prop on your route.")),Y.createElement(Y.Fragment,null,Y.createElement("h2",null,"Unexpected Application Error!"),Y.createElement("h3",{style:{fontStyle:"italic"}},r),i?Y.createElement("pre",{style:u},i):null,c)}var Aw=Y.createElement(zw,null),$m=class extends Y.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){this.props.onError?this.props.onError(e,r):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){const i=Sw(e.digest);i&&(e=i)}let r=e!==void 0?Y.createElement(qn.Provider,{value:this.props.routeContext},Y.createElement(uc.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?Y.createElement(Mw,{error:e},r):r}};$m.contextType=Ym;var oc=new WeakMap;function Mw({children:e,error:r}){let{basename:i}=Y.useContext(Tn);if(typeof r=="object"&&r&&"digest"in r&&typeof r.digest=="string"){let a=ww(r.digest);if(a){let u=oc.get(r);if(u)throw u;let s=dm(a.location,i);if(hm&&!oc.get(r))if(s.isExternal||a.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:a.replace}));throw oc.set(r,c),c}return Y.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return e}function Rw({routeContext:e,match:r,children:i}){let a=Y.useContext(zi);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),Y.createElement(qn.Provider,{value:e},i)}function Nw(e,r=[],i=null,a=null,u=null){if(e==null){if(!i)return null;if(i.errors)e=i.matches;else if(r.length===0&&!i.initialized&&i.matches.length>0)e=i.matches;else return null}let s=e,c=i==null?void 0:i.errors;if(c!=null){let g=s.findIndex(y=>y.route.id&&(c==null?void 0:c[y.route.id])!==void 0);Be(g>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),s=s.slice(0,Math.min(s.length,g+1))}let f=!1,h=-1;if(i)for(let g=0;g<s.length;g++){let y=s[g];if((y.route.HydrateFallback||y.route.hydrateFallbackElement)&&(h=g),y.route.id){let{loaderData:x,errors:v}=i,w=y.route.loader&&!x.hasOwnProperty(y.route.id)&&(!v||v[y.route.id]===void 0);if(y.route.lazy||w){f=!0,h>=0?s=s.slice(0,h+1):s=[s[0]];break}}}let d=i&&a?(g,y)=>{var x,v;a(g,{location:i.location,params:((v=(x=i.matches)==null?void 0:x[0])==null?void 0:v.params)??{},unstable_pattern:sa(i.matches),errorInfo:y})}:void 0;return s.reduceRight((g,y,x)=>{let v,w=!1,_=null,C=null;i&&(v=c&&y.route.id?c[y.route.id]:void 0,_=y.route.errorElement||Aw,f&&(h<0&&x===0?(Zm("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),w=!0,C=null):h===x&&(w=!0,C=y.route.hydrateFallbackElement||null)));let E=r.concat(s.slice(0,x+1)),M=()=>{let L;return v?L=_:w?L=C:y.route.Component?L=Y.createElement(y.route.Component,null):y.route.element?L=y.route.element:L=g,Y.createElement(Rw,{match:y,routeContext:{outlet:g,matches:E,isDataRoute:i!=null},children:L})};return i&&(y.route.ErrorBoundary||y.route.errorElement||x===0)?Y.createElement($m,{location:i.location,revalidation:i.revalidation,component:_,error:v,children:M(),routeContext:{outlet:null,matches:E,isDataRoute:!0},onError:d}):M()},null)}function sc(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Dw(e){let r=Y.useContext(zi);return Be(r,sc(e)),r}function Ow(e){let r=Y.useContext(da);return Be(r,sc(e)),r}function jw(e){let r=Y.useContext(qn);return Be(r,sc(e)),r}function cc(e){let r=jw(e),i=r.matches[r.matches.length-1];return Be(i.route.id,`${e} can only be used on routes that contain a unique "id"`),i.route.id}function Lw(){return cc("useRouteId")}function Uw(){var a;let e=Y.useContext(uc),r=Ow("useRouteError"),i=cc("useRouteError");return e!==void 0?e:(a=r.errors)==null?void 0:a[i]}function Bw(){let{router:e}=Dw("useNavigate"),r=cc("useNavigate"),i=Y.useRef(!1);return Gm(()=>{i.current=!0}),Y.useCallback(async(u,s={})=>{St(i.current,Xm),i.current&&(typeof u=="number"?await e.navigate(u):await e.navigate(u,{fromRouteId:r,...s}))},[e,r])}var Im={};function Zm(e,r,i){!r&&!Im[e]&&(Im[e]=!0,St(!1,i))}var Km={};function Pm(e,r){!e&&!Km[r]&&(Km[r]=!0,console.warn(r))}var Hw="useOptimistic",Jm=Wb[Hw],qw=()=>{};function Yw(e){return Jm?Jm(e):[e,qw]}function Vw(e){let r={hasErrorBoundary:e.hasErrorBoundary||e.ErrorBoundary!=null||e.errorElement!=null};return e.Component&&(e.element&&St(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(r,{element:Y.createElement(e.Component),Component:void 0})),e.HydrateFallback&&(e.hydrateFallbackElement&&St(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(r,{hydrateFallbackElement:Y.createElement(e.HydrateFallback),HydrateFallback:void 0})),e.ErrorBoundary&&(e.errorElement&&St(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(r,{errorElement:Y.createElement(e.ErrorBoundary),ErrorBoundary:void 0})),r}var Fw=["HydrateFallback","hydrateFallbackElement"],Xw=class{constructor(){this.status="pending",this.promise=new Promise((e,r)=>{this.resolve=i=>{this.status==="pending"&&(this.status="resolved",e(i))},this.reject=i=>{this.status==="pending"&&(this.status="rejected",r(i))}})}};function Gw({router:e,flushSync:r,onError:i,unstable_useTransitions:a}){a=yw()||a;let[s,c]=Y.useState(e.state),[f,h]=Yw(s),[d,g]=Y.useState(),[y,x]=Y.useState({isTransitioning:!1}),[v,w]=Y.useState(),[_,C]=Y.useState(),[E,M]=Y.useState(),L=Y.useRef(new Map),U=Y.useCallback((ee,{deletedFetchers:G,newErrors:D,flushSync:ne,viewTransitionOpts:ae})=>{D&&i&&Object.values(D).forEach(H=>{var I;return i(H,{location:ee.location,params:((I=ee.matches[0])==null?void 0:I.params)??{},unstable_pattern:sa(ee.matches)})}),ee.fetchers.forEach((H,I)=>{H.data!==void 0&&L.current.set(I,H.data)}),G.forEach(H=>L.current.delete(H)),Pm(ne===!1||r!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let ve=e.window!=null&&e.window.document!=null&&typeof e.window.document.startViewTransition=="function";if(Pm(ae==null||ve,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!ae||!ve){r&&ne?r(()=>c(ee)):a===!1?c(ee):Y.startTransition(()=>{a===!0&&h(H=>Wm(H,ee)),c(ee)});return}if(r&&ne){r(()=>{_&&(v==null||v.resolve(),_.skipTransition()),x({isTransitioning:!0,flushSync:!0,currentLocation:ae.currentLocation,nextLocation:ae.nextLocation})});let H=e.window.document.startViewTransition(()=>{r(()=>c(ee))});H.finished.finally(()=>{r(()=>{w(void 0),C(void 0),g(void 0),x({isTransitioning:!1})})}),r(()=>C(H));return}_?(v==null||v.resolve(),_.skipTransition(),M({state:ee,currentLocation:ae.currentLocation,nextLocation:ae.nextLocation})):(g(ee),x({isTransitioning:!0,flushSync:!1,currentLocation:ae.currentLocation,nextLocation:ae.nextLocation}))},[e.window,r,_,v,a,h,i]);Y.useLayoutEffect(()=>e.subscribe(U),[e,U]),Y.useEffect(()=>{y.isTransitioning&&!y.flushSync&&w(new Xw)},[y]),Y.useEffect(()=>{if(v&&d&&e.window){let ee=d,G=v.promise,D=e.window.document.startViewTransition(async()=>{a===!1?c(ee):Y.startTransition(()=>{a===!0&&h(ne=>Wm(ne,ee)),c(ee)}),await G});D.finished.finally(()=>{w(void 0),C(void 0),g(void 0),x({isTransitioning:!1})}),C(D)}},[d,v,e.window,a,h]),Y.useEffect(()=>{v&&d&&f.location.key===d.location.key&&v.resolve()},[v,_,f.location,d]),Y.useEffect(()=>{!y.isTransitioning&&E&&(g(E.state),x({isTransitioning:!0,flushSync:!1,currentLocation:E.currentLocation,nextLocation:E.nextLocation}),M(void 0))},[y.isTransitioning,E]);let V=Y.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:ee=>e.navigate(ee),push:(ee,G,D)=>e.navigate(ee,{state:G,preventScrollReset:D==null?void 0:D.preventScrollReset}),replace:(ee,G,D)=>e.navigate(ee,{replace:!0,state:G,preventScrollReset:D==null?void 0:D.preventScrollReset})}),[e]),B=e.basename||"/",N=Y.useMemo(()=>({router:e,navigator:V,static:!1,basename:B,onError:i}),[e,V,B,i]);return Y.createElement(Y.Fragment,null,Y.createElement(zi.Provider,{value:N},Y.createElement(da.Provider,{value:f},Y.createElement(Vm.Provider,{value:L.current},Y.createElement(ac.Provider,{value:y},Y.createElement(Zw,{basename:B,location:f.location,navigationType:f.historyAction,navigator:V,unstable_useTransitions:a},Y.createElement(Qw,{routes:e.routes,future:e.future,state:f,onError:i})))))),null)}function Wm(e,r){return{...e,navigation:r.navigation.state!=="idle"?r.navigation:e.navigation,revalidation:r.revalidation!=="idle"?r.revalidation:e.revalidation,actionData:r.navigation.state!=="submitting"?r.actionData:e.actionData,fetchers:r.fetchers}}var Qw=Y.memo($w);function $w({routes:e,future:r,state:i,onError:a}){return Tw(e,void 0,i,a,r)}function Iw(e){return Cw(e.context)}function Zw({basename:e="/",children:r=null,location:i,navigationType:a="POP",navigator:u,static:s=!1,unstable_useTransitions:c}){Be(!ma(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let f=e.replace(/^\/*/,"/"),h=Y.useMemo(()=>({basename:f,navigator:u,static:s,unstable_useTransitions:c,future:{}}),[f,u,s,c]);typeof i=="string"&&(i=hr(i));let{pathname:d="/",search:g="",hash:y="",state:x=null,key:v="default"}=i,w=Y.useMemo(()=>{let _=_n(d,f);return _==null?null:{location:{pathname:_,search:g,hash:y,state:x,key:v},navigationType:a}},[f,d,g,y,x,v,a]);return St(w!=null,`<Router basename="${f}"> is not able to match the URL "${d}${g}${y}" because it does not start with the basename, so the <Router> won't render anything.`),w==null?null:Y.createElement(Tn.Provider,{value:h},Y.createElement(Lu.Provider,{children:r,value:w}))}var Bu="get",Hu="application/x-www-form-urlencoded";function qu(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement}function Kw(e){return qu(e)&&e.tagName.toLowerCase()==="button"}function Pw(e){return qu(e)&&e.tagName.toLowerCase()==="form"}function Jw(e){return qu(e)&&e.tagName.toLowerCase()==="input"}function Ww(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function eS(e,r){return e.button===0&&(!r||r==="_self")&&!Ww(e)}var Yu=null;function tS(){if(Yu===null)try{new FormData(document.createElement("form"),0),Yu=!1}catch{Yu=!0}return Yu}var nS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function fc(e){return e!=null&&!nS.has(e)?(St(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Hu}"`),null):e}function rS(e,r){let i,a,u,s,c;if(Pw(e)){let f=e.getAttribute("action");a=f?_n(f,r):null,i=e.getAttribute("method")||Bu,u=fc(e.getAttribute("enctype"))||Hu,s=new FormData(e)}else if(Kw(e)||Jw(e)&&(e.type==="submit"||e.type==="image")){let f=e.form;if(f==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=e.getAttribute("formaction")||f.getAttribute("action");if(a=h?_n(h,r):null,i=e.getAttribute("formmethod")||f.getAttribute("method")||Bu,u=fc(e.getAttribute("formenctype"))||fc(f.getAttribute("enctype"))||Hu,s=new FormData(f,e),!tS()){let{name:d,type:g,value:y}=e;if(g==="image"){let x=d?`${d}.`:"";s.append(`${x}x`,"0"),s.append(`${x}y`,"0")}else d&&s.append(d,y)}}else{if(qu(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');i=Bu,a=null,u=Hu,c=e}return s&&u==="text/plain"&&(c=s,s=void 0),{action:a,method:i.toLowerCase(),encType:u,formData:s,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function hc(e,r){if(e===!1||e===null||typeof e>"u")throw new Error(r)}function iS(e,r,i,a){let u=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return i?u.pathname.endsWith("/")?u.pathname=`${u.pathname}_.${a}`:u.pathname=`${u.pathname}.${a}`:u.pathname==="/"?u.pathname=`_root.${a}`:r&&_n(u.pathname,r)==="/"?u.pathname=`${r.replace(/\/$/,"")}/_root.${a}`:u.pathname=`${u.pathname.replace(/\/$/,"")}.${a}`,u}async function lS(e,r){if(e.id in r)return r[e.id];try{let i=await import(e.module);return r[e.id]=i,i}catch(i){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(i),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function aS(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function uS(e,r,i){let a=await Promise.all(e.map(async u=>{let s=r.routes[u.route.id];if(s){let c=await lS(s,i);return c.links?c.links():[]}return[]}));return fS(a.flat(1).filter(aS).filter(u=>u.rel==="stylesheet"||u.rel==="preload").map(u=>u.rel==="stylesheet"?{...u,rel:"prefetch",as:"style"}:{...u,rel:"prefetch"}))}function ep(e,r,i,a,u,s){let c=(h,d)=>i[d]?h.route.id!==i[d].route.id:!0,f=(h,d)=>{var g;return i[d].pathname!==h.pathname||((g=i[d].route.path)==null?void 0:g.endsWith("*"))&&i[d].params["*"]!==h.params["*"]};return s==="assets"?r.filter((h,d)=>c(h,d)||f(h,d)):s==="data"?r.filter((h,d)=>{var y;let g=a.routes[h.route.id];if(!g||!g.hasLoader)return!1;if(c(h,d)||f(h,d))return!0;if(h.route.shouldRevalidate){let x=h.route.shouldRevalidate({currentUrl:new URL(u.pathname+u.search+u.hash,window.origin),currentParams:((y=i[0])==null?void 0:y.params)||{},nextUrl:new URL(e,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof x=="boolean")return x}return!0}):[]}function oS(e,r,{includeHydrateFallback:i}={}){return sS(e.map(a=>{let u=r.routes[a.route.id];if(!u)return[];let s=[u.module];return u.clientActionModule&&(s=s.concat(u.clientActionModule)),u.clientLoaderModule&&(s=s.concat(u.clientLoaderModule)),i&&u.hydrateFallbackModule&&(s=s.concat(u.hydrateFallbackModule)),u.imports&&(s=s.concat(u.imports)),s}).flat(1))}function sS(e){return[...new Set(e)]}function cS(e){let r={},i=Object.keys(e).sort();for(let a of i)r[a]=e[a];return r}function fS(e,r){let i=new Set;return new Set(r),e.reduce((a,u)=>{let s=JSON.stringify(cS(u));return i.has(s)||(i.add(s),a.push({key:s,link:u})),a},[])}function tp(){let e=Y.useContext(zi);return hc(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function hS(){let e=Y.useContext(da);return hc(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var dc=Y.createContext(void 0);dc.displayName="FrameworkContext";function np(){let e=Y.useContext(dc);return hc(e,"You must render this element inside a <HydratedRouter> element"),e}function dS(e,r){let i=Y.useContext(dc),[a,u]=Y.useState(!1),[s,c]=Y.useState(!1),{onFocus:f,onBlur:h,onMouseEnter:d,onMouseLeave:g,onTouchStart:y}=r,x=Y.useRef(null);Y.useEffect(()=>{if(e==="render"&&c(!0),e==="viewport"){let _=E=>{E.forEach(M=>{c(M.isIntersecting)})},C=new IntersectionObserver(_,{threshold:.5});return x.current&&C.observe(x.current),()=>{C.disconnect()}}},[e]),Y.useEffect(()=>{if(a){let _=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(_)}}},[a]);let v=()=>{u(!0)},w=()=>{u(!1),c(!1)};return i?e!=="intent"?[s,x,{}]:[s,x,{onFocus:ga(f,v),onBlur:ga(h,w),onMouseEnter:ga(d,v),onMouseLeave:ga(g,w),onTouchStart:ga(y,v)}]:[!1,x,{}]}function ga(e,r){return i=>{e&&e(i),i.defaultPrevented||r(i)}}function mS({page:e,...r}){let{router:i}=tp(),a=Y.useMemo(()=>Xr(i.routes,e,i.basename),[i.routes,e,i.basename]);return a?Y.createElement(gS,{page:e,matches:a,...r}):null}function pS(e){let{manifest:r,routeModules:i}=np(),[a,u]=Y.useState([]);return Y.useEffect(()=>{let s=!1;return uS(e,r,i).then(c=>{s||u(c)}),()=>{s=!0}},[e,r,i]),a}function gS({page:e,matches:r,...i}){let a=$r(),{future:u,manifest:s,routeModules:c}=np(),{basename:f}=tp(),{loaderData:h,matches:d}=hS(),g=Y.useMemo(()=>ep(e,r,d,s,a,"data"),[e,r,d,s,a]),y=Y.useMemo(()=>ep(e,r,d,s,a,"assets"),[e,r,d,s,a]),x=Y.useMemo(()=>{if(e===a.pathname+a.search+a.hash)return[];let _=new Set,C=!1;if(r.forEach(M=>{var U;let L=s.routes[M.route.id];!L||!L.hasLoader||(!g.some(V=>V.route.id===M.route.id)&&M.route.id in h&&((U=c[M.route.id])!=null&&U.shouldRevalidate)||L.hasClientLoader?C=!0:_.add(M.route.id))}),_.size===0)return[];let E=iS(e,f,u.unstable_trailingSlashAwareDataRequests,"data");return C&&_.size>0&&E.searchParams.set("_routes",r.filter(M=>_.has(M.route.id)).map(M=>M.route.id).join(",")),[E.pathname+E.search]},[f,u.unstable_trailingSlashAwareDataRequests,h,a,s,g,r,e,c]),v=Y.useMemo(()=>oS(y,s),[y,s]),w=pS(y);return Y.createElement(Y.Fragment,null,x.map(_=>Y.createElement("link",{key:_,rel:"prefetch",as:"fetch",href:_,...i})),v.map(_=>Y.createElement("link",{key:_,rel:"modulepreload",href:_,...i})),w.map(({key:_,link:C})=>Y.createElement("link",{key:_,nonce:i.nonce,...C,crossOrigin:C.crossOrigin??i.crossOrigin})))}function yS(...e){return r=>{e.forEach(i=>{typeof i=="function"?i(r):i!=null&&(i.current=r)})}}var vS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{vS&&(window.__reactRouterVersion="7.13.0")}catch{}function xS(e,r){return Q1({basename:r==null?void 0:r.basename,getContext:r==null?void 0:r.getContext,future:r==null?void 0:r.future,history:o1({window:r==null?void 0:r.window}),hydrationData:bS(),routes:e,mapRouteProperties:Vw,hydrationRouteProperties:Fw,dataStrategy:r==null?void 0:r.dataStrategy,patchRoutesOnNavigation:r==null?void 0:r.patchRoutesOnNavigation,window:r==null?void 0:r.window,unstable_instrumentations:r==null?void 0:r.unstable_instrumentations}).initialize()}function bS(){let e=window==null?void 0:window.__staticRouterHydrationData;return e&&e.errors&&(e={...e,errors:wS(e.errors)}),e}function wS(e){if(!e)return null;let r=Object.entries(e),i={};for(let[a,u]of r)if(u&&u.__type==="RouteErrorResponse")i[a]=new ua(u.status,u.statusText,u.data,u.internal===!0);else if(u&&u.__type==="Error"){if(u.__subType){let s=window[u.__subType];if(typeof s=="function")try{let c=new s(u.message);c.stack="",i[a]=c}catch{}}if(i[a]==null){let s=new Error(u.message);s.stack="",i[a]=s}}else i[a]=u;return i}var rp=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,fn=Y.forwardRef(function({onClick:r,discover:i="render",prefetch:a="none",relative:u,reloadDocument:s,replace:c,state:f,target:h,to:d,preventScrollReset:g,viewTransition:y,unstable_defaultShouldRevalidate:x,...v},w){let{basename:_,unstable_useTransitions:C}=Y.useContext(Tn),E=typeof d=="string"&&rp.test(d),M=dm(d,_);d=M.to;let L=Ew(d,{relative:u}),[U,V,B]=dS(a,v),N=kS(d,{replace:c,state:f,target:h,preventScrollReset:g,relative:u,viewTransition:y,unstable_defaultShouldRevalidate:x,unstable_useTransitions:C});function ee(D){r&&r(D),D.defaultPrevented||N(D)}let G=Y.createElement("a",{...v,...B,href:M.absoluteURL||L,onClick:M.isExternal||s?r:ee,ref:yS(w,V),target:h,"data-discover":!E&&i==="render"?"true":void 0});return U&&!E?Y.createElement(Y.Fragment,null,G,Y.createElement(mS,{page:L})):G});fn.displayName="Link";var mc=Y.forwardRef(function({"aria-current":r="page",caseSensitive:i=!1,className:a="",end:u=!1,style:s,to:c,viewTransition:f,children:h,...d},g){let y=pa(c,{relative:d.relative}),x=$r(),v=Y.useContext(da),{navigator:w,basename:_}=Y.useContext(Tn),C=v!=null&&AS(y)&&f===!0,E=w.encodeLocation?w.encodeLocation(y).pathname:y.pathname,M=x.pathname,L=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;i||(M=M.toLowerCase(),L=L?L.toLowerCase():null,E=E.toLowerCase()),L&&_&&(L=_n(L,_)||L);const U=E!=="/"&&E.endsWith("/")?E.length-1:E.length;let V=M===E||!u&&M.startsWith(E)&&M.charAt(U)==="/",B=L!=null&&(L===E||!u&&L.startsWith(E)&&L.charAt(E.length)==="/"),N={isActive:V,isPending:B,isTransitioning:C},ee=V?r:void 0,G;typeof a=="function"?G=a(N):G=[a,V?"active":null,B?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let D=typeof s=="function"?s(N):s;return Y.createElement(fn,{...d,"aria-current":ee,className:G,ref:g,style:D,to:c,viewTransition:f},typeof h=="function"?h(N):h)});mc.displayName="NavLink";var SS=Y.forwardRef(({discover:e="render",fetcherKey:r,navigate:i,reloadDocument:a,replace:u,state:s,method:c=Bu,action:f,onSubmit:h,relative:d,preventScrollReset:g,viewTransition:y,unstable_defaultShouldRevalidate:x,...v},w)=>{let{unstable_useTransitions:_}=Y.useContext(Tn),C=TS(),E=zS(f,{relative:d}),M=c.toLowerCase()==="get"?"get":"post",L=typeof f=="string"&&rp.test(f),U=V=>{if(h&&h(V),V.defaultPrevented)return;V.preventDefault();let B=V.nativeEvent.submitter,N=(B==null?void 0:B.getAttribute("formmethod"))||c,ee=()=>C(B||V.currentTarget,{fetcherKey:r,method:N,navigate:i,replace:u,state:s,relative:d,preventScrollReset:g,viewTransition:y,unstable_defaultShouldRevalidate:x});_&&i!==!1?Y.startTransition(()=>ee()):ee()};return Y.createElement("form",{ref:w,method:M,action:E,onSubmit:a?h:U,...v,"data-discover":!L&&e==="render"?"true":void 0})});SS.displayName="Form";function ES(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ip(e){let r=Y.useContext(zi);return Be(r,ES(e)),r}function kS(e,{target:r,replace:i,state:a,preventScrollReset:u,relative:s,viewTransition:c,unstable_defaultShouldRevalidate:f,unstable_useTransitions:h}={}){let d=Uu(),g=$r(),y=pa(e,{relative:s});return Y.useCallback(x=>{if(eS(x,r)){x.preventDefault();let v=i!==void 0?i:er(g)===er(y),w=()=>d(e,{replace:v,state:a,preventScrollReset:u,relative:s,viewTransition:c,unstable_defaultShouldRevalidate:f});h?Y.startTransition(()=>w()):w()}},[g,d,y,i,a,r,e,u,s,c,f,h])}var _S=0,CS=()=>`__${String(++_S)}__`;function TS(){let{router:e}=ip("useSubmit"),{basename:r}=Y.useContext(Tn),i=Lw(),a=e.fetch,u=e.navigate;return Y.useCallback(async(s,c={})=>{let{action:f,method:h,encType:d,formData:g,body:y}=rS(s,r);if(c.navigate===!1){let x=c.fetcherKey||CS();await a(x,i,c.action||f,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:g,body:y,formMethod:c.method||h,formEncType:c.encType||d,flushSync:c.flushSync})}else await u(c.action||f,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:g,body:y,formMethod:c.method||h,formEncType:c.encType||d,replace:c.replace,state:c.state,fromRouteId:i,flushSync:c.flushSync,viewTransition:c.viewTransition})},[a,u,r,i])}function zS(e,{relative:r}={}){let{basename:i}=Y.useContext(Tn),a=Y.useContext(qn);Be(a,"useFormAction must be used inside a RouteContext");let[u]=a.matches.slice(-1),s={...pa(e||".",{relative:r})},c=$r();if(e==null){s.search=c.search;let f=new URLSearchParams(s.search),h=f.getAll("index");if(h.some(g=>g==="")){f.delete("index"),h.filter(y=>y).forEach(y=>f.append("index",y));let g=f.toString();s.search=g?`?${g}`:""}}return(!e||e===".")&&u.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),i!=="/"&&(s.pathname=s.pathname==="/"?i:tr([i,s.pathname])),er(s)}function AS(e,{relative:r}={}){let i=Y.useContext(ac);Be(i!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:a}=ip("useViewTransitionState"),u=pa(e,{relative:r});if(!i.isTransitioning)return!1;let s=_n(i.currentLocation.pathname,a)||i.currentLocation.pathname,c=_n(i.nextLocation.pathname,a)||i.nextLocation.pathname;return Nu(u.pathname,c)!=null||Nu(u.pathname,s)!=null}var MS=Pd();function RS(e){return Y.createElement(Gw,{flushSync:MS.flushSync,...e})}const pc="spek:recent-paths",lp=5,ap=Y.createContext(null);function Vu(){try{const e=localStorage.getItem(pc);if(!e)return[];const r=JSON.parse(e);return Array.isArray(r)?r.slice(0,lp):[]}catch{return[]}}function NS(e){const r=Vu().filter(i=>i!==e);r.unshift(e),localStorage.setItem(pc,JSON.stringify(r.slice(0,lp)))}function DS({children:e}){const[r,i]=Y.useState(""),[a,u]=Y.useState(Vu),s=Y.useCallback(h=>{i(h),h&&(NS(h),u(Vu()))},[]),c=Y.useCallback(()=>{i("")},[]),f=Y.useCallback(h=>{const d=Vu().filter(g=>g!==h);localStorage.setItem(pc,JSON.stringify(d)),u(d)},[]);return k.jsx(ap.Provider,{value:{repoPath:r,setRepoPath:s,recentPaths:a,clearRepoPath:c,removePath:f},children:e})}function Yn(){const e=Y.useContext(ap);if(!e)throw new Error("useRepo must be used within RepoProvider");return e}const up="spek:theme",op=Y.createContext(null);function OS(){try{const e=localStorage.getItem(up);if(e==="dark"||e==="light")return e}catch{}return window.matchMedia("(prefers-color-scheme: light)").matches?"light":"dark"}function jS({children:e}){const[r,i]=Y.useState(OS);Y.useEffect(()=>{document.documentElement.setAttribute("data-theme",r)},[r]);const a=Y.useCallback(()=>{i(u=>{const s=u==="dark"?"light":"dark";try{localStorage.setItem(up,s)}catch{}return s})},[]);return k.jsx(op.Provider,{value:{theme:r,toggleTheme:a},children:k.jsx(LS.Provider,{value:{setTheme:i},children:e})})}function sp(){const e=Y.useContext(op);if(!e)throw new Error("useTheme must be used within ThemeProvider");return e}const LS=Y.createContext(null),cp=Y.createContext(null);function US({adapter:e,children:r}){return k.jsx(cp.Provider,{value:e,children:r})}function mr(){const e=Y.useContext(cp);if(!e)throw new Error("useApiAdapter must be used within ApiAdapterProvider");return e}class BS{constructor(){Zb(this,"data");if(this.data=window.__DEMO_DATA__,!this.data)throw new Error("Demo data not found. Ensure __DEMO_DATA__ is set.")}getOverview(){return Promise.resolve(this.data.overview)}getSpecs(){return Promise.resolve(this.data.specs)}getSpec(r){const i=this.data.specDetails[r];return i?Promise.resolve(i):Promise.reject(new Error(`Spec not found: ${r}`))}getSpecAtChange(r,i){var s;const a=(s=this.data.specVersions)==null?void 0:s[r],u=a==null?void 0:a[i];return u===void 0?Promise.reject(new Error(`Spec version not found: ${r}@${i}`)):Promise.resolve({content:u})}getChanges(){return Promise.resolve(this.data.changes)}getChange(r){const i=this.data.changeDetails[r];return i?Promise.resolve(i):Promise.reject(new Error(`Change not found: ${r}`))}search(r){const i=r.toLowerCase(),a=[];for(const[u,s]of Object.entries(this.data.specDetails))if(s.content.toLowerCase().includes(i)||u.toLowerCase().includes(i)){const c=s.content.toLowerCase().indexOf(i),f=Math.max(0,c-60),h=Math.min(s.content.length,c+r.length+60),d=(f>0?"...":"")+s.content.slice(f,h)+(h<s.content.length?"...":"");a.push({type:"spec",title:u,topic:u,context:d})}for(const[u,s]of Object.entries(this.data.changeDetails)){const f=[s.proposal,s.design].filter(Boolean).join(`
`);if(f.toLowerCase().includes(i)||u.toLowerCase().includes(i)){const h=f.toLowerCase().indexOf(i),d=Math.max(0,h-60),g=Math.min(f.length,h+r.length+60),y=h>=0?(d>0?"...":"")+f.slice(d,g)+(g<f.length?"...":""):u;a.push({type:"change",title:u,slug:u,context:y})}}return Promise.resolve(a)}browse(){return Promise.resolve({path:"/",entries:[]})}detect(){return Promise.resolve({hasOpenSpec:!0})}async resync(){}getGraphData(){return Promise.resolve(this.data.graphData)}}const fp=Y.createContext({refreshKey:0,refresh:()=>{}});function HS(){return Y.useContext(fp).refreshKey}function qS(){return Y.useContext(fp).refresh}function YS(){const{repoPath:e}=Yn(),r=qS();Y.useEffect(()=>{if(window.__DEMO_DATA__)return;if(window.__vscodeApi){const u=s=>{var c;((c=s.data)==null?void 0:c.type)==="fileChanged"&&r()};return window.addEventListener("message",u),()=>window.removeEventListener("message",u)}if(!e)return;const i=`/api/openspec/watch?dir=${encodeURIComponent(e)}`,a=new EventSource(i);return a.onmessage=()=>{r()},()=>{a.close()}},[e,r])}function Ai(e,r){const i=HS(),[a,u]=Y.useState({data:null,loading:!!e,error:null});Y.useRef(!1);const s=Y.useRef(i);return Y.useEffect(()=>{const c=s.current!==i;if(s.current=i,!e){u({data:null,loading:!1,error:null});return}let f=!1;const h=()=>{c||u({data:null,loading:!0,error:null}),e().then(d=>{f||u({data:d,loading:!1,error:null})}).catch(d=>{f||u(g=>({data:c?g.data:null,loading:!1,error:c&&g.data?null:d.message}))})};if(c){const d=setTimeout(h,300);return()=>{f=!0,clearTimeout(d)}}return h(),()=>{f=!0}},[...r,i]),a}function VS(){const{repoPath:e}=Yn(),r=mr();return Ai(e?()=>r.getOverview():null,[e])}function hp(){const{repoPath:e}=Yn(),r=mr();return Ai(e?()=>r.getSpecs():null,[e])}function FS(e){const{repoPath:r}=Yn(),i=mr();return Ai(r&&e?()=>i.getSpec(e):null,[r,e])}function XS(e,r){const{repoPath:i}=Yn(),a=mr();return Ai(i&&e&&r?()=>a.getSpecAtChange(e,r):null,[i,e,r])}function dp(){const{repoPath:e}=Yn(),r=mr();return Ai(e?()=>r.getChanges():null,[e])}function GS(e){const{repoPath:r}=Yn(),i=mr();return Ai(r&&e?()=>i.getChange(e):null,[r,e])}function QS(){const{repoPath:e}=Yn(),r=mr(),[i,a]=Y.useState(!1);return{resync:Y.useCallback(async()=>{if(!(!e||i)){a(!0);try{await r.resync()}finally{a(!1)}}},[e,i,r]),loading:i}}function $S(){const{repoPath:e}=Yn(),r=mr();return Ai(e?()=>r.getGraphData():null,[e])}const mp=[{to:"/dashboard",label:"Overview",icon:k.jsx("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5a1 1 0 011-1h4a1 1 0 011 1v5a1 1 0 01-1 1H5a1 1 0 01-1-1V5zm10 0a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zm-10 9a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-3zm10-2a1 1 0 011-1h4a1 1 0 011 1v5a1 1 0 01-1 1h-4a1 1 0 01-1-1v-5z"})})},{to:"/specs",label:"Specs",icon:k.jsx("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})},{to:"/changes",label:"Changes",icon:k.jsx("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})},{to:"/graph",label:"Graph",icon:k.jsx("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})}];function pp({collapsed:e}){const{resync:r,loading:i}=QS();return k.jsxs("button",{onClick:r,disabled:i,className:`w-full flex items-center gap-2 rounded text-sm text-text-secondary hover:text-text-primary hover:bg-bg-tertiary transition-colors disabled:opacity-50 cursor-pointer disabled:cursor-not-allowed ${e?"justify-center px-2 py-2":"px-3 py-2"}`,title:"Resync git timestamps",children:[k.jsx("svg",{className:`w-4 h-4 shrink-0 ${i?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),!e&&(i?"Syncing...":"Resync")]})}function IS({collapsed:e,onToggle:r}){return k.jsxs("button",{onClick:r,className:`w-full flex items-center gap-2 rounded text-sm text-text-secondary hover:text-text-primary hover:bg-bg-tertiary transition-colors cursor-pointer ${e?"justify-center px-2 py-2":"px-3 py-2"}`,title:e?"Expand sidebar":"Collapse sidebar",children:[k.jsx("svg",{className:"w-4 h-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e?k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"}):k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7M19 19l-7-7 7-7"})}),!e&&(e?"Expand":"Collapse")]})}function ZS({open:e,isMobile:r,collapsed:i,onClose:a,onToggle:u}){const s=$r();return Y.useEffect(()=>{r&&a()},[s.pathname]),r?e?k.jsxs(k.Fragment,{children:[k.jsx("div",{className:"fixed inset-0 bg-black/50 z-20",onClick:a}),k.jsxs("aside",{className:"fixed top-14 left-0 bottom-0 w-60 bg-bg-secondary border-r border-border overflow-y-auto z-30 flex flex-col",children:[k.jsx("nav",{className:"p-4 space-y-1 flex-1",children:mp.map(c=>k.jsxs(mc,{to:c.to,className:({isActive:f})=>`flex items-center gap-2 px-3 py-2 rounded text-sm transition-colors ${f?"bg-accent/10 text-accent font-medium":"text-text-secondary hover:text-text-primary hover:bg-bg-tertiary"}`,children:[c.icon,c.label]},c.to))}),k.jsx("div",{className:"p-4 border-t border-border",children:k.jsx(pp,{collapsed:!1})})]})]}):null:k.jsxs("aside",{className:`fixed top-14 left-0 bottom-0 bg-bg-secondary border-r border-border overflow-y-auto flex flex-col transition-all duration-200 ${i?"w-14":"w-60"}`,children:[k.jsx("nav",{className:`flex-1 space-y-1 ${i?"p-2":"p-4"}`,children:mp.map(c=>k.jsxs(mc,{to:c.to,title:i?c.label:void 0,className:({isActive:f})=>`flex items-center gap-2 rounded text-sm transition-colors ${i?"justify-center px-2 py-2":"px-3 py-2"} ${f?"bg-accent/10 text-accent font-medium":"text-text-secondary hover:text-text-primary hover:bg-bg-tertiary"}`,children:[c.icon,!i&&c.label]},c.to))}),k.jsxs("div",{className:`border-t border-border space-y-1 ${i?"p-2":"p-4"}`,children:[k.jsx(IS,{collapsed:i,onToggle:u}),k.jsx(pp,{collapsed:i})]})]})}function KS(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function gp({text:e,query:r}){if(!e||!r.trim())return k.jsx(k.Fragment,{children:e??""});const i=KS(r.trim()),a=e.split(new RegExp(`(${i})`,"gi"));return k.jsx(k.Fragment,{children:a.map((u,s)=>u.toLowerCase()===r.trim().toLowerCase()?k.jsx("mark",{className:"bg-accent/20 text-accent rounded px-0.5",children:u},s):k.jsx("span",{children:u},s))})}function PS(e){const r=mr(),[i,a]=Y.useState([]),[u,s]=Y.useState(!1);return Y.useEffect(()=>{if(!e.trim()){a([]),s(!1);return}s(!0);const c=setTimeout(()=>{r.search(e.trim()).then(f=>{a(f),s(!1)}).catch(()=>{a([]),s(!1)})},300);return()=>clearTimeout(c)},[e,r]),{results:i,loading:u}}function JS({open:e,onClose:r}){const[i,a]=Y.useState(""),[u,s]=Y.useState(0),[c,f]=Y.useState("all"),h=Y.useRef(null),d=Uu(),{results:g,loading:y}=PS(i),x=g.filter(V=>V.type==="spec"),v=g.filter(V=>V.type==="change"),w=c==="change"?[]:x,_=c==="spec"?[]:v,C=Y.useMemo(()=>[...w,..._],[w,_]);Y.useEffect(()=>{e&&(a(""),s(0),f("all"),setTimeout(()=>{var V;return(V=h.current)==null?void 0:V.focus()},0))},[e]),Y.useEffect(()=>{s(0)},[g,c]);const E=Y.useCallback(V=>{const B=V.type==="spec"?`/specs/${encodeURIComponent(V.topic??V.title)}`:`/changes/${encodeURIComponent(V.slug??V.title)}`;d(B),r()},[d,r]),M=Y.useCallback(V=>{V.key==="ArrowDown"?(V.preventDefault(),s(B=>Math.min(B+1,C.length-1))):V.key==="ArrowUp"?(V.preventDefault(),s(B=>Math.max(B-1,0))):V.key==="Enter"?(V.preventDefault(),C[u]&&E(C[u])):V.key==="Escape"&&(V.preventDefault(),r())},[C,u,E,r]);if(!e)return null;let L=0;const U=[{label:"All",value:"all"},{label:"Specs",value:"spec"},{label:"Changes",value:"change"}];return k.jsxs("div",{className:"fixed inset-0 z-50 flex items-start justify-center pt-[20vh]",children:[k.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:r}),k.jsxs("div",{className:"relative w-full max-w-xl bg-bg-secondary border border-border rounded-lg shadow-2xl overflow-hidden",children:[k.jsxs("div",{className:"flex items-center border-b border-border px-4",children:[k.jsx("svg",{className:"w-5 h-5 text-text-muted shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),k.jsx("input",{ref:h,type:"text",value:i,onChange:V=>a(V.target.value),onKeyDown:M,placeholder:"Search specs and changes...",className:"flex-1 bg-transparent text-text-primary px-3 py-3 text-sm outline-none placeholder:text-text-muted"}),k.jsx("kbd",{className:"text-xs text-text-muted bg-bg-tertiary px-1.5 py-0.5 rounded border border-border",children:"ESC"})]}),i.trim()&&!y&&g.length>0&&k.jsx("div",{className:"flex gap-1 px-4 pt-2",children:U.map(V=>k.jsx("button",{onClick:()=>f(V.value),className:`px-2.5 py-0.5 text-xs rounded-full transition-colors cursor-pointer ${c===V.value?"bg-accent/20 text-accent":"bg-bg-tertiary text-text-muted hover:text-text-secondary"}`,children:V.label},V.value))}),k.jsxs("div",{className:"max-h-80 overflow-y-auto",children:[!i.trim()&&k.jsx("p",{className:"text-text-muted text-sm p-4 text-center",children:"Type to search across specs and changes..."}),i.trim()&&y&&k.jsx("p",{className:"text-text-muted text-sm p-4 text-center",children:"Searching..."}),i.trim()&&!y&&C.length===0&&k.jsxs("div",{className:"text-center p-4",children:[k.jsx("p",{className:"text-text-muted text-sm",children:"No results found"}),k.jsx("p",{className:"text-text-muted text-xs mt-1",children:"Try different keywords or check the spelling"})]}),!y&&w.length>0&&k.jsxs("div",{children:[k.jsx("div",{className:"px-4 pt-3 pb-1 text-xs font-semibold text-text-muted uppercase tracking-wider",children:"Specs"}),w.map(V=>{const B=L++;return k.jsx(yp,{result:V,query:i,selected:B===u,onClick:()=>E(V)},`spec-${V.title}`)})]}),!y&&_.length>0&&k.jsxs("div",{children:[k.jsx("div",{className:"px-4 pt-3 pb-1 text-xs font-semibold text-text-muted uppercase tracking-wider",children:"Changes"}),_.map(V=>{const B=L++;return k.jsx(yp,{result:V,query:i,selected:B===u,onClick:()=>E(V)},`change-${V.title}`)})]})]})]})]})}function yp({result:e,query:r,selected:i,onClick:a}){return k.jsxs("button",{onClick:a,className:`w-full text-left px-4 py-2 cursor-pointer transition-colors ${i?"bg-bg-tertiary":"hover:bg-bg-tertiary/50"}`,children:[k.jsx("div",{className:"text-sm font-medium text-text-primary",children:k.jsx(gp,{text:e.title,query:r})}),e.context&&k.jsx("div",{className:"text-xs text-text-muted mt-0.5 truncate",children:k.jsx(gp,{text:e.context,query:r})})]})}function WS(){const{repoPath:e}=Yn(),{theme:r,toggleTheme:i}=sp();YS();const a=Uu(),[u,s]=Y.useState(!1),[c,f]=Y.useState(!1),[h,d]=Y.useState(!1),[g,y]=Y.useState(()=>{try{return localStorage.getItem("spek-sidebar-collapsed")==="true"}catch{return!1}}),x=Y.useCallback(()=>{y(w=>{const _=!w;try{localStorage.setItem("spek-sidebar-collapsed",String(_))}catch{}return _})},[]);Y.useEffect(()=>{const w=window.matchMedia("(max-width: 767px)");d(w.matches);const _=C=>{d(C.matches),C.matches||f(!1)};return w.addEventListener("change",_),()=>w.removeEventListener("change",_)},[]),Y.useEffect(()=>{e||a("/",{replace:!0})},[e,a]),Y.useEffect(()=>{const w=_=>{(_.metaKey||_.ctrlKey)&&_.key==="k"&&(_.preventDefault(),s(!0))};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[]);const v=Y.useCallback(()=>s(!1),[]);return e?k.jsxs("div",{className:"min-h-screen bg-bg-primary",children:[k.jsxs("header",{className:"fixed top-0 left-0 right-0 h-14 bg-bg-secondary border-b border-border flex items-center px-4 z-10",children:[h&&k.jsx("button",{onClick:()=>f(!c),"aria-label":"Open navigation menu",className:"p-2 mr-2 rounded text-text-secondary hover:text-text-primary hover:bg-bg-tertiary transition-colors cursor-pointer",children:k.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),k.jsxs("span",{className:"text-accent font-bold text-lg flex items-center gap-1.5",children:[k.jsxs("svg",{className:"w-6 h-6",viewBox:"0 0 32 32",fill:"none",children:[k.jsx("path",{d:"M 20 8.5 C 20 8.5, 23 8.5, 23 11.5 C 23 14.5, 20 16, 16 16 C 12 16, 9 17.5, 9 20.5 C 9 23.5, 12 23.5, 12 23.5",stroke:"currentColor",strokeWidth:"3.5",strokeLinecap:"round"}),k.jsx("path",{d:"M 12.8 8.5 L 14.3 7 L 15.8 8.5 L 14.3 10 Z",fill:"currentColor",opacity:"0.9"}),k.jsx("path",{d:"M 16.2 23.5 L 17.7 22 L 19.2 23.5 L 17.7 25 Z",fill:"currentColor",opacity:"0.7"})]}),"spek"]}),k.jsx("div",{className:"flex-1 flex justify-center",children:k.jsxs("button",{onClick:()=>s(!0),className:"px-4 py-1.5 rounded bg-bg-tertiary text-text-muted text-sm hover:text-text-secondary hover:bg-bg-tertiary/80 transition-colors flex items-center gap-2 cursor-pointer",children:[k.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),"Search...",k.jsx("kbd",{className:"text-xs bg-bg-primary/50 px-1.5 py-0.5 rounded border border-border ml-2",children:"⌘K"})]})}),k.jsx("button",{onClick:i,className:"p-2 rounded text-text-secondary hover:text-text-primary hover:bg-bg-tertiary transition-colors cursor-pointer",title:r==="dark"?"Switch to light theme":"Switch to dark theme",children:r==="dark"?k.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):k.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:k.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),!h&&k.jsx("span",{className:"text-text-muted text-sm font-mono truncate max-w-80",title:e,children:e})]}),k.jsx(ZS,{open:c,isMobile:h,collapsed:g,onClose:()=>f(!1),onToggle:x}),k.jsx("main",{className:`pt-18 p-6 transition-all duration-200 ${h?"":g?"ml-14":"ml-60"}`,children:k.jsx(Iw,{})}),k.jsx(JS,{open:u,onClose:v})]}):null}function gc({completed:e,total:r}){if(r===0)return k.jsx("span",{className:"text-text-muted text-sm",children:"No tasks"});const i=Math.round(e/r*100);return k.jsxs("div",{className:"flex items-center gap-3",children:[k.jsx("div",{className:"flex-1 h-2 bg-bg-tertiary rounded-full overflow-hidden",children:k.jsx("div",{className:`h-full rounded-full transition-all ${e===r?"bg-green-500":"bg-accent"}`,style:{width:`${i}%`}})}),k.jsxs("span",{className:"text-text-secondary text-sm whitespace-nowrap",children:[e," / ",r]})]})}const yc=60,vc=60*yc,ya=24*vc,vp=7*ya,xp=30*ya,bp=365*ya;function Fu(e){const r=Date.now(),i=new Date(e).getTime(),a=Math.floor((r-i)/1e3);if(a<0||a<yc)return"just now";if(a<vc)return`${Math.floor(a/yc)} min ago`;if(a<ya){const s=Math.floor(a/vc);return`${s} hour${s>1?"s":""} ago`}if(a<vp){const s=Math.floor(a/ya);return`${s} day${s>1?"s":""} ago`}if(a<xp){const s=Math.floor(a/vp);return`${s} week${s>1?"s":""} ago`}if(a<bp){const s=Math.floor(a/xp);return`${s} month${s>1?"s":""} ago`}const u=Math.floor(a/bp);return`${u} year${u>1?"s":""} ago`}function wp(){var c,f;const e=VS(),r=dp();if(e.loading)return k.jsx("p",{className:"text-text-muted",children:"Loading..."});if(e.error)return k.jsxs("p",{className:"text-red-400",children:["Error: ",e.error]});const i=e.data,a=i.taskStats.total>0?Math.round(i.taskStats.completed/i.taskStats.total*100):0,u=((c=r.data)==null?void 0:c.active)??[],s=(((f=r.data)==null?void 0:f.archived)??[]).slice(0,10);return k.jsxs("div",{className:"space-y-8",children:[k.jsx("h1",{className:"text-2xl font-bold",children:"Overview"}),k.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[k.jsx(Xu,{label:"Specs",value:i.specsCount,delay:0}),k.jsx(Xu,{label:"Active Changes",value:i.changesCount.active,delay:80}),k.jsx(Xu,{label:"Archived Changes",value:i.changesCount.archived,delay:160}),k.jsx(Xu,{label:"Task Completion",value:`${a}%`,delay:240})]}),k.jsxs("section",{children:[k.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Active Changes"}),u.length===0?k.jsx("p",{className:"text-text-muted text-sm",children:"No active changes"}):k.jsx("div",{className:"space-y-2",children:u.map(h=>k.jsxs(fn,{to:`/changes/${h.slug}`,className:"block bg-bg-secondary border border-border rounded p-4 hover:border-accent transition-colors",children:[k.jsxs("div",{className:"flex items-center justify-between mb-2",children:[k.jsx("span",{className:"text-text-primary font-medium",children:h.description}),(h.timestamp||h.date)&&k.jsx("span",{className:"text-text-muted text-xs",title:h.timestamp||void 0,children:h.timestamp?Fu(h.timestamp):h.date})]}),h.taskStats&&k.jsx(gc,{completed:h.taskStats.completed,total:h.taskStats.total})]},h.slug))})]}),k.jsxs("section",{children:[k.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Recently Archived"}),s.length===0?k.jsx("p",{className:"text-text-muted text-sm",children:"No archived changes"}):k.jsx("div",{className:"space-y-1",children:s.map(h=>k.jsxs(fn,{to:`/changes/${h.slug}`,className:"flex items-center justify-between px-3 py-2 rounded hover:bg-bg-secondary transition-colors",children:[k.jsx("span",{className:"text-text-primary text-sm",children:h.description}),(h.timestamp||h.date)&&k.jsx("span",{className:"text-text-muted text-xs",title:h.timestamp||void 0,children:h.timestamp?Fu(h.timestamp):h.date})]},h.slug))})]}),k.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[k.jsxs(fn,{to:"/specs",className:"bg-bg-secondary border border-border rounded p-6 hover:border-accent transition-colors",children:[k.jsx("h3",{className:"font-semibold mb-1",children:"Specs"}),k.jsx("p",{className:"text-text-secondary text-sm",children:"Browse all spec topics"})]}),k.jsxs(fn,{to:"/changes",className:"bg-bg-secondary border border-border rounded p-6 hover:border-accent transition-colors",children:[k.jsx("h3",{className:"font-semibold mb-1",children:"Changes"}),k.jsx("p",{className:"text-text-secondary text-sm",children:"View change timeline"})]})]})]})}function Xu({label:e,value:r,delay:i=0}){return k.jsxs("div",{className:"bg-bg-secondary border border-border rounded p-4 animate-fade-in-up",style:{animationDelay:`${i}ms`},children:[k.jsx("div",{className:"text-4xl font-bold text-accent",children:r}),k.jsx("div",{className:"text-text-secondary text-sm",children:e})]})}function e2(){const{data:e,loading:r,error:i}=hp(),[a,u]=Y.useState("");if(r)return k.jsx("p",{className:"text-text-muted",children:"Loading..."});if(i)return k.jsxs("p",{className:"text-red-400",children:["Error: ",i]});const s=e??[],c=a?s.filter(f=>f.topic.toLowerCase().includes(a.toLowerCase())):s;return k.jsxs("div",{className:"space-y-4",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("h1",{className:"text-2xl font-bold",children:"Specs"}),k.jsxs("span",{className:"text-text-muted text-sm",children:[s.length," topics"]})]}),k.jsx("input",{type:"text",value:a,onChange:f=>u(f.target.value),placeholder:"Filter specs...",className:"w-full bg-bg-tertiary border border-border rounded px-3 py-2 text-sm text-text-primary placeholder:text-text-muted focus:outline-none focus:border-accent"}),k.jsx("div",{className:"space-y-1",children:c.length===0?k.jsx("p",{className:"text-text-muted text-sm",children:"No specs found"}):c.map(f=>k.jsx(fn,{to:`/specs/${f.topic}`,className:"block px-4 py-3 bg-bg-secondary border border-border rounded hover:border-accent transition-colors",children:k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("span",{className:"text-text-primary font-medium",children:f.topic}),f.historyCount>0&&k.jsxs("span",{className:"text-text-muted text-xs",children:[f.historyCount," ",f.historyCount===1?"change":"changes"]})]})},f.topic))})]})}function tN(){}function nN(){}function t2(e,r){const i={};return(e[e.length-1]===""?[...e,""]:e).join((i.padRight?" ":"")+","+(i.padLeft===!1?"":" ")).trim()}const n2=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,r2=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,i2={};function Sp(e,r){return(i2.jsx?r2:n2).test(e)}const l2=/[ \t\n\f\r]/g;function a2(e){return typeof e=="object"?e.type==="text"?Ep(e.value):!1:Ep(e)}function Ep(e){return e.replace(l2,"")===""}class va{constructor(r,i,a){this.normal=i,this.property=r,a&&(this.space=a)}}va.prototype.normal={},va.prototype.property={},va.prototype.space=void 0;function kp(e,r){const i={},a={};for(const u of e)Object.assign(i,u.property),Object.assign(a,u.normal);return new va(i,a,r)}function xc(e){return e.toLowerCase()}class Pt{constructor(r,i){this.attribute=i,this.property=r}}Pt.prototype.attribute="",Pt.prototype.booleanish=!1,Pt.prototype.boolean=!1,Pt.prototype.commaOrSpaceSeparated=!1,Pt.prototype.commaSeparated=!1,Pt.prototype.defined=!1,Pt.prototype.mustUseProperty=!1,Pt.prototype.number=!1,Pt.prototype.overloadedBoolean=!1,Pt.prototype.property="",Pt.prototype.spaceSeparated=!1,Pt.prototype.space=void 0;let u2=0;const Le=Mi(),Ct=Mi(),bc=Mi(),fe=Mi(),ct=Mi(),sl=Mi(),hn=Mi();function Mi(){return 2**++u2}const wc=Object.freeze(Object.defineProperty({__proto__:null,boolean:Le,booleanish:Ct,commaOrSpaceSeparated:hn,commaSeparated:sl,number:fe,overloadedBoolean:bc,spaceSeparated:ct},Symbol.toStringTag,{value:"Module"})),Sc=Object.keys(wc);class Ec extends Pt{constructor(r,i,a,u){let s=-1;if(super(r,i),_p(this,"space",u),typeof a=="number")for(;++s<Sc.length;){const c=Sc[s];_p(this,Sc[s],(a&wc[c])===wc[c])}}}Ec.prototype.defined=!0;function _p(e,r,i){i&&(e[r]=i)}function cl(e){const r={},i={};for(const[a,u]of Object.entries(e.properties)){const s=new Ec(a,e.transform(e.attributes||{},a),u,e.space);e.mustUseProperty&&e.mustUseProperty.includes(a)&&(s.mustUseProperty=!0),r[a]=s,i[xc(a)]=a,i[xc(s.attribute)]=a}return new va(r,i,e.space)}const Cp=cl({properties:{ariaActiveDescendant:null,ariaAtomic:Ct,ariaAutoComplete:null,ariaBusy:Ct,ariaChecked:Ct,ariaColCount:fe,ariaColIndex:fe,ariaColSpan:fe,ariaControls:ct,ariaCurrent:null,ariaDescribedBy:ct,ariaDetails:null,ariaDisabled:Ct,ariaDropEffect:ct,ariaErrorMessage:null,ariaExpanded:Ct,ariaFlowTo:ct,ariaGrabbed:Ct,ariaHasPopup:null,ariaHidden:Ct,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:ct,ariaLevel:fe,ariaLive:null,ariaModal:Ct,ariaMultiLine:Ct,ariaMultiSelectable:Ct,ariaOrientation:null,ariaOwns:ct,ariaPlaceholder:null,ariaPosInSet:fe,ariaPressed:Ct,ariaReadOnly:Ct,ariaRelevant:null,ariaRequired:Ct,ariaRoleDescription:ct,ariaRowCount:fe,ariaRowIndex:fe,ariaRowSpan:fe,ariaSelected:Ct,ariaSetSize:fe,ariaSort:null,ariaValueMax:fe,ariaValueMin:fe,ariaValueNow:fe,ariaValueText:null,role:null},transform(e,r){return r==="role"?r:"aria-"+r.slice(4).toLowerCase()}});function Tp(e,r){return r in e?e[r]:r}function zp(e,r){return Tp(e,r.toLowerCase())}const o2=cl({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:sl,acceptCharset:ct,accessKey:ct,action:null,allow:null,allowFullScreen:Le,allowPaymentRequest:Le,allowUserMedia:Le,alt:null,as:null,async:Le,autoCapitalize:null,autoComplete:ct,autoFocus:Le,autoPlay:Le,blocking:ct,capture:null,charSet:null,checked:Le,cite:null,className:ct,cols:fe,colSpan:null,content:null,contentEditable:Ct,controls:Le,controlsList:ct,coords:fe|sl,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Le,defer:Le,dir:null,dirName:null,disabled:Le,download:bc,draggable:Ct,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Le,formTarget:null,headers:ct,height:fe,hidden:bc,high:fe,href:null,hrefLang:null,htmlFor:ct,httpEquiv:ct,id:null,imageSizes:null,imageSrcSet:null,inert:Le,inputMode:null,integrity:null,is:null,isMap:Le,itemId:null,itemProp:ct,itemRef:ct,itemScope:Le,itemType:ct,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Le,low:fe,manifest:null,max:null,maxLength:fe,media:null,method:null,min:null,minLength:fe,multiple:Le,muted:Le,name:null,nonce:null,noModule:Le,noValidate:Le,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Le,optimum:fe,pattern:null,ping:ct,placeholder:null,playsInline:Le,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Le,referrerPolicy:null,rel:ct,required:Le,reversed:Le,rows:fe,rowSpan:fe,sandbox:ct,scope:null,scoped:Le,seamless:Le,selected:Le,shadowRootClonable:Le,shadowRootDelegatesFocus:Le,shadowRootMode:null,shape:null,size:fe,sizes:null,slot:null,span:fe,spellCheck:Ct,src:null,srcDoc:null,srcLang:null,srcSet:null,start:fe,step:null,style:null,tabIndex:fe,target:null,title:null,translate:null,type:null,typeMustMatch:Le,useMap:null,value:Ct,width:fe,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:ct,axis:null,background:null,bgColor:null,border:fe,borderColor:null,bottomMargin:fe,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Le,declare:Le,event:null,face:null,frame:null,frameBorder:null,hSpace:fe,leftMargin:fe,link:null,longDesc:null,lowSrc:null,marginHeight:fe,marginWidth:fe,noResize:Le,noHref:Le,noShade:Le,noWrap:Le,object:null,profile:null,prompt:null,rev:null,rightMargin:fe,rules:null,scheme:null,scrolling:Ct,standby:null,summary:null,text:null,topMargin:fe,valueType:null,version:null,vAlign:null,vLink:null,vSpace:fe,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Le,disableRemotePlayback:Le,prefix:null,property:null,results:fe,security:null,unselectable:null},space:"html",transform:zp}),s2=cl({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:hn,accentHeight:fe,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:fe,amplitude:fe,arabicForm:null,ascent:fe,attributeName:null,attributeType:null,azimuth:fe,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:fe,by:null,calcMode:null,capHeight:fe,className:ct,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:fe,diffuseConstant:fe,direction:null,display:null,dur:null,divisor:fe,dominantBaseline:null,download:Le,dx:null,dy:null,edgeMode:null,editable:null,elevation:fe,enableBackground:null,end:null,event:null,exponent:fe,externalResourcesRequired:null,fill:null,fillOpacity:fe,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:sl,g2:sl,glyphName:sl,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:fe,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:fe,horizOriginX:fe,horizOriginY:fe,id:null,ideographic:fe,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:fe,k:fe,k1:fe,k2:fe,k3:fe,k4:fe,kernelMatrix:hn,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:fe,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:fe,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:fe,overlineThickness:fe,paintOrder:null,panose1:null,path:null,pathLength:fe,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:ct,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:fe,pointsAtY:fe,pointsAtZ:fe,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:hn,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:hn,rev:hn,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:hn,requiredFeatures:hn,requiredFonts:hn,requiredFormats:hn,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:fe,specularExponent:fe,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:fe,strikethroughThickness:fe,string:null,stroke:null,strokeDashArray:hn,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:fe,strokeOpacity:fe,strokeWidth:null,style:null,surfaceScale:fe,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:hn,tabIndex:fe,tableValues:null,target:null,targetX:fe,targetY:fe,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:hn,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:fe,underlineThickness:fe,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:fe,values:null,vAlphabetic:fe,vMathematical:fe,vectorEffect:null,vHanging:fe,vIdeographic:fe,version:null,vertAdvY:fe,vertOriginX:fe,vertOriginY:fe,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:fe,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Tp}),Ap=cl({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,r){return"xlink:"+r.slice(5).toLowerCase()}}),Mp=cl({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:zp}),Rp=cl({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,r){return"xml:"+r.slice(3).toLowerCase()}}),c2={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},f2=/[A-Z]/g,Np=/-[a-z]/g,h2=/^data[-\w.:]+$/i;function d2(e,r){const i=xc(r);let a=r,u=Pt;if(i in e.normal)return e.property[e.normal[i]];if(i.length>4&&i.slice(0,4)==="data"&&h2.test(r)){if(r.charAt(4)==="-"){const s=r.slice(5).replace(Np,p2);a="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=r.slice(4);if(!Np.test(s)){let c=s.replace(f2,m2);c.charAt(0)!=="-"&&(c="-"+c),r="data"+c}}u=Ec}return new u(a,r)}function m2(e){return"-"+e.toLowerCase()}function p2(e){return e.charAt(1).toUpperCase()}const g2=kp([Cp,o2,Ap,Mp,Rp],"html"),kc=kp([Cp,s2,Ap,Mp,Rp],"svg");function y2(e){return e.join(" ").trim()}var fl={},_c,Dp;function v2(){if(Dp)return _c;Dp=1;var e=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,r=/\n/g,i=/^\s*/,a=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,u=/^:\s*/,s=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,c=/^[;\s]*/,f=/^\s+|\s+$/g,h=`
`,d="/",g="*",y="",x="comment",v="declaration";function w(C,E){if(typeof C!="string")throw new TypeError("First argument must be a string");if(!C)return[];E=E||{};var M=1,L=1;function U(H){var I=H.match(r);I&&(M+=I.length);var A=H.lastIndexOf(h);L=~A?H.length-A:L+H.length}function V(){var H={line:M,column:L};return function(I){return I.position=new B(H),G(),I}}function B(H){this.start=H,this.end={line:M,column:L},this.source=E.source}B.prototype.content=C;function N(H){var I=new Error(E.source+":"+M+":"+L+": "+H);if(I.reason=H,I.filename=E.source,I.line=M,I.column=L,I.source=C,!E.silent)throw I}function ee(H){var I=H.exec(C);if(I){var A=I[0];return U(A),C=C.slice(A.length),I}}function G(){ee(i)}function D(H){var I;for(H=H||[];I=ne();)I!==!1&&H.push(I);return H}function ne(){var H=V();if(!(d!=C.charAt(0)||g!=C.charAt(1))){for(var I=2;y!=C.charAt(I)&&(g!=C.charAt(I)||d!=C.charAt(I+1));)++I;if(I+=2,y===C.charAt(I-1))return N("End of comment missing");var A=C.slice(2,I-2);return L+=2,U(A),C=C.slice(I),L+=2,H({type:x,comment:A})}}function ae(){var H=V(),I=ee(a);if(I){if(ne(),!ee(u))return N("property missing ':'");var A=ee(s),Q=H({type:v,property:_(I[0].replace(e,y)),value:A?_(A[0].replace(e,y)):y});return ee(c),Q}}function ve(){var H=[];D(H);for(var I;I=ae();)I!==!1&&(H.push(I),D(H));return H}return G(),ve()}function _(C){return C?C.replace(f,y):y}return _c=w,_c}var Op;function x2(){if(Op)return fl;Op=1;var e=fl&&fl.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(fl,"__esModule",{value:!0}),fl.default=i;const r=e(v2());function i(a,u){let s=null;if(!a||typeof a!="string")return s;const c=(0,r.default)(a),f=typeof u=="function";return c.forEach(h=>{if(h.type!=="declaration")return;const{property:d,value:g}=h;f?u(d,g,h):g&&(s=s||{},s[d]=g)}),s}return fl}var xa={},jp;function b2(){if(jp)return xa;jp=1,Object.defineProperty(xa,"__esModule",{value:!0}),xa.camelCase=void 0;var e=/^--[a-zA-Z0-9_-]+$/,r=/-([a-z])/g,i=/^[^-]+$/,a=/^-(webkit|moz|ms|o|khtml)-/,u=/^-(ms)-/,s=function(d){return!d||i.test(d)||e.test(d)},c=function(d,g){return g.toUpperCase()},f=function(d,g){return"".concat(g,"-")},h=function(d,g){return g===void 0&&(g={}),s(d)?d:(d=d.toLowerCase(),g.reactCompat?d=d.replace(u,f):d=d.replace(a,f),d.replace(r,c))};return xa.camelCase=h,xa}var ba,Lp;function w2(){if(Lp)return ba;Lp=1;var e=ba&&ba.__importDefault||function(u){return u&&u.__esModule?u:{default:u}},r=e(x2()),i=b2();function a(u,s){var c={};return!u||typeof u!="string"||(0,r.default)(u,function(f,h){f&&h&&(c[(0,i.camelCase)(f,s)]=h)}),c}return a.default=a,ba=a,ba}var S2=w2();const E2=Fr(S2),Up=Bp("end"),Cc=Bp("start");function Bp(e){return r;function r(i){const a=i&&i.position&&i.position[e]||{};if(typeof a.line=="number"&&a.line>0&&typeof a.column=="number"&&a.column>0)return{line:a.line,column:a.column,offset:typeof a.offset=="number"&&a.offset>-1?a.offset:void 0}}}function k2(e){const r=Cc(e),i=Up(e);if(r&&i)return{start:r,end:i}}function wa(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?Hp(e.position):"start"in e||"end"in e?Hp(e):"line"in e||"column"in e?Tc(e):""}function Tc(e){return qp(e&&e.line)+":"+qp(e&&e.column)}function Hp(e){return Tc(e&&e.start)+"-"+Tc(e&&e.end)}function qp(e){return e&&typeof e=="number"?e:1}class Ft extends Error{constructor(r,i,a){super(),typeof i=="string"&&(a=i,i=void 0);let u="",s={},c=!1;if(i&&("line"in i&&"column"in i?s={place:i}:"start"in i&&"end"in i?s={place:i}:"type"in i?s={ancestors:[i],place:i.position}:s={...i}),typeof r=="string"?u=r:!s.cause&&r&&(c=!0,u=r.message,s.cause=r),!s.ruleId&&!s.source&&typeof a=="string"){const h=a.indexOf(":");h===-1?s.ruleId=a:(s.source=a.slice(0,h),s.ruleId=a.slice(h+1))}if(!s.place&&s.ancestors&&s.ancestors){const h=s.ancestors[s.ancestors.length-1];h&&(s.place=h.position)}const f=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=f?f.column:void 0,this.fatal=void 0,this.file="",this.message=u,this.line=f?f.line:void 0,this.name=wa(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=c&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ft.prototype.file="",Ft.prototype.name="",Ft.prototype.reason="",Ft.prototype.message="",Ft.prototype.stack="",Ft.prototype.column=void 0,Ft.prototype.line=void 0,Ft.prototype.ancestors=void 0,Ft.prototype.cause=void 0,Ft.prototype.fatal=void 0,Ft.prototype.place=void 0,Ft.prototype.ruleId=void 0,Ft.prototype.source=void 0;const zc={}.hasOwnProperty,_2=new Map,C2=/[A-Z]/g,T2=new Set(["table","tbody","thead","tfoot","tr"]),z2=new Set(["td","th"]),Yp="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function A2(e,r){if(!r||r.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const i=r.filePath||void 0;let a;if(r.development){if(typeof r.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");a=U2(i,r.jsxDEV)}else{if(typeof r.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof r.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");a=L2(i,r.jsx,r.jsxs)}const u={Fragment:r.Fragment,ancestors:[],components:r.components||{},create:a,elementAttributeNameCase:r.elementAttributeNameCase||"react",evaluater:r.createEvaluater?r.createEvaluater():void 0,filePath:i,ignoreInvalidStyle:r.ignoreInvalidStyle||!1,passKeys:r.passKeys!==!1,passNode:r.passNode||!1,schema:r.space==="svg"?kc:g2,stylePropertyNameCase:r.stylePropertyNameCase||"dom",tableCellAlignToStyle:r.tableCellAlignToStyle!==!1},s=Vp(u,e,void 0);return s&&typeof s!="string"?s:u.create(e,u.Fragment,{children:s||void 0},void 0)}function Vp(e,r,i){if(r.type==="element")return M2(e,r,i);if(r.type==="mdxFlowExpression"||r.type==="mdxTextExpression")return R2(e,r);if(r.type==="mdxJsxFlowElement"||r.type==="mdxJsxTextElement")return D2(e,r,i);if(r.type==="mdxjsEsm")return N2(e,r);if(r.type==="root")return O2(e,r,i);if(r.type==="text")return j2(e,r)}function M2(e,r,i){const a=e.schema;let u=a;r.tagName.toLowerCase()==="svg"&&a.space==="html"&&(u=kc,e.schema=u),e.ancestors.push(r);const s=Xp(e,r.tagName,!1),c=B2(e,r);let f=Mc(e,r);return T2.has(r.tagName)&&(f=f.filter(function(h){return typeof h=="string"?!a2(h):!0})),Fp(e,c,s,r),Ac(c,f),e.ancestors.pop(),e.schema=a,e.create(r,s,c,i)}function R2(e,r){if(r.data&&r.data.estree&&e.evaluater){const a=r.data.estree.body[0];return a.type,e.evaluater.evaluateExpression(a.expression)}Sa(e,r.position)}function N2(e,r){if(r.data&&r.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(r.data.estree);Sa(e,r.position)}function D2(e,r,i){const a=e.schema;let u=a;r.name==="svg"&&a.space==="html"&&(u=kc,e.schema=u),e.ancestors.push(r);const s=r.name===null?e.Fragment:Xp(e,r.name,!0),c=H2(e,r),f=Mc(e,r);return Fp(e,c,s,r),Ac(c,f),e.ancestors.pop(),e.schema=a,e.create(r,s,c,i)}function O2(e,r,i){const a={};return Ac(a,Mc(e,r)),e.create(r,e.Fragment,a,i)}function j2(e,r){return r.value}function Fp(e,r,i,a){typeof i!="string"&&i!==e.Fragment&&e.passNode&&(r.node=a)}function Ac(e,r){if(r.length>0){const i=r.length>1?r:r[0];i&&(e.children=i)}}function L2(e,r,i){return a;function a(u,s,c,f){const d=Array.isArray(c.children)?i:r;return f?d(s,c,f):d(s,c)}}function U2(e,r){return i;function i(a,u,s,c){const f=Array.isArray(s.children),h=Cc(a);return r(u,s,c,f,{columnNumber:h?h.column-1:void 0,fileName:e,lineNumber:h?h.line:void 0},void 0)}}function B2(e,r){const i={};let a,u;for(u in r.properties)if(u!=="children"&&zc.call(r.properties,u)){const s=q2(e,u,r.properties[u]);if(s){const[c,f]=s;e.tableCellAlignToStyle&&c==="align"&&typeof f=="string"&&z2.has(r.tagName)?a=f:i[c]=f}}if(a){const s=i.style||(i.style={});s[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=a}return i}function H2(e,r){const i={};for(const a of r.attributes)if(a.type==="mdxJsxExpressionAttribute")if(a.data&&a.data.estree&&e.evaluater){const s=a.data.estree.body[0];s.type;const c=s.expression;c.type;const f=c.properties[0];f.type,Object.assign(i,e.evaluater.evaluateExpression(f.argument))}else Sa(e,r.position);else{const u=a.name;let s;if(a.value&&typeof a.value=="object")if(a.value.data&&a.value.data.estree&&e.evaluater){const f=a.value.data.estree.body[0];f.type,s=e.evaluater.evaluateExpression(f.expression)}else Sa(e,r.position);else s=a.value===null?!0:a.value;i[u]=s}return i}function Mc(e,r){const i=[];let a=-1;const u=e.passKeys?new Map:_2;for(;++a<r.children.length;){const s=r.children[a];let c;if(e.passKeys){const h=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(h){const d=u.get(h)||0;c=h+"-"+d,u.set(h,d+1)}}const f=Vp(e,s,c);f!==void 0&&i.push(f)}return i}function q2(e,r,i){const a=d2(e.schema,r);if(!(i==null||typeof i=="number"&&Number.isNaN(i))){if(Array.isArray(i)&&(i=a.commaSeparated?t2(i):y2(i)),a.property==="style"){let u=typeof i=="object"?i:Y2(e,String(i));return e.stylePropertyNameCase==="css"&&(u=V2(u)),["style",u]}return[e.elementAttributeNameCase==="react"&&a.space?c2[a.property]||a.property:a.attribute,i]}}function Y2(e,r){try{return E2(r,{reactCompat:!0})}catch(i){if(e.ignoreInvalidStyle)return{};const a=i,u=new Ft("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:a,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw u.file=e.filePath||void 0,u.url=Yp+"#cannot-parse-style-attribute",u}}function Xp(e,r,i){let a;if(!i)a={type:"Literal",value:r};else if(r.includes(".")){const u=r.split(".");let s=-1,c;for(;++s<u.length;){const f=Sp(u[s])?{type:"Identifier",name:u[s]}:{type:"Literal",value:u[s]};c=c?{type:"MemberExpression",object:c,property:f,computed:!!(s&&f.type==="Literal"),optional:!1}:f}a=c}else a=Sp(r)&&!/^[a-z]/.test(r)?{type:"Identifier",name:r}:{type:"Literal",value:r};if(a.type==="Literal"){const u=a.value;return zc.call(e.components,u)?e.components[u]:u}if(e.evaluater)return e.evaluater.evaluateExpression(a);Sa(e)}function Sa(e,r){const i=new Ft("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:r,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw i.file=e.filePath||void 0,i.url=Yp+"#cannot-handle-mdx-estrees-without-createevaluater",i}function V2(e){const r={};let i;for(i in e)zc.call(e,i)&&(r[F2(i)]=e[i]);return r}function F2(e){let r=e.replace(C2,X2);return r.slice(0,3)==="ms-"&&(r="-"+r),r}function X2(e){return"-"+e.toLowerCase()}const Rc={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},G2={};function Nc(e,r){const i=G2,a=typeof i.includeImageAlt=="boolean"?i.includeImageAlt:!0,u=typeof i.includeHtml=="boolean"?i.includeHtml:!0;return Gp(e,a,u)}function Gp(e,r,i){if(Q2(e)){if("value"in e)return e.type==="html"&&!i?"":e.value;if(r&&"alt"in e&&e.alt)return e.alt;if("children"in e)return Qp(e.children,r,i)}return Array.isArray(e)?Qp(e,r,i):""}function Qp(e,r,i){const a=[];let u=-1;for(;++u<e.length;)a[u]=Gp(e[u],r,i);return a.join("")}function Q2(e){return!!(e&&typeof e=="object")}const $p=document.createElement("i");function Dc(e){const r="&"+e+";";$p.innerHTML=r;const i=$p.textContent;return i.charCodeAt(i.length-1)===59&&e!=="semi"||i===r?!1:i}function dn(e,r,i,a){const u=e.length;let s=0,c;if(r<0?r=-r>u?0:u+r:r=r>u?u:r,i=i>0?i:0,a.length<1e4)c=Array.from(a),c.unshift(r,i),e.splice(...c);else for(i&&e.splice(r,i);s<a.length;)c=a.slice(s,s+1e4),c.unshift(r,0),e.splice(...c),s+=1e4,r+=1e4}function zn(e,r){return e.length>0?(dn(e,e.length,0,r),e):r}const Ip={}.hasOwnProperty;function Zp(e){const r={};let i=-1;for(;++i<e.length;)$2(r,e[i]);return r}function $2(e,r){let i;for(i in r){const u=(Ip.call(e,i)?e[i]:void 0)||(e[i]={}),s=r[i];let c;if(s)for(c in s){Ip.call(u,c)||(u[c]=[]);const f=s[c];I2(u[c],Array.isArray(f)?f:f?[f]:[])}}}function I2(e,r){let i=-1;const a=[];for(;++i<r.length;)(r[i].add==="after"?e:a).push(r[i]);dn(e,0,0,a)}function Kp(e,r){const i=Number.parseInt(e,r);return i<9||i===11||i>13&&i<32||i>126&&i<160||i>55295&&i<57344||i>64975&&i<65008||(i&65535)===65535||(i&65535)===65534||i>1114111?"�":String.fromCodePoint(i)}function Vn(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Gt=Ir(/[A-Za-z]/),Xt=Ir(/[\dA-Za-z]/),Z2=Ir(/[#-'*+\--9=?A-Z^-~]/);function Gu(e){return e!==null&&(e<32||e===127)}const Oc=Ir(/\d/),K2=Ir(/[\dA-Fa-f]/),P2=Ir(/[!-/:-@[-`{-~]/);function ze(e){return e!==null&&e<-2}function ot(e){return e!==null&&(e<0||e===32)}function He(e){return e===-2||e===-1||e===32}const Qu=Ir(new RegExp("\\p{P}|\\p{S}","u")),Ri=Ir(/\s/);function Ir(e){return r;function r(i){return i!==null&&i>-1&&e.test(String.fromCharCode(i))}}function hl(e){const r=[];let i=-1,a=0,u=0;for(;++i<e.length;){const s=e.charCodeAt(i);let c="";if(s===37&&Xt(e.charCodeAt(i+1))&&Xt(e.charCodeAt(i+2)))u=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(c=String.fromCharCode(s));else if(s>55295&&s<57344){const f=e.charCodeAt(i+1);s<56320&&f>56319&&f<57344?(c=String.fromCharCode(s,f),u=1):c="�"}else c=String.fromCharCode(s);c&&(r.push(e.slice(a,i),encodeURIComponent(c)),a=i+u+1,c=""),u&&(i+=u,u=0)}return r.join("")+e.slice(a)}function Ze(e,r,i,a){const u=a?a-1:Number.POSITIVE_INFINITY;let s=0;return c;function c(h){return He(h)?(e.enter(i),f(h)):r(h)}function f(h){return He(h)&&s++<u?(e.consume(h),f):(e.exit(i),r(h))}}const J2={tokenize:W2};function W2(e){const r=e.attempt(this.parser.constructs.contentInitial,a,u);let i;return r;function a(f){if(f===null){e.consume(f);return}return e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),Ze(e,r,"linePrefix")}function u(f){return e.enter("paragraph"),s(f)}function s(f){const h=e.enter("chunkText",{contentType:"text",previous:i});return i&&(i.next=h),i=h,c(f)}function c(f){if(f===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(f);return}return ze(f)?(e.consume(f),e.exit("chunkText"),s):(e.consume(f),c)}}const eE={tokenize:tE},Pp={tokenize:nE};function tE(e){const r=this,i=[];let a=0,u,s,c;return f;function f(L){if(a<i.length){const U=i[a];return r.containerState=U[1],e.attempt(U[0].continuation,h,d)(L)}return d(L)}function h(L){if(a++,r.containerState._closeFlow){r.containerState._closeFlow=void 0,u&&M();const U=r.events.length;let V=U,B;for(;V--;)if(r.events[V][0]==="exit"&&r.events[V][1].type==="chunkFlow"){B=r.events[V][1].end;break}E(a);let N=U;for(;N<r.events.length;)r.events[N][1].end={...B},N++;return dn(r.events,V+1,0,r.events.slice(U)),r.events.length=N,d(L)}return f(L)}function d(L){if(a===i.length){if(!u)return x(L);if(u.currentConstruct&&u.currentConstruct.concrete)return w(L);r.interrupt=!!(u.currentConstruct&&!u._gfmTableDynamicInterruptHack)}return r.containerState={},e.check(Pp,g,y)(L)}function g(L){return u&&M(),E(a),x(L)}function y(L){return r.parser.lazy[r.now().line]=a!==i.length,c=r.now().offset,w(L)}function x(L){return r.containerState={},e.attempt(Pp,v,w)(L)}function v(L){return a++,i.push([r.currentConstruct,r.containerState]),x(L)}function w(L){if(L===null){u&&M(),E(0),e.consume(L);return}return u=u||r.parser.flow(r.now()),e.enter("chunkFlow",{_tokenizer:u,contentType:"flow",previous:s}),_(L)}function _(L){if(L===null){C(e.exit("chunkFlow"),!0),E(0),e.consume(L);return}return ze(L)?(e.consume(L),C(e.exit("chunkFlow")),a=0,r.interrupt=void 0,f):(e.consume(L),_)}function C(L,U){const V=r.sliceStream(L);if(U&&V.push(null),L.previous=s,s&&(s.next=L),s=L,u.defineSkip(L.start),u.write(V),r.parser.lazy[L.start.line]){let B=u.events.length;for(;B--;)if(u.events[B][1].start.offset<c&&(!u.events[B][1].end||u.events[B][1].end.offset>c))return;const N=r.events.length;let ee=N,G,D;for(;ee--;)if(r.events[ee][0]==="exit"&&r.events[ee][1].type==="chunkFlow"){if(G){D=r.events[ee][1].end;break}G=!0}for(E(a),B=N;B<r.events.length;)r.events[B][1].end={...D},B++;dn(r.events,ee+1,0,r.events.slice(N)),r.events.length=B}}function E(L){let U=i.length;for(;U-- >L;){const V=i[U];r.containerState=V[1],V[0].exit.call(r,e)}i.length=L}function M(){u.write([null]),s=void 0,u=void 0,r.containerState._closeFlow=void 0}}function nE(e,r,i){return Ze(e,e.attempt(this.parser.constructs.document,r,i),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function dl(e){if(e===null||ot(e)||Ri(e))return 1;if(Qu(e))return 2}function $u(e,r,i){const a=[];let u=-1;for(;++u<e.length;){const s=e[u].resolveAll;s&&!a.includes(s)&&(r=s(r,i),a.push(s))}return r}const jc={name:"attention",resolveAll:rE,tokenize:iE};function rE(e,r){let i=-1,a,u,s,c,f,h,d,g;for(;++i<e.length;)if(e[i][0]==="enter"&&e[i][1].type==="attentionSequence"&&e[i][1]._close){for(a=i;a--;)if(e[a][0]==="exit"&&e[a][1].type==="attentionSequence"&&e[a][1]._open&&r.sliceSerialize(e[a][1]).charCodeAt(0)===r.sliceSerialize(e[i][1]).charCodeAt(0)){if((e[a][1]._close||e[i][1]._open)&&(e[i][1].end.offset-e[i][1].start.offset)%3&&!((e[a][1].end.offset-e[a][1].start.offset+e[i][1].end.offset-e[i][1].start.offset)%3))continue;h=e[a][1].end.offset-e[a][1].start.offset>1&&e[i][1].end.offset-e[i][1].start.offset>1?2:1;const y={...e[a][1].end},x={...e[i][1].start};Jp(y,-h),Jp(x,h),c={type:h>1?"strongSequence":"emphasisSequence",start:y,end:{...e[a][1].end}},f={type:h>1?"strongSequence":"emphasisSequence",start:{...e[i][1].start},end:x},s={type:h>1?"strongText":"emphasisText",start:{...e[a][1].end},end:{...e[i][1].start}},u={type:h>1?"strong":"emphasis",start:{...c.start},end:{...f.end}},e[a][1].end={...c.start},e[i][1].start={...f.end},d=[],e[a][1].end.offset-e[a][1].start.offset&&(d=zn(d,[["enter",e[a][1],r],["exit",e[a][1],r]])),d=zn(d,[["enter",u,r],["enter",c,r],["exit",c,r],["enter",s,r]]),d=zn(d,$u(r.parser.constructs.insideSpan.null,e.slice(a+1,i),r)),d=zn(d,[["exit",s,r],["enter",f,r],["exit",f,r],["exit",u,r]]),e[i][1].end.offset-e[i][1].start.offset?(g=2,d=zn(d,[["enter",e[i][1],r],["exit",e[i][1],r]])):g=0,dn(e,a-1,i-a+3,d),i=a+d.length-g-2;break}}for(i=-1;++i<e.length;)e[i][1].type==="attentionSequence"&&(e[i][1].type="data");return e}function iE(e,r){const i=this.parser.constructs.attentionMarkers.null,a=this.previous,u=dl(a);let s;return c;function c(h){return s=h,e.enter("attentionSequence"),f(h)}function f(h){if(h===s)return e.consume(h),f;const d=e.exit("attentionSequence"),g=dl(h),y=!g||g===2&&u||i.includes(h),x=!u||u===2&&g||i.includes(a);return d._open=!!(s===42?y:y&&(u||!x)),d._close=!!(s===42?x:x&&(g||!y)),r(h)}}function Jp(e,r){e.column+=r,e.offset+=r,e._bufferIndex+=r}const lE={name:"autolink",tokenize:aE};function aE(e,r,i){let a=0;return u;function u(v){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),s}function s(v){return Gt(v)?(e.consume(v),c):v===64?i(v):d(v)}function c(v){return v===43||v===45||v===46||Xt(v)?(a=1,f(v)):d(v)}function f(v){return v===58?(e.consume(v),a=0,h):(v===43||v===45||v===46||Xt(v))&&a++<32?(e.consume(v),f):(a=0,d(v))}function h(v){return v===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.exit("autolink"),r):v===null||v===32||v===60||Gu(v)?i(v):(e.consume(v),h)}function d(v){return v===64?(e.consume(v),g):Z2(v)?(e.consume(v),d):i(v)}function g(v){return Xt(v)?y(v):i(v)}function y(v){return v===46?(e.consume(v),a=0,g):v===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.exit("autolink"),r):x(v)}function x(v){if((v===45||Xt(v))&&a++<63){const w=v===45?x:y;return e.consume(v),w}return i(v)}}const Ea={partial:!0,tokenize:uE};function uE(e,r,i){return a;function a(s){return He(s)?Ze(e,u,"linePrefix")(s):u(s)}function u(s){return s===null||ze(s)?r(s):i(s)}}const Wp={continuation:{tokenize:sE},exit:cE,name:"blockQuote",tokenize:oE};function oE(e,r,i){const a=this;return u;function u(c){if(c===62){const f=a.containerState;return f.open||(e.enter("blockQuote",{_container:!0}),f.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(c),e.exit("blockQuoteMarker"),s}return i(c)}function s(c){return He(c)?(e.enter("blockQuotePrefixWhitespace"),e.consume(c),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),r):(e.exit("blockQuotePrefix"),r(c))}}function sE(e,r,i){const a=this;return u;function u(c){return He(c)?Ze(e,s,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(c):s(c)}function s(c){return e.attempt(Wp,r,i)(c)}}function cE(e){e.exit("blockQuote")}const eg={name:"characterEscape",tokenize:fE};function fE(e,r,i){return a;function a(s){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(s),e.exit("escapeMarker"),u}function u(s){return P2(s)?(e.enter("characterEscapeValue"),e.consume(s),e.exit("characterEscapeValue"),e.exit("characterEscape"),r):i(s)}}const tg={name:"characterReference",tokenize:hE};function hE(e,r,i){const a=this;let u=0,s,c;return f;function f(y){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(y),e.exit("characterReferenceMarker"),h}function h(y){return y===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(y),e.exit("characterReferenceMarkerNumeric"),d):(e.enter("characterReferenceValue"),s=31,c=Xt,g(y))}function d(y){return y===88||y===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(y),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),s=6,c=K2,g):(e.enter("characterReferenceValue"),s=7,c=Oc,g(y))}function g(y){if(y===59&&u){const x=e.exit("characterReferenceValue");return c===Xt&&!Dc(a.sliceSerialize(x))?i(y):(e.enter("characterReferenceMarker"),e.consume(y),e.exit("characterReferenceMarker"),e.exit("characterReference"),r)}return c(y)&&u++<s?(e.consume(y),g):i(y)}}const ng={partial:!0,tokenize:mE},rg={concrete:!0,name:"codeFenced",tokenize:dE};function dE(e,r,i){const a=this,u={partial:!0,tokenize:V};let s=0,c=0,f;return h;function h(B){return d(B)}function d(B){const N=a.events[a.events.length-1];return s=N&&N[1].type==="linePrefix"?N[2].sliceSerialize(N[1],!0).length:0,f=B,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),g(B)}function g(B){return B===f?(c++,e.consume(B),g):c<3?i(B):(e.exit("codeFencedFenceSequence"),He(B)?Ze(e,y,"whitespace")(B):y(B))}function y(B){return B===null||ze(B)?(e.exit("codeFencedFence"),a.interrupt?r(B):e.check(ng,_,U)(B)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),x(B))}function x(B){return B===null||ze(B)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),y(B)):He(B)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),Ze(e,v,"whitespace")(B)):B===96&&B===f?i(B):(e.consume(B),x)}function v(B){return B===null||ze(B)?y(B):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),w(B))}function w(B){return B===null||ze(B)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),y(B)):B===96&&B===f?i(B):(e.consume(B),w)}function _(B){return e.attempt(u,U,C)(B)}function C(B){return e.enter("lineEnding"),e.consume(B),e.exit("lineEnding"),E}function E(B){return s>0&&He(B)?Ze(e,M,"linePrefix",s+1)(B):M(B)}function M(B){return B===null||ze(B)?e.check(ng,_,U)(B):(e.enter("codeFlowValue"),L(B))}function L(B){return B===null||ze(B)?(e.exit("codeFlowValue"),M(B)):(e.consume(B),L)}function U(B){return e.exit("codeFenced"),r(B)}function V(B,N,ee){let G=0;return D;function D(I){return B.enter("lineEnding"),B.consume(I),B.exit("lineEnding"),ne}function ne(I){return B.enter("codeFencedFence"),He(I)?Ze(B,ae,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(I):ae(I)}function ae(I){return I===f?(B.enter("codeFencedFenceSequence"),ve(I)):ee(I)}function ve(I){return I===f?(G++,B.consume(I),ve):G>=c?(B.exit("codeFencedFenceSequence"),He(I)?Ze(B,H,"whitespace")(I):H(I)):ee(I)}function H(I){return I===null||ze(I)?(B.exit("codeFencedFence"),N(I)):ee(I)}}}function mE(e,r,i){const a=this;return u;function u(c){return c===null?i(c):(e.enter("lineEnding"),e.consume(c),e.exit("lineEnding"),s)}function s(c){return a.parser.lazy[a.now().line]?i(c):r(c)}}const Lc={name:"codeIndented",tokenize:gE},pE={partial:!0,tokenize:yE};function gE(e,r,i){const a=this;return u;function u(d){return e.enter("codeIndented"),Ze(e,s,"linePrefix",5)(d)}function s(d){const g=a.events[a.events.length-1];return g&&g[1].type==="linePrefix"&&g[2].sliceSerialize(g[1],!0).length>=4?c(d):i(d)}function c(d){return d===null?h(d):ze(d)?e.attempt(pE,c,h)(d):(e.enter("codeFlowValue"),f(d))}function f(d){return d===null||ze(d)?(e.exit("codeFlowValue"),c(d)):(e.consume(d),f)}function h(d){return e.exit("codeIndented"),r(d)}}function yE(e,r,i){const a=this;return u;function u(c){return a.parser.lazy[a.now().line]?i(c):ze(c)?(e.enter("lineEnding"),e.consume(c),e.exit("lineEnding"),u):Ze(e,s,"linePrefix",5)(c)}function s(c){const f=a.events[a.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?r(c):ze(c)?u(c):i(c)}}const vE={name:"codeText",previous:bE,resolve:xE,tokenize:wE};function xE(e){let r=e.length-4,i=3,a,u;if((e[i][1].type==="lineEnding"||e[i][1].type==="space")&&(e[r][1].type==="lineEnding"||e[r][1].type==="space")){for(a=i;++a<r;)if(e[a][1].type==="codeTextData"){e[i][1].type="codeTextPadding",e[r][1].type="codeTextPadding",i+=2,r-=2;break}}for(a=i-1,r++;++a<=r;)u===void 0?a!==r&&e[a][1].type!=="lineEnding"&&(u=a):(a===r||e[a][1].type==="lineEnding")&&(e[u][1].type="codeTextData",a!==u+2&&(e[u][1].end=e[a-1][1].end,e.splice(u+2,a-u-2),r-=a-u-2,a=u+2),u=void 0);return e}function bE(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function wE(e,r,i){let a=0,u,s;return c;function c(y){return e.enter("codeText"),e.enter("codeTextSequence"),f(y)}function f(y){return y===96?(e.consume(y),a++,f):(e.exit("codeTextSequence"),h(y))}function h(y){return y===null?i(y):y===32?(e.enter("space"),e.consume(y),e.exit("space"),h):y===96?(s=e.enter("codeTextSequence"),u=0,g(y)):ze(y)?(e.enter("lineEnding"),e.consume(y),e.exit("lineEnding"),h):(e.enter("codeTextData"),d(y))}function d(y){return y===null||y===32||y===96||ze(y)?(e.exit("codeTextData"),h(y)):(e.consume(y),d)}function g(y){return y===96?(e.consume(y),u++,g):u===a?(e.exit("codeTextSequence"),e.exit("codeText"),r(y)):(s.type="codeTextData",d(y))}}class SE{constructor(r){this.left=r?[...r]:[],this.right=[]}get(r){if(r<0||r>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+r+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return r<this.left.length?this.left[r]:this.right[this.right.length-r+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(r,i){const a=i??Number.POSITIVE_INFINITY;return a<this.left.length?this.left.slice(r,a):r>this.left.length?this.right.slice(this.right.length-a+this.left.length,this.right.length-r+this.left.length).reverse():this.left.slice(r).concat(this.right.slice(this.right.length-a+this.left.length).reverse())}splice(r,i,a){const u=i||0;this.setCursor(Math.trunc(r));const s=this.right.splice(this.right.length-u,Number.POSITIVE_INFINITY);return a&&ka(this.left,a),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(r){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(r)}pushMany(r){this.setCursor(Number.POSITIVE_INFINITY),ka(this.left,r)}unshift(r){this.setCursor(0),this.right.push(r)}unshiftMany(r){this.setCursor(0),ka(this.right,r.reverse())}setCursor(r){if(!(r===this.left.length||r>this.left.length&&this.right.length===0||r<0&&this.left.length===0))if(r<this.left.length){const i=this.left.splice(r,Number.POSITIVE_INFINITY);ka(this.right,i.reverse())}else{const i=this.right.splice(this.left.length+this.right.length-r,Number.POSITIVE_INFINITY);ka(this.left,i.reverse())}}}function ka(e,r){let i=0;if(r.length<1e4)e.push(...r);else for(;i<r.length;)e.push(...r.slice(i,i+1e4)),i+=1e4}function ig(e){const r={};let i=-1,a,u,s,c,f,h,d;const g=new SE(e);for(;++i<g.length;){for(;i in r;)i=r[i];if(a=g.get(i),i&&a[1].type==="chunkFlow"&&g.get(i-1)[1].type==="listItemPrefix"&&(h=a[1]._tokenizer.events,s=0,s<h.length&&h[s][1].type==="lineEndingBlank"&&(s+=2),s<h.length&&h[s][1].type==="content"))for(;++s<h.length&&h[s][1].type!=="content";)h[s][1].type==="chunkText"&&(h[s][1]._isInFirstContentOfListItem=!0,s++);if(a[0]==="enter")a[1].contentType&&(Object.assign(r,EE(g,i)),i=r[i],d=!0);else if(a[1]._container){for(s=i,u=void 0;s--;)if(c=g.get(s),c[1].type==="lineEnding"||c[1].type==="lineEndingBlank")c[0]==="enter"&&(u&&(g.get(u)[1].type="lineEndingBlank"),c[1].type="lineEnding",u=s);else if(!(c[1].type==="linePrefix"||c[1].type==="listItemIndent"))break;u&&(a[1].end={...g.get(u)[1].start},f=g.slice(u,i),f.unshift(a),g.splice(u,i-u+1,f))}}return dn(e,0,Number.POSITIVE_INFINITY,g.slice(0)),!d}function EE(e,r){const i=e.get(r)[1],a=e.get(r)[2];let u=r-1;const s=[];let c=i._tokenizer;c||(c=a.parser[i.contentType](i.start),i._contentTypeTextTrailing&&(c._contentTypeTextTrailing=!0));const f=c.events,h=[],d={};let g,y,x=-1,v=i,w=0,_=0;const C=[_];for(;v;){for(;e.get(++u)[1]!==v;);s.push(u),v._tokenizer||(g=a.sliceStream(v),v.next||g.push(null),y&&c.defineSkip(v.start),v._isInFirstContentOfListItem&&(c._gfmTasklistFirstContentOfListItem=!0),c.write(g),v._isInFirstContentOfListItem&&(c._gfmTasklistFirstContentOfListItem=void 0)),y=v,v=v.next}for(v=i;++x<f.length;)f[x][0]==="exit"&&f[x-1][0]==="enter"&&f[x][1].type===f[x-1][1].type&&f[x][1].start.line!==f[x][1].end.line&&(_=x+1,C.push(_),v._tokenizer=void 0,v.previous=void 0,v=v.next);for(c.events=[],v?(v._tokenizer=void 0,v.previous=void 0):C.pop(),x=C.length;x--;){const E=f.slice(C[x],C[x+1]),M=s.pop();h.push([M,M+E.length-1]),e.splice(M,2,E)}for(h.reverse(),x=-1;++x<h.length;)d[w+h[x][0]]=w+h[x][1],w+=h[x][1]-h[x][0]-1;return d}const kE={resolve:CE,tokenize:TE},_E={partial:!0,tokenize:zE};function CE(e){return ig(e),e}function TE(e,r){let i;return a;function a(f){return e.enter("content"),i=e.enter("chunkContent",{contentType:"content"}),u(f)}function u(f){return f===null?s(f):ze(f)?e.check(_E,c,s)(f):(e.consume(f),u)}function s(f){return e.exit("chunkContent"),e.exit("content"),r(f)}function c(f){return e.consume(f),e.exit("chunkContent"),i.next=e.enter("chunkContent",{contentType:"content",previous:i}),i=i.next,u}}function zE(e,r,i){const a=this;return u;function u(c){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(c),e.exit("lineEnding"),Ze(e,s,"linePrefix")}function s(c){if(c===null||ze(c))return i(c);const f=a.events[a.events.length-1];return!a.parser.constructs.disable.null.includes("codeIndented")&&f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?r(c):e.interrupt(a.parser.constructs.flow,i,r)(c)}}function lg(e,r,i,a,u,s,c,f,h){const d=h||Number.POSITIVE_INFINITY;let g=0;return y;function y(E){return E===60?(e.enter(a),e.enter(u),e.enter(s),e.consume(E),e.exit(s),x):E===null||E===32||E===41||Gu(E)?i(E):(e.enter(a),e.enter(c),e.enter(f),e.enter("chunkString",{contentType:"string"}),_(E))}function x(E){return E===62?(e.enter(s),e.consume(E),e.exit(s),e.exit(u),e.exit(a),r):(e.enter(f),e.enter("chunkString",{contentType:"string"}),v(E))}function v(E){return E===62?(e.exit("chunkString"),e.exit(f),x(E)):E===null||E===60||ze(E)?i(E):(e.consume(E),E===92?w:v)}function w(E){return E===60||E===62||E===92?(e.consume(E),v):v(E)}function _(E){return!g&&(E===null||E===41||ot(E))?(e.exit("chunkString"),e.exit(f),e.exit(c),e.exit(a),r(E)):g<d&&E===40?(e.consume(E),g++,_):E===41?(e.consume(E),g--,_):E===null||E===32||E===40||Gu(E)?i(E):(e.consume(E),E===92?C:_)}function C(E){return E===40||E===41||E===92?(e.consume(E),_):_(E)}}function ag(e,r,i,a,u,s){const c=this;let f=0,h;return d;function d(v){return e.enter(a),e.enter(u),e.consume(v),e.exit(u),e.enter(s),g}function g(v){return f>999||v===null||v===91||v===93&&!h||v===94&&!f&&"_hiddenFootnoteSupport"in c.parser.constructs?i(v):v===93?(e.exit(s),e.enter(u),e.consume(v),e.exit(u),e.exit(a),r):ze(v)?(e.enter("lineEnding"),e.consume(v),e.exit("lineEnding"),g):(e.enter("chunkString",{contentType:"string"}),y(v))}function y(v){return v===null||v===91||v===93||ze(v)||f++>999?(e.exit("chunkString"),g(v)):(e.consume(v),h||(h=!He(v)),v===92?x:y)}function x(v){return v===91||v===92||v===93?(e.consume(v),f++,y):y(v)}}function ug(e,r,i,a,u,s){let c;return f;function f(x){return x===34||x===39||x===40?(e.enter(a),e.enter(u),e.consume(x),e.exit(u),c=x===40?41:x,h):i(x)}function h(x){return x===c?(e.enter(u),e.consume(x),e.exit(u),e.exit(a),r):(e.enter(s),d(x))}function d(x){return x===c?(e.exit(s),h(c)):x===null?i(x):ze(x)?(e.enter("lineEnding"),e.consume(x),e.exit("lineEnding"),Ze(e,d,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),g(x))}function g(x){return x===c||x===null||ze(x)?(e.exit("chunkString"),d(x)):(e.consume(x),x===92?y:g)}function y(x){return x===c||x===92?(e.consume(x),g):g(x)}}function _a(e,r){let i;return a;function a(u){return ze(u)?(e.enter("lineEnding"),e.consume(u),e.exit("lineEnding"),i=!0,a):He(u)?Ze(e,a,i?"linePrefix":"lineSuffix")(u):r(u)}}const AE={name:"definition",tokenize:RE},ME={partial:!0,tokenize:NE};function RE(e,r,i){const a=this;let u;return s;function s(v){return e.enter("definition"),c(v)}function c(v){return ag.call(a,e,f,i,"definitionLabel","definitionLabelMarker","definitionLabelString")(v)}function f(v){return u=Vn(a.sliceSerialize(a.events[a.events.length-1][1]).slice(1,-1)),v===58?(e.enter("definitionMarker"),e.consume(v),e.exit("definitionMarker"),h):i(v)}function h(v){return ot(v)?_a(e,d)(v):d(v)}function d(v){return lg(e,g,i,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(v)}function g(v){return e.attempt(ME,y,y)(v)}function y(v){return He(v)?Ze(e,x,"whitespace")(v):x(v)}function x(v){return v===null||ze(v)?(e.exit("definition"),a.parser.defined.push(u),r(v)):i(v)}}function NE(e,r,i){return a;function a(f){return ot(f)?_a(e,u)(f):i(f)}function u(f){return ug(e,s,i,"definitionTitle","definitionTitleMarker","definitionTitleString")(f)}function s(f){return He(f)?Ze(e,c,"whitespace")(f):c(f)}function c(f){return f===null||ze(f)?r(f):i(f)}}const DE={name:"hardBreakEscape",tokenize:OE};function OE(e,r,i){return a;function a(s){return e.enter("hardBreakEscape"),e.consume(s),u}function u(s){return ze(s)?(e.exit("hardBreakEscape"),r(s)):i(s)}}const jE={name:"headingAtx",resolve:LE,tokenize:UE};function LE(e,r){let i=e.length-2,a=3,u,s;return e[a][1].type==="whitespace"&&(a+=2),i-2>a&&e[i][1].type==="whitespace"&&(i-=2),e[i][1].type==="atxHeadingSequence"&&(a===i-1||i-4>a&&e[i-2][1].type==="whitespace")&&(i-=a+1===i?2:4),i>a&&(u={type:"atxHeadingText",start:e[a][1].start,end:e[i][1].end},s={type:"chunkText",start:e[a][1].start,end:e[i][1].end,contentType:"text"},dn(e,a,i-a+1,[["enter",u,r],["enter",s,r],["exit",s,r],["exit",u,r]])),e}function UE(e,r,i){let a=0;return u;function u(g){return e.enter("atxHeading"),s(g)}function s(g){return e.enter("atxHeadingSequence"),c(g)}function c(g){return g===35&&a++<6?(e.consume(g),c):g===null||ot(g)?(e.exit("atxHeadingSequence"),f(g)):i(g)}function f(g){return g===35?(e.enter("atxHeadingSequence"),h(g)):g===null||ze(g)?(e.exit("atxHeading"),r(g)):He(g)?Ze(e,f,"whitespace")(g):(e.enter("atxHeadingText"),d(g))}function h(g){return g===35?(e.consume(g),h):(e.exit("atxHeadingSequence"),f(g))}function d(g){return g===null||g===35||ot(g)?(e.exit("atxHeadingText"),f(g)):(e.consume(g),d)}}const BE=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],og=["pre","script","style","textarea"],HE={concrete:!0,name:"htmlFlow",resolveTo:VE,tokenize:FE},qE={partial:!0,tokenize:GE},YE={partial:!0,tokenize:XE};function VE(e){let r=e.length;for(;r--&&!(e[r][0]==="enter"&&e[r][1].type==="htmlFlow"););return r>1&&e[r-2][1].type==="linePrefix"&&(e[r][1].start=e[r-2][1].start,e[r+1][1].start=e[r-2][1].start,e.splice(r-2,2)),e}function FE(e,r,i){const a=this;let u,s,c,f,h;return d;function d(z){return g(z)}function g(z){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(z),y}function y(z){return z===33?(e.consume(z),x):z===47?(e.consume(z),s=!0,_):z===63?(e.consume(z),u=3,a.interrupt?r:T):Gt(z)?(e.consume(z),c=String.fromCharCode(z),C):i(z)}function x(z){return z===45?(e.consume(z),u=2,v):z===91?(e.consume(z),u=5,f=0,w):Gt(z)?(e.consume(z),u=4,a.interrupt?r:T):i(z)}function v(z){return z===45?(e.consume(z),a.interrupt?r:T):i(z)}function w(z){const se="CDATA[";return z===se.charCodeAt(f++)?(e.consume(z),f===se.length?a.interrupt?r:ae:w):i(z)}function _(z){return Gt(z)?(e.consume(z),c=String.fromCharCode(z),C):i(z)}function C(z){if(z===null||z===47||z===62||ot(z)){const se=z===47,pe=c.toLowerCase();return!se&&!s&&og.includes(pe)?(u=1,a.interrupt?r(z):ae(z)):BE.includes(c.toLowerCase())?(u=6,se?(e.consume(z),E):a.interrupt?r(z):ae(z)):(u=7,a.interrupt&&!a.parser.lazy[a.now().line]?i(z):s?M(z):L(z))}return z===45||Xt(z)?(e.consume(z),c+=String.fromCharCode(z),C):i(z)}function E(z){return z===62?(e.consume(z),a.interrupt?r:ae):i(z)}function M(z){return He(z)?(e.consume(z),M):D(z)}function L(z){return z===47?(e.consume(z),D):z===58||z===95||Gt(z)?(e.consume(z),U):He(z)?(e.consume(z),L):D(z)}function U(z){return z===45||z===46||z===58||z===95||Xt(z)?(e.consume(z),U):V(z)}function V(z){return z===61?(e.consume(z),B):He(z)?(e.consume(z),V):L(z)}function B(z){return z===null||z===60||z===61||z===62||z===96?i(z):z===34||z===39?(e.consume(z),h=z,N):He(z)?(e.consume(z),B):ee(z)}function N(z){return z===h?(e.consume(z),h=null,G):z===null||ze(z)?i(z):(e.consume(z),N)}function ee(z){return z===null||z===34||z===39||z===47||z===60||z===61||z===62||z===96||ot(z)?V(z):(e.consume(z),ee)}function G(z){return z===47||z===62||He(z)?L(z):i(z)}function D(z){return z===62?(e.consume(z),ne):i(z)}function ne(z){return z===null||ze(z)?ae(z):He(z)?(e.consume(z),ne):i(z)}function ae(z){return z===45&&u===2?(e.consume(z),A):z===60&&u===1?(e.consume(z),Q):z===62&&u===4?(e.consume(z),R):z===63&&u===3?(e.consume(z),T):z===93&&u===5?(e.consume(z),oe):ze(z)&&(u===6||u===7)?(e.exit("htmlFlowData"),e.check(qE,Z,ve)(z)):z===null||ze(z)?(e.exit("htmlFlowData"),ve(z)):(e.consume(z),ae)}function ve(z){return e.check(YE,H,Z)(z)}function H(z){return e.enter("lineEnding"),e.consume(z),e.exit("lineEnding"),I}function I(z){return z===null||ze(z)?ve(z):(e.enter("htmlFlowData"),ae(z))}function A(z){return z===45?(e.consume(z),T):ae(z)}function Q(z){return z===47?(e.consume(z),c="",te):ae(z)}function te(z){if(z===62){const se=c.toLowerCase();return og.includes(se)?(e.consume(z),R):ae(z)}return Gt(z)&&c.length<8?(e.consume(z),c+=String.fromCharCode(z),te):ae(z)}function oe(z){return z===93?(e.consume(z),T):ae(z)}function T(z){return z===62?(e.consume(z),R):z===45&&u===2?(e.consume(z),T):ae(z)}function R(z){return z===null||ze(z)?(e.exit("htmlFlowData"),Z(z)):(e.consume(z),R)}function Z(z){return e.exit("htmlFlow"),r(z)}}function XE(e,r,i){const a=this;return u;function u(c){return ze(c)?(e.enter("lineEnding"),e.consume(c),e.exit("lineEnding"),s):i(c)}function s(c){return a.parser.lazy[a.now().line]?i(c):r(c)}}function GE(e,r,i){return a;function a(u){return e.enter("lineEnding"),e.consume(u),e.exit("lineEnding"),e.attempt(Ea,r,i)}}const QE={name:"htmlText",tokenize:$E};function $E(e,r,i){const a=this;let u,s,c;return f;function f(T){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(T),h}function h(T){return T===33?(e.consume(T),d):T===47?(e.consume(T),V):T===63?(e.consume(T),L):Gt(T)?(e.consume(T),ee):i(T)}function d(T){return T===45?(e.consume(T),g):T===91?(e.consume(T),s=0,w):Gt(T)?(e.consume(T),M):i(T)}function g(T){return T===45?(e.consume(T),v):i(T)}function y(T){return T===null?i(T):T===45?(e.consume(T),x):ze(T)?(c=y,Q(T)):(e.consume(T),y)}function x(T){return T===45?(e.consume(T),v):y(T)}function v(T){return T===62?A(T):T===45?x(T):y(T)}function w(T){const R="CDATA[";return T===R.charCodeAt(s++)?(e.consume(T),s===R.length?_:w):i(T)}function _(T){return T===null?i(T):T===93?(e.consume(T),C):ze(T)?(c=_,Q(T)):(e.consume(T),_)}function C(T){return T===93?(e.consume(T),E):_(T)}function E(T){return T===62?A(T):T===93?(e.consume(T),E):_(T)}function M(T){return T===null||T===62?A(T):ze(T)?(c=M,Q(T)):(e.consume(T),M)}function L(T){return T===null?i(T):T===63?(e.consume(T),U):ze(T)?(c=L,Q(T)):(e.consume(T),L)}function U(T){return T===62?A(T):L(T)}function V(T){return Gt(T)?(e.consume(T),B):i(T)}function B(T){return T===45||Xt(T)?(e.consume(T),B):N(T)}function N(T){return ze(T)?(c=N,Q(T)):He(T)?(e.consume(T),N):A(T)}function ee(T){return T===45||Xt(T)?(e.consume(T),ee):T===47||T===62||ot(T)?G(T):i(T)}function G(T){return T===47?(e.consume(T),A):T===58||T===95||Gt(T)?(e.consume(T),D):ze(T)?(c=G,Q(T)):He(T)?(e.consume(T),G):A(T)}function D(T){return T===45||T===46||T===58||T===95||Xt(T)?(e.consume(T),D):ne(T)}function ne(T){return T===61?(e.consume(T),ae):ze(T)?(c=ne,Q(T)):He(T)?(e.consume(T),ne):G(T)}function ae(T){return T===null||T===60||T===61||T===62||T===96?i(T):T===34||T===39?(e.consume(T),u=T,ve):ze(T)?(c=ae,Q(T)):He(T)?(e.consume(T),ae):(e.consume(T),H)}function ve(T){return T===u?(e.consume(T),u=void 0,I):T===null?i(T):ze(T)?(c=ve,Q(T)):(e.consume(T),ve)}function H(T){return T===null||T===34||T===39||T===60||T===61||T===96?i(T):T===47||T===62||ot(T)?G(T):(e.consume(T),H)}function I(T){return T===47||T===62||ot(T)?G(T):i(T)}function A(T){return T===62?(e.consume(T),e.exit("htmlTextData"),e.exit("htmlText"),r):i(T)}function Q(T){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(T),e.exit("lineEnding"),te}function te(T){return He(T)?Ze(e,oe,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(T):oe(T)}function oe(T){return e.enter("htmlTextData"),c(T)}}const Uc={name:"labelEnd",resolveAll:PE,resolveTo:JE,tokenize:WE},IE={tokenize:ek},ZE={tokenize:tk},KE={tokenize:nk};function PE(e){let r=-1;const i=[];for(;++r<e.length;){const a=e[r][1];if(i.push(e[r]),a.type==="labelImage"||a.type==="labelLink"||a.type==="labelEnd"){const u=a.type==="labelImage"?4:2;a.type="data",r+=u}}return e.length!==i.length&&dn(e,0,e.length,i),e}function JE(e,r){let i=e.length,a=0,u,s,c,f;for(;i--;)if(u=e[i][1],s){if(u.type==="link"||u.type==="labelLink"&&u._inactive)break;e[i][0]==="enter"&&u.type==="labelLink"&&(u._inactive=!0)}else if(c){if(e[i][0]==="enter"&&(u.type==="labelImage"||u.type==="labelLink")&&!u._balanced&&(s=i,u.type!=="labelLink")){a=2;break}}else u.type==="labelEnd"&&(c=i);const h={type:e[s][1].type==="labelLink"?"link":"image",start:{...e[s][1].start},end:{...e[e.length-1][1].end}},d={type:"label",start:{...e[s][1].start},end:{...e[c][1].end}},g={type:"labelText",start:{...e[s+a+2][1].end},end:{...e[c-2][1].start}};return f=[["enter",h,r],["enter",d,r]],f=zn(f,e.slice(s+1,s+a+3)),f=zn(f,[["enter",g,r]]),f=zn(f,$u(r.parser.constructs.insideSpan.null,e.slice(s+a+4,c-3),r)),f=zn(f,[["exit",g,r],e[c-2],e[c-1],["exit",d,r]]),f=zn(f,e.slice(c+1)),f=zn(f,[["exit",h,r]]),dn(e,s,e.length,f),e}function WE(e,r,i){const a=this;let u=a.events.length,s,c;for(;u--;)if((a.events[u][1].type==="labelImage"||a.events[u][1].type==="labelLink")&&!a.events[u][1]._balanced){s=a.events[u][1];break}return f;function f(x){return s?s._inactive?y(x):(c=a.parser.defined.includes(Vn(a.sliceSerialize({start:s.end,end:a.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(x),e.exit("labelMarker"),e.exit("labelEnd"),h):i(x)}function h(x){return x===40?e.attempt(IE,g,c?g:y)(x):x===91?e.attempt(ZE,g,c?d:y)(x):c?g(x):y(x)}function d(x){return e.attempt(KE,g,y)(x)}function g(x){return r(x)}function y(x){return s._balanced=!0,i(x)}}function ek(e,r,i){return a;function a(y){return e.enter("resource"),e.enter("resourceMarker"),e.consume(y),e.exit("resourceMarker"),u}function u(y){return ot(y)?_a(e,s)(y):s(y)}function s(y){return y===41?g(y):lg(e,c,f,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(y)}function c(y){return ot(y)?_a(e,h)(y):g(y)}function f(y){return i(y)}function h(y){return y===34||y===39||y===40?ug(e,d,i,"resourceTitle","resourceTitleMarker","resourceTitleString")(y):g(y)}function d(y){return ot(y)?_a(e,g)(y):g(y)}function g(y){return y===41?(e.enter("resourceMarker"),e.consume(y),e.exit("resourceMarker"),e.exit("resource"),r):i(y)}}function tk(e,r,i){const a=this;return u;function u(f){return ag.call(a,e,s,c,"reference","referenceMarker","referenceString")(f)}function s(f){return a.parser.defined.includes(Vn(a.sliceSerialize(a.events[a.events.length-1][1]).slice(1,-1)))?r(f):i(f)}function c(f){return i(f)}}function nk(e,r,i){return a;function a(s){return e.enter("reference"),e.enter("referenceMarker"),e.consume(s),e.exit("referenceMarker"),u}function u(s){return s===93?(e.enter("referenceMarker"),e.consume(s),e.exit("referenceMarker"),e.exit("reference"),r):i(s)}}const rk={name:"labelStartImage",resolveAll:Uc.resolveAll,tokenize:ik};function ik(e,r,i){const a=this;return u;function u(f){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(f),e.exit("labelImageMarker"),s}function s(f){return f===91?(e.enter("labelMarker"),e.consume(f),e.exit("labelMarker"),e.exit("labelImage"),c):i(f)}function c(f){return f===94&&"_hiddenFootnoteSupport"in a.parser.constructs?i(f):r(f)}}const lk={name:"labelStartLink",resolveAll:Uc.resolveAll,tokenize:ak};function ak(e,r,i){const a=this;return u;function u(c){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(c),e.exit("labelMarker"),e.exit("labelLink"),s}function s(c){return c===94&&"_hiddenFootnoteSupport"in a.parser.constructs?i(c):r(c)}}const Bc={name:"lineEnding",tokenize:uk};function uk(e,r){return i;function i(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),Ze(e,r,"linePrefix")}}const Iu={name:"thematicBreak",tokenize:ok};function ok(e,r,i){let a=0,u;return s;function s(d){return e.enter("thematicBreak"),c(d)}function c(d){return u=d,f(d)}function f(d){return d===u?(e.enter("thematicBreakSequence"),h(d)):a>=3&&(d===null||ze(d))?(e.exit("thematicBreak"),r(d)):i(d)}function h(d){return d===u?(e.consume(d),a++,h):(e.exit("thematicBreakSequence"),He(d)?Ze(e,f,"whitespace")(d):f(d))}}const Jt={continuation:{tokenize:hk},exit:mk,name:"list",tokenize:fk},sk={partial:!0,tokenize:pk},ck={partial:!0,tokenize:dk};function fk(e,r,i){const a=this,u=a.events[a.events.length-1];let s=u&&u[1].type==="linePrefix"?u[2].sliceSerialize(u[1],!0).length:0,c=0;return f;function f(v){const w=a.containerState.type||(v===42||v===43||v===45?"listUnordered":"listOrdered");if(w==="listUnordered"?!a.containerState.marker||v===a.containerState.marker:Oc(v)){if(a.containerState.type||(a.containerState.type=w,e.enter(w,{_container:!0})),w==="listUnordered")return e.enter("listItemPrefix"),v===42||v===45?e.check(Iu,i,d)(v):d(v);if(!a.interrupt||v===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),h(v)}return i(v)}function h(v){return Oc(v)&&++c<10?(e.consume(v),h):(!a.interrupt||c<2)&&(a.containerState.marker?v===a.containerState.marker:v===41||v===46)?(e.exit("listItemValue"),d(v)):i(v)}function d(v){return e.enter("listItemMarker"),e.consume(v),e.exit("listItemMarker"),a.containerState.marker=a.containerState.marker||v,e.check(Ea,a.interrupt?i:g,e.attempt(sk,x,y))}function g(v){return a.containerState.initialBlankLine=!0,s++,x(v)}function y(v){return He(v)?(e.enter("listItemPrefixWhitespace"),e.consume(v),e.exit("listItemPrefixWhitespace"),x):i(v)}function x(v){return a.containerState.size=s+a.sliceSerialize(e.exit("listItemPrefix"),!0).length,r(v)}}function hk(e,r,i){const a=this;return a.containerState._closeFlow=void 0,e.check(Ea,u,s);function u(f){return a.containerState.furtherBlankLines=a.containerState.furtherBlankLines||a.containerState.initialBlankLine,Ze(e,r,"listItemIndent",a.containerState.size+1)(f)}function s(f){return a.containerState.furtherBlankLines||!He(f)?(a.containerState.furtherBlankLines=void 0,a.containerState.initialBlankLine=void 0,c(f)):(a.containerState.furtherBlankLines=void 0,a.containerState.initialBlankLine=void 0,e.attempt(ck,r,c)(f))}function c(f){return a.containerState._closeFlow=!0,a.interrupt=void 0,Ze(e,e.attempt(Jt,r,i),"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(f)}}function dk(e,r,i){const a=this;return Ze(e,u,"listItemIndent",a.containerState.size+1);function u(s){const c=a.events[a.events.length-1];return c&&c[1].type==="listItemIndent"&&c[2].sliceSerialize(c[1],!0).length===a.containerState.size?r(s):i(s)}}function mk(e){e.exit(this.containerState.type)}function pk(e,r,i){const a=this;return Ze(e,u,"listItemPrefixWhitespace",a.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function u(s){const c=a.events[a.events.length-1];return!He(s)&&c&&c[1].type==="listItemPrefixWhitespace"?r(s):i(s)}}const sg={name:"setextUnderline",resolveTo:gk,tokenize:yk};function gk(e,r){let i=e.length,a,u,s;for(;i--;)if(e[i][0]==="enter"){if(e[i][1].type==="content"){a=i;break}e[i][1].type==="paragraph"&&(u=i)}else e[i][1].type==="content"&&e.splice(i,1),!s&&e[i][1].type==="definition"&&(s=i);const c={type:"setextHeading",start:{...e[a][1].start},end:{...e[e.length-1][1].end}};return e[u][1].type="setextHeadingText",s?(e.splice(u,0,["enter",c,r]),e.splice(s+1,0,["exit",e[a][1],r]),e[a][1].end={...e[s][1].end}):e[a][1]=c,e.push(["exit",c,r]),e}function yk(e,r,i){const a=this;let u;return s;function s(d){let g=a.events.length,y;for(;g--;)if(a.events[g][1].type!=="lineEnding"&&a.events[g][1].type!=="linePrefix"&&a.events[g][1].type!=="content"){y=a.events[g][1].type==="paragraph";break}return!a.parser.lazy[a.now().line]&&(a.interrupt||y)?(e.enter("setextHeadingLine"),u=d,c(d)):i(d)}function c(d){return e.enter("setextHeadingLineSequence"),f(d)}function f(d){return d===u?(e.consume(d),f):(e.exit("setextHeadingLineSequence"),He(d)?Ze(e,h,"lineSuffix")(d):h(d))}function h(d){return d===null||ze(d)?(e.exit("setextHeadingLine"),r(d)):i(d)}}const vk={tokenize:xk};function xk(e){const r=this,i=e.attempt(Ea,a,e.attempt(this.parser.constructs.flowInitial,u,Ze(e,e.attempt(this.parser.constructs.flow,u,e.attempt(kE,u)),"linePrefix")));return i;function a(s){if(s===null){e.consume(s);return}return e.enter("lineEndingBlank"),e.consume(s),e.exit("lineEndingBlank"),r.currentConstruct=void 0,i}function u(s){if(s===null){e.consume(s);return}return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),r.currentConstruct=void 0,i}}const bk={resolveAll:fg()},wk=cg("string"),Sk=cg("text");function cg(e){return{resolveAll:fg(e==="text"?Ek:void 0),tokenize:r};function r(i){const a=this,u=this.parser.constructs[e],s=i.attempt(u,c,f);return c;function c(g){return d(g)?s(g):f(g)}function f(g){if(g===null){i.consume(g);return}return i.enter("data"),i.consume(g),h}function h(g){return d(g)?(i.exit("data"),s(g)):(i.consume(g),h)}function d(g){if(g===null)return!0;const y=u[g];let x=-1;if(y)for(;++x<y.length;){const v=y[x];if(!v.previous||v.previous.call(a,a.previous))return!0}return!1}}}function fg(e){return r;function r(i,a){let u=-1,s;for(;++u<=i.length;)s===void 0?i[u]&&i[u][1].type==="data"&&(s=u,u++):(!i[u]||i[u][1].type!=="data")&&(u!==s+2&&(i[s][1].end=i[u-1][1].end,i.splice(s+2,u-s-2),u=s+2),s=void 0);return e?e(i,a):i}}function Ek(e,r){let i=0;for(;++i<=e.length;)if((i===e.length||e[i][1].type==="lineEnding")&&e[i-1][1].type==="data"){const a=e[i-1][1],u=r.sliceStream(a);let s=u.length,c=-1,f=0,h;for(;s--;){const d=u[s];if(typeof d=="string"){for(c=d.length;d.charCodeAt(c-1)===32;)f++,c--;if(c)break;c=-1}else if(d===-2)h=!0,f++;else if(d!==-1){s++;break}}if(r._contentTypeTextTrailing&&i===e.length&&(f=0),f){const d={type:i===e.length||h||f<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?c:a.start._bufferIndex+c,_index:a.start._index+s,line:a.end.line,column:a.end.column-f,offset:a.end.offset-f},end:{...a.end}};a.end={...d.start},a.start.offset===a.end.offset?Object.assign(a,d):(e.splice(i,0,["enter",d,r],["exit",d,r]),i+=2)}i++}return e}const kk=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:{91:AE},disable:{null:[]},document:{42:Jt,43:Jt,45:Jt,48:Jt,49:Jt,50:Jt,51:Jt,52:Jt,53:Jt,54:Jt,55:Jt,56:Jt,57:Jt,62:Wp},flow:{35:jE,42:Iu,45:[sg,Iu],60:HE,61:sg,95:Iu,96:rg,126:rg},flowInitial:{[-2]:Lc,[-1]:Lc,32:Lc},insideSpan:{null:[jc,bk]},string:{38:tg,92:eg},text:{[-5]:Bc,[-4]:Bc,[-3]:Bc,33:rk,38:tg,42:jc,60:[lE,QE],91:lk,92:[DE,eg],93:Uc,95:jc,96:vE}},Symbol.toStringTag,{value:"Module"}));function _k(e,r,i){let a={_bufferIndex:-1,_index:0,line:i&&i.line||1,column:i&&i.column||1,offset:i&&i.offset||0};const u={},s=[];let c=[],f=[];const h={attempt:N(V),check:N(B),consume:M,enter:L,exit:U,interrupt:N(B,{interrupt:!0})},d={code:null,containerState:{},defineSkip:_,events:[],now:w,parser:e,previous:null,sliceSerialize:x,sliceStream:v,write:y};let g=r.tokenize.call(d,h);return r.resolveAll&&s.push(r),d;function y(ne){return c=zn(c,ne),C(),c[c.length-1]!==null?[]:(ee(r,0),d.events=$u(s,d.events,d),d.events)}function x(ne,ae){return Tk(v(ne),ae)}function v(ne){return Ck(c,ne)}function w(){const{_bufferIndex:ne,_index:ae,line:ve,column:H,offset:I}=a;return{_bufferIndex:ne,_index:ae,line:ve,column:H,offset:I}}function _(ne){u[ne.line]=ne.column,D()}function C(){let ne;for(;a._index<c.length;){const ae=c[a._index];if(typeof ae=="string")for(ne=a._index,a._bufferIndex<0&&(a._bufferIndex=0);a._index===ne&&a._bufferIndex<ae.length;)E(ae.charCodeAt(a._bufferIndex));else E(ae)}}function E(ne){g=g(ne)}function M(ne){ze(ne)?(a.line++,a.column=1,a.offset+=ne===-3?2:1,D()):ne!==-1&&(a.column++,a.offset++),a._bufferIndex<0?a._index++:(a._bufferIndex++,a._bufferIndex===c[a._index].length&&(a._bufferIndex=-1,a._index++)),d.previous=ne}function L(ne,ae){const ve=ae||{};return ve.type=ne,ve.start=w(),d.events.push(["enter",ve,d]),f.push(ve),ve}function U(ne){const ae=f.pop();return ae.end=w(),d.events.push(["exit",ae,d]),ae}function V(ne,ae){ee(ne,ae.from)}function B(ne,ae){ae.restore()}function N(ne,ae){return ve;function ve(H,I,A){let Q,te,oe,T;return Array.isArray(H)?Z(H):"tokenize"in H?Z([H]):R(H);function R(ye){return Te;function Te(Oe){const Ke=Oe!==null&&ye[Oe],en=Oe!==null&&ye.null,Gn=[...Array.isArray(Ke)?Ke:Ke?[Ke]:[],...Array.isArray(en)?en:en?[en]:[]];return Z(Gn)(Oe)}}function Z(ye){return Q=ye,te=0,ye.length===0?A:z(ye[te])}function z(ye){return Te;function Te(Oe){return T=G(),oe=ye,ye.partial||(d.currentConstruct=ye),ye.name&&d.parser.constructs.disable.null.includes(ye.name)?pe():ye.tokenize.call(ae?Object.assign(Object.create(d),ae):d,h,se,pe)(Oe)}}function se(ye){return ne(oe,T),I}function pe(ye){return T.restore(),++te<Q.length?z(Q[te]):A}}}function ee(ne,ae){ne.resolveAll&&!s.includes(ne)&&s.push(ne),ne.resolve&&dn(d.events,ae,d.events.length-ae,ne.resolve(d.events.slice(ae),d)),ne.resolveTo&&(d.events=ne.resolveTo(d.events,d))}function G(){const ne=w(),ae=d.previous,ve=d.currentConstruct,H=d.events.length,I=Array.from(f);return{from:H,restore:A};function A(){a=ne,d.previous=ae,d.currentConstruct=ve,d.events.length=H,f=I,D()}}function D(){a.line in u&&a.column<2&&(a.column=u[a.line],a.offset+=u[a.line]-1)}}function Ck(e,r){const i=r.start._index,a=r.start._bufferIndex,u=r.end._index,s=r.end._bufferIndex;let c;if(i===u)c=[e[i].slice(a,s)];else{if(c=e.slice(i,u),a>-1){const f=c[0];typeof f=="string"?c[0]=f.slice(a):c.shift()}s>0&&c.push(e[u].slice(0,s))}return c}function Tk(e,r){let i=-1;const a=[];let u;for(;++i<e.length;){const s=e[i];let c;if(typeof s=="string")c=s;else switch(s){case-5:{c="\r";break}case-4:{c=`
`;break}case-3:{c=`\r
`;break}case-2:{c=r?" ":"	";break}case-1:{if(!r&&u)continue;c=" ";break}default:c=String.fromCharCode(s)}u=s===-2,a.push(c)}return a.join("")}function zk(e){const a={constructs:Zp([kk,...(e||{}).extensions||[]]),content:u(J2),defined:[],document:u(eE),flow:u(vk),lazy:{},string:u(wk),text:u(Sk)};return a;function u(s){return c;function c(f){return _k(a,s,f)}}}function Ak(e){for(;!ig(e););return e}const hg=/[\0\t\n\r]/g;function Mk(){let e=1,r="",i=!0,a;return u;function u(s,c,f){const h=[];let d,g,y,x,v;for(s=r+(typeof s=="string"?s.toString():new TextDecoder(c||void 0).decode(s)),y=0,r="",i&&(s.charCodeAt(0)===65279&&y++,i=void 0);y<s.length;){if(hg.lastIndex=y,d=hg.exec(s),x=d&&d.index!==void 0?d.index:s.length,v=s.charCodeAt(x),!d){r=s.slice(y);break}if(v===10&&y===x&&a)h.push(-3),a=void 0;else switch(a&&(h.push(-5),a=void 0),y<x&&(h.push(s.slice(y,x)),e+=x-y),v){case 0:{h.push(65533),e++;break}case 9:{for(g=Math.ceil(e/4)*4,h.push(-2);e++<g;)h.push(-1);break}case 10:{h.push(-4),e=1;break}default:a=!0,e=1}y=x+1}return f&&(a&&h.push(-5),r&&h.push(r),h.push(null)),h}}const Rk=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Nk(e){return e.replace(Rk,Dk)}function Dk(e,r,i){if(r)return r;if(i.charCodeAt(0)===35){const u=i.charCodeAt(1),s=u===120||u===88;return Kp(i.slice(s?2:1),s?16:10)}return Dc(i)||e}const dg={}.hasOwnProperty;function Ok(e,r,i){return typeof r!="string"&&(i=r,r=void 0),jk(i)(Ak(zk(i).document().write(Mk()(e,r,!0))))}function jk(e){const r={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(br),autolinkProtocol:G,autolinkEmail:G,atxHeading:s(Wr),blockQuote:s(en),characterEscape:G,characterReference:G,codeFenced:s(Gn),codeFencedFenceInfo:c,codeFencedFenceMeta:c,codeIndented:s(Gn,c),codeText:s(yt,c),codeTextData:G,data:G,codeFlowValue:G,definition:s(Qn),definitionDestinationString:c,definitionLabelString:c,definitionTitleString:c,emphasis:s(An),hardBreakEscape:s(tn),hardBreakTrailing:s(tn),htmlFlow:s(bl,c),htmlFlowData:G,htmlText:s(bl,c),htmlTextData:G,image:s(wl),label:c,link:s(br),listItem:s(Li),listItemValue:x,listOrdered:s(ei,y),listUnordered:s(ei),paragraph:s(Va),reference:z,referenceString:c,resourceDestinationString:c,resourceTitleString:c,setextHeading:s(Wr),strong:s(Fa),thematicBreak:s(wr)},exit:{atxHeading:h(),atxHeadingSequence:V,autolink:h(),autolinkEmail:Ke,autolinkProtocol:Oe,blockQuote:h(),characterEscapeValue:D,characterReferenceMarkerHexadecimal:pe,characterReferenceMarkerNumeric:pe,characterReferenceValue:ye,characterReference:Te,codeFenced:h(C),codeFencedFence:_,codeFencedFenceInfo:v,codeFencedFenceMeta:w,codeFlowValue:D,codeIndented:h(E),codeText:h(I),codeTextData:D,data:D,definition:h(),definitionDestinationString:U,definitionLabelString:M,definitionTitleString:L,emphasis:h(),hardBreakEscape:h(ae),hardBreakTrailing:h(ae),htmlFlow:h(ve),htmlFlowData:D,htmlText:h(H),htmlTextData:D,image:h(Q),label:oe,labelText:te,lineEnding:ne,link:h(A),listItem:h(),listOrdered:h(),listUnordered:h(),paragraph:h(),referenceString:se,resourceDestinationString:T,resourceTitleString:R,resource:Z,setextHeading:h(ee),setextHeadingLineSequence:N,setextHeadingText:B,strong:h(),thematicBreak:h()}};mg(r,(e||{}).mdastExtensions||[]);const i={};return a;function a(ie){let he={type:"root",children:[]};const ke={stack:[he],tokenStack:[],config:r,enter:f,exit:d,buffer:c,resume:g,data:i},Me=[];let Pe=-1;for(;++Pe<ie.length;)if(ie[Pe][1].type==="listOrdered"||ie[Pe][1].type==="listUnordered")if(ie[Pe][0]==="enter")Me.push(Pe);else{const Zt=Me.pop();Pe=u(ie,Zt,Pe)}for(Pe=-1;++Pe<ie.length;){const Zt=r[ie[Pe][0]];dg.call(Zt,ie[Pe][1].type)&&Zt[ie[Pe][1].type].call(Object.assign({sliceSerialize:ie[Pe][2].sliceSerialize},ke),ie[Pe][1])}if(ke.tokenStack.length>0){const Zt=ke.tokenStack[ke.tokenStack.length-1];(Zt[1]||pg).call(ke,void 0,Zt[0])}for(he.position={start:Zr(ie.length>0?ie[0][1].start:{line:1,column:1,offset:0}),end:Zr(ie.length>0?ie[ie.length-2][1].end:{line:1,column:1,offset:0})},Pe=-1;++Pe<r.transforms.length;)he=r.transforms[Pe](he)||he;return he}function u(ie,he,ke){let Me=he-1,Pe=-1,Zt=!1,pn,Ot,nt,jt;for(;++Me<=ke;){const tt=ie[Me];switch(tt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{tt[0]==="enter"?Pe++:Pe--,jt=void 0;break}case"lineEndingBlank":{tt[0]==="enter"&&(pn&&!jt&&!Pe&&!nt&&(nt=Me),jt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:jt=void 0}if(!Pe&&tt[0]==="enter"&&tt[1].type==="listItemPrefix"||Pe===-1&&tt[0]==="exit"&&(tt[1].type==="listUnordered"||tt[1].type==="listOrdered")){if(pn){let $n=Me;for(Ot=void 0;$n--;){const gn=ie[$n];if(gn[1].type==="lineEnding"||gn[1].type==="lineEndingBlank"){if(gn[0]==="exit")continue;Ot&&(ie[Ot][1].type="lineEndingBlank",Zt=!0),gn[1].type="lineEnding",Ot=$n}else if(!(gn[1].type==="linePrefix"||gn[1].type==="blockQuotePrefix"||gn[1].type==="blockQuotePrefixWhitespace"||gn[1].type==="blockQuoteMarker"||gn[1].type==="listItemIndent"))break}nt&&(!Ot||nt<Ot)&&(pn._spread=!0),pn.end=Object.assign({},Ot?ie[Ot][1].start:tt[1].end),ie.splice(Ot||Me,0,["exit",pn,tt[2]]),Me++,ke++}if(tt[1].type==="listItemPrefix"){const $n={type:"listItem",_spread:!1,start:Object.assign({},tt[1].start),end:void 0};pn=$n,ie.splice(Me,0,["enter",$n,tt[2]]),Me++,ke++,nt=void 0,jt=!0}}}return ie[he][1]._spread=Zt,ke}function s(ie,he){return ke;function ke(Me){f.call(this,ie(Me),Me),he&&he.call(this,Me)}}function c(){this.stack.push({type:"fragment",children:[]})}function f(ie,he,ke){this.stack[this.stack.length-1].children.push(ie),this.stack.push(ie),this.tokenStack.push([he,ke||void 0]),ie.position={start:Zr(he.start),end:void 0}}function h(ie){return he;function he(ke){ie&&ie.call(this,ke),d.call(this,ke)}}function d(ie,he){const ke=this.stack.pop(),Me=this.tokenStack.pop();if(Me)Me[0].type!==ie.type&&(he?he.call(this,ie,Me[0]):(Me[1]||pg).call(this,ie,Me[0]));else throw new Error("Cannot close `"+ie.type+"` ("+wa({start:ie.start,end:ie.end})+"): it’s not open");ke.position.end=Zr(ie.end)}function g(){return Nc(this.stack.pop())}function y(){this.data.expectingFirstListItemValue=!0}function x(ie){if(this.data.expectingFirstListItemValue){const he=this.stack[this.stack.length-2];he.start=Number.parseInt(this.sliceSerialize(ie),10),this.data.expectingFirstListItemValue=void 0}}function v(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.lang=ie}function w(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.meta=ie}function _(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function C(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.value=ie.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function E(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.value=ie.replace(/(\r?\n|\r)$/g,"")}function M(ie){const he=this.resume(),ke=this.stack[this.stack.length-1];ke.label=he,ke.identifier=Vn(this.sliceSerialize(ie)).toLowerCase()}function L(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.title=ie}function U(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.url=ie}function V(ie){const he=this.stack[this.stack.length-1];if(!he.depth){const ke=this.sliceSerialize(ie).length;he.depth=ke}}function B(){this.data.setextHeadingSlurpLineEnding=!0}function N(ie){const he=this.stack[this.stack.length-1];he.depth=this.sliceSerialize(ie).codePointAt(0)===61?1:2}function ee(){this.data.setextHeadingSlurpLineEnding=void 0}function G(ie){const ke=this.stack[this.stack.length-1].children;let Me=ke[ke.length-1];(!Me||Me.type!=="text")&&(Me=pt(),Me.position={start:Zr(ie.start),end:void 0},ke.push(Me)),this.stack.push(Me)}function D(ie){const he=this.stack.pop();he.value+=this.sliceSerialize(ie),he.position.end=Zr(ie.end)}function ne(ie){const he=this.stack[this.stack.length-1];if(this.data.atHardBreak){const ke=he.children[he.children.length-1];ke.position.end=Zr(ie.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&r.canContainEols.includes(he.type)&&(G.call(this,ie),D.call(this,ie))}function ae(){this.data.atHardBreak=!0}function ve(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.value=ie}function H(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.value=ie}function I(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.value=ie}function A(){const ie=this.stack[this.stack.length-1];if(this.data.inReference){const he=this.data.referenceType||"shortcut";ie.type+="Reference",ie.referenceType=he,delete ie.url,delete ie.title}else delete ie.identifier,delete ie.label;this.data.referenceType=void 0}function Q(){const ie=this.stack[this.stack.length-1];if(this.data.inReference){const he=this.data.referenceType||"shortcut";ie.type+="Reference",ie.referenceType=he,delete ie.url,delete ie.title}else delete ie.identifier,delete ie.label;this.data.referenceType=void 0}function te(ie){const he=this.sliceSerialize(ie),ke=this.stack[this.stack.length-2];ke.label=Nk(he),ke.identifier=Vn(he).toLowerCase()}function oe(){const ie=this.stack[this.stack.length-1],he=this.resume(),ke=this.stack[this.stack.length-1];if(this.data.inReference=!0,ke.type==="link"){const Me=ie.children;ke.children=Me}else ke.alt=he}function T(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.url=ie}function R(){const ie=this.resume(),he=this.stack[this.stack.length-1];he.title=ie}function Z(){this.data.inReference=void 0}function z(){this.data.referenceType="collapsed"}function se(ie){const he=this.resume(),ke=this.stack[this.stack.length-1];ke.label=he,ke.identifier=Vn(this.sliceSerialize(ie)).toLowerCase(),this.data.referenceType="full"}function pe(ie){this.data.characterReferenceType=ie.type}function ye(ie){const he=this.sliceSerialize(ie),ke=this.data.characterReferenceType;let Me;ke?(Me=Kp(he,ke==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Me=Dc(he);const Pe=this.stack[this.stack.length-1];Pe.value+=Me}function Te(ie){const he=this.stack.pop();he.position.end=Zr(ie.end)}function Oe(ie){D.call(this,ie);const he=this.stack[this.stack.length-1];he.url=this.sliceSerialize(ie)}function Ke(ie){D.call(this,ie);const he=this.stack[this.stack.length-1];he.url="mailto:"+this.sliceSerialize(ie)}function en(){return{type:"blockquote",children:[]}}function Gn(){return{type:"code",lang:null,meta:null,value:""}}function yt(){return{type:"inlineCode",value:""}}function Qn(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function An(){return{type:"emphasis",children:[]}}function Wr(){return{type:"heading",depth:0,children:[]}}function tn(){return{type:"break"}}function bl(){return{type:"html",value:""}}function wl(){return{type:"image",title:null,url:"",alt:null}}function br(){return{type:"link",title:null,url:"",children:[]}}function ei(ie){return{type:"list",ordered:ie.type==="listOrdered",start:null,spread:ie._spread,children:[]}}function Li(ie){return{type:"listItem",spread:ie._spread,checked:null,children:[]}}function Va(){return{type:"paragraph",children:[]}}function Fa(){return{type:"strong",children:[]}}function pt(){return{type:"text",value:""}}function wr(){return{type:"thematicBreak"}}}function Zr(e){return{line:e.line,column:e.column,offset:e.offset}}function mg(e,r){let i=-1;for(;++i<r.length;){const a=r[i];Array.isArray(a)?mg(e,a):Lk(e,a)}}function Lk(e,r){let i;for(i in r)if(dg.call(r,i))switch(i){case"canContainEols":{const a=r[i];a&&e[i].push(...a);break}case"transforms":{const a=r[i];a&&e[i].push(...a);break}case"enter":case"exit":{const a=r[i];a&&Object.assign(e[i],a);break}}}function pg(e,r){throw e?new Error("Cannot close `"+e.type+"` ("+wa({start:e.start,end:e.end})+"): a different token (`"+r.type+"`, "+wa({start:r.start,end:r.end})+") is open"):new Error("Cannot close document, a token (`"+r.type+"`, "+wa({start:r.start,end:r.end})+") is still open")}function Uk(e){const r=this;r.parser=i;function i(a){return Ok(a,{...r.data("settings"),...e,extensions:r.data("micromarkExtensions")||[],mdastExtensions:r.data("fromMarkdownExtensions")||[]})}}function Bk(e,r){const i={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(r),!0)};return e.patch(r,i),e.applyData(r,i)}function Hk(e,r){const i={type:"element",tagName:"br",properties:{},children:[]};return e.patch(r,i),[e.applyData(r,i),{type:"text",value:`
`}]}function qk(e,r){const i=r.value?r.value+`
`:"",a={},u=r.lang?r.lang.split(/\s+/):[];u.length>0&&(a.className=["language-"+u[0]]);let s={type:"element",tagName:"code",properties:a,children:[{type:"text",value:i}]};return r.meta&&(s.data={meta:r.meta}),e.patch(r,s),s=e.applyData(r,s),s={type:"element",tagName:"pre",properties:{},children:[s]},e.patch(r,s),s}function Yk(e,r){const i={type:"element",tagName:"del",properties:{},children:e.all(r)};return e.patch(r,i),e.applyData(r,i)}function Vk(e,r){const i={type:"element",tagName:"em",properties:{},children:e.all(r)};return e.patch(r,i),e.applyData(r,i)}function Fk(e,r){const i=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",a=String(r.identifier).toUpperCase(),u=hl(a.toLowerCase()),s=e.footnoteOrder.indexOf(a);let c,f=e.footnoteCounts.get(a);f===void 0?(f=0,e.footnoteOrder.push(a),c=e.footnoteOrder.length):c=s+1,f+=1,e.footnoteCounts.set(a,f);const h={type:"element",tagName:"a",properties:{href:"#"+i+"fn-"+u,id:i+"fnref-"+u+(f>1?"-"+f:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(c)}]};e.patch(r,h);const d={type:"element",tagName:"sup",properties:{},children:[h]};return e.patch(r,d),e.applyData(r,d)}function Xk(e,r){const i={type:"element",tagName:"h"+r.depth,properties:{},children:e.all(r)};return e.patch(r,i),e.applyData(r,i)}function Gk(e,r){if(e.options.allowDangerousHtml){const i={type:"raw",value:r.value};return e.patch(r,i),e.applyData(r,i)}}function gg(e,r){const i=r.referenceType;let a="]";if(i==="collapsed"?a+="[]":i==="full"&&(a+="["+(r.label||r.identifier)+"]"),r.type==="imageReference")return[{type:"text",value:"!["+r.alt+a}];const u=e.all(r),s=u[0];s&&s.type==="text"?s.value="["+s.value:u.unshift({type:"text",value:"["});const c=u[u.length-1];return c&&c.type==="text"?c.value+=a:u.push({type:"text",value:a}),u}function Qk(e,r){const i=String(r.identifier).toUpperCase(),a=e.definitionById.get(i);if(!a)return gg(e,r);const u={src:hl(a.url||""),alt:r.alt};a.title!==null&&a.title!==void 0&&(u.title=a.title);const s={type:"element",tagName:"img",properties:u,children:[]};return e.patch(r,s),e.applyData(r,s)}function $k(e,r){const i={src:hl(r.url)};r.alt!==null&&r.alt!==void 0&&(i.alt=r.alt),r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"img",properties:i,children:[]};return e.patch(r,a),e.applyData(r,a)}function Ik(e,r){const i={type:"text",value:r.value.replace(/\r?\n|\r/g," ")};e.patch(r,i);const a={type:"element",tagName:"code",properties:{},children:[i]};return e.patch(r,a),e.applyData(r,a)}function Zk(e,r){const i=String(r.identifier).toUpperCase(),a=e.definitionById.get(i);if(!a)return gg(e,r);const u={href:hl(a.url||"")};a.title!==null&&a.title!==void 0&&(u.title=a.title);const s={type:"element",tagName:"a",properties:u,children:e.all(r)};return e.patch(r,s),e.applyData(r,s)}function Kk(e,r){const i={href:hl(r.url)};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"a",properties:i,children:e.all(r)};return e.patch(r,a),e.applyData(r,a)}function Pk(e,r,i){const a=e.all(r),u=i?Jk(i):yg(r),s={},c=[];if(typeof r.checked=="boolean"){const g=a[0];let y;g&&g.type==="element"&&g.tagName==="p"?y=g:(y={type:"element",tagName:"p",properties:{},children:[]},a.unshift(y)),y.children.length>0&&y.children.unshift({type:"text",value:" "}),y.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:r.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let f=-1;for(;++f<a.length;){const g=a[f];(u||f!==0||g.type!=="element"||g.tagName!=="p")&&c.push({type:"text",value:`
`}),g.type==="element"&&g.tagName==="p"&&!u?c.push(...g.children):c.push(g)}const h=a[a.length-1];h&&(u||h.type!=="element"||h.tagName!=="p")&&c.push({type:"text",value:`
`});const d={type:"element",tagName:"li",properties:s,children:c};return e.patch(r,d),e.applyData(r,d)}function Jk(e){let r=!1;if(e.type==="list"){r=e.spread||!1;const i=e.children;let a=-1;for(;!r&&++a<i.length;)r=yg(i[a])}return r}function yg(e){const r=e.spread;return r??e.children.length>1}function Wk(e,r){const i={},a=e.all(r);let u=-1;for(typeof r.start=="number"&&r.start!==1&&(i.start=r.start);++u<a.length;){const c=a[u];if(c.type==="element"&&c.tagName==="li"&&c.properties&&Array.isArray(c.properties.className)&&c.properties.className.includes("task-list-item")){i.className=["contains-task-list"];break}}const s={type:"element",tagName:r.ordered?"ol":"ul",properties:i,children:e.wrap(a,!0)};return e.patch(r,s),e.applyData(r,s)}function e_(e,r){const i={type:"element",tagName:"p",properties:{},children:e.all(r)};return e.patch(r,i),e.applyData(r,i)}function t_(e,r){const i={type:"root",children:e.wrap(e.all(r))};return e.patch(r,i),e.applyData(r,i)}function n_(e,r){const i={type:"element",tagName:"strong",properties:{},children:e.all(r)};return e.patch(r,i),e.applyData(r,i)}function r_(e,r){const i=e.all(r),a=i.shift(),u=[];if(a){const c={type:"element",tagName:"thead",properties:{},children:e.wrap([a],!0)};e.patch(r.children[0],c),u.push(c)}if(i.length>0){const c={type:"element",tagName:"tbody",properties:{},children:e.wrap(i,!0)},f=Cc(r.children[1]),h=Up(r.children[r.children.length-1]);f&&h&&(c.position={start:f,end:h}),u.push(c)}const s={type:"element",tagName:"table",properties:{},children:e.wrap(u,!0)};return e.patch(r,s),e.applyData(r,s)}function i_(e,r,i){const a=i?i.children:void 0,s=(a?a.indexOf(r):1)===0?"th":"td",c=i&&i.type==="table"?i.align:void 0,f=c?c.length:r.children.length;let h=-1;const d=[];for(;++h<f;){const y=r.children[h],x={},v=c?c[h]:void 0;v&&(x.align=v);let w={type:"element",tagName:s,properties:x,children:[]};y&&(w.children=e.all(y),e.patch(y,w),w=e.applyData(y,w)),d.push(w)}const g={type:"element",tagName:"tr",properties:{},children:e.wrap(d,!0)};return e.patch(r,g),e.applyData(r,g)}function l_(e,r){const i={type:"element",tagName:"td",properties:{},children:e.all(r)};return e.patch(r,i),e.applyData(r,i)}const vg=9,xg=32;function a_(e){const r=String(e),i=/\r?\n|\r/g;let a=i.exec(r),u=0;const s=[];for(;a;)s.push(bg(r.slice(u,a.index),u>0,!0),a[0]),u=a.index+a[0].length,a=i.exec(r);return s.push(bg(r.slice(u),u>0,!1)),s.join("")}function bg(e,r,i){let a=0,u=e.length;if(r){let s=e.codePointAt(a);for(;s===vg||s===xg;)a++,s=e.codePointAt(a)}if(i){let s=e.codePointAt(u-1);for(;s===vg||s===xg;)u--,s=e.codePointAt(u-1)}return u>a?e.slice(a,u):""}function u_(e,r){const i={type:"text",value:a_(String(r.value))};return e.patch(r,i),e.applyData(r,i)}function o_(e,r){const i={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(r,i),e.applyData(r,i)}const s_={blockquote:Bk,break:Hk,code:qk,delete:Yk,emphasis:Vk,footnoteReference:Fk,heading:Xk,html:Gk,imageReference:Qk,image:$k,inlineCode:Ik,linkReference:Zk,link:Kk,listItem:Pk,list:Wk,paragraph:e_,root:t_,strong:n_,table:r_,tableCell:l_,tableRow:i_,text:u_,thematicBreak:o_,toml:Zu,yaml:Zu,definition:Zu,footnoteDefinition:Zu};function Zu(){}const wg=-1,Ku=0,Ca=1,Pu=2,Hc=3,qc=4,Yc=5,Vc=6,Sg=7,Eg=8,kg=typeof self=="object"?self:globalThis,c_=(e,r)=>{const i=(u,s)=>(e.set(s,u),u),a=u=>{if(e.has(u))return e.get(u);const[s,c]=r[u];switch(s){case Ku:case wg:return i(c,u);case Ca:{const f=i([],u);for(const h of c)f.push(a(h));return f}case Pu:{const f=i({},u);for(const[h,d]of c)f[a(h)]=a(d);return f}case Hc:return i(new Date(c),u);case qc:{const{source:f,flags:h}=c;return i(new RegExp(f,h),u)}case Yc:{const f=i(new Map,u);for(const[h,d]of c)f.set(a(h),a(d));return f}case Vc:{const f=i(new Set,u);for(const h of c)f.add(a(h));return f}case Sg:{const{name:f,message:h}=c;return i(new kg[f](h),u)}case Eg:return i(BigInt(c),u);case"BigInt":return i(Object(BigInt(c)),u);case"ArrayBuffer":return i(new Uint8Array(c).buffer,c);case"DataView":{const{buffer:f}=new Uint8Array(c);return i(new DataView(f),c)}}return i(new kg[s](c),u)};return a},_g=e=>c_(new Map,e)(0),ml="",{toString:f_}={},{keys:h_}=Object,Ta=e=>{const r=typeof e;if(r!=="object"||!e)return[Ku,r];const i=f_.call(e).slice(8,-1);switch(i){case"Array":return[Ca,ml];case"Object":return[Pu,ml];case"Date":return[Hc,ml];case"RegExp":return[qc,ml];case"Map":return[Yc,ml];case"Set":return[Vc,ml];case"DataView":return[Ca,i]}return i.includes("Array")?[Ca,i]:i.includes("Error")?[Sg,i]:[Pu,i]},Ju=([e,r])=>e===Ku&&(r==="function"||r==="symbol"),d_=(e,r,i,a)=>{const u=(c,f)=>{const h=a.push(c)-1;return i.set(f,h),h},s=c=>{if(i.has(c))return i.get(c);let[f,h]=Ta(c);switch(f){case Ku:{let g=c;switch(h){case"bigint":f=Eg,g=c.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+h);g=null;break;case"undefined":return u([wg],c)}return u([f,g],c)}case Ca:{if(h){let x=c;return h==="DataView"?x=new Uint8Array(c.buffer):h==="ArrayBuffer"&&(x=new Uint8Array(c)),u([h,[...x]],c)}const g=[],y=u([f,g],c);for(const x of c)g.push(s(x));return y}case Pu:{if(h)switch(h){case"BigInt":return u([h,c.toString()],c);case"Boolean":case"Number":case"String":return u([h,c.valueOf()],c)}if(r&&"toJSON"in c)return s(c.toJSON());const g=[],y=u([f,g],c);for(const x of h_(c))(e||!Ju(Ta(c[x])))&&g.push([s(x),s(c[x])]);return y}case Hc:return u([f,c.toISOString()],c);case qc:{const{source:g,flags:y}=c;return u([f,{source:g,flags:y}],c)}case Yc:{const g=[],y=u([f,g],c);for(const[x,v]of c)(e||!(Ju(Ta(x))||Ju(Ta(v))))&&g.push([s(x),s(v)]);return y}case Vc:{const g=[],y=u([f,g],c);for(const x of c)(e||!Ju(Ta(x)))&&g.push(s(x));return y}}const{message:d}=c;return u([f,{name:h,message:d}],c)};return s},Cg=(e,{json:r,lossy:i}={})=>{const a=[];return d_(!(r||i),!!r,new Map,a)(e),a},Wu=typeof structuredClone=="function"?(e,r)=>r&&("json"in r||"lossy"in r)?_g(Cg(e,r)):structuredClone(e):(e,r)=>_g(Cg(e,r));function m_(e,r){const i=[{type:"text",value:"↩"}];return r>1&&i.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(r)}]}),i}function p_(e,r){return"Back to reference "+(e+1)+(r>1?"-"+r:"")}function g_(e){const r=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",i=e.options.footnoteBackContent||m_,a=e.options.footnoteBackLabel||p_,u=e.options.footnoteLabel||"Footnotes",s=e.options.footnoteLabelTagName||"h2",c=e.options.footnoteLabelProperties||{className:["sr-only"]},f=[];let h=-1;for(;++h<e.footnoteOrder.length;){const d=e.footnoteById.get(e.footnoteOrder[h]);if(!d)continue;const g=e.all(d),y=String(d.identifier).toUpperCase(),x=hl(y.toLowerCase());let v=0;const w=[],_=e.footnoteCounts.get(y);for(;_!==void 0&&++v<=_;){w.length>0&&w.push({type:"text",value:" "});let M=typeof i=="string"?i:i(h,v);typeof M=="string"&&(M={type:"text",value:M}),w.push({type:"element",tagName:"a",properties:{href:"#"+r+"fnref-"+x+(v>1?"-"+v:""),dataFootnoteBackref:"",ariaLabel:typeof a=="string"?a:a(h,v),className:["data-footnote-backref"]},children:Array.isArray(M)?M:[M]})}const C=g[g.length-1];if(C&&C.type==="element"&&C.tagName==="p"){const M=C.children[C.children.length-1];M&&M.type==="text"?M.value+=" ":C.children.push({type:"text",value:" "}),C.children.push(...w)}else g.push(...w);const E={type:"element",tagName:"li",properties:{id:r+"fn-"+x},children:e.wrap(g,!0)};e.patch(d,E),f.push(E)}if(f.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...Wu(c),id:"footnote-label"},children:[{type:"text",value:u}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(f,!0)},{type:"text",value:`
`}]}}const eo=(function(e){if(e==null)return b_;if(typeof e=="function")return to(e);if(typeof e=="object")return Array.isArray(e)?y_(e):v_(e);if(typeof e=="string")return x_(e);throw new Error("Expected function, string, or object as test")});function y_(e){const r=[];let i=-1;for(;++i<e.length;)r[i]=eo(e[i]);return to(a);function a(...u){let s=-1;for(;++s<r.length;)if(r[s].apply(this,u))return!0;return!1}}function v_(e){const r=e;return to(i);function i(a){const u=a;let s;for(s in e)if(u[s]!==r[s])return!1;return!0}}function x_(e){return to(r);function r(i){return i&&i.type===e}}function to(e){return r;function r(i,a,u){return!!(w_(i)&&e.call(this,i,typeof a=="number"?a:void 0,u||void 0))}}function b_(){return!0}function w_(e){return e!==null&&typeof e=="object"&&"type"in e}function hN(e){return e}const Tg=[],S_=!0,Fc=!1,E_="skip";function zg(e,r,i,a){let u;typeof r=="function"&&typeof i!="function"?(a=i,i=r):u=r;const s=eo(u),c=a?-1:1;f(e,void 0,[])();function f(h,d,g){const y=h&&typeof h=="object"?h:{};if(typeof y.type=="string"){const v=typeof y.tagName=="string"?y.tagName:typeof y.name=="string"?y.name:void 0;Object.defineProperty(x,"name",{value:"node ("+(h.type+(v?"<"+v+">":""))+")"})}return x;function x(){let v=Tg,w,_,C;if((!r||s(h,d,g[g.length-1]||void 0))&&(v=k_(i(h,g)),v[0]===Fc))return v;if("children"in h&&h.children){const E=h;if(E.children&&v[0]!==E_)for(_=(a?E.children.length:-1)+c,C=g.concat(E);_>-1&&_<E.children.length;){const M=E.children[_];if(w=f(M,_,C)(),w[0]===Fc)return w;_=typeof w[1]=="number"?w[1]:_+c}}return v}}}function k_(e){return Array.isArray(e)?e:typeof e=="number"?[S_,e]:e==null?Tg:[e]}function Xc(e,r,i,a){let u,s,c;typeof r=="function"&&typeof i!="function"?(s=void 0,c=r,u=i):(s=r,c=i,u=a),zg(e,s,f,u);function f(h,d){const g=d[d.length-1],y=g?g.children.indexOf(h):void 0;return c(h,y,g)}}const Gc={}.hasOwnProperty,__={};function C_(e,r){const i=r||__,a=new Map,u=new Map,s=new Map,c={...s_,...i.handlers},f={all:d,applyData:z_,definitionById:a,footnoteById:u,footnoteCounts:s,footnoteOrder:[],handlers:c,one:h,options:i,patch:T_,wrap:M_};return Xc(e,function(g){if(g.type==="definition"||g.type==="footnoteDefinition"){const y=g.type==="definition"?a:u,x=String(g.identifier).toUpperCase();y.has(x)||y.set(x,g)}}),f;function h(g,y){const x=g.type,v=f.handlers[x];if(Gc.call(f.handlers,x)&&v)return v(f,g,y);if(f.options.passThrough&&f.options.passThrough.includes(x)){if("children"in g){const{children:_,...C}=g,E=Wu(C);return E.children=f.all(g),E}return Wu(g)}return(f.options.unknownHandler||A_)(f,g,y)}function d(g){const y=[];if("children"in g){const x=g.children;let v=-1;for(;++v<x.length;){const w=f.one(x[v],g);if(w){if(v&&x[v-1].type==="break"&&(!Array.isArray(w)&&w.type==="text"&&(w.value=Ag(w.value)),!Array.isArray(w)&&w.type==="element")){const _=w.children[0];_&&_.type==="text"&&(_.value=Ag(_.value))}Array.isArray(w)?y.push(...w):y.push(w)}}}return y}}function T_(e,r){e.position&&(r.position=k2(e))}function z_(e,r){let i=r;if(e&&e.data){const a=e.data.hName,u=e.data.hChildren,s=e.data.hProperties;if(typeof a=="string")if(i.type==="element")i.tagName=a;else{const c="children"in i?i.children:[i];i={type:"element",tagName:a,properties:{},children:c}}i.type==="element"&&s&&Object.assign(i.properties,Wu(s)),"children"in i&&i.children&&u!==null&&u!==void 0&&(i.children=u)}return i}function A_(e,r){const i=r.data||{},a="value"in r&&!(Gc.call(i,"hProperties")||Gc.call(i,"hChildren"))?{type:"text",value:r.value}:{type:"element",tagName:"div",properties:{},children:e.all(r)};return e.patch(r,a),e.applyData(r,a)}function M_(e,r){const i=[];let a=-1;for(r&&i.push({type:"text",value:`
`});++a<e.length;)a&&i.push({type:"text",value:`
`}),i.push(e[a]);return r&&e.length>0&&i.push({type:"text",value:`
`}),i}function Ag(e){let r=0,i=e.charCodeAt(r);for(;i===9||i===32;)r++,i=e.charCodeAt(r);return e.slice(r)}function Mg(e,r){const i=C_(e,r),a=i.one(e,void 0),u=g_(i),s=Array.isArray(a)?{type:"root",children:a}:a||{type:"root",children:[]};return u&&s.children.push({type:"text",value:`
`},u),s}function R_(e,r){return e&&"run"in e?async function(i,a){const u=Mg(i,{file:a,...r});await e.run(u,a)}:function(i,a){return Mg(i,{file:a,...e||r})}}function Rg(e){if(e)throw e}var Qc,Ng;function N_(){if(Ng)return Qc;Ng=1;var e=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=Object.defineProperty,a=Object.getOwnPropertyDescriptor,u=function(d){return typeof Array.isArray=="function"?Array.isArray(d):r.call(d)==="[object Array]"},s=function(d){if(!d||r.call(d)!=="[object Object]")return!1;var g=e.call(d,"constructor"),y=d.constructor&&d.constructor.prototype&&e.call(d.constructor.prototype,"isPrototypeOf");if(d.constructor&&!g&&!y)return!1;var x;for(x in d);return typeof x>"u"||e.call(d,x)},c=function(d,g){i&&g.name==="__proto__"?i(d,g.name,{enumerable:!0,configurable:!0,value:g.newValue,writable:!0}):d[g.name]=g.newValue},f=function(d,g){if(g==="__proto__")if(e.call(d,g)){if(a)return a(d,g).value}else return;return d[g]};return Qc=function h(){var d,g,y,x,v,w,_=arguments[0],C=1,E=arguments.length,M=!1;for(typeof _=="boolean"&&(M=_,_=arguments[1]||{},C=2),(_==null||typeof _!="object"&&typeof _!="function")&&(_={});C<E;++C)if(d=arguments[C],d!=null)for(g in d)y=f(_,g),x=f(d,g),_!==x&&(M&&x&&(s(x)||(v=u(x)))?(v?(v=!1,w=y&&u(y)?y:[]):w=y&&s(y)?y:{},c(_,{name:g,newValue:h(M,w,x)})):typeof x<"u"&&c(_,{name:g,newValue:x}));return _},Qc}var D_=N_();const $c=Fr(D_);function Ic(e){if(typeof e!="object"||e===null)return!1;const r=Object.getPrototypeOf(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function O_(){const e=[],r={run:i,use:a};return r;function i(...u){let s=-1;const c=u.pop();if(typeof c!="function")throw new TypeError("Expected function as last argument, not "+c);f(null,...u);function f(h,...d){const g=e[++s];let y=-1;if(h){c(h);return}for(;++y<u.length;)(d[y]===null||d[y]===void 0)&&(d[y]=u[y]);u=d,g?j_(g,f)(...d):c(null,...d)}}function a(u){if(typeof u!="function")throw new TypeError("Expected `middelware` to be a function, not "+u);return e.push(u),r}}function j_(e,r){let i;return a;function a(...c){const f=e.length>c.length;let h;f&&c.push(u);try{h=e.apply(this,c)}catch(d){const g=d;if(f&&i)throw g;return u(g)}f||(h&&h.then&&typeof h.then=="function"?h.then(s,u):h instanceof Error?u(h):s(h))}function u(c,...f){i||(i=!0,r(c,...f))}function s(c){u(null,c)}}const nr={basename:L_,dirname:U_,extname:B_,join:H_,sep:"/"};function L_(e,r){if(r!==void 0&&typeof r!="string")throw new TypeError('"ext" argument must be a string');za(e);let i=0,a=-1,u=e.length,s;if(r===void 0||r.length===0||r.length>e.length){for(;u--;)if(e.codePointAt(u)===47){if(s){i=u+1;break}}else a<0&&(s=!0,a=u+1);return a<0?"":e.slice(i,a)}if(r===e)return"";let c=-1,f=r.length-1;for(;u--;)if(e.codePointAt(u)===47){if(s){i=u+1;break}}else c<0&&(s=!0,c=u+1),f>-1&&(e.codePointAt(u)===r.codePointAt(f--)?f<0&&(a=u):(f=-1,a=c));return i===a?a=c:a<0&&(a=e.length),e.slice(i,a)}function U_(e){if(za(e),e.length===0)return".";let r=-1,i=e.length,a;for(;--i;)if(e.codePointAt(i)===47){if(a){r=i;break}}else a||(a=!0);return r<0?e.codePointAt(0)===47?"/":".":r===1&&e.codePointAt(0)===47?"//":e.slice(0,r)}function B_(e){za(e);let r=e.length,i=-1,a=0,u=-1,s=0,c;for(;r--;){const f=e.codePointAt(r);if(f===47){if(c){a=r+1;break}continue}i<0&&(c=!0,i=r+1),f===46?u<0?u=r:s!==1&&(s=1):u>-1&&(s=-1)}return u<0||i<0||s===0||s===1&&u===i-1&&u===a+1?"":e.slice(u,i)}function H_(...e){let r=-1,i;for(;++r<e.length;)za(e[r]),e[r]&&(i=i===void 0?e[r]:i+"/"+e[r]);return i===void 0?".":q_(i)}function q_(e){za(e);const r=e.codePointAt(0)===47;let i=Y_(e,!r);return i.length===0&&!r&&(i="."),i.length>0&&e.codePointAt(e.length-1)===47&&(i+="/"),r?"/"+i:i}function Y_(e,r){let i="",a=0,u=-1,s=0,c=-1,f,h;for(;++c<=e.length;){if(c<e.length)f=e.codePointAt(c);else{if(f===47)break;f=47}if(f===47){if(!(u===c-1||s===1))if(u!==c-1&&s===2){if(i.length<2||a!==2||i.codePointAt(i.length-1)!==46||i.codePointAt(i.length-2)!==46){if(i.length>2){if(h=i.lastIndexOf("/"),h!==i.length-1){h<0?(i="",a=0):(i=i.slice(0,h),a=i.length-1-i.lastIndexOf("/")),u=c,s=0;continue}}else if(i.length>0){i="",a=0,u=c,s=0;continue}}r&&(i=i.length>0?i+"/..":"..",a=2)}else i.length>0?i+="/"+e.slice(u+1,c):i=e.slice(u+1,c),a=c-u-1;u=c,s=0}else f===46&&s>-1?s++:s=-1}return i}function za(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const V_={cwd:F_};function F_(){return"/"}function Zc(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function X_(e){if(typeof e=="string")e=new URL(e);else if(!Zc(e)){const r=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw r.code="ERR_INVALID_ARG_TYPE",r}if(e.protocol!=="file:"){const r=new TypeError("The URL must be of scheme file");throw r.code="ERR_INVALID_URL_SCHEME",r}return G_(e)}function G_(e){if(e.hostname!==""){const a=new TypeError('File URL host must be "localhost" or empty on darwin');throw a.code="ERR_INVALID_FILE_URL_HOST",a}const r=e.pathname;let i=-1;for(;++i<r.length;)if(r.codePointAt(i)===37&&r.codePointAt(i+1)===50){const a=r.codePointAt(i+2);if(a===70||a===102){const u=new TypeError("File URL path must not include encoded / characters");throw u.code="ERR_INVALID_FILE_URL_PATH",u}}return decodeURIComponent(r)}const Kc=["history","path","basename","stem","extname","dirname"];class Dg{constructor(r){let i;r?Zc(r)?i={path:r}:typeof r=="string"||Q_(r)?i={value:r}:i=r:i={},this.cwd="cwd"in i?"":V_.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let a=-1;for(;++a<Kc.length;){const s=Kc[a];s in i&&i[s]!==void 0&&i[s]!==null&&(this[s]=s==="history"?[...i[s]]:i[s])}let u;for(u in i)Kc.includes(u)||(this[u]=i[u])}get basename(){return typeof this.path=="string"?nr.basename(this.path):void 0}set basename(r){Jc(r,"basename"),Pc(r,"basename"),this.path=nr.join(this.dirname||"",r)}get dirname(){return typeof this.path=="string"?nr.dirname(this.path):void 0}set dirname(r){Og(this.basename,"dirname"),this.path=nr.join(r||"",this.basename)}get extname(){return typeof this.path=="string"?nr.extname(this.path):void 0}set extname(r){if(Pc(r,"extname"),Og(this.dirname,"extname"),r){if(r.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(r.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=nr.join(this.dirname,this.stem+(r||""))}get path(){return this.history[this.history.length-1]}set path(r){Zc(r)&&(r=X_(r)),Jc(r,"path"),this.path!==r&&this.history.push(r)}get stem(){return typeof this.path=="string"?nr.basename(this.path,this.extname):void 0}set stem(r){Jc(r,"stem"),Pc(r,"stem"),this.path=nr.join(this.dirname||"",r+(this.extname||""))}fail(r,i,a){const u=this.message(r,i,a);throw u.fatal=!0,u}info(r,i,a){const u=this.message(r,i,a);return u.fatal=void 0,u}message(r,i,a){const u=new Ft(r,i,a);return this.path&&(u.name=this.path+":"+u.name,u.file=this.path),u.fatal=!1,this.messages.push(u),u}toString(r){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(r||void 0).decode(this.value)}}function Pc(e,r){if(e&&e.includes(nr.sep))throw new Error("`"+r+"` cannot be a path: did not expect `"+nr.sep+"`")}function Jc(e,r){if(!e)throw new Error("`"+r+"` cannot be empty")}function Og(e,r){if(!e)throw new Error("Setting `"+r+"` requires `path` to be set too")}function Q_(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const $_=(function(e){const a=this.constructor.prototype,u=a[e],s=function(){return u.apply(s,arguments)};return Object.setPrototypeOf(s,a),s}),I_={}.hasOwnProperty;class Wc extends $_{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=O_()}copy(){const r=new Wc;let i=-1;for(;++i<this.attachers.length;){const a=this.attachers[i];r.use(...a)}return r.data($c(!0,{},this.namespace)),r}data(r,i){return typeof r=="string"?arguments.length===2?(nf("data",this.frozen),this.namespace[r]=i,this):I_.call(this.namespace,r)&&this.namespace[r]||void 0:r?(nf("data",this.frozen),this.namespace=r,this):this.namespace}freeze(){if(this.frozen)return this;const r=this;for(;++this.freezeIndex<this.attachers.length;){const[i,...a]=this.attachers[this.freezeIndex];if(a[0]===!1)continue;a[0]===!0&&(a[0]=void 0);const u=i.call(r,...a);typeof u=="function"&&this.transformers.use(u)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(r){this.freeze();const i=no(r),a=this.parser||this.Parser;return ef("parse",a),a(String(i),i)}process(r,i){const a=this;return this.freeze(),ef("process",this.parser||this.Parser),tf("process",this.compiler||this.Compiler),i?u(void 0,i):new Promise(u);function u(s,c){const f=no(r),h=a.parse(f);a.run(h,f,function(g,y,x){if(g||!y||!x)return d(g);const v=y,w=a.stringify(v,x);P_(w)?x.value=w:x.result=w,d(g,x)});function d(g,y){g||!y?c(g):s?s(y):i(void 0,y)}}}processSync(r){let i=!1,a;return this.freeze(),ef("processSync",this.parser||this.Parser),tf("processSync",this.compiler||this.Compiler),this.process(r,u),Lg("processSync","process",i),a;function u(s,c){i=!0,Rg(s),a=c}}run(r,i,a){jg(r),this.freeze();const u=this.transformers;return!a&&typeof i=="function"&&(a=i,i=void 0),a?s(void 0,a):new Promise(s);function s(c,f){const h=no(i);u.run(r,h,d);function d(g,y,x){const v=y||r;g?f(g):c?c(v):a(void 0,v,x)}}}runSync(r,i){let a=!1,u;return this.run(r,i,s),Lg("runSync","run",a),u;function s(c,f){Rg(c),u=f,a=!0}}stringify(r,i){this.freeze();const a=no(i),u=this.compiler||this.Compiler;return tf("stringify",u),jg(r),u(r,a)}use(r,...i){const a=this.attachers,u=this.namespace;if(nf("use",this.frozen),r!=null)if(typeof r=="function")h(r,i);else if(typeof r=="object")Array.isArray(r)?f(r):c(r);else throw new TypeError("Expected usable value, not `"+r+"`");return this;function s(d){if(typeof d=="function")h(d,[]);else if(typeof d=="object")if(Array.isArray(d)){const[g,...y]=d;h(g,y)}else c(d);else throw new TypeError("Expected usable value, not `"+d+"`")}function c(d){if(!("plugins"in d)&&!("settings"in d))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");f(d.plugins),d.settings&&(u.settings=$c(!0,u.settings,d.settings))}function f(d){let g=-1;if(d!=null)if(Array.isArray(d))for(;++g<d.length;){const y=d[g];s(y)}else throw new TypeError("Expected a list of plugins, not `"+d+"`")}function h(d,g){let y=-1,x=-1;for(;++y<a.length;)if(a[y][0]===d){x=y;break}if(x===-1)a.push([d,...g]);else if(g.length>0){let[v,...w]=g;const _=a[x][1];Ic(_)&&Ic(v)&&(v=$c(!0,_,v)),a[x]=[d,v,...w]}}}}const Z_=new Wc().freeze();function ef(e,r){if(typeof r!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function tf(e,r){if(typeof r!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function nf(e,r){if(r)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function jg(e){if(!Ic(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Lg(e,r,i){if(!i)throw new Error("`"+e+"` finished async. Use `"+r+"` instead")}function no(e){return K_(e)?e:new Dg(e)}function K_(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function P_(e){return typeof e=="string"||J_(e)}function J_(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const W_="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Ug=[],Bg={allowDangerousHtml:!0},eC=/^(https?|ircs?|mailto|xmpp)$/i,tC=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function nC(e){const r=rC(e),i=iC(e);return lC(r.runSync(r.parse(i),i),e)}function rC(e){const r=e.rehypePlugins||Ug,i=e.remarkPlugins||Ug,a=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...Bg}:Bg;return Z_().use(Uk).use(i).use(R_,a).use(r)}function iC(e){const r=e.children||"",i=new Dg;return typeof r=="string"&&(i.value=r),i}function lC(e,r){const i=r.allowedElements,a=r.allowElement,u=r.components,s=r.disallowedElements,c=r.skipHtml,f=r.unwrapDisallowed,h=r.urlTransform||aC;for(const g of tC)Object.hasOwn(r,g.from)&&(""+g.from+(g.to?"use `"+g.to+"` instead":"remove it")+W_+g.id,void 0);return Xc(e,d),A2(e,{Fragment:k.Fragment,components:u,ignoreInvalidStyle:!0,jsx:k.jsx,jsxs:k.jsxs,passKeys:!0,passNode:!0});function d(g,y,x){if(g.type==="raw"&&x&&typeof y=="number")return c?x.children.splice(y,1):x.children[y]={type:"text",value:g.value},y;if(g.type==="element"){let v;for(v in Rc)if(Object.hasOwn(Rc,v)&&Object.hasOwn(g.properties,v)){const w=g.properties[v],_=Rc[v];(_===null||_.includes(g.tagName))&&(g.properties[v]=h(String(w||""),v,g))}}if(g.type==="element"){let v=i?!i.includes(g.tagName):s?s.includes(g.tagName):!1;if(!v&&a&&typeof y=="number"&&(v=!a(g,y,x)),v&&x&&typeof y=="number")return f&&g.children?x.children.splice(y,1,...g.children):x.children.splice(y,1),y}}}function aC(e){const r=e.indexOf(":"),i=e.indexOf("?"),a=e.indexOf("#"),u=e.indexOf("/");return r===-1||u!==-1&&r>u||i!==-1&&r>i||a!==-1&&r>a||eC.test(e.slice(0,r))?e:""}function Hg(e,r){const i=String(e);if(typeof r!="string")throw new TypeError("Expected character");let a=0,u=i.indexOf(r);for(;u!==-1;)a++,u=i.indexOf(r,u+r.length);return a}function uC(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function oC(e,r,i){const u=eo((i||{}).ignore||[]),s=sC(r);let c=-1;for(;++c<s.length;)zg(e,"text",f);function f(d,g){let y=-1,x;for(;++y<g.length;){const v=g[y],w=x?x.children:void 0;if(u(v,w?w.indexOf(v):void 0,x))return;x=v}if(x)return h(d,g)}function h(d,g){const y=g[g.length-1],x=s[c][0],v=s[c][1];let w=0;const C=y.children.indexOf(d);let E=!1,M=[];x.lastIndex=0;let L=x.exec(d.value);for(;L;){const U=L.index,V={index:L.index,input:L.input,stack:[...g,d]};let B=v(...L,V);if(typeof B=="string"&&(B=B.length>0?{type:"text",value:B}:void 0),B===!1?x.lastIndex=U+1:(w!==U&&M.push({type:"text",value:d.value.slice(w,U)}),Array.isArray(B)?M.push(...B):B&&M.push(B),w=U+L[0].length,E=!0),!x.global)break;L=x.exec(d.value)}return E?(w<d.value.length&&M.push({type:"text",value:d.value.slice(w)}),y.children.splice(C,1,...M)):M=[d],C+M.length}}function sC(e){const r=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const i=!e[0]||Array.isArray(e[0])?e:[e];let a=-1;for(;++a<i.length;){const u=i[a];r.push([cC(u[0]),fC(u[1])])}return r}function cC(e){return typeof e=="string"?new RegExp(uC(e),"g"):e}function fC(e){return typeof e=="function"?e:function(){return e}}const rf="phrasing",lf=["autolink","link","image","label"];function hC(){return{transforms:[xC],enter:{literalAutolink:mC,literalAutolinkEmail:af,literalAutolinkHttp:af,literalAutolinkWww:af},exit:{literalAutolink:vC,literalAutolinkEmail:yC,literalAutolinkHttp:pC,literalAutolinkWww:gC}}}function dC(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:rf,notInConstruct:lf},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:rf,notInConstruct:lf},{character:":",before:"[ps]",after:"\\/",inConstruct:rf,notInConstruct:lf}]}}function mC(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function af(e){this.config.enter.autolinkProtocol.call(this,e)}function pC(e){this.config.exit.autolinkProtocol.call(this,e)}function gC(e){this.config.exit.data.call(this,e);const r=this.stack[this.stack.length-1];r.type,r.url="http://"+this.sliceSerialize(e)}function yC(e){this.config.exit.autolinkEmail.call(this,e)}function vC(e){this.exit(e)}function xC(e){oC(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,bC],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),wC]],{ignore:["link","linkReference"]})}function bC(e,r,i,a,u){let s="";if(!qg(u)||(/^w/i.test(r)&&(i=r+i,r="",s="http://"),!SC(i)))return!1;const c=EC(i+a);if(!c[0])return!1;const f={type:"link",title:null,url:s+r+c[0],children:[{type:"text",value:r+c[0]}]};return c[1]?[f,{type:"text",value:c[1]}]:f}function wC(e,r,i,a){return!qg(a,!0)||/[-\d_]$/.test(i)?!1:{type:"link",title:null,url:"mailto:"+r+"@"+i,children:[{type:"text",value:r+"@"+i}]}}function SC(e){const r=e.split(".");return!(r.length<2||r[r.length-1]&&(/_/.test(r[r.length-1])||!/[a-zA-Z\d]/.test(r[r.length-1]))||r[r.length-2]&&(/_/.test(r[r.length-2])||!/[a-zA-Z\d]/.test(r[r.length-2])))}function EC(e){const r=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!r)return[e,void 0];e=e.slice(0,r.index);let i=r[0],a=i.indexOf(")");const u=Hg(e,"(");let s=Hg(e,")");for(;a!==-1&&u>s;)e+=i.slice(0,a+1),i=i.slice(a+1),a=i.indexOf(")"),s++;return[e,i]}function qg(e,r){const i=e.input.charCodeAt(e.index-1);return(e.index===0||Ri(i)||Qu(i))&&(!r||i!==47)}Yg.peek=NC;function kC(){this.buffer()}function _C(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function CC(){this.buffer()}function TC(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function zC(e){const r=this.resume(),i=this.stack[this.stack.length-1];i.type,i.identifier=Vn(this.sliceSerialize(e)).toLowerCase(),i.label=r}function AC(e){this.exit(e)}function MC(e){const r=this.resume(),i=this.stack[this.stack.length-1];i.type,i.identifier=Vn(this.sliceSerialize(e)).toLowerCase(),i.label=r}function RC(e){this.exit(e)}function NC(){return"["}function Yg(e,r,i,a){const u=i.createTracker(a);let s=u.move("[^");const c=i.enter("footnoteReference"),f=i.enter("reference");return s+=u.move(i.safe(i.associationId(e),{after:"]",before:s})),f(),c(),s+=u.move("]"),s}function DC(){return{enter:{gfmFootnoteCallString:kC,gfmFootnoteCall:_C,gfmFootnoteDefinitionLabelString:CC,gfmFootnoteDefinition:TC},exit:{gfmFootnoteCallString:zC,gfmFootnoteCall:AC,gfmFootnoteDefinitionLabelString:MC,gfmFootnoteDefinition:RC}}}function OC(e){let r=!1;return e&&e.firstLineBlank&&(r=!0),{handlers:{footnoteDefinition:i,footnoteReference:Yg},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function i(a,u,s,c){const f=s.createTracker(c);let h=f.move("[^");const d=s.enter("footnoteDefinition"),g=s.enter("label");return h+=f.move(s.safe(s.associationId(a),{before:h,after:"]"})),g(),h+=f.move("]:"),a.children&&a.children.length>0&&(f.shift(4),h+=f.move((r?`
`:" ")+s.indentLines(s.containerFlow(a,f.current()),r?Vg:jC))),d(),h}}function jC(e,r,i){return r===0?e:Vg(e,r,i)}function Vg(e,r,i){return(i?"":"    ")+e}const LC=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];Fg.peek=YC;function UC(){return{canContainEols:["delete"],enter:{strikethrough:HC},exit:{strikethrough:qC}}}function BC(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:LC}],handlers:{delete:Fg}}}function HC(e){this.enter({type:"delete",children:[]},e)}function qC(e){this.exit(e)}function Fg(e,r,i,a){const u=i.createTracker(a),s=i.enter("strikethrough");let c=u.move("~~");return c+=i.containerPhrasing(e,{...u.current(),before:c,after:"~"}),c+=u.move("~~"),s(),c}function YC(){return"~"}function VC(e){return e.length}function FC(e,r){const i=r||{},a=(i.align||[]).concat(),u=i.stringLength||VC,s=[],c=[],f=[],h=[];let d=0,g=-1;for(;++g<e.length;){const _=[],C=[];let E=-1;for(e[g].length>d&&(d=e[g].length);++E<e[g].length;){const M=XC(e[g][E]);if(i.alignDelimiters!==!1){const L=u(M);C[E]=L,(h[E]===void 0||L>h[E])&&(h[E]=L)}_.push(M)}c[g]=_,f[g]=C}let y=-1;if(typeof a=="object"&&"length"in a)for(;++y<d;)s[y]=Xg(a[y]);else{const _=Xg(a);for(;++y<d;)s[y]=_}y=-1;const x=[],v=[];for(;++y<d;){const _=s[y];let C="",E="";_===99?(C=":",E=":"):_===108?C=":":_===114&&(E=":");let M=i.alignDelimiters===!1?1:Math.max(1,h[y]-C.length-E.length);const L=C+"-".repeat(M)+E;i.alignDelimiters!==!1&&(M=C.length+M+E.length,M>h[y]&&(h[y]=M),v[y]=M),x[y]=L}c.splice(1,0,x),f.splice(1,0,v),g=-1;const w=[];for(;++g<c.length;){const _=c[g],C=f[g];y=-1;const E=[];for(;++y<d;){const M=_[y]||"";let L="",U="";if(i.alignDelimiters!==!1){const V=h[y]-(C[y]||0),B=s[y];B===114?L=" ".repeat(V):B===99?V%2?(L=" ".repeat(V/2+.5),U=" ".repeat(V/2-.5)):(L=" ".repeat(V/2),U=L):U=" ".repeat(V)}i.delimiterStart!==!1&&!y&&E.push("|"),i.padding!==!1&&!(i.alignDelimiters===!1&&M==="")&&(i.delimiterStart!==!1||y)&&E.push(" "),i.alignDelimiters!==!1&&E.push(L),E.push(M),i.alignDelimiters!==!1&&E.push(U),i.padding!==!1&&E.push(" "),(i.delimiterEnd!==!1||y!==d-1)&&E.push("|")}w.push(i.delimiterEnd===!1?E.join("").replace(/ +$/,""):E.join(""))}return w.join(`
`)}function XC(e){return e==null?"":String(e)}function Xg(e){const r=typeof e=="string"?e.codePointAt(0):0;return r===67||r===99?99:r===76||r===108?108:r===82||r===114?114:0}function GC(e,r,i,a){const u=i.enter("blockquote"),s=i.createTracker(a);s.move("> "),s.shift(2);const c=i.indentLines(i.containerFlow(e,s.current()),QC);return u(),c}function QC(e,r,i){return">"+(i?"":" ")+e}function $C(e,r){return Gg(e,r.inConstruct,!0)&&!Gg(e,r.notInConstruct,!1)}function Gg(e,r,i){if(typeof r=="string"&&(r=[r]),!r||r.length===0)return i;let a=-1;for(;++a<r.length;)if(e.includes(r[a]))return!0;return!1}function Qg(e,r,i,a){let u=-1;for(;++u<i.unsafe.length;)if(i.unsafe[u].character===`
`&&$C(i.stack,i.unsafe[u]))return/[ \t]/.test(a.before)?"":" ";return`\\
`}function IC(e,r){const i=String(e);let a=i.indexOf(r),u=a,s=0,c=0;if(typeof r!="string")throw new TypeError("Expected substring");for(;a!==-1;)a===u?++s>c&&(c=s):s=1,u=a+r.length,a=i.indexOf(r,u);return c}function ZC(e,r){return!!(r.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function KC(e){const r=e.options.fence||"`";if(r!=="`"&&r!=="~")throw new Error("Cannot serialize code with `"+r+"` for `options.fence`, expected `` ` `` or `~`");return r}function PC(e,r,i,a){const u=KC(i),s=e.value||"",c=u==="`"?"GraveAccent":"Tilde";if(ZC(e,i)){const y=i.enter("codeIndented"),x=i.indentLines(s,JC);return y(),x}const f=i.createTracker(a),h=u.repeat(Math.max(IC(s,u)+1,3)),d=i.enter("codeFenced");let g=f.move(h);if(e.lang){const y=i.enter(`codeFencedLang${c}`);g+=f.move(i.safe(e.lang,{before:g,after:" ",encode:["`"],...f.current()})),y()}if(e.lang&&e.meta){const y=i.enter(`codeFencedMeta${c}`);g+=f.move(" "),g+=f.move(i.safe(e.meta,{before:g,after:`
`,encode:["`"],...f.current()})),y()}return g+=f.move(`
`),s&&(g+=f.move(s+`
`)),g+=f.move(h),d(),g}function JC(e,r,i){return(i?"":"    ")+e}function uf(e){const r=e.options.quote||'"';if(r!=='"'&&r!=="'")throw new Error("Cannot serialize title with `"+r+"` for `options.quote`, expected `\"`, or `'`");return r}function WC(e,r,i,a){const u=uf(i),s=u==='"'?"Quote":"Apostrophe",c=i.enter("definition");let f=i.enter("label");const h=i.createTracker(a);let d=h.move("[");return d+=h.move(i.safe(i.associationId(e),{before:d,after:"]",...h.current()})),d+=h.move("]: "),f(),!e.url||/[\0- \u007F]/.test(e.url)?(f=i.enter("destinationLiteral"),d+=h.move("<"),d+=h.move(i.safe(e.url,{before:d,after:">",...h.current()})),d+=h.move(">")):(f=i.enter("destinationRaw"),d+=h.move(i.safe(e.url,{before:d,after:e.title?" ":`
`,...h.current()}))),f(),e.title&&(f=i.enter(`title${s}`),d+=h.move(" "+u),d+=h.move(i.safe(e.title,{before:d,after:u,...h.current()})),d+=h.move(u),f()),c(),d}function e4(e){const r=e.options.emphasis||"*";if(r!=="*"&&r!=="_")throw new Error("Cannot serialize emphasis with `"+r+"` for `options.emphasis`, expected `*`, or `_`");return r}function Aa(e){return"&#x"+e.toString(16).toUpperCase()+";"}function ro(e,r,i){const a=dl(e),u=dl(r);return a===void 0?u===void 0?i==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:u===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:a===1?u===void 0?{inside:!1,outside:!1}:u===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:u===void 0?{inside:!1,outside:!1}:u===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}$g.peek=t4;function $g(e,r,i,a){const u=e4(i),s=i.enter("emphasis"),c=i.createTracker(a),f=c.move(u);let h=c.move(i.containerPhrasing(e,{after:u,before:f,...c.current()}));const d=h.charCodeAt(0),g=ro(a.before.charCodeAt(a.before.length-1),d,u);g.inside&&(h=Aa(d)+h.slice(1));const y=h.charCodeAt(h.length-1),x=ro(a.after.charCodeAt(0),y,u);x.inside&&(h=h.slice(0,-1)+Aa(y));const v=c.move(u);return s(),i.attentionEncodeSurroundingInfo={after:x.outside,before:g.outside},f+h+v}function t4(e,r,i){return i.options.emphasis||"*"}function n4(e,r){let i=!1;return Xc(e,function(a){if("value"in a&&/\r?\n|\r/.test(a.value)||a.type==="break")return i=!0,Fc}),!!((!e.depth||e.depth<3)&&Nc(e)&&(r.options.setext||i))}function r4(e,r,i,a){const u=Math.max(Math.min(6,e.depth||1),1),s=i.createTracker(a);if(n4(e,i)){const g=i.enter("headingSetext"),y=i.enter("phrasing"),x=i.containerPhrasing(e,{...s.current(),before:`
`,after:`
`});return y(),g(),x+`
`+(u===1?"=":"-").repeat(x.length-(Math.max(x.lastIndexOf("\r"),x.lastIndexOf(`
`))+1))}const c="#".repeat(u),f=i.enter("headingAtx"),h=i.enter("phrasing");s.move(c+" ");let d=i.containerPhrasing(e,{before:"# ",after:`
`,...s.current()});return/^[\t ]/.test(d)&&(d=Aa(d.charCodeAt(0))+d.slice(1)),d=d?c+" "+d:c,i.options.closeAtx&&(d+=" "+c),h(),f(),d}Ig.peek=i4;function Ig(e){return e.value||""}function i4(){return"<"}Zg.peek=l4;function Zg(e,r,i,a){const u=uf(i),s=u==='"'?"Quote":"Apostrophe",c=i.enter("image");let f=i.enter("label");const h=i.createTracker(a);let d=h.move("![");return d+=h.move(i.safe(e.alt,{before:d,after:"]",...h.current()})),d+=h.move("]("),f(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(f=i.enter("destinationLiteral"),d+=h.move("<"),d+=h.move(i.safe(e.url,{before:d,after:">",...h.current()})),d+=h.move(">")):(f=i.enter("destinationRaw"),d+=h.move(i.safe(e.url,{before:d,after:e.title?" ":")",...h.current()}))),f(),e.title&&(f=i.enter(`title${s}`),d+=h.move(" "+u),d+=h.move(i.safe(e.title,{before:d,after:u,...h.current()})),d+=h.move(u),f()),d+=h.move(")"),c(),d}function l4(){return"!"}Kg.peek=a4;function Kg(e,r,i,a){const u=e.referenceType,s=i.enter("imageReference");let c=i.enter("label");const f=i.createTracker(a);let h=f.move("![");const d=i.safe(e.alt,{before:h,after:"]",...f.current()});h+=f.move(d+"]["),c();const g=i.stack;i.stack=[],c=i.enter("reference");const y=i.safe(i.associationId(e),{before:h,after:"]",...f.current()});return c(),i.stack=g,s(),u==="full"||!d||d!==y?h+=f.move(y+"]"):u==="shortcut"?h=h.slice(0,-1):h+=f.move("]"),h}function a4(){return"!"}Pg.peek=u4;function Pg(e,r,i){let a=e.value||"",u="`",s=-1;for(;new RegExp("(^|[^`])"+u+"([^`]|$)").test(a);)u+="`";for(/[^ \r\n]/.test(a)&&(/^[ \r\n]/.test(a)&&/[ \r\n]$/.test(a)||/^`|`$/.test(a))&&(a=" "+a+" ");++s<i.unsafe.length;){const c=i.unsafe[s],f=i.compilePattern(c);let h;if(c.atBreak)for(;h=f.exec(a);){let d=h.index;a.charCodeAt(d)===10&&a.charCodeAt(d-1)===13&&d--,a=a.slice(0,d)+" "+a.slice(h.index+1)}}return u+a+u}function u4(){return"`"}function Jg(e,r){const i=Nc(e);return!!(!r.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(i===e.url||"mailto:"+i===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}Wg.peek=o4;function Wg(e,r,i,a){const u=uf(i),s=u==='"'?"Quote":"Apostrophe",c=i.createTracker(a);let f,h;if(Jg(e,i)){const g=i.stack;i.stack=[],f=i.enter("autolink");let y=c.move("<");return y+=c.move(i.containerPhrasing(e,{before:y,after:">",...c.current()})),y+=c.move(">"),f(),i.stack=g,y}f=i.enter("link"),h=i.enter("label");let d=c.move("[");return d+=c.move(i.containerPhrasing(e,{before:d,after:"](",...c.current()})),d+=c.move("]("),h(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(h=i.enter("destinationLiteral"),d+=c.move("<"),d+=c.move(i.safe(e.url,{before:d,after:">",...c.current()})),d+=c.move(">")):(h=i.enter("destinationRaw"),d+=c.move(i.safe(e.url,{before:d,after:e.title?" ":")",...c.current()}))),h(),e.title&&(h=i.enter(`title${s}`),d+=c.move(" "+u),d+=c.move(i.safe(e.title,{before:d,after:u,...c.current()})),d+=c.move(u),h()),d+=c.move(")"),f(),d}function o4(e,r,i){return Jg(e,i)?"<":"["}ey.peek=s4;function ey(e,r,i,a){const u=e.referenceType,s=i.enter("linkReference");let c=i.enter("label");const f=i.createTracker(a);let h=f.move("[");const d=i.containerPhrasing(e,{before:h,after:"]",...f.current()});h+=f.move(d+"]["),c();const g=i.stack;i.stack=[],c=i.enter("reference");const y=i.safe(i.associationId(e),{before:h,after:"]",...f.current()});return c(),i.stack=g,s(),u==="full"||!d||d!==y?h+=f.move(y+"]"):u==="shortcut"?h=h.slice(0,-1):h+=f.move("]"),h}function s4(){return"["}function of(e){const r=e.options.bullet||"*";if(r!=="*"&&r!=="+"&&r!=="-")throw new Error("Cannot serialize items with `"+r+"` for `options.bullet`, expected `*`, `+`, or `-`");return r}function c4(e){const r=of(e),i=e.options.bulletOther;if(!i)return r==="*"?"-":"*";if(i!=="*"&&i!=="+"&&i!=="-")throw new Error("Cannot serialize items with `"+i+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(i===r)throw new Error("Expected `bullet` (`"+r+"`) and `bulletOther` (`"+i+"`) to be different");return i}function f4(e){const r=e.options.bulletOrdered||".";if(r!=="."&&r!==")")throw new Error("Cannot serialize items with `"+r+"` for `options.bulletOrdered`, expected `.` or `)`");return r}function ty(e){const r=e.options.rule||"*";if(r!=="*"&&r!=="-"&&r!=="_")throw new Error("Cannot serialize rules with `"+r+"` for `options.rule`, expected `*`, `-`, or `_`");return r}function h4(e,r,i,a){const u=i.enter("list"),s=i.bulletCurrent;let c=e.ordered?f4(i):of(i);const f=e.ordered?c==="."?")":".":c4(i);let h=r&&i.bulletLastUsed?c===i.bulletLastUsed:!1;if(!e.ordered){const g=e.children?e.children[0]:void 0;if((c==="*"||c==="-")&&g&&(!g.children||!g.children[0])&&i.stack[i.stack.length-1]==="list"&&i.stack[i.stack.length-2]==="listItem"&&i.stack[i.stack.length-3]==="list"&&i.stack[i.stack.length-4]==="listItem"&&i.indexStack[i.indexStack.length-1]===0&&i.indexStack[i.indexStack.length-2]===0&&i.indexStack[i.indexStack.length-3]===0&&(h=!0),ty(i)===c&&g){let y=-1;for(;++y<e.children.length;){const x=e.children[y];if(x&&x.type==="listItem"&&x.children&&x.children[0]&&x.children[0].type==="thematicBreak"){h=!0;break}}}}h&&(c=f),i.bulletCurrent=c;const d=i.containerFlow(e,a);return i.bulletLastUsed=c,i.bulletCurrent=s,u(),d}function d4(e){const r=e.options.listItemIndent||"one";if(r!=="tab"&&r!=="one"&&r!=="mixed")throw new Error("Cannot serialize items with `"+r+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return r}function m4(e,r,i,a){const u=d4(i);let s=i.bulletCurrent||of(i);r&&r.type==="list"&&r.ordered&&(s=(typeof r.start=="number"&&r.start>-1?r.start:1)+(i.options.incrementListMarker===!1?0:r.children.indexOf(e))+s);let c=s.length+1;(u==="tab"||u==="mixed"&&(r&&r.type==="list"&&r.spread||e.spread))&&(c=Math.ceil(c/4)*4);const f=i.createTracker(a);f.move(s+" ".repeat(c-s.length)),f.shift(c);const h=i.enter("listItem"),d=i.indentLines(i.containerFlow(e,f.current()),g);return h(),d;function g(y,x,v){return x?(v?"":" ".repeat(c))+y:(v?s:s+" ".repeat(c-s.length))+y}}function p4(e,r,i,a){const u=i.enter("paragraph"),s=i.enter("phrasing"),c=i.containerPhrasing(e,a);return s(),u(),c}const g4=eo(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function y4(e,r,i,a){return(e.children.some(function(c){return g4(c)})?i.containerPhrasing:i.containerFlow).call(i,e,a)}function v4(e){const r=e.options.strong||"*";if(r!=="*"&&r!=="_")throw new Error("Cannot serialize strong with `"+r+"` for `options.strong`, expected `*`, or `_`");return r}ny.peek=x4;function ny(e,r,i,a){const u=v4(i),s=i.enter("strong"),c=i.createTracker(a),f=c.move(u+u);let h=c.move(i.containerPhrasing(e,{after:u,before:f,...c.current()}));const d=h.charCodeAt(0),g=ro(a.before.charCodeAt(a.before.length-1),d,u);g.inside&&(h=Aa(d)+h.slice(1));const y=h.charCodeAt(h.length-1),x=ro(a.after.charCodeAt(0),y,u);x.inside&&(h=h.slice(0,-1)+Aa(y));const v=c.move(u+u);return s(),i.attentionEncodeSurroundingInfo={after:x.outside,before:g.outside},f+h+v}function x4(e,r,i){return i.options.strong||"*"}function b4(e,r,i,a){return i.safe(e.value,a)}function w4(e){const r=e.options.ruleRepetition||3;if(r<3)throw new Error("Cannot serialize rules with repetition `"+r+"` for `options.ruleRepetition`, expected `3` or more");return r}function S4(e,r,i){const a=(ty(i)+(i.options.ruleSpaces?" ":"")).repeat(w4(i));return i.options.ruleSpaces?a.slice(0,-1):a}const ry={blockquote:GC,break:Qg,code:PC,definition:WC,emphasis:$g,hardBreak:Qg,heading:r4,html:Ig,image:Zg,imageReference:Kg,inlineCode:Pg,link:Wg,linkReference:ey,list:h4,listItem:m4,paragraph:p4,root:y4,strong:ny,text:b4,thematicBreak:S4};function E4(){return{enter:{table:k4,tableData:iy,tableHeader:iy,tableRow:C4},exit:{codeText:T4,table:_4,tableData:sf,tableHeader:sf,tableRow:sf}}}function k4(e){const r=e._align;this.enter({type:"table",align:r.map(function(i){return i==="none"?null:i}),children:[]},e),this.data.inTable=!0}function _4(e){this.exit(e),this.data.inTable=void 0}function C4(e){this.enter({type:"tableRow",children:[]},e)}function sf(e){this.exit(e)}function iy(e){this.enter({type:"tableCell",children:[]},e)}function T4(e){let r=this.resume();this.data.inTable&&(r=r.replace(/\\([\\|])/g,z4));const i=this.stack[this.stack.length-1];i.type,i.value=r,this.exit(e)}function z4(e,r){return r==="|"?r:e}function A4(e){const r=e||{},i=r.tableCellPadding,a=r.tablePipeAlign,u=r.stringLength,s=i?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:x,table:c,tableCell:h,tableRow:f}};function c(v,w,_,C){return d(g(v,_,C),v.align)}function f(v,w,_,C){const E=y(v,_,C),M=d([E]);return M.slice(0,M.indexOf(`
`))}function h(v,w,_,C){const E=_.enter("tableCell"),M=_.enter("phrasing"),L=_.containerPhrasing(v,{...C,before:s,after:s});return M(),E(),L}function d(v,w){return FC(v,{align:w,alignDelimiters:a,padding:i,stringLength:u})}function g(v,w,_){const C=v.children;let E=-1;const M=[],L=w.enter("table");for(;++E<C.length;)M[E]=y(C[E],w,_);return L(),M}function y(v,w,_){const C=v.children;let E=-1;const M=[],L=w.enter("tableRow");for(;++E<C.length;)M[E]=h(C[E],v,w,_);return L(),M}function x(v,w,_){let C=ry.inlineCode(v,w,_);return _.stack.includes("tableCell")&&(C=C.replace(/\|/g,"\\$&")),C}}function M4(){return{exit:{taskListCheckValueChecked:ly,taskListCheckValueUnchecked:ly,paragraph:N4}}}function R4(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:D4}}}function ly(e){const r=this.stack[this.stack.length-2];r.type,r.checked=e.type==="taskListCheckValueChecked"}function N4(e){const r=this.stack[this.stack.length-2];if(r&&r.type==="listItem"&&typeof r.checked=="boolean"){const i=this.stack[this.stack.length-1];i.type;const a=i.children[0];if(a&&a.type==="text"){const u=r.children;let s=-1,c;for(;++s<u.length;){const f=u[s];if(f.type==="paragraph"){c=f;break}}c===i&&(a.value=a.value.slice(1),a.value.length===0?i.children.shift():i.position&&a.position&&typeof a.position.start.offset=="number"&&(a.position.start.column++,a.position.start.offset++,i.position.start=Object.assign({},a.position.start)))}}this.exit(e)}function D4(e,r,i,a){const u=e.children[0],s=typeof e.checked=="boolean"&&u&&u.type==="paragraph",c="["+(e.checked?"x":" ")+"] ",f=i.createTracker(a);s&&f.move(c);let h=ry.listItem(e,r,i,{...a,...f.current()});return s&&(h=h.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,d)),h;function d(g){return g+c}}function O4(){return[hC(),DC(),UC(),E4(),M4()]}function j4(e){return{extensions:[dC(),OC(e),BC(),A4(e),R4()]}}const L4={tokenize:V4,partial:!0},ay={tokenize:F4,partial:!0},uy={tokenize:X4,partial:!0},oy={tokenize:G4,partial:!0},U4={tokenize:Q4,partial:!0},sy={name:"wwwAutolink",tokenize:q4,previous:fy},cy={name:"protocolAutolink",tokenize:Y4,previous:hy},pr={name:"emailAutolink",tokenize:H4,previous:dy},rr={};function B4(){return{text:rr}}let Ni=48;for(;Ni<123;)rr[Ni]=pr,Ni++,Ni===58?Ni=65:Ni===91&&(Ni=97);rr[43]=pr,rr[45]=pr,rr[46]=pr,rr[95]=pr,rr[72]=[pr,cy],rr[104]=[pr,cy],rr[87]=[pr,sy],rr[119]=[pr,sy];function H4(e,r,i){const a=this;let u,s;return c;function c(y){return!cf(y)||!dy.call(a,a.previous)||ff(a.events)?i(y):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),f(y))}function f(y){return cf(y)?(e.consume(y),f):y===64?(e.consume(y),h):i(y)}function h(y){return y===46?e.check(U4,g,d)(y):y===45||y===95||Xt(y)?(s=!0,e.consume(y),h):g(y)}function d(y){return e.consume(y),u=!0,h}function g(y){return s&&u&&Gt(a.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),r(y)):i(y)}}function q4(e,r,i){const a=this;return u;function u(c){return c!==87&&c!==119||!fy.call(a,a.previous)||ff(a.events)?i(c):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(L4,e.attempt(ay,e.attempt(uy,s),i),i)(c))}function s(c){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),r(c)}}function Y4(e,r,i){const a=this;let u="",s=!1;return c;function c(y){return(y===72||y===104)&&hy.call(a,a.previous)&&!ff(a.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),u+=String.fromCodePoint(y),e.consume(y),f):i(y)}function f(y){if(Gt(y)&&u.length<5)return u+=String.fromCodePoint(y),e.consume(y),f;if(y===58){const x=u.toLowerCase();if(x==="http"||x==="https")return e.consume(y),h}return i(y)}function h(y){return y===47?(e.consume(y),s?d:(s=!0,h)):i(y)}function d(y){return y===null||Gu(y)||ot(y)||Ri(y)||Qu(y)?i(y):e.attempt(ay,e.attempt(uy,g),i)(y)}function g(y){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),r(y)}}function V4(e,r,i){let a=0;return u;function u(c){return(c===87||c===119)&&a<3?(a++,e.consume(c),u):c===46&&a===3?(e.consume(c),s):i(c)}function s(c){return c===null?i(c):r(c)}}function F4(e,r,i){let a,u,s;return c;function c(d){return d===46||d===95?e.check(oy,h,f)(d):d===null||ot(d)||Ri(d)||d!==45&&Qu(d)?h(d):(s=!0,e.consume(d),c)}function f(d){return d===95?a=!0:(u=a,a=void 0),e.consume(d),c}function h(d){return u||a||!s?i(d):r(d)}}function X4(e,r){let i=0,a=0;return u;function u(c){return c===40?(i++,e.consume(c),u):c===41&&a<i?s(c):c===33||c===34||c===38||c===39||c===41||c===42||c===44||c===46||c===58||c===59||c===60||c===63||c===93||c===95||c===126?e.check(oy,r,s)(c):c===null||ot(c)||Ri(c)?r(c):(e.consume(c),u)}function s(c){return c===41&&a++,e.consume(c),u}}function G4(e,r,i){return a;function a(f){return f===33||f===34||f===39||f===41||f===42||f===44||f===46||f===58||f===59||f===63||f===95||f===126?(e.consume(f),a):f===38?(e.consume(f),s):f===93?(e.consume(f),u):f===60||f===null||ot(f)||Ri(f)?r(f):i(f)}function u(f){return f===null||f===40||f===91||ot(f)||Ri(f)?r(f):a(f)}function s(f){return Gt(f)?c(f):i(f)}function c(f){return f===59?(e.consume(f),a):Gt(f)?(e.consume(f),c):i(f)}}function Q4(e,r,i){return a;function a(s){return e.consume(s),u}function u(s){return Xt(s)?i(s):r(s)}}function fy(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||ot(e)}function hy(e){return!Gt(e)}function dy(e){return!(e===47||cf(e))}function cf(e){return e===43||e===45||e===46||e===95||Xt(e)}function ff(e){let r=e.length,i=!1;for(;r--;){const a=e[r][1];if((a.type==="labelLink"||a.type==="labelImage")&&!a._balanced){i=!0;break}if(a._gfmAutolinkLiteralWalkedInto){i=!1;break}}return e.length>0&&!i&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),i}const $4={tokenize:tT,partial:!0};function I4(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:J4,continuation:{tokenize:W4},exit:eT}},text:{91:{name:"gfmFootnoteCall",tokenize:P4},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:Z4,resolveTo:K4}}}}function Z4(e,r,i){const a=this;let u=a.events.length;const s=a.parser.gfmFootnotes||(a.parser.gfmFootnotes=[]);let c;for(;u--;){const h=a.events[u][1];if(h.type==="labelImage"){c=h;break}if(h.type==="gfmFootnoteCall"||h.type==="labelLink"||h.type==="label"||h.type==="image"||h.type==="link")break}return f;function f(h){if(!c||!c._balanced)return i(h);const d=Vn(a.sliceSerialize({start:c.end,end:a.now()}));return d.codePointAt(0)!==94||!s.includes(d.slice(1))?i(h):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(h),e.exit("gfmFootnoteCallLabelMarker"),r(h))}}function K4(e,r){let i=e.length;for(;i--;)if(e[i][1].type==="labelImage"&&e[i][0]==="enter"){e[i][1];break}e[i+1][1].type="data",e[i+3][1].type="gfmFootnoteCallLabelMarker";const a={type:"gfmFootnoteCall",start:Object.assign({},e[i+3][1].start),end:Object.assign({},e[e.length-1][1].end)},u={type:"gfmFootnoteCallMarker",start:Object.assign({},e[i+3][1].end),end:Object.assign({},e[i+3][1].end)};u.end.column++,u.end.offset++,u.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},u.end),end:Object.assign({},e[e.length-1][1].start)},c={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},f=[e[i+1],e[i+2],["enter",a,r],e[i+3],e[i+4],["enter",u,r],["exit",u,r],["enter",s,r],["enter",c,r],["exit",c,r],["exit",s,r],e[e.length-2],e[e.length-1],["exit",a,r]];return e.splice(i,e.length-i+1,...f),e}function P4(e,r,i){const a=this,u=a.parser.gfmFootnotes||(a.parser.gfmFootnotes=[]);let s=0,c;return f;function f(y){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(y),e.exit("gfmFootnoteCallLabelMarker"),h}function h(y){return y!==94?i(y):(e.enter("gfmFootnoteCallMarker"),e.consume(y),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",d)}function d(y){if(s>999||y===93&&!c||y===null||y===91||ot(y))return i(y);if(y===93){e.exit("chunkString");const x=e.exit("gfmFootnoteCallString");return u.includes(Vn(a.sliceSerialize(x)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(y),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),r):i(y)}return ot(y)||(c=!0),s++,e.consume(y),y===92?g:d}function g(y){return y===91||y===92||y===93?(e.consume(y),s++,d):d(y)}}function J4(e,r,i){const a=this,u=a.parser.gfmFootnotes||(a.parser.gfmFootnotes=[]);let s,c=0,f;return h;function h(w){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(w),e.exit("gfmFootnoteDefinitionLabelMarker"),d}function d(w){return w===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(w),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",g):i(w)}function g(w){if(c>999||w===93&&!f||w===null||w===91||ot(w))return i(w);if(w===93){e.exit("chunkString");const _=e.exit("gfmFootnoteDefinitionLabelString");return s=Vn(a.sliceSerialize(_)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(w),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),x}return ot(w)||(f=!0),c++,e.consume(w),w===92?y:g}function y(w){return w===91||w===92||w===93?(e.consume(w),c++,g):g(w)}function x(w){return w===58?(e.enter("definitionMarker"),e.consume(w),e.exit("definitionMarker"),u.includes(s)||u.push(s),Ze(e,v,"gfmFootnoteDefinitionWhitespace")):i(w)}function v(w){return r(w)}}function W4(e,r,i){return e.check(Ea,r,e.attempt($4,r,i))}function eT(e){e.exit("gfmFootnoteDefinition")}function tT(e,r,i){const a=this;return Ze(e,u,"gfmFootnoteDefinitionIndent",5);function u(s){const c=a.events[a.events.length-1];return c&&c[1].type==="gfmFootnoteDefinitionIndent"&&c[2].sliceSerialize(c[1],!0).length===4?r(s):i(s)}}function nT(e){let i=(e||{}).singleTilde;const a={name:"strikethrough",tokenize:s,resolveAll:u};return i==null&&(i=!0),{text:{126:a},insideSpan:{null:[a]},attentionMarkers:{null:[126]}};function u(c,f){let h=-1;for(;++h<c.length;)if(c[h][0]==="enter"&&c[h][1].type==="strikethroughSequenceTemporary"&&c[h][1]._close){let d=h;for(;d--;)if(c[d][0]==="exit"&&c[d][1].type==="strikethroughSequenceTemporary"&&c[d][1]._open&&c[h][1].end.offset-c[h][1].start.offset===c[d][1].end.offset-c[d][1].start.offset){c[h][1].type="strikethroughSequence",c[d][1].type="strikethroughSequence";const g={type:"strikethrough",start:Object.assign({},c[d][1].start),end:Object.assign({},c[h][1].end)},y={type:"strikethroughText",start:Object.assign({},c[d][1].end),end:Object.assign({},c[h][1].start)},x=[["enter",g,f],["enter",c[d][1],f],["exit",c[d][1],f],["enter",y,f]],v=f.parser.constructs.insideSpan.null;v&&dn(x,x.length,0,$u(v,c.slice(d+1,h),f)),dn(x,x.length,0,[["exit",y,f],["enter",c[h][1],f],["exit",c[h][1],f],["exit",g,f]]),dn(c,d-1,h-d+3,x),h=d+x.length-2;break}}for(h=-1;++h<c.length;)c[h][1].type==="strikethroughSequenceTemporary"&&(c[h][1].type="data");return c}function s(c,f,h){const d=this.previous,g=this.events;let y=0;return x;function x(w){return d===126&&g[g.length-1][1].type!=="characterEscape"?h(w):(c.enter("strikethroughSequenceTemporary"),v(w))}function v(w){const _=dl(d);if(w===126)return y>1?h(w):(c.consume(w),y++,v);if(y<2&&!i)return h(w);const C=c.exit("strikethroughSequenceTemporary"),E=dl(w);return C._open=!E||E===2&&!!_,C._close=!_||_===2&&!!E,f(w)}}}class rT{constructor(){this.map=[]}add(r,i,a){iT(this,r,i,a)}consume(r){if(this.map.sort(function(s,c){return s[0]-c[0]}),this.map.length===0)return;let i=this.map.length;const a=[];for(;i>0;)i-=1,a.push(r.slice(this.map[i][0]+this.map[i][1]),this.map[i][2]),r.length=this.map[i][0];a.push(r.slice()),r.length=0;let u=a.pop();for(;u;){for(const s of u)r.push(s);u=a.pop()}this.map.length=0}}function iT(e,r,i,a){let u=0;if(!(i===0&&a.length===0)){for(;u<e.map.length;){if(e.map[u][0]===r){e.map[u][1]+=i,e.map[u][2].push(...a);return}u+=1}e.map.push([r,i,a])}}function lT(e,r){let i=!1;const a=[];for(;r<e.length;){const u=e[r];if(i){if(u[0]==="enter")u[1].type==="tableContent"&&a.push(e[r+1][1].type==="tableDelimiterMarker"?"left":"none");else if(u[1].type==="tableContent"){if(e[r-1][1].type==="tableDelimiterMarker"){const s=a.length-1;a[s]=a[s]==="left"?"center":"right"}}else if(u[1].type==="tableDelimiterRow")break}else u[0]==="enter"&&u[1].type==="tableDelimiterRow"&&(i=!0);r+=1}return a}function aT(){return{flow:{null:{name:"table",tokenize:uT,resolveAll:oT}}}}function uT(e,r,i){const a=this;let u=0,s=0,c;return f;function f(D){let ne=a.events.length-1;for(;ne>-1;){const H=a.events[ne][1].type;if(H==="lineEnding"||H==="linePrefix")ne--;else break}const ae=ne>-1?a.events[ne][1].type:null,ve=ae==="tableHead"||ae==="tableRow"?B:h;return ve===B&&a.parser.lazy[a.now().line]?i(D):ve(D)}function h(D){return e.enter("tableHead"),e.enter("tableRow"),d(D)}function d(D){return D===124||(c=!0,s+=1),g(D)}function g(D){return D===null?i(D):ze(D)?s>1?(s=0,a.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(D),e.exit("lineEnding"),v):i(D):He(D)?Ze(e,g,"whitespace")(D):(s+=1,c&&(c=!1,u+=1),D===124?(e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),c=!0,g):(e.enter("data"),y(D)))}function y(D){return D===null||D===124||ot(D)?(e.exit("data"),g(D)):(e.consume(D),D===92?x:y)}function x(D){return D===92||D===124?(e.consume(D),y):y(D)}function v(D){return a.interrupt=!1,a.parser.lazy[a.now().line]?i(D):(e.enter("tableDelimiterRow"),c=!1,He(D)?Ze(e,w,"linePrefix",a.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(D):w(D))}function w(D){return D===45||D===58?C(D):D===124?(c=!0,e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),_):V(D)}function _(D){return He(D)?Ze(e,C,"whitespace")(D):C(D)}function C(D){return D===58?(s+=1,c=!0,e.enter("tableDelimiterMarker"),e.consume(D),e.exit("tableDelimiterMarker"),E):D===45?(s+=1,E(D)):D===null||ze(D)?U(D):V(D)}function E(D){return D===45?(e.enter("tableDelimiterFiller"),M(D)):V(D)}function M(D){return D===45?(e.consume(D),M):D===58?(c=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(D),e.exit("tableDelimiterMarker"),L):(e.exit("tableDelimiterFiller"),L(D))}function L(D){return He(D)?Ze(e,U,"whitespace")(D):U(D)}function U(D){return D===124?w(D):D===null||ze(D)?!c||u!==s?V(D):(e.exit("tableDelimiterRow"),e.exit("tableHead"),r(D)):V(D)}function V(D){return i(D)}function B(D){return e.enter("tableRow"),N(D)}function N(D){return D===124?(e.enter("tableCellDivider"),e.consume(D),e.exit("tableCellDivider"),N):D===null||ze(D)?(e.exit("tableRow"),r(D)):He(D)?Ze(e,N,"whitespace")(D):(e.enter("data"),ee(D))}function ee(D){return D===null||D===124||ot(D)?(e.exit("data"),N(D)):(e.consume(D),D===92?G:ee)}function G(D){return D===92||D===124?(e.consume(D),ee):ee(D)}}function oT(e,r){let i=-1,a=!0,u=0,s=[0,0,0,0],c=[0,0,0,0],f=!1,h=0,d,g,y;const x=new rT;for(;++i<e.length;){const v=e[i],w=v[1];v[0]==="enter"?w.type==="tableHead"?(f=!1,h!==0&&(my(x,r,h,d,g),g=void 0,h=0),d={type:"table",start:Object.assign({},w.start),end:Object.assign({},w.end)},x.add(i,0,[["enter",d,r]])):w.type==="tableRow"||w.type==="tableDelimiterRow"?(a=!0,y=void 0,s=[0,0,0,0],c=[0,i+1,0,0],f&&(f=!1,g={type:"tableBody",start:Object.assign({},w.start),end:Object.assign({},w.end)},x.add(i,0,[["enter",g,r]])),u=w.type==="tableDelimiterRow"?2:g?3:1):u&&(w.type==="data"||w.type==="tableDelimiterMarker"||w.type==="tableDelimiterFiller")?(a=!1,c[2]===0&&(s[1]!==0&&(c[0]=c[1],y=io(x,r,s,u,void 0,y),s=[0,0,0,0]),c[2]=i)):w.type==="tableCellDivider"&&(a?a=!1:(s[1]!==0&&(c[0]=c[1],y=io(x,r,s,u,void 0,y)),s=c,c=[s[1],i,0,0])):w.type==="tableHead"?(f=!0,h=i):w.type==="tableRow"||w.type==="tableDelimiterRow"?(h=i,s[1]!==0?(c[0]=c[1],y=io(x,r,s,u,i,y)):c[1]!==0&&(y=io(x,r,c,u,i,y)),u=0):u&&(w.type==="data"||w.type==="tableDelimiterMarker"||w.type==="tableDelimiterFiller")&&(c[3]=i)}for(h!==0&&my(x,r,h,d,g),x.consume(r.events),i=-1;++i<r.events.length;){const v=r.events[i];v[0]==="enter"&&v[1].type==="table"&&(v[1]._align=lT(r.events,i))}return e}function io(e,r,i,a,u,s){const c=a===1?"tableHeader":a===2?"tableDelimiter":"tableData",f="tableContent";i[0]!==0&&(s.end=Object.assign({},pl(r.events,i[0])),e.add(i[0],0,[["exit",s,r]]));const h=pl(r.events,i[1]);if(s={type:c,start:Object.assign({},h),end:Object.assign({},h)},e.add(i[1],0,[["enter",s,r]]),i[2]!==0){const d=pl(r.events,i[2]),g=pl(r.events,i[3]),y={type:f,start:Object.assign({},d),end:Object.assign({},g)};if(e.add(i[2],0,[["enter",y,r]]),a!==2){const x=r.events[i[2]],v=r.events[i[3]];if(x[1].end=Object.assign({},v[1].end),x[1].type="chunkText",x[1].contentType="text",i[3]>i[2]+1){const w=i[2]+1,_=i[3]-i[2]-1;e.add(w,_,[])}}e.add(i[3]+1,0,[["exit",y,r]])}return u!==void 0&&(s.end=Object.assign({},pl(r.events,u)),e.add(u,0,[["exit",s,r]]),s=void 0),s}function my(e,r,i,a,u){const s=[],c=pl(r.events,i);u&&(u.end=Object.assign({},c),s.push(["exit",u,r])),a.end=Object.assign({},c),s.push(["exit",a,r]),e.add(i+1,0,s)}function pl(e,r){const i=e[r],a=i[0]==="enter"?"start":"end";return i[1][a]}const sT={name:"tasklistCheck",tokenize:fT};function cT(){return{text:{91:sT}}}function fT(e,r,i){const a=this;return u;function u(h){return a.previous!==null||!a._gfmTasklistFirstContentOfListItem?i(h):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(h),e.exit("taskListCheckMarker"),s)}function s(h){return ot(h)?(e.enter("taskListCheckValueUnchecked"),e.consume(h),e.exit("taskListCheckValueUnchecked"),c):h===88||h===120?(e.enter("taskListCheckValueChecked"),e.consume(h),e.exit("taskListCheckValueChecked"),c):i(h)}function c(h){return h===93?(e.enter("taskListCheckMarker"),e.consume(h),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),f):i(h)}function f(h){return ze(h)?r(h):He(h)?e.check({tokenize:hT},r,i)(h):i(h)}}function hT(e,r,i){return Ze(e,a,"whitespace");function a(u){return u===null?i(u):r(u)}}function dT(e){return Zp([B4(),I4(),nT(e),aT(),cT()])}const mT={};function pT(e){const r=this,i=e||mT,a=r.data(),u=a.micromarkExtensions||(a.micromarkExtensions=[]),s=a.fromMarkdownExtensions||(a.fromMarkdownExtensions=[]),c=a.toMarkdownExtensions||(a.toMarkdownExtensions=[]);u.push(dT(i)),s.push(O4()),c.push(j4(i))}const py={WHEN:"bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded text-sm font-semibold",GIVEN:"bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded text-sm font-semibold",THEN:"bg-green-500/20 text-green-400 px-1.5 py-0.5 rounded text-sm font-semibold",AND:"bg-gray-500/20 text-gray-400 px-1.5 py-0.5 rounded text-sm font-semibold",MUST:"text-red-400 font-bold",SHALL:"text-red-400 font-bold",ADDED:"bg-orange-500/20 text-orange-400 px-1.5 py-0.5 rounded text-xs font-semibold",MODIFIED:"bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded text-xs font-semibold"},hf=new RegExp(`\\b(${Object.keys(py).join("|")})\\b`,"g");function gy(e){const r=[];let i=0,a;for(hf.lastIndex=0;(a=hf.exec(e))!==null;){a.index>i&&r.push(e.slice(i,a.index));const u=a[1];r.push(k.jsx("span",{className:py[u],children:u},a.index)),i=hf.lastIndex}return i<e.length&&r.push(e.slice(i)),r}function df(e){return typeof e=="string"?gy(e):Array.isArray(e)?e.map((r,i)=>typeof r=="string"?k.jsx("span",{children:gy(r)},i):r):e}function lo({content:e,specTopics:r}){return k.jsx("div",{className:"markdown-body",children:k.jsx(nC,{remarkPlugins:[pT],components:{p({children:i}){return k.jsx("p",{className:"mb-4 leading-relaxed",children:df(i)})},li({children:i}){return k.jsx("li",{className:"mb-1",children:df(i)})},h1({children:i}){return k.jsx("h1",{className:"text-2xl font-bold mt-6 mb-4 text-text-primary",children:i})},h2({children:i}){return k.jsx("h2",{className:"text-xl font-bold mt-6 mb-3 text-text-primary border-b border-border pb-2",children:i})},h3({children:i}){return k.jsx("h3",{className:"text-lg font-semibold mt-5 mb-2 text-text-primary",children:i})},h4({children:i}){return k.jsx("h4",{className:"text-base font-semibold mt-4 mb-2 text-text-secondary",children:i})},h5({children:i}){return k.jsx("h5",{className:"text-sm font-semibold mt-3 mb-1 text-text-secondary",children:i})},h6({children:i}){return k.jsx("h6",{className:"text-sm font-medium mt-3 mb-1 text-text-muted",children:i})},strong({children:i}){return k.jsx("strong",{className:"font-bold text-text-primary",children:df(i)})},em({children:i}){return k.jsx("em",{className:"italic text-text-secondary",children:i})},a({href:i,children:a}){return k.jsx("a",{href:i,className:"text-accent hover:text-accent-hover underline transition-colors",target:"_blank",rel:"noopener noreferrer",children:a})},code({className:i,children:a}){if(i==null?void 0:i.startsWith("language-"))return k.jsx("code",{className:`${i} block`,children:a});const s=typeof a=="string"?a:String(a??"");return r!=null&&r.includes(s)?k.jsx(fn,{to:`/specs/${s}`,className:"bg-bg-tertiary text-accent hover:text-accent-hover px-1.5 py-0.5 rounded text-sm underline decoration-dotted transition-colors",children:s}):k.jsx("code",{className:"bg-bg-tertiary text-accent px-1.5 py-0.5 rounded text-sm",children:a})},pre({children:i}){return k.jsx("pre",{className:"bg-bg-tertiary border border-border rounded-lg p-4 text-sm overflow-x-auto mb-4 leading-relaxed",children:i})},table({children:i}){return k.jsx("div",{className:"overflow-x-auto mb-4",children:k.jsx("table",{className:"min-w-full border-collapse border border-border text-sm",children:i})})},thead({children:i}){return k.jsx("thead",{className:"bg-bg-tertiary",children:i})},th({children:i}){return k.jsx("th",{className:"border border-border px-3 py-2 text-left font-semibold text-text-secondary",children:i})},td({children:i}){return k.jsx("td",{className:"border border-border px-3 py-2 text-text-primary",children:i})},ul({children:i}){return k.jsx("ul",{className:"list-disc list-inside mb-4 space-y-1",children:i})},ol({children:i}){return k.jsx("ol",{className:"list-decimal list-inside mb-4 space-y-1",children:i})},hr(){return k.jsx("hr",{className:"border-border my-6"})},blockquote({children:i}){return k.jsx("blockquote",{className:"border-l-4 border-accent pl-4 my-4 text-text-secondary italic",children:i})},input({checked:i,type:a}){return a==="checkbox"?k.jsx("input",{type:"checkbox",checked:i,readOnly:!0,className:"mr-2 accent-accent"}):k.jsx("input",{type:a})}},children:e})})}class gT{diff(r,i,a={}){let u;typeof a=="function"?(u=a,a={}):"callback"in a&&(u=a.callback);const s=this.castInput(r,a),c=this.castInput(i,a),f=this.removeEmpty(this.tokenize(s,a)),h=this.removeEmpty(this.tokenize(c,a));return this.diffWithOptionsObj(f,h,a,u)}diffWithOptionsObj(r,i,a,u){var s;const c=M=>{if(M=this.postProcess(M,a),u){setTimeout(function(){u(M)},0);return}else return M},f=i.length,h=r.length;let d=1,g=f+h;a.maxEditLength!=null&&(g=Math.min(g,a.maxEditLength));const y=(s=a.timeout)!==null&&s!==void 0?s:1/0,x=Date.now()+y,v=[{oldPos:-1,lastComponent:void 0}];let w=this.extractCommon(v[0],i,r,0,a);if(v[0].oldPos+1>=h&&w+1>=f)return c(this.buildValues(v[0].lastComponent,i,r));let _=-1/0,C=1/0;const E=()=>{for(let M=Math.max(_,-d);M<=Math.min(C,d);M+=2){let L;const U=v[M-1],V=v[M+1];U&&(v[M-1]=void 0);let B=!1;if(V){const ee=V.oldPos-M;B=V&&0<=ee&&ee<f}const N=U&&U.oldPos+1<h;if(!B&&!N){v[M]=void 0;continue}if(!N||B&&U.oldPos<V.oldPos?L=this.addToPath(V,!0,!1,0,a):L=this.addToPath(U,!1,!0,1,a),w=this.extractCommon(L,i,r,M,a),L.oldPos+1>=h&&w+1>=f)return c(this.buildValues(L.lastComponent,i,r))||!0;v[M]=L,L.oldPos+1>=h&&(C=Math.min(C,M-1)),w+1>=f&&(_=Math.max(_,M+1))}d++};if(u)(function M(){setTimeout(function(){if(d>g||Date.now()>x)return u(void 0);E()||M()},0)})();else for(;d<=g&&Date.now()<=x;){const M=E();if(M)return M}}addToPath(r,i,a,u,s){const c=r.lastComponent;return c&&!s.oneChangePerToken&&c.added===i&&c.removed===a?{oldPos:r.oldPos+u,lastComponent:{count:c.count+1,added:i,removed:a,previousComponent:c.previousComponent}}:{oldPos:r.oldPos+u,lastComponent:{count:1,added:i,removed:a,previousComponent:c}}}extractCommon(r,i,a,u,s){const c=i.length,f=a.length;let h=r.oldPos,d=h-u,g=0;for(;d+1<c&&h+1<f&&this.equals(a[h+1],i[d+1],s);)d++,h++,g++,s.oneChangePerToken&&(r.lastComponent={count:1,previousComponent:r.lastComponent,added:!1,removed:!1});return g&&!s.oneChangePerToken&&(r.lastComponent={count:g,previousComponent:r.lastComponent,added:!1,removed:!1}),r.oldPos=h,d}equals(r,i,a){return a.comparator?a.comparator(r,i):r===i||!!a.ignoreCase&&r.toLowerCase()===i.toLowerCase()}removeEmpty(r){const i=[];for(let a=0;a<r.length;a++)r[a]&&i.push(r[a]);return i}castInput(r,i){return r}tokenize(r,i){return Array.from(r)}join(r){return r.join("")}postProcess(r,i){return r}get useLongestToken(){return!1}buildValues(r,i,a){const u=[];let s;for(;r;)u.push(r),s=r.previousComponent,delete r.previousComponent,r=s;u.reverse();const c=u.length;let f=0,h=0,d=0;for(;f<c;f++){const g=u[f];if(g.removed)g.value=this.join(a.slice(d,d+g.count)),d+=g.count;else{if(!g.added&&this.useLongestToken){let y=i.slice(h,h+g.count);y=y.map(function(x,v){const w=a[d+v];return w.length>x.length?w:x}),g.value=this.join(y)}else g.value=this.join(i.slice(h,h+g.count));h+=g.count,g.added||(d+=g.count)}}return u}}class yT extends gT{constructor(){super(...arguments),this.tokenize=bT}equals(r,i,a){return a.ignoreWhitespace?((!a.newlineIsToken||!r.includes(`
`))&&(r=r.trim()),(!a.newlineIsToken||!i.includes(`
`))&&(i=i.trim())):a.ignoreNewlineAtEof&&!a.newlineIsToken&&(r.endsWith(`
`)&&(r=r.slice(0,-1)),i.endsWith(`
`)&&(i=i.slice(0,-1))),super.equals(r,i,a)}}const vT=new yT;function xT(e,r,i){return vT.diff(e,r,i)}function bT(e,r){r.stripTrailingCr&&(e=e.replace(/\r\n/g,`
`));const i=[],a=e.split(/(\n|\r\n)/);a[a.length-1]||a.pop();for(let u=0;u<a.length;u++){const s=a[u];u%2&&!r.newlineIsToken?i[i.length-1]+=s:i.push(s)}return i}function wT({oldContent:e,newContent:r,oldLabel:i,newLabel:a}){const u=Y.useMemo(()=>xT(e,r),[e,r]);return u.some(c=>c.added||c.removed)?k.jsxs("div",{className:"rounded-lg border border-border overflow-hidden",children:[(i||a)&&k.jsxs("div",{className:"flex items-center gap-4 px-4 py-2 bg-bg-secondary border-b border-border text-xs text-text-muted",children:[i&&k.jsxs("span",{className:"text-red-400",children:["--- ",i]}),a&&k.jsxs("span",{className:"text-green-400",children:["+++ ",a]})]}),k.jsx("div",{className:"overflow-x-auto",children:k.jsx("pre",{className:"text-sm leading-relaxed",children:u.map((c,f)=>k.jsx(ST,{change:c},f))})})]}):k.jsx("div",{className:"rounded-lg border border-border bg-bg-secondary p-6 text-center",children:k.jsx("p",{className:"text-text-muted",children:"No differences found"})})}function ST({change:e}){const r=e.value.replace(/\n$/,"").split(`
`);if(!e.added&&!e.removed){if(r.length<=6)return k.jsx(k.Fragment,{children:r.map((f,h)=>k.jsxs("div",{className:"px-4 py-0.5",children:[k.jsx("span",{className:"text-text-muted select-none inline-block w-5 mr-2",children:" "}),f]},h))});const s=r.slice(0,3),c=r.slice(-3);return k.jsxs(k.Fragment,{children:[s.map((f,h)=>k.jsxs("div",{className:"px-4 py-0.5",children:[k.jsx("span",{className:"text-text-muted select-none inline-block w-5 mr-2",children:" "}),f]},`b-${h}`)),k.jsxs("div",{className:"px-4 py-1 bg-bg-secondary text-text-muted text-xs text-center border-y border-border",children:["··· ",r.length-6," lines hidden ···"]}),c.map((f,h)=>k.jsxs("div",{className:"px-4 py-0.5",children:[k.jsx("span",{className:"text-text-muted select-none inline-block w-5 mr-2",children:" "}),f]},`a-${h}`))]})}const i=e.added?"bg-green-400/10":"bg-red-400/10",a=e.added?"text-green-400":"text-red-400",u=e.added?"+":"-";return k.jsx(k.Fragment,{children:r.map((s,c)=>k.jsxs("div",{className:`px-4 py-0.5 ${i}`,children:[k.jsx("span",{className:`${a} select-none inline-block w-5 mr-2`,children:u}),k.jsx("span",{className:a,children:s})]},c))})}function ET({topic:e,entry:r,currentContent:i,onClose:a}){const{data:u,loading:s,error:c}=XS(e,r.slug);return s?k.jsx("p",{className:"text-text-muted",children:"Loading diff..."}):c?k.jsxs("p",{className:"text-red-400",children:["Error: ",c]}):u?k.jsxs("div",{className:"space-y-3",children:[k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsxs("h2",{className:"text-lg font-semibold",children:["Diff: ",r.description]}),k.jsx("button",{onClick:a,className:"text-sm text-text-muted hover:text-accent transition-colors px-3 py-1 rounded border border-border hover:border-accent",children:"Close diff"})]}),k.jsx(wT,{oldContent:u.content,newContent:i,oldLabel:r.slug,newLabel:"current"})]}):null}function kT(){const{topic:e}=Qm(),{data:r,loading:i,error:a}=FS(e??""),[u,s]=Y.useState(null);return i?k.jsx("p",{className:"text-text-muted",children:"Loading..."}):a?k.jsxs("p",{className:"text-red-400",children:["Error: ",a]}):r?k.jsxs("div",{className:"space-y-6",children:[k.jsxs("div",{children:[k.jsx(fn,{to:"/specs",className:"text-text-muted text-base font-medium hover:text-accent transition-colors",children:"← Back to Specs"}),k.jsx("h1",{className:"text-2xl font-bold mt-2",children:r.topic})]}),u?k.jsx(ET,{topic:r.topic,entry:u,currentContent:r.content,onClose:()=>s(null)}):k.jsx(lo,{content:r.content}),k.jsxs("section",{children:[k.jsx("h2",{className:"text-lg font-semibold mb-3",children:"History"}),r.history.length===0?k.jsx("p",{className:"text-text-muted text-sm",children:"No changes have affected this spec"}):k.jsxs("div",{className:"relative pl-6",children:[k.jsx("div",{className:"absolute left-2 top-1 bottom-1 w-px bg-border"}),k.jsx("div",{className:"space-y-4",children:r.history.map(c=>k.jsxs("div",{className:"relative hover:bg-bg-secondary rounded p-2 transition-colors",children:[k.jsx("div",{className:"absolute -left-4 top-3.5 w-2.5 h-2.5 rounded-full border-2 border-accent bg-bg-primary"}),k.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[(c.timestamp||c.date)&&k.jsx("span",{className:"text-text-muted text-xs font-mono",title:c.timestamp||void 0,children:c.timestamp?new Date(c.timestamp).toLocaleString():c.date}),k.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${c.status==="active"?"bg-green-400/10 text-green-400":"bg-text-muted/10 text-text-muted"}`,children:c.status})]}),k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx(fn,{to:`/changes/${c.slug}`,className:"text-sm text-accent hover:underline",children:c.description}),k.jsx("button",{onClick:()=>s((u==null?void 0:u.slug)===c.slug?null:c),className:`text-xs px-2 py-0.5 rounded border transition-colors ${(u==null?void 0:u.slug)===c.slug?"border-accent text-accent bg-accent/10":"border-border text-text-muted hover:text-accent hover:border-accent"}`,children:(u==null?void 0:u.slug)===c.slug?"Comparing":"Compare"})]})]},c.slug))})]})]})]}):k.jsx("p",{className:"text-text-muted",children:"Spec not found"})}function _T(){const{data:e,loading:r,error:i}=dp();if(r)return k.jsx("p",{className:"text-text-muted",children:"Loading..."});if(i)return k.jsxs("p",{className:"text-red-400",children:["Error: ",i]});const a=(e==null?void 0:e.active)??[],u=(e==null?void 0:e.archived)??[];return a.length===0&&u.length===0?k.jsxs("div",{children:[k.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Changes"}),k.jsx("p",{className:"text-text-muted",children:"No changes found"})]}):k.jsxs("div",{className:"space-y-8",children:[k.jsx("h1",{className:"text-2xl font-bold",children:"Changes"}),a.length>0&&k.jsxs("section",{children:[k.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Active"}),k.jsx("div",{className:"space-y-2",children:a.map(s=>k.jsxs(fn,{to:`/changes/${s.slug}`,className:"block bg-bg-secondary border border-border border-l-4 border-l-accent rounded p-4 hover:border-accent transition-colors",children:[k.jsxs("div",{className:"flex items-center justify-between mb-2",children:[k.jsx("span",{className:"text-text-primary font-medium",children:s.description}),(s.timestamp||s.date)&&k.jsx("span",{className:"text-text-muted text-xs",title:s.timestamp||void 0,children:s.timestamp?Fu(s.timestamp):s.date})]}),s.taskStats&&k.jsx(gc,{completed:s.taskStats.completed,total:s.taskStats.total})]},s.slug))})]}),u.length>0&&k.jsxs("section",{children:[k.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Archived"}),k.jsx("div",{className:"space-y-2",children:u.map(s=>k.jsx(fn,{to:`/changes/${s.slug}`,className:"block bg-bg-secondary border border-border rounded p-4 hover:border-accent transition-colors",children:k.jsxs("div",{className:"flex items-center justify-between",children:[k.jsx("span",{className:"text-text-primary",children:s.description}),(s.timestamp||s.date)&&k.jsx("span",{className:"text-text-muted text-xs",title:s.timestamp||void 0,children:s.timestamp?Fu(s.timestamp):s.date})]})},s.slug))})]})]})}function CT({tabs:e,header:r,sticky:i}){var f;const[a,u]=Y.useState(((f=e[0])==null?void 0:f.id)??""),s=e.find(h=>h.id===a),c=k.jsxs(k.Fragment,{children:[r,k.jsx("div",{className:"flex border-b border-border",children:e.map(h=>k.jsx("button",{onClick:()=>u(h.id),className:`px-4 py-2 text-sm transition-colors border-b-2 -mb-px ${h.id===a?"border-accent text-accent":"border-transparent text-text-secondary hover:text-text-primary"}`,children:h.label},h.id))})]});return k.jsxs("div",{children:[i?k.jsx("div",{className:"sticky top-14 z-[5] bg-bg-primary -mx-6 px-6 pb-px",children:c}):k.jsx("div",{className:"mb-4",children:c}),k.jsx("div",{className:`animate-fade-in ${i?"mt-4":""}`,children:s==null?void 0:s.content},a)]})}function TT(){const{slug:e}=Qm(),{data:r,loading:i,error:a}=GS(e??""),{data:u}=hp(),s=(u==null?void 0:u.map(h=>h.topic))??[];if(i)return k.jsx("p",{className:"text-text-muted",children:"Loading..."});if(a)return k.jsxs("p",{className:"text-red-400",children:["Error: ",a]});if(!r)return k.jsx("p",{className:"text-text-muted",children:"Change not found"});const c=[{id:"proposal",label:"Proposal",content:r.proposal?k.jsx(lo,{content:r.proposal,specTopics:s}):k.jsx("p",{className:"text-text-muted text-sm",children:"No content"})},{id:"design",label:"Design",content:r.design?k.jsx(lo,{content:r.design}):k.jsx("p",{className:"text-text-muted text-sm",children:"No content"})},{id:"specs",label:"Specs",content:r.specs.length>0?k.jsx("div",{className:"space-y-6",children:r.specs.map(h=>k.jsxs("div",{children:[k.jsx("h3",{className:"text-sm font-semibold text-accent mb-2",children:h.topic}),k.jsx(lo,{content:h.content})]},h.topic))}):k.jsx("p",{className:"text-text-muted text-sm",children:"No delta specs"})},{id:"tasks",label:"Tasks",content:r.tasks?k.jsxs("div",{className:"space-y-4",children:[k.jsx(gc,{completed:r.tasks.completed,total:r.tasks.total}),k.jsx("div",{className:"space-y-4",children:r.tasks.sections.map(h=>k.jsxs("div",{children:[k.jsx("h3",{className:"text-sm font-semibold text-text-secondary mb-2",children:h.title}),k.jsx("div",{className:"space-y-1",children:h.tasks.map((d,g)=>k.jsxs("div",{className:`flex items-start gap-2 text-sm ${d.completed?"opacity-60":""}`,children:[d.completed?k.jsxs("svg",{className:"w-4 h-4 mt-0.5 shrink-0 text-green-400",viewBox:"0 0 16 16",fill:"none",children:[k.jsx("circle",{cx:"8",cy:"8",r:"7",fill:"currentColor",opacity:"0.2"}),k.jsx("path",{d:"M5 8l2 2 4-4",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]}):k.jsx("svg",{className:"w-4 h-4 mt-0.5 shrink-0 text-text-muted",viewBox:"0 0 16 16",fill:"none",children:k.jsx("circle",{cx:"8",cy:"8",r:"7",stroke:"currentColor",strokeWidth:"1.5"})}),k.jsx("span",{className:d.completed?"text-text-secondary line-through":"text-text-primary",children:d.text})]},g))})]},h.title))})]}):k.jsx("p",{className:"text-text-muted text-sm",children:"No content"})}],f=k.jsxs("div",{className:"pt-2 pb-3",children:[k.jsx(fn,{to:"/changes",className:"text-text-muted text-base font-medium hover:text-accent transition-colors",children:"← Back to Changes"}),k.jsx("h1",{className:"text-2xl font-bold mt-2",children:e})]});return k.jsx("div",{children:k.jsx(CT,{tabs:c,header:f,sticky:!0})})}function zT(e,r){var i,a=1;e==null&&(e=0),r==null&&(r=0);function u(){var s,c=i.length,f,h=0,d=0;for(s=0;s<c;++s)f=i[s],h+=f.x,d+=f.y;for(h=(h/c-e)*a,d=(d/c-r)*a,s=0;s<c;++s)f=i[s],f.x-=h,f.y-=d}return u.initialize=function(s){i=s},u.x=function(s){return arguments.length?(e=+s,u):e},u.y=function(s){return arguments.length?(r=+s,u):r},u.strength=function(s){return arguments.length?(a=+s,u):a},u}function AT(e){const r=+this._x.call(null,e),i=+this._y.call(null,e);return yy(this.cover(r,i),r,i,e)}function yy(e,r,i,a){if(isNaN(r)||isNaN(i))return e;var u,s=e._root,c={data:a},f=e._x0,h=e._y0,d=e._x1,g=e._y1,y,x,v,w,_,C,E,M;if(!s)return e._root=c,e;for(;s.length;)if((_=r>=(y=(f+d)/2))?f=y:d=y,(C=i>=(x=(h+g)/2))?h=x:g=x,u=s,!(s=s[E=C<<1|_]))return u[E]=c,e;if(v=+e._x.call(null,s.data),w=+e._y.call(null,s.data),r===v&&i===w)return c.next=s,u?u[E]=c:e._root=c,e;do u=u?u[E]=new Array(4):e._root=new Array(4),(_=r>=(y=(f+d)/2))?f=y:d=y,(C=i>=(x=(h+g)/2))?h=x:g=x;while((E=C<<1|_)===(M=(w>=x)<<1|v>=y));return u[M]=s,u[E]=c,e}function MT(e){var r,i,a=e.length,u,s,c=new Array(a),f=new Array(a),h=1/0,d=1/0,g=-1/0,y=-1/0;for(i=0;i<a;++i)isNaN(u=+this._x.call(null,r=e[i]))||isNaN(s=+this._y.call(null,r))||(c[i]=u,f[i]=s,u<h&&(h=u),u>g&&(g=u),s<d&&(d=s),s>y&&(y=s));if(h>g||d>y)return this;for(this.cover(h,d).cover(g,y),i=0;i<a;++i)yy(this,c[i],f[i],e[i]);return this}function RT(e,r){if(isNaN(e=+e)||isNaN(r=+r))return this;var i=this._x0,a=this._y0,u=this._x1,s=this._y1;if(isNaN(i))u=(i=Math.floor(e))+1,s=(a=Math.floor(r))+1;else{for(var c=u-i||1,f=this._root,h,d;i>e||e>=u||a>r||r>=s;)switch(d=(r<a)<<1|e<i,h=new Array(4),h[d]=f,f=h,c*=2,d){case 0:u=i+c,s=a+c;break;case 1:i=u-c,s=a+c;break;case 2:u=i+c,a=s-c;break;case 3:i=u-c,a=s-c;break}this._root&&this._root.length&&(this._root=f)}return this._x0=i,this._y0=a,this._x1=u,this._y1=s,this}function NT(){var e=[];return this.visit(function(r){if(!r.length)do e.push(r.data);while(r=r.next)}),e}function DT(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function Qt(e,r,i,a,u){this.node=e,this.x0=r,this.y0=i,this.x1=a,this.y1=u}function OT(e,r,i){var a,u=this._x0,s=this._y0,c,f,h,d,g=this._x1,y=this._y1,x=[],v=this._root,w,_;for(v&&x.push(new Qt(v,u,s,g,y)),i==null?i=1/0:(u=e-i,s=r-i,g=e+i,y=r+i,i*=i);w=x.pop();)if(!(!(v=w.node)||(c=w.x0)>g||(f=w.y0)>y||(h=w.x1)<u||(d=w.y1)<s))if(v.length){var C=(c+h)/2,E=(f+d)/2;x.push(new Qt(v[3],C,E,h,d),new Qt(v[2],c,E,C,d),new Qt(v[1],C,f,h,E),new Qt(v[0],c,f,C,E)),(_=(r>=E)<<1|e>=C)&&(w=x[x.length-1],x[x.length-1]=x[x.length-1-_],x[x.length-1-_]=w)}else{var M=e-+this._x.call(null,v.data),L=r-+this._y.call(null,v.data),U=M*M+L*L;if(U<i){var V=Math.sqrt(i=U);u=e-V,s=r-V,g=e+V,y=r+V,a=v.data}}return a}function jT(e){if(isNaN(g=+this._x.call(null,e))||isNaN(y=+this._y.call(null,e)))return this;var r,i=this._root,a,u,s,c=this._x0,f=this._y0,h=this._x1,d=this._y1,g,y,x,v,w,_,C,E;if(!i)return this;if(i.length)for(;;){if((w=g>=(x=(c+h)/2))?c=x:h=x,(_=y>=(v=(f+d)/2))?f=v:d=v,r=i,!(i=i[C=_<<1|w]))return this;if(!i.length)break;(r[C+1&3]||r[C+2&3]||r[C+3&3])&&(a=r,E=C)}for(;i.data!==e;)if(u=i,!(i=i.next))return this;return(s=i.next)&&delete i.next,u?(s?u.next=s:delete u.next,this):r?(s?r[C]=s:delete r[C],(i=r[0]||r[1]||r[2]||r[3])&&i===(r[3]||r[2]||r[1]||r[0])&&!i.length&&(a?a[E]=i:this._root=i),this):(this._root=s,this)}function LT(e){for(var r=0,i=e.length;r<i;++r)this.remove(e[r]);return this}function UT(){return this._root}function BT(){var e=0;return this.visit(function(r){if(!r.length)do++e;while(r=r.next)}),e}function HT(e){var r=[],i,a=this._root,u,s,c,f,h;for(a&&r.push(new Qt(a,this._x0,this._y0,this._x1,this._y1));i=r.pop();)if(!e(a=i.node,s=i.x0,c=i.y0,f=i.x1,h=i.y1)&&a.length){var d=(s+f)/2,g=(c+h)/2;(u=a[3])&&r.push(new Qt(u,d,g,f,h)),(u=a[2])&&r.push(new Qt(u,s,g,d,h)),(u=a[1])&&r.push(new Qt(u,d,c,f,g)),(u=a[0])&&r.push(new Qt(u,s,c,d,g))}return this}function qT(e){var r=[],i=[],a;for(this._root&&r.push(new Qt(this._root,this._x0,this._y0,this._x1,this._y1));a=r.pop();){var u=a.node;if(u.length){var s,c=a.x0,f=a.y0,h=a.x1,d=a.y1,g=(c+h)/2,y=(f+d)/2;(s=u[0])&&r.push(new Qt(s,c,f,g,y)),(s=u[1])&&r.push(new Qt(s,g,f,h,y)),(s=u[2])&&r.push(new Qt(s,c,y,g,d)),(s=u[3])&&r.push(new Qt(s,g,y,h,d))}i.push(a)}for(;a=i.pop();)e(a.node,a.x0,a.y0,a.x1,a.y1);return this}function YT(e){return e[0]}function VT(e){return arguments.length?(this._x=e,this):this._x}function FT(e){return e[1]}function XT(e){return arguments.length?(this._y=e,this):this._y}function mf(e,r,i){var a=new pf(r??YT,i??FT,NaN,NaN,NaN,NaN);return e==null?a:a.addAll(e)}function pf(e,r,i,a,u,s){this._x=e,this._y=r,this._x0=i,this._y0=a,this._x1=u,this._y1=s,this._root=void 0}function vy(e){for(var r={data:e.data},i=r;e=e.next;)i=i.next={data:e.data};return r}var $t=mf.prototype=pf.prototype;$t.copy=function(){var e=new pf(this._x,this._y,this._x0,this._y0,this._x1,this._y1),r=this._root,i,a;if(!r)return e;if(!r.length)return e._root=vy(r),e;for(i=[{source:r,target:e._root=new Array(4)}];r=i.pop();)for(var u=0;u<4;++u)(a=r.source[u])&&(a.length?i.push({source:a,target:r.target[u]=new Array(4)}):r.target[u]=vy(a));return e},$t.add=AT,$t.addAll=MT,$t.cover=RT,$t.data=NT,$t.extent=DT,$t.find=OT,$t.remove=jT,$t.removeAll=LT,$t.root=UT,$t.size=BT,$t.visit=HT,$t.visitAfter=qT,$t.x=VT,$t.y=XT;function It(e){return function(){return e}}function Kr(e){return(e()-.5)*1e-6}function GT(e){return e.x+e.vx}function QT(e){return e.y+e.vy}function $T(e){var r,i,a,u=1,s=1;typeof e!="function"&&(e=It(e==null?1:+e));function c(){for(var d,g=r.length,y,x,v,w,_,C,E=0;E<s;++E)for(y=mf(r,GT,QT).visitAfter(f),d=0;d<g;++d)x=r[d],_=i[x.index],C=_*_,v=x.x+x.vx,w=x.y+x.vy,y.visit(M);function M(L,U,V,B,N){var ee=L.data,G=L.r,D=_+G;if(ee){if(ee.index>x.index){var ne=v-ee.x-ee.vx,ae=w-ee.y-ee.vy,ve=ne*ne+ae*ae;ve<D*D&&(ne===0&&(ne=Kr(a),ve+=ne*ne),ae===0&&(ae=Kr(a),ve+=ae*ae),ve=(D-(ve=Math.sqrt(ve)))/ve*u,x.vx+=(ne*=ve)*(D=(G*=G)/(C+G)),x.vy+=(ae*=ve)*D,ee.vx-=ne*(D=1-D),ee.vy-=ae*D)}return}return U>v+D||B<v-D||V>w+D||N<w-D}}function f(d){if(d.data)return d.r=i[d.data.index];for(var g=d.r=0;g<4;++g)d[g]&&d[g].r>d.r&&(d.r=d[g].r)}function h(){if(r){var d,g=r.length,y;for(i=new Array(g),d=0;d<g;++d)y=r[d],i[y.index]=+e(y,d,r)}}return c.initialize=function(d,g){r=d,a=g,h()},c.iterations=function(d){return arguments.length?(s=+d,c):s},c.strength=function(d){return arguments.length?(u=+d,c):u},c.radius=function(d){return arguments.length?(e=typeof d=="function"?d:It(+d),h(),c):e},c}function IT(e){return e.index}function xy(e,r){var i=e.get(r);if(!i)throw new Error("node not found: "+r);return i}function ZT(e){var r=IT,i=y,a,u=It(30),s,c,f,h,d,g=1;e==null&&(e=[]);function y(C){return 1/Math.min(f[C.source.index],f[C.target.index])}function x(C){for(var E=0,M=e.length;E<g;++E)for(var L=0,U,V,B,N,ee,G,D;L<M;++L)U=e[L],V=U.source,B=U.target,N=B.x+B.vx-V.x-V.vx||Kr(d),ee=B.y+B.vy-V.y-V.vy||Kr(d),G=Math.sqrt(N*N+ee*ee),G=(G-s[L])/G*C*a[L],N*=G,ee*=G,B.vx-=N*(D=h[L]),B.vy-=ee*D,V.vx+=N*(D=1-D),V.vy+=ee*D}function v(){if(c){var C,E=c.length,M=e.length,L=new Map(c.map((V,B)=>[r(V,B,c),V])),U;for(C=0,f=new Array(E);C<M;++C)U=e[C],U.index=C,typeof U.source!="object"&&(U.source=xy(L,U.source)),typeof U.target!="object"&&(U.target=xy(L,U.target)),f[U.source.index]=(f[U.source.index]||0)+1,f[U.target.index]=(f[U.target.index]||0)+1;for(C=0,h=new Array(M);C<M;++C)U=e[C],h[C]=f[U.source.index]/(f[U.source.index]+f[U.target.index]);a=new Array(M),w(),s=new Array(M),_()}}function w(){if(c)for(var C=0,E=e.length;C<E;++C)a[C]=+i(e[C],C,e)}function _(){if(c)for(var C=0,E=e.length;C<E;++C)s[C]=+u(e[C],C,e)}return x.initialize=function(C,E){c=C,d=E,v()},x.links=function(C){return arguments.length?(e=C,v(),x):e},x.id=function(C){return arguments.length?(r=C,x):r},x.iterations=function(C){return arguments.length?(g=+C,x):g},x.strength=function(C){return arguments.length?(i=typeof C=="function"?C:It(+C),w(),x):i},x.distance=function(C){return arguments.length?(u=typeof C=="function"?C:It(+C),_(),x):u},x}var KT={value:()=>{}};function Ma(){for(var e=0,r=arguments.length,i={},a;e<r;++e){if(!(a=arguments[e]+"")||a in i||/[\s.]/.test(a))throw new Error("illegal type: "+a);i[a]=[]}return new ao(i)}function ao(e){this._=e}function PT(e,r){return e.trim().split(/^|\s+/).map(function(i){var a="",u=i.indexOf(".");if(u>=0&&(a=i.slice(u+1),i=i.slice(0,u)),i&&!r.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:a}})}ao.prototype=Ma.prototype={constructor:ao,on:function(e,r){var i=this._,a=PT(e+"",i),u,s=-1,c=a.length;if(arguments.length<2){for(;++s<c;)if((u=(e=a[s]).type)&&(u=JT(i[u],e.name)))return u;return}if(r!=null&&typeof r!="function")throw new Error("invalid callback: "+r);for(;++s<c;)if(u=(e=a[s]).type)i[u]=by(i[u],e.name,r);else if(r==null)for(u in i)i[u]=by(i[u],e.name,null);return this},copy:function(){var e={},r=this._;for(var i in r)e[i]=r[i].slice();return new ao(e)},call:function(e,r){if((u=arguments.length-2)>0)for(var i=new Array(u),a=0,u,s;a<u;++a)i[a]=arguments[a+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],a=0,u=s.length;a<u;++a)s[a].value.apply(r,i)},apply:function(e,r,i){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var a=this._[e],u=0,s=a.length;u<s;++u)a[u].value.apply(r,i)}};function JT(e,r){for(var i=0,a=e.length,u;i<a;++i)if((u=e[i]).name===r)return u.value}function by(e,r,i){for(var a=0,u=e.length;a<u;++a)if(e[a].name===r){e[a]=KT,e=e.slice(0,a).concat(e.slice(a+1));break}return i!=null&&e.push({name:r,value:i}),e}var gl=0,Ra=0,Na=0,wy=1e3,uo,Da,oo=0,Di=0,so=0,Oa=typeof performance=="object"&&performance.now?performance:Date,Sy=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function gf(){return Di||(Sy(WT),Di=Oa.now()+so)}function WT(){Di=0}function co(){this._call=this._time=this._next=null}co.prototype=yf.prototype={constructor:co,restart:function(e,r,i){if(typeof e!="function")throw new TypeError("callback is not a function");i=(i==null?gf():+i)+(r==null?0:+r),!this._next&&Da!==this&&(Da?Da._next=this:uo=this,Da=this),this._call=e,this._time=i,vf()},stop:function(){this._call&&(this._call=null,this._time=1/0,vf())}};function yf(e,r,i){var a=new co;return a.restart(e,r,i),a}function ez(){gf(),++gl;for(var e=uo,r;e;)(r=Di-e._time)>=0&&e._call.call(void 0,r),e=e._next;--gl}function Ey(){Di=(oo=Oa.now())+so,gl=Ra=0;try{ez()}finally{gl=0,nz(),Di=0}}function tz(){var e=Oa.now(),r=e-oo;r>wy&&(so-=r,oo=e)}function nz(){for(var e,r=uo,i,a=1/0;r;)r._call?(a>r._time&&(a=r._time),e=r,r=r._next):(i=r._next,r._next=null,r=e?e._next=i:uo=i);Da=e,vf(a)}function vf(e){if(!gl){Ra&&(Ra=clearTimeout(Ra));var r=e-Di;r>24?(e<1/0&&(Ra=setTimeout(Ey,e-Oa.now()-so)),Na&&(Na=clearInterval(Na))):(Na||(oo=Oa.now(),Na=setInterval(tz,wy)),gl=1,Sy(Ey))}}function ky(e,r,i){var a=new co;return r=r==null?0:+r,a.restart(u=>{a.stop(),e(u+r)},r,i),a}const rz=1664525,iz=1013904223,_y=4294967296;function lz(){let e=1;return()=>(e=(rz*e+iz)%_y)/_y}function az(e){return e.x}function uz(e){return e.y}var oz=10,sz=Math.PI*(3-Math.sqrt(5));function cz(e){var r,i=1,a=.001,u=1-Math.pow(a,1/300),s=0,c=.6,f=new Map,h=yf(y),d=Ma("tick","end"),g=lz();e==null&&(e=[]);function y(){x(),d.call("tick",r),i<a&&(h.stop(),d.call("end",r))}function x(_){var C,E=e.length,M;_===void 0&&(_=1);for(var L=0;L<_;++L)for(i+=(s-i)*u,f.forEach(function(U){U(i)}),C=0;C<E;++C)M=e[C],M.fx==null?M.x+=M.vx*=c:(M.x=M.fx,M.vx=0),M.fy==null?M.y+=M.vy*=c:(M.y=M.fy,M.vy=0);return r}function v(){for(var _=0,C=e.length,E;_<C;++_){if(E=e[_],E.index=_,E.fx!=null&&(E.x=E.fx),E.fy!=null&&(E.y=E.fy),isNaN(E.x)||isNaN(E.y)){var M=oz*Math.sqrt(.5+_),L=_*sz;E.x=M*Math.cos(L),E.y=M*Math.sin(L)}(isNaN(E.vx)||isNaN(E.vy))&&(E.vx=E.vy=0)}}function w(_){return _.initialize&&_.initialize(e,g),_}return v(),r={tick:x,restart:function(){return h.restart(y),r},stop:function(){return h.stop(),r},nodes:function(_){return arguments.length?(e=_,v(),f.forEach(w),r):e},alpha:function(_){return arguments.length?(i=+_,r):i},alphaMin:function(_){return arguments.length?(a=+_,r):a},alphaDecay:function(_){return arguments.length?(u=+_,r):+u},alphaTarget:function(_){return arguments.length?(s=+_,r):s},velocityDecay:function(_){return arguments.length?(c=1-_,r):1-c},randomSource:function(_){return arguments.length?(g=_,f.forEach(w),r):g},force:function(_,C){return arguments.length>1?(C==null?f.delete(_):f.set(_,w(C)),r):f.get(_)},find:function(_,C,E){var M=0,L=e.length,U,V,B,N,ee;for(E==null?E=1/0:E*=E,M=0;M<L;++M)N=e[M],U=_-N.x,V=C-N.y,B=U*U+V*V,B<E&&(ee=N,E=B);return ee},on:function(_,C){return arguments.length>1?(d.on(_,C),r):d.on(_)}}}function fz(){var e,r,i,a,u=It(-30),s,c=1,f=1/0,h=.81;function d(v){var w,_=e.length,C=mf(e,az,uz).visitAfter(y);for(a=v,w=0;w<_;++w)r=e[w],C.visit(x)}function g(){if(e){var v,w=e.length,_;for(s=new Array(w),v=0;v<w;++v)_=e[v],s[_.index]=+u(_,v,e)}}function y(v){var w=0,_,C,E=0,M,L,U;if(v.length){for(M=L=U=0;U<4;++U)(_=v[U])&&(C=Math.abs(_.value))&&(w+=_.value,E+=C,M+=C*_.x,L+=C*_.y);v.x=M/E,v.y=L/E}else{_=v,_.x=_.data.x,_.y=_.data.y;do w+=s[_.data.index];while(_=_.next)}v.value=w}function x(v,w,_,C){if(!v.value)return!0;var E=v.x-r.x,M=v.y-r.y,L=C-w,U=E*E+M*M;if(L*L/h<U)return U<f&&(E===0&&(E=Kr(i),U+=E*E),M===0&&(M=Kr(i),U+=M*M),U<c&&(U=Math.sqrt(c*U)),r.vx+=E*v.value*a/U,r.vy+=M*v.value*a/U),!0;if(v.length||U>=f)return;(v.data!==r||v.next)&&(E===0&&(E=Kr(i),U+=E*E),M===0&&(M=Kr(i),U+=M*M),U<c&&(U=Math.sqrt(c*U)));do v.data!==r&&(L=s[v.data.index]*a/U,r.vx+=E*L,r.vy+=M*L);while(v=v.next)}return d.initialize=function(v,w){e=v,i=w,g()},d.strength=function(v){return arguments.length?(u=typeof v=="function"?v:It(+v),g(),d):u},d.distanceMin=function(v){return arguments.length?(c=v*v,d):Math.sqrt(c)},d.distanceMax=function(v){return arguments.length?(f=v*v,d):Math.sqrt(f)},d.theta=function(v){return arguments.length?(h=v*v,d):Math.sqrt(h)},d}function hz(e){var r=It(.1),i,a,u;typeof e!="function"&&(e=It(e==null?0:+e));function s(f){for(var h=0,d=i.length,g;h<d;++h)g=i[h],g.vx+=(u[h]-g.x)*a[h]*f}function c(){if(i){var f,h=i.length;for(a=new Array(h),u=new Array(h),f=0;f<h;++f)a[f]=isNaN(u[f]=+e(i[f],f,i))?0:+r(i[f],f,i)}}return s.initialize=function(f){i=f,c()},s.strength=function(f){return arguments.length?(r=typeof f=="function"?f:It(+f),c(),s):r},s.x=function(f){return arguments.length?(e=typeof f=="function"?f:It(+f),c(),s):e},s}function dz(e){var r=It(.1),i,a,u;typeof e!="function"&&(e=It(e==null?0:+e));function s(f){for(var h=0,d=i.length,g;h<d;++h)g=i[h],g.vy+=(u[h]-g.y)*a[h]*f}function c(){if(i){var f,h=i.length;for(a=new Array(h),u=new Array(h),f=0;f<h;++f)a[f]=isNaN(u[f]=+e(i[f],f,i))?0:+r(i[f],f,i)}}return s.initialize=function(f){i=f,c()},s.strength=function(f){return arguments.length?(r=typeof f=="function"?f:It(+f),c(),s):r},s.y=function(f){return arguments.length?(e=typeof f=="function"?f:It(+f),c(),s):e},s}var xf="http://www.w3.org/1999/xhtml";const Cy={svg:"http://www.w3.org/2000/svg",xhtml:xf,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function fo(e){var r=e+="",i=r.indexOf(":");return i>=0&&(r=e.slice(0,i))!=="xmlns"&&(e=e.slice(i+1)),Cy.hasOwnProperty(r)?{space:Cy[r],local:e}:e}function mz(e){return function(){var r=this.ownerDocument,i=this.namespaceURI;return i===xf&&r.documentElement.namespaceURI===xf?r.createElement(e):r.createElementNS(i,e)}}function pz(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Ty(e){var r=fo(e);return(r.local?pz:mz)(r)}function gz(){}function bf(e){return e==null?gz:function(){return this.querySelector(e)}}function yz(e){typeof e!="function"&&(e=bf(e));for(var r=this._groups,i=r.length,a=new Array(i),u=0;u<i;++u)for(var s=r[u],c=s.length,f=a[u]=new Array(c),h,d,g=0;g<c;++g)(h=s[g])&&(d=e.call(h,h.__data__,g,s))&&("__data__"in h&&(d.__data__=h.__data__),f[g]=d);return new mn(a,this._parents)}function vz(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function xz(){return[]}function zy(e){return e==null?xz:function(){return this.querySelectorAll(e)}}function bz(e){return function(){return vz(e.apply(this,arguments))}}function wz(e){typeof e=="function"?e=bz(e):e=zy(e);for(var r=this._groups,i=r.length,a=[],u=[],s=0;s<i;++s)for(var c=r[s],f=c.length,h,d=0;d<f;++d)(h=c[d])&&(a.push(e.call(h,h.__data__,d,c)),u.push(h));return new mn(a,u)}function Ay(e){return function(){return this.matches(e)}}function My(e){return function(r){return r.matches(e)}}var Sz=Array.prototype.find;function Ez(e){return function(){return Sz.call(this.children,e)}}function kz(){return this.firstElementChild}function _z(e){return this.select(e==null?kz:Ez(typeof e=="function"?e:My(e)))}var Cz=Array.prototype.filter;function Tz(){return Array.from(this.children)}function zz(e){return function(){return Cz.call(this.children,e)}}function Az(e){return this.selectAll(e==null?Tz:zz(typeof e=="function"?e:My(e)))}function Mz(e){typeof e!="function"&&(e=Ay(e));for(var r=this._groups,i=r.length,a=new Array(i),u=0;u<i;++u)for(var s=r[u],c=s.length,f=a[u]=[],h,d=0;d<c;++d)(h=s[d])&&e.call(h,h.__data__,d,s)&&f.push(h);return new mn(a,this._parents)}function Ry(e){return new Array(e.length)}function Rz(){return new mn(this._enter||this._groups.map(Ry),this._parents)}function ho(e,r){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=r}ho.prototype={constructor:ho,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,r){return this._parent.insertBefore(e,r)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Nz(e){return function(){return e}}function Dz(e,r,i,a,u,s){for(var c=0,f,h=r.length,d=s.length;c<d;++c)(f=r[c])?(f.__data__=s[c],a[c]=f):i[c]=new ho(e,s[c]);for(;c<h;++c)(f=r[c])&&(u[c]=f)}function Oz(e,r,i,a,u,s,c){var f,h,d=new Map,g=r.length,y=s.length,x=new Array(g),v;for(f=0;f<g;++f)(h=r[f])&&(x[f]=v=c.call(h,h.__data__,f,r)+"",d.has(v)?u[f]=h:d.set(v,h));for(f=0;f<y;++f)v=c.call(e,s[f],f,s)+"",(h=d.get(v))?(a[f]=h,h.__data__=s[f],d.delete(v)):i[f]=new ho(e,s[f]);for(f=0;f<g;++f)(h=r[f])&&d.get(x[f])===h&&(u[f]=h)}function jz(e){return e.__data__}function Lz(e,r){if(!arguments.length)return Array.from(this,jz);var i=r?Oz:Dz,a=this._parents,u=this._groups;typeof e!="function"&&(e=Nz(e));for(var s=u.length,c=new Array(s),f=new Array(s),h=new Array(s),d=0;d<s;++d){var g=a[d],y=u[d],x=y.length,v=Uz(e.call(g,g&&g.__data__,d,a)),w=v.length,_=f[d]=new Array(w),C=c[d]=new Array(w),E=h[d]=new Array(x);i(g,y,_,C,E,v,r);for(var M=0,L=0,U,V;M<w;++M)if(U=_[M]){for(M>=L&&(L=M+1);!(V=C[L])&&++L<w;);U._next=V||null}}return c=new mn(c,a),c._enter=f,c._exit=h,c}function Uz(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Bz(){return new mn(this._exit||this._groups.map(Ry),this._parents)}function Hz(e,r,i){var a=this.enter(),u=this,s=this.exit();return typeof e=="function"?(a=e(a),a&&(a=a.selection())):a=a.append(e+""),r!=null&&(u=r(u),u&&(u=u.selection())),i==null?s.remove():i(s),a&&u?a.merge(u).order():u}function qz(e){for(var r=e.selection?e.selection():e,i=this._groups,a=r._groups,u=i.length,s=a.length,c=Math.min(u,s),f=new Array(u),h=0;h<c;++h)for(var d=i[h],g=a[h],y=d.length,x=f[h]=new Array(y),v,w=0;w<y;++w)(v=d[w]||g[w])&&(x[w]=v);for(;h<u;++h)f[h]=i[h];return new mn(f,this._parents)}function Yz(){for(var e=this._groups,r=-1,i=e.length;++r<i;)for(var a=e[r],u=a.length-1,s=a[u],c;--u>=0;)(c=a[u])&&(s&&c.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(c,s),s=c);return this}function Vz(e){e||(e=Fz);function r(y,x){return y&&x?e(y.__data__,x.__data__):!y-!x}for(var i=this._groups,a=i.length,u=new Array(a),s=0;s<a;++s){for(var c=i[s],f=c.length,h=u[s]=new Array(f),d,g=0;g<f;++g)(d=c[g])&&(h[g]=d);h.sort(r)}return new mn(u,this._parents).order()}function Fz(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function Xz(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Gz(){return Array.from(this)}function Qz(){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var a=e[r],u=0,s=a.length;u<s;++u){var c=a[u];if(c)return c}return null}function $z(){let e=0;for(const r of this)++e;return e}function Iz(){return!this.node()}function Zz(e){for(var r=this._groups,i=0,a=r.length;i<a;++i)for(var u=r[i],s=0,c=u.length,f;s<c;++s)(f=u[s])&&e.call(f,f.__data__,s,u);return this}function Kz(e){return function(){this.removeAttribute(e)}}function Pz(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Jz(e,r){return function(){this.setAttribute(e,r)}}function Wz(e,r){return function(){this.setAttributeNS(e.space,e.local,r)}}function eA(e,r){return function(){var i=r.apply(this,arguments);i==null?this.removeAttribute(e):this.setAttribute(e,i)}}function tA(e,r){return function(){var i=r.apply(this,arguments);i==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,i)}}function nA(e,r){var i=fo(e);if(arguments.length<2){var a=this.node();return i.local?a.getAttributeNS(i.space,i.local):a.getAttribute(i)}return this.each((r==null?i.local?Pz:Kz:typeof r=="function"?i.local?tA:eA:i.local?Wz:Jz)(i,r))}function Ny(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function rA(e){return function(){this.style.removeProperty(e)}}function iA(e,r,i){return function(){this.style.setProperty(e,r,i)}}function lA(e,r,i){return function(){var a=r.apply(this,arguments);a==null?this.style.removeProperty(e):this.style.setProperty(e,a,i)}}function aA(e,r,i){return arguments.length>1?this.each((r==null?rA:typeof r=="function"?lA:iA)(e,r,i??"")):yl(this.node(),e)}function yl(e,r){return e.style.getPropertyValue(r)||Ny(e).getComputedStyle(e,null).getPropertyValue(r)}function uA(e){return function(){delete this[e]}}function oA(e,r){return function(){this[e]=r}}function sA(e,r){return function(){var i=r.apply(this,arguments);i==null?delete this[e]:this[e]=i}}function cA(e,r){return arguments.length>1?this.each((r==null?uA:typeof r=="function"?sA:oA)(e,r)):this.node()[e]}function Dy(e){return e.trim().split(/^|\s+/)}function wf(e){return e.classList||new Oy(e)}function Oy(e){this._node=e,this._names=Dy(e.getAttribute("class")||"")}Oy.prototype={add:function(e){var r=this._names.indexOf(e);r<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var r=this._names.indexOf(e);r>=0&&(this._names.splice(r,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function jy(e,r){for(var i=wf(e),a=-1,u=r.length;++a<u;)i.add(r[a])}function Ly(e,r){for(var i=wf(e),a=-1,u=r.length;++a<u;)i.remove(r[a])}function fA(e){return function(){jy(this,e)}}function hA(e){return function(){Ly(this,e)}}function dA(e,r){return function(){(r.apply(this,arguments)?jy:Ly)(this,e)}}function mA(e,r){var i=Dy(e+"");if(arguments.length<2){for(var a=wf(this.node()),u=-1,s=i.length;++u<s;)if(!a.contains(i[u]))return!1;return!0}return this.each((typeof r=="function"?dA:r?fA:hA)(i,r))}function pA(){this.textContent=""}function gA(e){return function(){this.textContent=e}}function yA(e){return function(){var r=e.apply(this,arguments);this.textContent=r??""}}function vA(e){return arguments.length?this.each(e==null?pA:(typeof e=="function"?yA:gA)(e)):this.node().textContent}function xA(){this.innerHTML=""}function bA(e){return function(){this.innerHTML=e}}function wA(e){return function(){var r=e.apply(this,arguments);this.innerHTML=r??""}}function SA(e){return arguments.length?this.each(e==null?xA:(typeof e=="function"?wA:bA)(e)):this.node().innerHTML}function EA(){this.nextSibling&&this.parentNode.appendChild(this)}function kA(){return this.each(EA)}function _A(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function CA(){return this.each(_A)}function TA(e){var r=typeof e=="function"?e:Ty(e);return this.select(function(){return this.appendChild(r.apply(this,arguments))})}function zA(){return null}function AA(e,r){var i=typeof e=="function"?e:Ty(e),a=r==null?zA:typeof r=="function"?r:bf(r);return this.select(function(){return this.insertBefore(i.apply(this,arguments),a.apply(this,arguments)||null)})}function MA(){var e=this.parentNode;e&&e.removeChild(this)}function RA(){return this.each(MA)}function NA(){var e=this.cloneNode(!1),r=this.parentNode;return r?r.insertBefore(e,this.nextSibling):e}function DA(){var e=this.cloneNode(!0),r=this.parentNode;return r?r.insertBefore(e,this.nextSibling):e}function OA(e){return this.select(e?DA:NA)}function jA(e){return arguments.length?this.property("__data__",e):this.node().__data__}function LA(e){return function(r){e.call(this,r,this.__data__)}}function UA(e){return e.trim().split(/^|\s+/).map(function(r){var i="",a=r.indexOf(".");return a>=0&&(i=r.slice(a+1),r=r.slice(0,a)),{type:r,name:i}})}function BA(e){return function(){var r=this.__on;if(r){for(var i=0,a=-1,u=r.length,s;i<u;++i)s=r[i],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):r[++a]=s;++a?r.length=a:delete this.__on}}}function HA(e,r,i){return function(){var a=this.__on,u,s=LA(r);if(a){for(var c=0,f=a.length;c<f;++c)if((u=a[c]).type===e.type&&u.name===e.name){this.removeEventListener(u.type,u.listener,u.options),this.addEventListener(u.type,u.listener=s,u.options=i),u.value=r;return}}this.addEventListener(e.type,s,i),u={type:e.type,name:e.name,value:r,listener:s,options:i},a?a.push(u):this.__on=[u]}}function qA(e,r,i){var a=UA(e+""),u,s=a.length,c;if(arguments.length<2){var f=this.node().__on;if(f){for(var h=0,d=f.length,g;h<d;++h)for(u=0,g=f[h];u<s;++u)if((c=a[u]).type===g.type&&c.name===g.name)return g.value}return}for(f=r?HA:BA,u=0;u<s;++u)this.each(f(a[u],r,i));return this}function Uy(e,r,i){var a=Ny(e),u=a.CustomEvent;typeof u=="function"?u=new u(r,i):(u=a.document.createEvent("Event"),i?(u.initEvent(r,i.bubbles,i.cancelable),u.detail=i.detail):u.initEvent(r,!1,!1)),e.dispatchEvent(u)}function YA(e,r){return function(){return Uy(this,e,r)}}function VA(e,r){return function(){return Uy(this,e,r.apply(this,arguments))}}function FA(e,r){return this.each((typeof r=="function"?VA:YA)(e,r))}function*XA(){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var a=e[r],u=0,s=a.length,c;u<s;++u)(c=a[u])&&(yield c)}var By=[null];function mn(e,r){this._groups=e,this._parents=r}function ja(){return new mn([[document.documentElement]],By)}function GA(){return this}mn.prototype=ja.prototype={constructor:mn,select:yz,selectAll:wz,selectChild:_z,selectChildren:Az,filter:Mz,data:Lz,enter:Rz,exit:Bz,join:Hz,merge:qz,selection:GA,order:Yz,sort:Vz,call:Xz,nodes:Gz,node:Qz,size:$z,empty:Iz,each:Zz,attr:nA,style:aA,property:cA,classed:mA,text:vA,html:SA,raise:kA,lower:CA,append:TA,insert:AA,remove:RA,clone:OA,datum:jA,on:qA,dispatch:FA,[Symbol.iterator]:XA};function ir(e){return typeof e=="string"?new mn([[document.querySelector(e)]],[document.documentElement]):new mn([[e]],By)}function QA(e){let r;for(;r=e.sourceEvent;)e=r;return e}function gr(e,r){if(e=QA(e),r===void 0&&(r=e.currentTarget),r){var i=r.ownerSVGElement||r;if(i.createSVGPoint){var a=i.createSVGPoint();return a.x=e.clientX,a.y=e.clientY,a=a.matrixTransform(r.getScreenCTM().inverse()),[a.x,a.y]}if(r.getBoundingClientRect){var u=r.getBoundingClientRect();return[e.clientX-u.left-r.clientLeft,e.clientY-u.top-r.clientTop]}}return[e.pageX,e.pageY]}var $A=Ma("start","end","cancel","interrupt"),IA=[],Hy=0,qy=1,Sf=2,mo=3,Yy=4,Ef=5,po=6;function go(e,r,i,a,u,s){var c=e.__transition;if(!c)e.__transition={};else if(i in c)return;ZA(e,i,{name:r,index:a,group:u,on:$A,tween:IA,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Hy})}function kf(e,r){var i=Fn(e,r);if(i.state>Hy)throw new Error("too late; already scheduled");return i}function lr(e,r){var i=Fn(e,r);if(i.state>mo)throw new Error("too late; already running");return i}function Fn(e,r){var i=e.__transition;if(!i||!(i=i[r]))throw new Error("transition not found");return i}function ZA(e,r,i){var a=e.__transition,u;a[r]=i,i.timer=yf(s,0,i.time);function s(d){i.state=qy,i.timer.restart(c,i.delay,i.time),i.delay<=d&&c(d-i.delay)}function c(d){var g,y,x,v;if(i.state!==qy)return h();for(g in a)if(v=a[g],v.name===i.name){if(v.state===mo)return ky(c);v.state===Yy?(v.state=po,v.timer.stop(),v.on.call("interrupt",e,e.__data__,v.index,v.group),delete a[g]):+g<r&&(v.state=po,v.timer.stop(),v.on.call("cancel",e,e.__data__,v.index,v.group),delete a[g])}if(ky(function(){i.state===mo&&(i.state=Yy,i.timer.restart(f,i.delay,i.time),f(d))}),i.state=Sf,i.on.call("start",e,e.__data__,i.index,i.group),i.state===Sf){for(i.state=mo,u=new Array(x=i.tween.length),g=0,y=-1;g<x;++g)(v=i.tween[g].value.call(e,e.__data__,i.index,i.group))&&(u[++y]=v);u.length=y+1}}function f(d){for(var g=d<i.duration?i.ease.call(null,d/i.duration):(i.timer.restart(h),i.state=Ef,1),y=-1,x=u.length;++y<x;)u[y].call(e,g);i.state===Ef&&(i.on.call("end",e,e.__data__,i.index,i.group),h())}function h(){i.state=po,i.timer.stop(),delete a[r];for(var d in a)return;delete e.__transition}}function yo(e,r){var i=e.__transition,a,u,s=!0,c;if(i){r=r==null?null:r+"";for(c in i){if((a=i[c]).name!==r){s=!1;continue}u=a.state>Sf&&a.state<Ef,a.state=po,a.timer.stop(),a.on.call(u?"interrupt":"cancel",e,e.__data__,a.index,a.group),delete i[c]}s&&delete e.__transition}}function KA(e){return this.each(function(){yo(this,e)})}function _f(e,r,i){e.prototype=r.prototype=i,i.constructor=e}function Vy(e,r){var i=Object.create(e.prototype);for(var a in r)i[a]=r[a];return i}function La(){}var Ua=.7,vo=1/Ua,vl="\\s*([+-]?\\d+)\\s*",Ba="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ar="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",PA=/^#([0-9a-f]{3,8})$/,JA=new RegExp(`^rgb\\(${vl},${vl},${vl}\\)$`),WA=new RegExp(`^rgb\\(${ar},${ar},${ar}\\)$`),e3=new RegExp(`^rgba\\(${vl},${vl},${vl},${Ba}\\)$`),t3=new RegExp(`^rgba\\(${ar},${ar},${ar},${Ba}\\)$`),n3=new RegExp(`^hsl\\(${Ba},${ar},${ar}\\)$`),r3=new RegExp(`^hsla\\(${Ba},${ar},${ar},${Ba}\\)$`),Fy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};_f(La,Ha,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Xy,formatHex:Xy,formatHex8:i3,formatHsl:l3,formatRgb:Gy,toString:Gy});function Xy(){return this.rgb().formatHex()}function i3(){return this.rgb().formatHex8()}function l3(){return Ky(this).formatHsl()}function Gy(){return this.rgb().formatRgb()}function Ha(e){var r,i;return e=(e+"").trim().toLowerCase(),(r=PA.exec(e))?(i=r[1].length,r=parseInt(r[1],16),i===6?Qy(r):i===3?new Wt(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):i===8?xo(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):i===4?xo(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=JA.exec(e))?new Wt(r[1],r[2],r[3],1):(r=WA.exec(e))?new Wt(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=e3.exec(e))?xo(r[1],r[2],r[3],r[4]):(r=t3.exec(e))?xo(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=n3.exec(e))?Zy(r[1],r[2]/100,r[3]/100,1):(r=r3.exec(e))?Zy(r[1],r[2]/100,r[3]/100,r[4]):Fy.hasOwnProperty(e)?Qy(Fy[e]):e==="transparent"?new Wt(NaN,NaN,NaN,0):null}function Qy(e){return new Wt(e>>16&255,e>>8&255,e&255,1)}function xo(e,r,i,a){return a<=0&&(e=r=i=NaN),new Wt(e,r,i,a)}function a3(e){return e instanceof La||(e=Ha(e)),e?(e=e.rgb(),new Wt(e.r,e.g,e.b,e.opacity)):new Wt}function Cf(e,r,i,a){return arguments.length===1?a3(e):new Wt(e,r,i,a??1)}function Wt(e,r,i,a){this.r=+e,this.g=+r,this.b=+i,this.opacity=+a}_f(Wt,Cf,Vy(La,{brighter(e){return e=e==null?vo:Math.pow(vo,e),new Wt(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ua:Math.pow(Ua,e),new Wt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Wt(Oi(this.r),Oi(this.g),Oi(this.b),bo(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$y,formatHex:$y,formatHex8:u3,formatRgb:Iy,toString:Iy}));function $y(){return`#${ji(this.r)}${ji(this.g)}${ji(this.b)}`}function u3(){return`#${ji(this.r)}${ji(this.g)}${ji(this.b)}${ji((isNaN(this.opacity)?1:this.opacity)*255)}`}function Iy(){const e=bo(this.opacity);return`${e===1?"rgb(":"rgba("}${Oi(this.r)}, ${Oi(this.g)}, ${Oi(this.b)}${e===1?")":`, ${e})`}`}function bo(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Oi(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ji(e){return e=Oi(e),(e<16?"0":"")+e.toString(16)}function Zy(e,r,i,a){return a<=0?e=r=i=NaN:i<=0||i>=1?e=r=NaN:r<=0&&(e=NaN),new Xn(e,r,i,a)}function Ky(e){if(e instanceof Xn)return new Xn(e.h,e.s,e.l,e.opacity);if(e instanceof La||(e=Ha(e)),!e)return new Xn;if(e instanceof Xn)return e;e=e.rgb();var r=e.r/255,i=e.g/255,a=e.b/255,u=Math.min(r,i,a),s=Math.max(r,i,a),c=NaN,f=s-u,h=(s+u)/2;return f?(r===s?c=(i-a)/f+(i<a)*6:i===s?c=(a-r)/f+2:c=(r-i)/f+4,f/=h<.5?s+u:2-s-u,c*=60):f=h>0&&h<1?0:c,new Xn(c,f,h,e.opacity)}function o3(e,r,i,a){return arguments.length===1?Ky(e):new Xn(e,r,i,a??1)}function Xn(e,r,i,a){this.h=+e,this.s=+r,this.l=+i,this.opacity=+a}_f(Xn,o3,Vy(La,{brighter(e){return e=e==null?vo:Math.pow(vo,e),new Xn(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ua:Math.pow(Ua,e),new Xn(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,r=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,a=i+(i<.5?i:1-i)*r,u=2*i-a;return new Wt(Tf(e>=240?e-240:e+120,u,a),Tf(e,u,a),Tf(e<120?e+240:e-120,u,a),this.opacity)},clamp(){return new Xn(Py(this.h),wo(this.s),wo(this.l),bo(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=bo(this.opacity);return`${e===1?"hsl(":"hsla("}${Py(this.h)}, ${wo(this.s)*100}%, ${wo(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Py(e){return e=(e||0)%360,e<0?e+360:e}function wo(e){return Math.max(0,Math.min(1,e||0))}function Tf(e,r,i){return(e<60?r+(i-r)*e/60:e<180?i:e<240?r+(i-r)*(240-e)/60:r)*255}const Jy=e=>()=>e;function s3(e,r){return function(i){return e+i*r}}function c3(e,r,i){return e=Math.pow(e,i),r=Math.pow(r,i)-e,i=1/i,function(a){return Math.pow(e+a*r,i)}}function f3(e){return(e=+e)==1?Wy:function(r,i){return i-r?c3(r,i,e):Jy(isNaN(r)?i:r)}}function Wy(e,r){var i=r-e;return i?s3(e,i):Jy(isNaN(e)?r:e)}const e0=(function e(r){var i=f3(r);function a(u,s){var c=i((u=Cf(u)).r,(s=Cf(s)).r),f=i(u.g,s.g),h=i(u.b,s.b),d=Wy(u.opacity,s.opacity);return function(g){return u.r=c(g),u.g=f(g),u.b=h(g),u.opacity=d(g),u+""}}return a.gamma=e,a})(1);function Pr(e,r){return e=+e,r=+r,function(i){return e*(1-i)+r*i}}var zf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Af=new RegExp(zf.source,"g");function h3(e){return function(){return e}}function d3(e){return function(r){return e(r)+""}}function m3(e,r){var i=zf.lastIndex=Af.lastIndex=0,a,u,s,c=-1,f=[],h=[];for(e=e+"",r=r+"";(a=zf.exec(e))&&(u=Af.exec(r));)(s=u.index)>i&&(s=r.slice(i,s),f[c]?f[c]+=s:f[++c]=s),(a=a[0])===(u=u[0])?f[c]?f[c]+=u:f[++c]=u:(f[++c]=null,h.push({i:c,x:Pr(a,u)})),i=Af.lastIndex;return i<r.length&&(s=r.slice(i),f[c]?f[c]+=s:f[++c]=s),f.length<2?h[0]?d3(h[0].x):h3(r):(r=h.length,function(d){for(var g=0,y;g<r;++g)f[(y=h[g]).i]=y.x(d);return f.join("")})}var t0=180/Math.PI,Mf={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function n0(e,r,i,a,u,s){var c,f,h;return(c=Math.sqrt(e*e+r*r))&&(e/=c,r/=c),(h=e*i+r*a)&&(i-=e*h,a-=r*h),(f=Math.sqrt(i*i+a*a))&&(i/=f,a/=f,h/=f),e*a<r*i&&(e=-e,r=-r,h=-h,c=-c),{translateX:u,translateY:s,rotate:Math.atan2(r,e)*t0,skewX:Math.atan(h)*t0,scaleX:c,scaleY:f}}var So;function p3(e){const r=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return r.isIdentity?Mf:n0(r.a,r.b,r.c,r.d,r.e,r.f)}function g3(e){return e==null||(So||(So=document.createElementNS("http://www.w3.org/2000/svg","g")),So.setAttribute("transform",e),!(e=So.transform.baseVal.consolidate()))?Mf:(e=e.matrix,n0(e.a,e.b,e.c,e.d,e.e,e.f))}function r0(e,r,i,a){function u(d){return d.length?d.pop()+" ":""}function s(d,g,y,x,v,w){if(d!==y||g!==x){var _=v.push("translate(",null,r,null,i);w.push({i:_-4,x:Pr(d,y)},{i:_-2,x:Pr(g,x)})}else(y||x)&&v.push("translate("+y+r+x+i)}function c(d,g,y,x){d!==g?(d-g>180?g+=360:g-d>180&&(d+=360),x.push({i:y.push(u(y)+"rotate(",null,a)-2,x:Pr(d,g)})):g&&y.push(u(y)+"rotate("+g+a)}function f(d,g,y,x){d!==g?x.push({i:y.push(u(y)+"skewX(",null,a)-2,x:Pr(d,g)}):g&&y.push(u(y)+"skewX("+g+a)}function h(d,g,y,x,v,w){if(d!==y||g!==x){var _=v.push(u(v)+"scale(",null,",",null,")");w.push({i:_-4,x:Pr(d,y)},{i:_-2,x:Pr(g,x)})}else(y!==1||x!==1)&&v.push(u(v)+"scale("+y+","+x+")")}return function(d,g){var y=[],x=[];return d=e(d),g=e(g),s(d.translateX,d.translateY,g.translateX,g.translateY,y,x),c(d.rotate,g.rotate,y,x),f(d.skewX,g.skewX,y,x),h(d.scaleX,d.scaleY,g.scaleX,g.scaleY,y,x),d=g=null,function(v){for(var w=-1,_=x.length,C;++w<_;)y[(C=x[w]).i]=C.x(v);return y.join("")}}}var y3=r0(p3,"px, ","px)","deg)"),v3=r0(g3,", ",")",")"),x3=1e-12;function i0(e){return((e=Math.exp(e))+1/e)/2}function b3(e){return((e=Math.exp(e))-1/e)/2}function w3(e){return((e=Math.exp(2*e))-1)/(e+1)}const S3=(function e(r,i,a){function u(s,c){var f=s[0],h=s[1],d=s[2],g=c[0],y=c[1],x=c[2],v=g-f,w=y-h,_=v*v+w*w,C,E;if(_<x3)E=Math.log(x/d)/r,C=function(N){return[f+N*v,h+N*w,d*Math.exp(r*N*E)]};else{var M=Math.sqrt(_),L=(x*x-d*d+a*_)/(2*d*i*M),U=(x*x-d*d-a*_)/(2*x*i*M),V=Math.log(Math.sqrt(L*L+1)-L),B=Math.log(Math.sqrt(U*U+1)-U);E=(B-V)/r,C=function(N){var ee=N*E,G=i0(V),D=d/(i*M)*(G*w3(r*ee+V)-b3(V));return[f+D*v,h+D*w,d*G/i0(r*ee+V)]}}return C.duration=E*1e3*r/Math.SQRT2,C}return u.rho=function(s){var c=Math.max(.001,+s),f=c*c,h=f*f;return e(c,f,h)},u})(Math.SQRT2,2,4);function E3(e,r){var i,a;return function(){var u=lr(this,e),s=u.tween;if(s!==i){a=i=s;for(var c=0,f=a.length;c<f;++c)if(a[c].name===r){a=a.slice(),a.splice(c,1);break}}u.tween=a}}function k3(e,r,i){var a,u;if(typeof i!="function")throw new Error;return function(){var s=lr(this,e),c=s.tween;if(c!==a){u=(a=c).slice();for(var f={name:r,value:i},h=0,d=u.length;h<d;++h)if(u[h].name===r){u[h]=f;break}h===d&&u.push(f)}s.tween=u}}function _3(e,r){var i=this._id;if(e+="",arguments.length<2){for(var a=Fn(this.node(),i).tween,u=0,s=a.length,c;u<s;++u)if((c=a[u]).name===e)return c.value;return null}return this.each((r==null?E3:k3)(i,e,r))}function Rf(e,r,i){var a=e._id;return e.each(function(){var u=lr(this,a);(u.value||(u.value={}))[r]=i.apply(this,arguments)}),function(u){return Fn(u,a).value[r]}}function l0(e,r){var i;return(typeof r=="number"?Pr:r instanceof Ha?e0:(i=Ha(r))?(r=i,e0):m3)(e,r)}function C3(e){return function(){this.removeAttribute(e)}}function T3(e){return function(){this.removeAttributeNS(e.space,e.local)}}function z3(e,r,i){var a,u=i+"",s;return function(){var c=this.getAttribute(e);return c===u?null:c===a?s:s=r(a=c,i)}}function A3(e,r,i){var a,u=i+"",s;return function(){var c=this.getAttributeNS(e.space,e.local);return c===u?null:c===a?s:s=r(a=c,i)}}function M3(e,r,i){var a,u,s;return function(){var c,f=i(this),h;return f==null?void this.removeAttribute(e):(c=this.getAttribute(e),h=f+"",c===h?null:c===a&&h===u?s:(u=h,s=r(a=c,f)))}}function R3(e,r,i){var a,u,s;return function(){var c,f=i(this),h;return f==null?void this.removeAttributeNS(e.space,e.local):(c=this.getAttributeNS(e.space,e.local),h=f+"",c===h?null:c===a&&h===u?s:(u=h,s=r(a=c,f)))}}function N3(e,r){var i=fo(e),a=i==="transform"?v3:l0;return this.attrTween(e,typeof r=="function"?(i.local?R3:M3)(i,a,Rf(this,"attr."+e,r)):r==null?(i.local?T3:C3)(i):(i.local?A3:z3)(i,a,r))}function D3(e,r){return function(i){this.setAttribute(e,r.call(this,i))}}function O3(e,r){return function(i){this.setAttributeNS(e.space,e.local,r.call(this,i))}}function j3(e,r){var i,a;function u(){var s=r.apply(this,arguments);return s!==a&&(i=(a=s)&&O3(e,s)),i}return u._value=r,u}function L3(e,r){var i,a;function u(){var s=r.apply(this,arguments);return s!==a&&(i=(a=s)&&D3(e,s)),i}return u._value=r,u}function U3(e,r){var i="attr."+e;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(r==null)return this.tween(i,null);if(typeof r!="function")throw new Error;var a=fo(e);return this.tween(i,(a.local?j3:L3)(a,r))}function B3(e,r){return function(){kf(this,e).delay=+r.apply(this,arguments)}}function H3(e,r){return r=+r,function(){kf(this,e).delay=r}}function q3(e){var r=this._id;return arguments.length?this.each((typeof e=="function"?B3:H3)(r,e)):Fn(this.node(),r).delay}function Y3(e,r){return function(){lr(this,e).duration=+r.apply(this,arguments)}}function V3(e,r){return r=+r,function(){lr(this,e).duration=r}}function F3(e){var r=this._id;return arguments.length?this.each((typeof e=="function"?Y3:V3)(r,e)):Fn(this.node(),r).duration}function X3(e,r){if(typeof r!="function")throw new Error;return function(){lr(this,e).ease=r}}function G3(e){var r=this._id;return arguments.length?this.each(X3(r,e)):Fn(this.node(),r).ease}function Q3(e,r){return function(){var i=r.apply(this,arguments);if(typeof i!="function")throw new Error;lr(this,e).ease=i}}function $3(e){if(typeof e!="function")throw new Error;return this.each(Q3(this._id,e))}function I3(e){typeof e!="function"&&(e=Ay(e));for(var r=this._groups,i=r.length,a=new Array(i),u=0;u<i;++u)for(var s=r[u],c=s.length,f=a[u]=[],h,d=0;d<c;++d)(h=s[d])&&e.call(h,h.__data__,d,s)&&f.push(h);return new yr(a,this._parents,this._name,this._id)}function Z3(e){if(e._id!==this._id)throw new Error;for(var r=this._groups,i=e._groups,a=r.length,u=i.length,s=Math.min(a,u),c=new Array(a),f=0;f<s;++f)for(var h=r[f],d=i[f],g=h.length,y=c[f]=new Array(g),x,v=0;v<g;++v)(x=h[v]||d[v])&&(y[v]=x);for(;f<a;++f)c[f]=r[f];return new yr(c,this._parents,this._name,this._id)}function K3(e){return(e+"").trim().split(/^|\s+/).every(function(r){var i=r.indexOf(".");return i>=0&&(r=r.slice(0,i)),!r||r==="start"})}function P3(e,r,i){var a,u,s=K3(r)?kf:lr;return function(){var c=s(this,e),f=c.on;f!==a&&(u=(a=f).copy()).on(r,i),c.on=u}}function J3(e,r){var i=this._id;return arguments.length<2?Fn(this.node(),i).on.on(e):this.each(P3(i,e,r))}function W3(e){return function(){var r=this.parentNode;for(var i in this.__transition)if(+i!==e)return;r&&r.removeChild(this)}}function eM(){return this.on("end.remove",W3(this._id))}function tM(e){var r=this._name,i=this._id;typeof e!="function"&&(e=bf(e));for(var a=this._groups,u=a.length,s=new Array(u),c=0;c<u;++c)for(var f=a[c],h=f.length,d=s[c]=new Array(h),g,y,x=0;x<h;++x)(g=f[x])&&(y=e.call(g,g.__data__,x,f))&&("__data__"in g&&(y.__data__=g.__data__),d[x]=y,go(d[x],r,i,x,d,Fn(g,i)));return new yr(s,this._parents,r,i)}function nM(e){var r=this._name,i=this._id;typeof e!="function"&&(e=zy(e));for(var a=this._groups,u=a.length,s=[],c=[],f=0;f<u;++f)for(var h=a[f],d=h.length,g,y=0;y<d;++y)if(g=h[y]){for(var x=e.call(g,g.__data__,y,h),v,w=Fn(g,i),_=0,C=x.length;_<C;++_)(v=x[_])&&go(v,r,i,_,x,w);s.push(x),c.push(g)}return new yr(s,c,r,i)}var rM=ja.prototype.constructor;function iM(){return new rM(this._groups,this._parents)}function lM(e,r){var i,a,u;return function(){var s=yl(this,e),c=(this.style.removeProperty(e),yl(this,e));return s===c?null:s===i&&c===a?u:u=r(i=s,a=c)}}function a0(e){return function(){this.style.removeProperty(e)}}function aM(e,r,i){var a,u=i+"",s;return function(){var c=yl(this,e);return c===u?null:c===a?s:s=r(a=c,i)}}function uM(e,r,i){var a,u,s;return function(){var c=yl(this,e),f=i(this),h=f+"";return f==null&&(h=f=(this.style.removeProperty(e),yl(this,e))),c===h?null:c===a&&h===u?s:(u=h,s=r(a=c,f))}}function oM(e,r){var i,a,u,s="style."+r,c="end."+s,f;return function(){var h=lr(this,e),d=h.on,g=h.value[s]==null?f||(f=a0(r)):void 0;(d!==i||u!==g)&&(a=(i=d).copy()).on(c,u=g),h.on=a}}function sM(e,r,i){var a=(e+="")=="transform"?y3:l0;return r==null?this.styleTween(e,lM(e,a)).on("end.style."+e,a0(e)):typeof r=="function"?this.styleTween(e,uM(e,a,Rf(this,"style."+e,r))).each(oM(this._id,e)):this.styleTween(e,aM(e,a,r),i).on("end.style."+e,null)}function cM(e,r,i){return function(a){this.style.setProperty(e,r.call(this,a),i)}}function fM(e,r,i){var a,u;function s(){var c=r.apply(this,arguments);return c!==u&&(a=(u=c)&&cM(e,c,i)),a}return s._value=r,s}function hM(e,r,i){var a="style."+(e+="");if(arguments.length<2)return(a=this.tween(a))&&a._value;if(r==null)return this.tween(a,null);if(typeof r!="function")throw new Error;return this.tween(a,fM(e,r,i??""))}function dM(e){return function(){this.textContent=e}}function mM(e){return function(){var r=e(this);this.textContent=r??""}}function pM(e){return this.tween("text",typeof e=="function"?mM(Rf(this,"text",e)):dM(e==null?"":e+""))}function gM(e){return function(r){this.textContent=e.call(this,r)}}function yM(e){var r,i;function a(){var u=e.apply(this,arguments);return u!==i&&(r=(i=u)&&gM(u)),r}return a._value=e,a}function vM(e){var r="text";if(arguments.length<1)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,yM(e))}function xM(){for(var e=this._name,r=this._id,i=u0(),a=this._groups,u=a.length,s=0;s<u;++s)for(var c=a[s],f=c.length,h,d=0;d<f;++d)if(h=c[d]){var g=Fn(h,r);go(h,e,i,d,c,{time:g.time+g.delay+g.duration,delay:0,duration:g.duration,ease:g.ease})}return new yr(a,this._parents,e,i)}function bM(){var e,r,i=this,a=i._id,u=i.size();return new Promise(function(s,c){var f={value:c},h={value:function(){--u===0&&s()}};i.each(function(){var d=lr(this,a),g=d.on;g!==e&&(r=(e=g).copy(),r._.cancel.push(f),r._.interrupt.push(f),r._.end.push(h)),d.on=r}),u===0&&s()})}var wM=0;function yr(e,r,i,a){this._groups=e,this._parents=r,this._name=i,this._id=a}function u0(){return++wM}var vr=ja.prototype;yr.prototype={constructor:yr,select:tM,selectAll:nM,selectChild:vr.selectChild,selectChildren:vr.selectChildren,filter:I3,merge:Z3,selection:iM,transition:xM,call:vr.call,nodes:vr.nodes,node:vr.node,size:vr.size,empty:vr.empty,each:vr.each,on:J3,attr:N3,attrTween:U3,style:sM,styleTween:hM,text:pM,textTween:vM,remove:eM,tween:_3,delay:q3,duration:F3,ease:G3,easeVarying:$3,end:bM,[Symbol.iterator]:vr[Symbol.iterator]};function SM(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var EM={time:null,delay:0,duration:250,ease:SM};function kM(e,r){for(var i;!(i=e.__transition)||!(i=i[r]);)if(!(e=e.parentNode))throw new Error(`transition ${r} not found`);return i}function _M(e){var r,i;e instanceof yr?(r=e._id,e=e._name):(r=u0(),(i=EM).time=gf(),e=e==null?null:e+"");for(var a=this._groups,u=a.length,s=0;s<u;++s)for(var c=a[s],f=c.length,h,d=0;d<f;++d)(h=c[d])&&go(h,e,r,d,c,i||kM(h,r));return new yr(a,this._parents,e,r)}ja.prototype.interrupt=KA,ja.prototype.transition=_M;const CM={passive:!1},qa={capture:!0,passive:!1};function Nf(e){e.stopImmediatePropagation()}function xl(e){e.preventDefault(),e.stopImmediatePropagation()}function o0(e){var r=e.document.documentElement,i=ir(e).on("dragstart.drag",xl,qa);"onselectstart"in r?i.on("selectstart.drag",xl,qa):(r.__noselect=r.style.MozUserSelect,r.style.MozUserSelect="none")}function s0(e,r){var i=e.document.documentElement,a=ir(e).on("dragstart.drag",null);r&&(a.on("click.drag",xl,qa),setTimeout(function(){a.on("click.drag",null)},0)),"onselectstart"in i?a.on("selectstart.drag",null):(i.style.MozUserSelect=i.__noselect,delete i.__noselect)}const Eo=e=>()=>e;function Df(e,{sourceEvent:r,subject:i,target:a,identifier:u,active:s,x:c,y:f,dx:h,dy:d,dispatch:g}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:r,enumerable:!0,configurable:!0},subject:{value:i,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},identifier:{value:u,enumerable:!0,configurable:!0},active:{value:s,enumerable:!0,configurable:!0},x:{value:c,enumerable:!0,configurable:!0},y:{value:f,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:d,enumerable:!0,configurable:!0},_:{value:g}})}Df.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function TM(e){return!e.ctrlKey&&!e.button}function zM(){return this.parentNode}function AM(e,r){return r??{x:e.x,y:e.y}}function MM(){return navigator.maxTouchPoints||"ontouchstart"in this}function RM(){var e=TM,r=zM,i=AM,a=MM,u={},s=Ma("start","drag","end"),c=0,f,h,d,g,y=0;function x(U){U.on("mousedown.drag",v).filter(a).on("touchstart.drag",C).on("touchmove.drag",E,CM).on("touchend.drag touchcancel.drag",M).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(U,V){if(!(g||!e.call(this,U,V))){var B=L(this,r.call(this,U,V),U,V,"mouse");B&&(ir(U.view).on("mousemove.drag",w,qa).on("mouseup.drag",_,qa),o0(U.view),Nf(U),d=!1,f=U.clientX,h=U.clientY,B("start",U))}}function w(U){if(xl(U),!d){var V=U.clientX-f,B=U.clientY-h;d=V*V+B*B>y}u.mouse("drag",U)}function _(U){ir(U.view).on("mousemove.drag mouseup.drag",null),s0(U.view,d),xl(U),u.mouse("end",U)}function C(U,V){if(e.call(this,U,V)){var B=U.changedTouches,N=r.call(this,U,V),ee=B.length,G,D;for(G=0;G<ee;++G)(D=L(this,N,U,V,B[G].identifier,B[G]))&&(Nf(U),D("start",U,B[G]))}}function E(U){var V=U.changedTouches,B=V.length,N,ee;for(N=0;N<B;++N)(ee=u[V[N].identifier])&&(xl(U),ee("drag",U,V[N]))}function M(U){var V=U.changedTouches,B=V.length,N,ee;for(g&&clearTimeout(g),g=setTimeout(function(){g=null},500),N=0;N<B;++N)(ee=u[V[N].identifier])&&(Nf(U),ee("end",U,V[N]))}function L(U,V,B,N,ee,G){var D=s.copy(),ne=gr(G||B,V),ae,ve,H;if((H=i.call(U,new Df("beforestart",{sourceEvent:B,target:x,identifier:ee,active:c,x:ne[0],y:ne[1],dx:0,dy:0,dispatch:D}),N))!=null)return ae=H.x-ne[0]||0,ve=H.y-ne[1]||0,function I(A,Q,te){var oe=ne,T;switch(A){case"start":u[ee]=I,T=c++;break;case"end":delete u[ee],--c;case"drag":ne=gr(te||Q,V),T=c;break}D.call(A,U,new Df(A,{sourceEvent:Q,subject:H,target:x,identifier:ee,active:T,x:ne[0]+ae,y:ne[1]+ve,dx:ne[0]-oe[0],dy:ne[1]-oe[1],dispatch:D}),N)}}return x.filter=function(U){return arguments.length?(e=typeof U=="function"?U:Eo(!!U),x):e},x.container=function(U){return arguments.length?(r=typeof U=="function"?U:Eo(U),x):r},x.subject=function(U){return arguments.length?(i=typeof U=="function"?U:Eo(U),x):i},x.touchable=function(U){return arguments.length?(a=typeof U=="function"?U:Eo(!!U),x):a},x.on=function(){var U=s.on.apply(s,arguments);return U===s?x:U},x.clickDistance=function(U){return arguments.length?(y=(U=+U)*U,x):Math.sqrt(y)},x}const ko=e=>()=>e;function NM(e,{sourceEvent:r,target:i,transform:a,dispatch:u}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:r,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},transform:{value:a,enumerable:!0,configurable:!0},_:{value:u}})}function xr(e,r,i){this.k=e,this.x=r,this.y=i}xr.prototype={constructor:xr,scale:function(e){return e===1?this:new xr(this.k*e,this.x,this.y)},translate:function(e,r){return e===0&r===0?this:new xr(this.k,this.x+this.k*e,this.y+this.k*r)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Of=new xr(1,0,0);xr.prototype;function jf(e){e.stopImmediatePropagation()}function Ya(e){e.preventDefault(),e.stopImmediatePropagation()}function DM(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function OM(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function c0(){return this.__zoom||Of}function jM(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function LM(){return navigator.maxTouchPoints||"ontouchstart"in this}function UM(e,r,i){var a=e.invertX(r[0][0])-i[0][0],u=e.invertX(r[1][0])-i[1][0],s=e.invertY(r[0][1])-i[0][1],c=e.invertY(r[1][1])-i[1][1];return e.translate(u>a?(a+u)/2:Math.min(0,a)||Math.max(0,u),c>s?(s+c)/2:Math.min(0,s)||Math.max(0,c))}function BM(){var e=DM,r=OM,i=UM,a=jM,u=LM,s=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],f=250,h=S3,d=Ma("start","zoom","end"),g,y,x,v=500,w=150,_=0,C=10;function E(H){H.property("__zoom",c0).on("wheel.zoom",ee,{passive:!1}).on("mousedown.zoom",G).on("dblclick.zoom",D).filter(u).on("touchstart.zoom",ne).on("touchmove.zoom",ae).on("touchend.zoom touchcancel.zoom",ve).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}E.transform=function(H,I,A,Q){var te=H.selection?H.selection():H;te.property("__zoom",c0),H!==te?V(H,I,A,Q):te.interrupt().each(function(){B(this,arguments).event(Q).start().zoom(null,typeof I=="function"?I.apply(this,arguments):I).end()})},E.scaleBy=function(H,I,A,Q){E.scaleTo(H,function(){var te=this.__zoom.k,oe=typeof I=="function"?I.apply(this,arguments):I;return te*oe},A,Q)},E.scaleTo=function(H,I,A,Q){E.transform(H,function(){var te=r.apply(this,arguments),oe=this.__zoom,T=A==null?U(te):typeof A=="function"?A.apply(this,arguments):A,R=oe.invert(T),Z=typeof I=="function"?I.apply(this,arguments):I;return i(L(M(oe,Z),T,R),te,c)},A,Q)},E.translateBy=function(H,I,A,Q){E.transform(H,function(){return i(this.__zoom.translate(typeof I=="function"?I.apply(this,arguments):I,typeof A=="function"?A.apply(this,arguments):A),r.apply(this,arguments),c)},null,Q)},E.translateTo=function(H,I,A,Q,te){E.transform(H,function(){var oe=r.apply(this,arguments),T=this.__zoom,R=Q==null?U(oe):typeof Q=="function"?Q.apply(this,arguments):Q;return i(Of.translate(R[0],R[1]).scale(T.k).translate(typeof I=="function"?-I.apply(this,arguments):-I,typeof A=="function"?-A.apply(this,arguments):-A),oe,c)},Q,te)};function M(H,I){return I=Math.max(s[0],Math.min(s[1],I)),I===H.k?H:new xr(I,H.x,H.y)}function L(H,I,A){var Q=I[0]-A[0]*H.k,te=I[1]-A[1]*H.k;return Q===H.x&&te===H.y?H:new xr(H.k,Q,te)}function U(H){return[(+H[0][0]+ +H[1][0])/2,(+H[0][1]+ +H[1][1])/2]}function V(H,I,A,Q){H.on("start.zoom",function(){B(this,arguments).event(Q).start()}).on("interrupt.zoom end.zoom",function(){B(this,arguments).event(Q).end()}).tween("zoom",function(){var te=this,oe=arguments,T=B(te,oe).event(Q),R=r.apply(te,oe),Z=A==null?U(R):typeof A=="function"?A.apply(te,oe):A,z=Math.max(R[1][0]-R[0][0],R[1][1]-R[0][1]),se=te.__zoom,pe=typeof I=="function"?I.apply(te,oe):I,ye=h(se.invert(Z).concat(z/se.k),pe.invert(Z).concat(z/pe.k));return function(Te){if(Te===1)Te=pe;else{var Oe=ye(Te),Ke=z/Oe[2];Te=new xr(Ke,Z[0]-Oe[0]*Ke,Z[1]-Oe[1]*Ke)}T.zoom(null,Te)}})}function B(H,I,A){return!A&&H.__zooming||new N(H,I)}function N(H,I){this.that=H,this.args=I,this.active=0,this.sourceEvent=null,this.extent=r.apply(H,I),this.taps=0}N.prototype={event:function(H){return H&&(this.sourceEvent=H),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(H,I){return this.mouse&&H!=="mouse"&&(this.mouse[1]=I.invert(this.mouse[0])),this.touch0&&H!=="touch"&&(this.touch0[1]=I.invert(this.touch0[0])),this.touch1&&H!=="touch"&&(this.touch1[1]=I.invert(this.touch1[0])),this.that.__zoom=I,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(H){var I=ir(this.that).datum();d.call(H,this.that,new NM(H,{sourceEvent:this.sourceEvent,target:E,transform:this.that.__zoom,dispatch:d}),I)}};function ee(H,...I){if(!e.apply(this,arguments))return;var A=B(this,I).event(H),Q=this.__zoom,te=Math.max(s[0],Math.min(s[1],Q.k*Math.pow(2,a.apply(this,arguments)))),oe=gr(H);if(A.wheel)(A.mouse[0][0]!==oe[0]||A.mouse[0][1]!==oe[1])&&(A.mouse[1]=Q.invert(A.mouse[0]=oe)),clearTimeout(A.wheel);else{if(Q.k===te)return;A.mouse=[oe,Q.invert(oe)],yo(this),A.start()}Ya(H),A.wheel=setTimeout(T,w),A.zoom("mouse",i(L(M(Q,te),A.mouse[0],A.mouse[1]),A.extent,c));function T(){A.wheel=null,A.end()}}function G(H,...I){if(x||!e.apply(this,arguments))return;var A=H.currentTarget,Q=B(this,I,!0).event(H),te=ir(H.view).on("mousemove.zoom",Z,!0).on("mouseup.zoom",z,!0),oe=gr(H,A),T=H.clientX,R=H.clientY;o0(H.view),jf(H),Q.mouse=[oe,this.__zoom.invert(oe)],yo(this),Q.start();function Z(se){if(Ya(se),!Q.moved){var pe=se.clientX-T,ye=se.clientY-R;Q.moved=pe*pe+ye*ye>_}Q.event(se).zoom("mouse",i(L(Q.that.__zoom,Q.mouse[0]=gr(se,A),Q.mouse[1]),Q.extent,c))}function z(se){te.on("mousemove.zoom mouseup.zoom",null),s0(se.view,Q.moved),Ya(se),Q.event(se).end()}}function D(H,...I){if(e.apply(this,arguments)){var A=this.__zoom,Q=gr(H.changedTouches?H.changedTouches[0]:H,this),te=A.invert(Q),oe=A.k*(H.shiftKey?.5:2),T=i(L(M(A,oe),Q,te),r.apply(this,I),c);Ya(H),f>0?ir(this).transition().duration(f).call(V,T,Q,H):ir(this).call(E.transform,T,Q,H)}}function ne(H,...I){if(e.apply(this,arguments)){var A=H.touches,Q=A.length,te=B(this,I,H.changedTouches.length===Q).event(H),oe,T,R,Z;for(jf(H),T=0;T<Q;++T)R=A[T],Z=gr(R,this),Z=[Z,this.__zoom.invert(Z),R.identifier],te.touch0?!te.touch1&&te.touch0[2]!==Z[2]&&(te.touch1=Z,te.taps=0):(te.touch0=Z,oe=!0,te.taps=1+!!g);g&&(g=clearTimeout(g)),oe&&(te.taps<2&&(y=Z[0],g=setTimeout(function(){g=null},v)),yo(this),te.start())}}function ae(H,...I){if(this.__zooming){var A=B(this,I).event(H),Q=H.changedTouches,te=Q.length,oe,T,R,Z;for(Ya(H),oe=0;oe<te;++oe)T=Q[oe],R=gr(T,this),A.touch0&&A.touch0[2]===T.identifier?A.touch0[0]=R:A.touch1&&A.touch1[2]===T.identifier&&(A.touch1[0]=R);if(T=A.that.__zoom,A.touch1){var z=A.touch0[0],se=A.touch0[1],pe=A.touch1[0],ye=A.touch1[1],Te=(Te=pe[0]-z[0])*Te+(Te=pe[1]-z[1])*Te,Oe=(Oe=ye[0]-se[0])*Oe+(Oe=ye[1]-se[1])*Oe;T=M(T,Math.sqrt(Te/Oe)),R=[(z[0]+pe[0])/2,(z[1]+pe[1])/2],Z=[(se[0]+ye[0])/2,(se[1]+ye[1])/2]}else if(A.touch0)R=A.touch0[0],Z=A.touch0[1];else return;A.zoom("touch",i(L(T,R,Z),A.extent,c))}}function ve(H,...I){if(this.__zooming){var A=B(this,I).event(H),Q=H.changedTouches,te=Q.length,oe,T;for(jf(H),x&&clearTimeout(x),x=setTimeout(function(){x=null},v),oe=0;oe<te;++oe)T=Q[oe],A.touch0&&A.touch0[2]===T.identifier?delete A.touch0:A.touch1&&A.touch1[2]===T.identifier&&delete A.touch1;if(A.touch1&&!A.touch0&&(A.touch0=A.touch1,delete A.touch1),A.touch0)A.touch0[1]=this.__zoom.invert(A.touch0[0]);else if(A.end(),A.taps===2&&(T=gr(T,this),Math.hypot(y[0]-T[0],y[1]-T[1])<C)){var R=ir(this).on("dblclick.zoom");R&&R.apply(this,arguments)}}}return E.wheelDelta=function(H){return arguments.length?(a=typeof H=="function"?H:ko(+H),E):a},E.filter=function(H){return arguments.length?(e=typeof H=="function"?H:ko(!!H),E):e},E.touchable=function(H){return arguments.length?(u=typeof H=="function"?H:ko(!!H),E):u},E.extent=function(H){return arguments.length?(r=typeof H=="function"?H:ko([[+H[0][0],+H[0][1]],[+H[1][0],+H[1][1]]]),E):r},E.scaleExtent=function(H){return arguments.length?(s[0]=+H[0],s[1]=+H[1],E):[s[0],s[1]]},E.translateExtent=function(H){return arguments.length?(c[0][0]=+H[0][0],c[1][0]=+H[1][0],c[0][1]=+H[0][1],c[1][1]=+H[1][1],E):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},E.constrain=function(H){return arguments.length?(i=H,E):i},E.duration=function(H){return arguments.length?(f=+H,E):f},E.interpolate=function(H){return arguments.length?(h=H,E):h},E.on=function(){var H=d.on.apply(d,arguments);return H===d?E:H},E.clickDistance=function(H){return arguments.length?(_=(H=+H)*H,E):Math.sqrt(_)},E.tapDistance=function(H){return arguments.length?(C=+H,E):C},E}function HM(e,r=25){return e.length>r?e.slice(0,r)+"...":e}function Jr(e){if(e.type==="spec"){const i=e.historyCount||0;return Math.min(45,Math.max(20,20+i*5))}const r=e.specCount||1;return Math.min(40,Math.max(18,14+r*6))}function qM({data:e,onNavigate:r,theme:i}){const a=Y.useRef(null),u=Y.useRef(r);return u.current=r,Y.useEffect(()=>{const s=a.current;if(!s)return;const c=s.parentElement,f=c.clientWidth,h=c.clientHeight,d=getComputedStyle(document.documentElement),g=d.getPropertyValue("--color-border").trim()||"#374151",y=d.getPropertyValue("--color-text-primary").trim()||"#e2e8f0",x=d.getPropertyValue("--color-text-secondary").trim()||"#94a3b8",v=ir(s);v.selectAll("*").remove(),v.attr("width",f).attr("height",h);const w=e.nodes.map(G=>({...G,x:0,y:0})),_=new Map(w.map(G=>[G.id,G])),C=e.edges.filter(G=>_.has(G.source)&&_.has(G.target)).map(G=>({source:_.get(G.source),target:_.get(G.target)})),E=new Map;for(const G of C){const D=G.source.id,ne=G.target.id;E.has(D)||E.set(D,new Set),E.has(ne)||E.set(ne,new Set),E.get(D).add(ne),E.get(ne).add(D)}const M=v.append("g"),L=M.append("g").attr("class","links").selectAll("line").data(C).join("line").attr("stroke",g).attr("stroke-width",1.5).attr("stroke-opacity",.6),U=M.append("g").attr("class","nodes").selectAll("g").data(w).join("g").attr("cursor","pointer");U.filter(G=>G.type==="spec").append("circle").attr("r",G=>Jr(G)).attr("fill","#f59e0b").attr("fill-opacity",.85).attr("stroke","#fbbf24").attr("stroke-width",2),U.filter(G=>G.type==="change").append("rect").attr("width",G=>Jr(G)*2).attr("height",G=>Jr(G)*1.4).attr("x",G=>-Jr(G)).attr("y",G=>-Jr(G)*.7).attr("rx",6).attr("fill",G=>G.status==="active"?"#22c55e":"#64748b").attr("fill-opacity",.85).attr("stroke",G=>G.status==="active"?"#4ade80":"#94a3b8").attr("stroke-width",2),U.append("text").text(G=>HM(G.label)).attr("text-anchor","middle").attr("dy",G=>Jr(G)+16).attr("fill",x).attr("font-size",12).attr("pointer-events","none"),U.on("mouseenter",(G,D)=>{const ne=E.get(D.id)||new Set;U.attr("opacity",ae=>ae.id===D.id||ne.has(ae.id)?1:.1),L.attr("stroke-opacity",ae=>ae.source.id===D.id||ae.target.id===D.id?.9:.05).attr("stroke",ae=>ae.source.id===D.id||ae.target.id===D.id?y:g)}).on("mouseleave",()=>{U.attr("opacity",1),L.attr("stroke-opacity",.6).attr("stroke",g)});let V=!1;U.on("click",(G,D)=>{if(!V)if(D.type==="spec")u.current(`/specs/${D.label}`);else{const ne=D.id.replace(/^change:/,"");u.current(`/changes/${ne}`)}});const B=cz(w).force("link",ZT(C).id(G=>G.id).distance(80)).force("charge",fz().strength(-120)).force("center",zT(f/2,h/2)).force("x",hz(f/2).strength(.05)).force("y",dz(h/2).strength(.05)).force("collide",$T().radius(G=>Jr(G)+8)).on("tick",()=>{L.attr("x1",G=>G.source.x).attr("y1",G=>G.source.y).attr("x2",G=>G.target.x).attr("y2",G=>G.target.y),U.attr("transform",G=>`translate(${G.x},${G.y})`)}),N=RM().on("start",(G,D)=>{V=!1,G.active||B.alphaTarget(.3).restart(),D.fx=D.x,D.fy=D.y}).on("drag",(G,D)=>{V=!0,D.fx=G.x,D.fy=G.y}).on("end",(G,D)=>{G.active||B.alphaTarget(0),D.fx=null,D.fy=null});U.call(N);const ee=BM().scaleExtent([.3,3]).on("zoom",G=>{M.attr("transform",G.transform)});return v.call(ee),B.on("end",()=>{let G=1/0,D=1/0,ne=-1/0,ae=-1/0;for(const oe of w){const T=Jr(oe)+20;oe.x-T<G&&(G=oe.x-T),oe.y-T<D&&(D=oe.y-T),oe.x+T>ne&&(ne=oe.x+T),oe.y+T>ae&&(ae=oe.y+T)}const ve=ne-G,H=ae-D;if(ve<=0||H<=0)return;const I=60,A=Math.min((f-I*2)/ve,(h-I*2)/H,1.5),Q=f/2-(G+ve/2)*A,te=h/2-(D+H/2)*A;v.transition().duration(500).call(ee.transform,Of.translate(Q,te).scale(A))}),()=>{B.stop()}},[e,i]),k.jsx("svg",{ref:a,className:"w-full h-full"})}function YM(){return k.jsxs("div",{className:"absolute bottom-4 left-4 bg-bg-secondary/90 border border-border rounded-lg px-4 py-3 text-xs text-text-secondary space-y-2",children:[k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"inline-block w-3 h-3 rounded-full bg-amber-500"}),k.jsx("span",{children:"Spec"})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"inline-block w-3 h-2.5 rounded-sm bg-green-500"}),k.jsx("span",{children:"Active Change"})]}),k.jsxs("div",{className:"flex items-center gap-2",children:[k.jsx("span",{className:"inline-block w-3 h-2.5 rounded-sm bg-slate-500"}),k.jsx("span",{children:"Archived Change"})]})]})}function VM(){const{data:e,loading:r,error:i}=$S(),{theme:a}=sp(),u=Uu(),s=Y.useCallback(c=>u(c),[u]);return r?k.jsx("p",{className:"text-text-muted",children:"Loading graph..."}):i?k.jsxs("p",{className:"text-red-400",children:["Error: ",i]}):!e||e.edges.length===0?k.jsxs("div",{className:"space-y-4",children:[k.jsx("h1",{className:"text-2xl font-bold",children:"Graph"}),k.jsx("p",{className:"text-text-muted",children:"No spec-change relationships to visualize."})]}):k.jsxs("div",{children:[k.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Graph"}),k.jsxs("div",{className:"relative h-[calc(100vh-10rem)] bg-bg-primary border border-border rounded-lg overflow-hidden",children:[k.jsx(qM,{data:e,onNavigate:s,theme:a}),k.jsx(YM,{})]})]})}const FM=xS([{element:k.jsx(WS,{}),children:[{path:"/",element:k.jsx(wp,{})},{path:"/dashboard",element:k.jsx(wp,{})},{path:"/specs",element:k.jsx(e2,{})},{path:"/specs/:topic",element:k.jsx(kT,{})},{path:"/changes",element:k.jsx(_T,{})},{path:"/changes/:slug",element:k.jsx(TT,{})},{path:"/graph",element:k.jsx(VM,{})}]}]);function XM(){const{setRepoPath:e}=Yn(),r=Y.useMemo(()=>new BS,[]);return Y.useEffect(()=>{e("demo")},[e]),k.jsx(US,{adapter:r,children:k.jsx(RS,{router:FM})})}function GM(){return k.jsx(jS,{children:k.jsx(DS,{children:k.jsx(XM,{})})})}l1.createRoot(document.getElementById("root")).render(k.jsx(Y.StrictMode,{children:k.jsx(GM,{})}))})();
</script>
  </body>
</html>